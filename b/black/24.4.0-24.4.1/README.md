# Comparing `tmp/black-24.4.0.tar.gz` & `tmp/black-24.4.1.tar.gz`

## Comparing `black-24.4.0.tar` & `black-24.4.1.tar`

### file list

```diff
@@ -1,399 +1,401 @@
--rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-24.4.0/.flake8
--rw-r--r--   0        0        0      125 2020-02-02 00:00:00.000000 black-24.4.0/.git_archival.txt
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.4.0/.gitattributes
--rw-r--r--   0        0        0     2332 2020-02-02 00:00:00.000000 black-24.4.0/.pre-commit-config.yaml
--rw-r--r--   0        0        0      681 2020-02-02 00:00:00.000000 black-24.4.0/.pre-commit-hooks.yaml
--rw-r--r--   0        0        0       49 2020-02-02 00:00:00.000000 black-24.4.0/.prettierrc.yaml
--rw-r--r--   0        0        0      221 2020-02-02 00:00:00.000000 black-24.4.0/.readthedocs.yaml
--rw-r--r--   0        0        0    64681 2020-02-02 00:00:00.000000 black-24.4.0/CHANGES.md
--rw-r--r--   0        0        0      933 2020-02-02 00:00:00.000000 black-24.4.0/CITATION.cff
--rw-r--r--   0        0        0      422 2020-02-02 00:00:00.000000 black-24.4.0/CONTRIBUTING.md
--rw-r--r--   0        0        0      718 2020-02-02 00:00:00.000000 black-24.4.0/Dockerfile
--rw-r--r--   0        0        0     9778 2020-02-02 00:00:00.000000 black-24.4.0/README.md
--rw-r--r--   0        0        0      289 2020-02-02 00:00:00.000000 black-24.4.0/SECURITY.md
--rw-r--r--   0        0        0     2391 2020-02-02 00:00:00.000000 black-24.4.0/action.yml
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.0/test_requirements.txt
--rw-r--r--   0        0        0     3148 2020-02-02 00:00:00.000000 black-24.4.0/tox.ini
--rw-r--r--   0        0        0      554 2020-02-02 00:00:00.000000 black-24.4.0/.github/CODE_OF_CONDUCT.md
--rw-r--r--   0        0        0     1536 2020-02-02 00:00:00.000000 black-24.4.0/.github/PULL_REQUEST_TEMPLATE.md
--rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-24.4.0/.github/dependabot.yml
--rw-r--r--   0        0        0     1554 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/bug_report.md
--rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/config.yml
--rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/docs-issue.md
--rw-r--r--   0        0        0      649 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/feature_request.md
--rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-24.4.0/.github/ISSUE_TEMPLATE/style_issue.md
--rw-r--r--   0        0        0      684 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/changelog.yml
--rw-r--r--   0        0        0     5325 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/diff_shades.yml
--rw-r--r--   0        0        0     1534 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/diff_shades_comment.yml
--rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/doc.yml
--rw-r--r--   0        0        0     1889 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/docker.yml
--rw-r--r--   0        0        0     1128 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/fuzz.yml
--rw-r--r--   0        0        0     1359 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/lint.yml
--rw-r--r--   0        0        0     3795 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/pypi_upload.yml
--rw-r--r--   0        0        0     1668 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/release_tests.yml
--rw-r--r--   0        0        0     3176 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/test.yml
--rw-r--r--   0        0        0     1910 2020-02-02 00:00:00.000000 black-24.4.0/.github/workflows/upload_binary.yml
--rw-r--r--   0        0        0     5373 2020-02-02 00:00:00.000000 black-24.4.0/action/main.py
--rw-r--r--   0        0        0     7597 2020-02-02 00:00:00.000000 black-24.4.0/autoload/black.vim
--rw-r--r--   0        0        0      603 2020-02-02 00:00:00.000000 black-24.4.0/docs/Makefile
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.4.0/docs/authors.md
--rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.4.0/docs/change_log.md
--rw-r--r--   0        0        0     6841 2020-02-02 00:00:00.000000 black-24.4.0/docs/conf.py
--rw-r--r--   0        0        0     5708 2020-02-02 00:00:00.000000 black-24.4.0/docs/faq.md
--rw-r--r--   0        0        0     1613 2020-02-02 00:00:00.000000 black-24.4.0/docs/getting_started.md
--rw-r--r--   0        0        0     3662 2020-02-02 00:00:00.000000 black-24.4.0/docs/index.md
--rw-r--r--   0        0        0       62 2020-02-02 00:00:00.000000 black-24.4.0/docs/license.md
--rw-r--r--   0        0        0      773 2020-02-02 00:00:00.000000 black-24.4.0/docs/make.bat
--rw-r--r--   0        0        0      260 2020-02-02 00:00:00.000000 black-24.4.0/docs/requirements.txt
--rw-r--r--   0        0        0      950 2020-02-02 00:00:00.000000 black-24.4.0/docs/_static/license.svg
--rw-r--r--   0        0        0    99591 2020-02-02 00:00:00.000000 black-24.4.0/docs/_static/logo2-readme.png
--rw-r--r--   0        0        0   128768 2020-02-02 00:00:00.000000 black-24.4.0/docs/_static/logo2.png
--rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-24.4.0/docs/_static/pypi_template.svg
--rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/flake8/.flake8
--rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/flake8/setup.cfg
--rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/flake8/tox.ini
--rw-r--r--   0        0        0       23 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/isort/.editorconfig
--rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/isort/.isort.cfg
--rw-r--r--   0        0        0       31 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/isort/pyproject.toml
--rw-r--r--   0        0        0       24 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/isort/setup.cfg
--rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pycodestyle/.flake8
--rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pycodestyle/setup.cfg
--rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pycodestyle/tox.ini
--rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pylint/pylintrc
--rw-r--r--   0        0        0       44 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pylint/pyproject.toml
--rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-24.4.0/docs/compatible_configs/pylint/setup.cfg
--rw-r--r--   0        0        0     2758 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/gauging_changes.md
--rw-r--r--   0        0        0     1318 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/index.md
--rw-r--r--   0        0        0     9266 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/issue_triage.md
--rw-r--r--   0        0        0     8542 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/release_process.md
--rw-r--r--   0        0        0     5051 2020-02-02 00:00:00.000000 black-24.4.0/docs/contributing/the_basics.md
--rw-r--r--   0        0        0      310 2020-02-02 00:00:00.000000 black-24.4.0/docs/guides/index.md
--rw-r--r--   0        0        0     2407 2020-02-02 00:00:00.000000 black-24.4.0/docs/guides/introducing_black_to_your_project.md
--rw-r--r--   0        0        0     7928 2020-02-02 00:00:00.000000 black-24.4.0/docs/guides/using_black_with_other_tools.md
--rw-r--r--   0        0        0    12292 2020-02-02 00:00:00.000000 black-24.4.0/docs/integrations/editors.md
--rw-r--r--   0        0        0     2757 2020-02-02 00:00:00.000000 black-24.4.0/docs/integrations/github_actions.md
--rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-24.4.0/docs/integrations/index.md
--rw-r--r--   0        0        0     1962 2020-02-02 00:00:00.000000 black-24.4.0/docs/integrations/source_version_control.md
--rw-r--r--   0        0        0    20363 2020-02-02 00:00:00.000000 black-24.4.0/docs/the_black_code_style/current_style.md
--rw-r--r--   0        0        0     8309 2020-02-02 00:00:00.000000 black-24.4.0/docs/the_black_code_style/future_style.md
--rw-r--r--   0        0        0     2346 2020-02-02 00:00:00.000000 black-24.4.0/docs/the_black_code_style/index.md
--rw-r--r--   0        0        0     4684 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/black_as_a_server.md
--rw-r--r--   0        0        0     2173 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/black_docker_image.md
--rw-r--r--   0        0        0     1870 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/file_collection_and_discovery.md
--rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/index.md
--rw-r--r--   0        0        0    19326 2020-02-02 00:00:00.000000 black-24.4.0/docs/usage_and_configuration/the_basics.md
--rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 black-24.4.0/gallery/Dockerfile
--rw-r--r--   0        0        0     1595 2020-02-02 00:00:00.000000 black-24.4.0/gallery/README.md
--rwxr-xr-x   0        0        0     9105 2020-02-02 00:00:00.000000 black-24.4.0/gallery/gallery.py
--rw-r--r--   0        0        0     2176 2020-02-02 00:00:00.000000 black-24.4.0/plugin/black.vim
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/scripts/__init__.py
--rw-r--r--   0        0        0     1863 2020-02-02 00:00:00.000000 black-24.4.0/scripts/check_pre_commit_rev_in_example.py
--rw-r--r--   0        0        0     1618 2020-02-02 00:00:00.000000 black-24.4.0/scripts/check_version_in_basics_example.py
--rw-r--r--   0        0        0     8987 2020-02-02 00:00:00.000000 black-24.4.0/scripts/diff_shades_gha_helper.py
--rw-r--r--   0        0        0     3553 2020-02-02 00:00:00.000000 black-24.4.0/scripts/fuzz.py
--rwxr-xr-x   0        0        0     2381 2020-02-02 00:00:00.000000 black-24.4.0/scripts/generate_schema.py
--rw-r--r--   0        0        0     2358 2020-02-02 00:00:00.000000 black-24.4.0/scripts/make_width_table.py
--rwxr-xr-x   0        0        0     2987 2020-02-02 00:00:00.000000 black-24.4.0/scripts/migrate-black.py
--rwxr-xr-x   0        0        0     7496 2020-02-02 00:00:00.000000 black-24.4.0/scripts/release.py
--rw-r--r--   0        0        0     2321 2020-02-02 00:00:00.000000 black-24.4.0/scripts/release_tests.py
--rw-r--r--   0        0        0       19 2020-02-02 00:00:00.000000 black-24.4.0/src/_black_version.py
--rw-r--r--   0        0        0    51975 2020-02-02 00:00:00.000000 black-24.4.0/src/black/__init__.py
--rw-r--r--   0        0        0       47 2020-02-02 00:00:00.000000 black-24.4.0/src/black/__main__.py
--rw-r--r--   0        0        0    10761 2020-02-02 00:00:00.000000 black-24.4.0/src/black/_width_table.py
--rw-r--r--   0        0        0    12426 2020-02-02 00:00:00.000000 black-24.4.0/src/black/brackets.py
--rw-r--r--   0        0        0     4835 2020-02-02 00:00:00.000000 black-24.4.0/src/black/cache.py
--rw-r--r--   0        0        0    15983 2020-02-02 00:00:00.000000 black-24.4.0/src/black/comments.py
--rw-r--r--   0        0        0     6410 2020-02-02 00:00:00.000000 black-24.4.0/src/black/concurrency.py
--rw-r--r--   0        0        0      321 2020-02-02 00:00:00.000000 black-24.4.0/src/black/const.py
--rw-r--r--   0        0        0     1906 2020-02-02 00:00:00.000000 black-24.4.0/src/black/debug.py
--rw-r--r--   0        0        0    14665 2020-02-02 00:00:00.000000 black-24.4.0/src/black/files.py
--rw-r--r--   0        0        0    13364 2020-02-02 00:00:00.000000 black-24.4.0/src/black/handle_ipynb_magics.py
--rw-r--r--   0        0        0    67512 2020-02-02 00:00:00.000000 black-24.4.0/src/black/linegen.py
--rw-r--r--   0        0        0    39349 2020-02-02 00:00:00.000000 black-24.4.0/src/black/lines.py
--rw-r--r--   0        0        0     8500 2020-02-02 00:00:00.000000 black-24.4.0/src/black/mode.py
--rw-r--r--   0        0        0    28915 2020-02-02 00:00:00.000000 black-24.4.0/src/black/nodes.py
--rw-r--r--   0        0        0     1655 2020-02-02 00:00:00.000000 black-24.4.0/src/black/numerics.py
--rw-r--r--   0        0        0     3939 2020-02-02 00:00:00.000000 black-24.4.0/src/black/output.py
--rw-r--r--   0        0        0     8428 2020-02-02 00:00:00.000000 black-24.4.0/src/black/parsing.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/src/black/py.typed
--rw-r--r--   0        0        0    19695 2020-02-02 00:00:00.000000 black-24.4.0/src/black/ranges.py
--rw-r--r--   0        0        0     3452 2020-02-02 00:00:00.000000 black-24.4.0/src/black/report.py
--rw-r--r--   0        0        0      557 2020-02-02 00:00:00.000000 black-24.4.0/src/black/rusty.py
--rw-r--r--   0        0        0      617 2020-02-02 00:00:00.000000 black-24.4.0/src/black/schema.py
--rw-r--r--   0        0        0    10933 2020-02-02 00:00:00.000000 black-24.4.0/src/black/strings.py
--rw-r--r--   0        0        0    95476 2020-02-02 00:00:00.000000 black-24.4.0/src/black/trans.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/src/black/resources/__init__.py
--rw-r--r--   0        0        0     7433 2020-02-02 00:00:00.000000 black-24.4.0/src/black/resources/black.schema.json
--rw-r--r--   0        0        0     8867 2020-02-02 00:00:00.000000 black-24.4.0/src/blackd/__init__.py
--rw-r--r--   0        0        0       37 2020-02-02 00:00:00.000000 black-24.4.0/src/blackd/__main__.py
--rw-r--r--   0        0        0     1585 2020-02-02 00:00:00.000000 black-24.4.0/src/blackd/middlewares.py
--rw-r--r--   0        0        0    11351 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/Grammar.txt
--rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/LICENSE
--rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/PatternGrammar.txt
--rw-r--r--   0        0        0     1074 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/README
--rw-r--r--   0        0        0        8 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/__init__.py
--rw-r--r--   0        0        0     4810 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pygram.py
--rw-r--r--   0        0        0    32666 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pytree.py
--rw-r--r--   0        0        0      143 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/__init__.py
--rw-r--r--   0        0        0     9587 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/conv.py
--rw-r--r--   0        0        0    10631 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/driver.py
--rw-r--r--   0        0        0     6858 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/grammar.py
--rw-r--r--   0        0        0     1614 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/literals.py
--rw-r--r--   0        0        0    15658 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/parse.py
--rw-r--r--   0        0        0    15428 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/pgen.py
--rw-r--r--   0        0        0     1805 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/token.py
--rw-r--r--   0        0        0    23006 2020-02-02 00:00:00.000000 black-24.4.0/src/blib2to3/pgen2/tokenize.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/__init__.py
--rw-r--r--   0        0        0      727 2020-02-02 00:00:00.000000 black-24.4.0/tests/conftest.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.0/tests/empty.toml
--rw-r--r--   0        0        0     4530 2020-02-02 00:00:00.000000 black-24.4.0/tests/optional.py
--rw-r--r--   0        0        0      388 2020-02-02 00:00:00.000000 black-24.4.0/tests/test.toml
--rw-r--r--   0        0        0   118890 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_black.py
--rw-r--r--   0        0        0     9375 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_blackd.py
--rw-r--r--   0        0        0     2531 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_docs.py
--rw-r--r--   0        0        0     2683 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_format.py
--rw-r--r--   0        0        0    16073 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_ipynb.py
--rw-r--r--   0        0        0     1247 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_no_ipynb.py
--rw-r--r--   0        0        0     4538 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_ranges.py
--rw-r--r--   0        0        0      560 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_schema.py
--rw-r--r--   0        0        0     2238 2020-02-02 00:00:00.000000 black-24.4.0/tests/test_trans.py
--rw-r--r--   0        0        0    12198 2020-02-02 00:00:00.000000 black-24.4.0/tests/util.py
--rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/empty_pyproject.toml
--rw-r--r--   0        0        0       88 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/incorrect_spelling.toml
--rw-r--r--   0        0        0       33 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_line_ranges.toml
--rw-r--r--   0        0        0     1794 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/allow_empty_first_line.py
--rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/async_stmts.py
--rw-r--r--   0        0        0      907 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/attribute_access_on_number_literals.py
--rw-r--r--   0        0        0       63 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/beginning_backslash.py
--rw-r--r--   0        0        0      333 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/bracketmatch.py
--rw-r--r--   0        0        0      511 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/bytes_docstring.py
--rw-r--r--   0        0        0     1092 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/class_blank_parentheses.py
--rw-r--r--   0        0        0     4318 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/class_methods_new_line.py
--rw-r--r--   0        0        0     3294 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/collections.py
--rw-r--r--   0        0        0      212 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comment_after_escaped_newline.py
--rw-r--r--   0        0        0      174 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comment_type_hint.py
--rw-r--r--   0        0        0     1909 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments.py
--rw-r--r--   0        0        0     7640 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments2.py
--rw-r--r--   0        0        0     1573 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments3.py
--rw-r--r--   0        0        0     3532 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments4.py
--rw-r--r--   0        0        0     1184 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments5.py
--rw-r--r--   0        0        0     2479 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments6.py
--rw-r--r--   0        0        0      298 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments8.py
--rw-r--r--   0        0        0     5279 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments9.py
--rw-r--r--   0        0        0     2150 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments_in_blocks.py
--rw-r--r--   0        0        0     1142 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments_in_double_parens.py
--rw-r--r--   0        0        0      994 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/comments_non_breaking_space.py
--rw-r--r--   0        0        0     5596 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/composition.py
--rw-r--r--   0        0        0    11196 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/composition_no_trailing_comma.py
--rw-r--r--   0        0        0     4910 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/conditional_expression.py
--rw-r--r--   0        0        0     1171 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_38.py
--rw-r--r--   0        0        0     3392 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_39.py
--rw-r--r--   0        0        0      627 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_autodetect_310.py
--rw-r--r--   0        0        0      585 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_autodetect_311.py
--rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_autodetect_38.py
--rw-r--r--   0        0        0      654 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/context_managers_autodetect_39.py
--rw-r--r--   0        0        0     7978 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring.py
--rw-r--r--   0        0        0      118 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring_newline_preview.py
--rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring_no_extra_empty_line_before_eof.py
--rw-r--r--   0        0        0     3638 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring_no_string_normalization.py
--rw-r--r--   0        0        0     3518 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/docstring_preview.py
--rw-r--r--   0        0        0     2247 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/dummy_implementations.py
--rw-r--r--   0        0        0     4597 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/empty_lines.py
--rw-r--r--   0        0        0    15801 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/expression.diff
--rw-r--r--   0        0        0    18624 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/expression.py
--rw-r--r--   0        0        0      234 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/f_docstring.py
--rw-r--r--   0        0        0     9635 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff.py
--rw-r--r--   0        0        0      604 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff2.py
--rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff3.py
--rw-r--r--   0        0        0      278 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff4.py
--rw-r--r--   0        0        0     3619 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtonoff5.py
--rw-r--r--   0        0        0      277 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtpass_imports.py
--rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip.py
--rw-r--r--   0        0        0      708 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip2.py
--rw-r--r--   0        0        0      362 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip3.py
--rw-r--r--   0        0        0       92 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip4.py
--rw-r--r--   0        0        0      301 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip5.py
--rw-r--r--   0        0        0      235 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip6.py
--rw-r--r--   0        0        0      356 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip7.py
--rw-r--r--   0        0        0     1705 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip8.py
--rw-r--r--   0        0        0      113 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fmtskip9.py
--rw-r--r--   0        0        0     1932 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/form_feeds.py
--rw-r--r--   0        0        0      989 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/fstring.py
--rw-r--r--   0        0        0     5786 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/funcdef_return_type_trailing_comma.py
--rw-r--r--   0        0        0     6408 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/function.py
--rw-r--r--   0        0        0     2419 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/function2.py
--rw-r--r--   0        0        0     3605 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/function_trailing_comma.py
--rw-r--r--   0        0        0      520 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/ignore_pyi.py
--rw-r--r--   0        0        0     2542 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/import_spacing.py
--rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/is_simple_lookup_for_doublestar_expression.py
--rw-r--r--   0        0        0      547 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/keep_newline_after_match.py
--rw-r--r--   0        0        0     3519 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_basic.py
--rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_diff_edge_case.py
--rw-r--r--   0        0        0     1276 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_exceeding_end.py
--rw-r--r--   0        0        0     1373 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_fmt_off.py
--rw-r--r--   0        0        0      998 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_fmt_off_decorator.py
--rw-r--r--   0        0        0     1155 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_fmt_off_overlap.py
--rw-r--r--   0        0        0      346 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_imports.py
--rw-r--r--   0        0        0      633 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_indentation.py
--rw-r--r--   0        0        0      619 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_outside_source.py
--rw-r--r--   0        0        0     1065 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_two_passes.py
--rw-r--r--   0        0        0      591 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/line_ranges_unwrapping.py
--rw-r--r--   0        0        0      126 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/linelength6.py
--rw-r--r--   0        0        0    11608 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/long_strings_flag_disabled.py
--rw-r--r--   0        0        0      329 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_1.py
--rw-r--r--   0        0        0     2252 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_2.py
--rw-r--r--   0        0        0      181 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_3.py
--rw-r--r--   0        0        0      182 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_4.py
--rw-r--r--   0        0        0      180 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_followed_by_class.py
--rw-r--r--   0        0        0      196 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/module_docstring_followed_by_function.py
--rw-r--r--   0        0        0      644 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/multiline_consecutive_open_parentheses_ignore.py
--rw-r--r--   0        0        0     1243 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/nested_stub.py
--rw-r--r--   0        0        0      988 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/no_blank_line_before_docstring.py
--rw-r--r--   0        0        0      544 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/numeric_literals.py
--rw-r--r--   0        0        0      215 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/numeric_literals_skip_underscores.py
--rw-r--r--   0        0        0      674 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/one_element_subscript.py
--rw-r--r--   0        0        0      797 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/parenthesized_context_managers.py
--rw-r--r--   0        0        0     2965 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_complex.py
--rw-r--r--   0        0        0     1796 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_extras.py
--rw-r--r--   0        0        0     3098 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_generic.py
--rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_long.py
--rw-r--r--   0        0        0     2673 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_simple.py
--rw-r--r--   0        0        0     1093 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_style.py
--rw-r--r--   0        0        0      547 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_trailing_comma.py
--rw-r--r--   0        0        0     2190 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pattern_matching_with_if_stmt.py
--rw-r--r--   0        0        0     4689 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep604_union_types_line_breaks.py
--rw-r--r--   0        0        0      711 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_570.py
--rw-r--r--   0        0        0     1001 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572.py
--rw-r--r--   0        0        0      514 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_do_not_remove_parens.py
--rw-r--r--   0        0        0      531 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_py310.py
--rw-r--r--   0        0        0      282 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_py39.py
--rw-r--r--   0        0        0     1919 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_remove_parens.py
--rw-r--r--   0        0        0       60 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_572_slices.py
--rw-r--r--   0        0        0      583 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_604.py
--rw-r--r--   0        0        0     2146 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_646.py
--rw-r--r--   0        0        0     1004 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_654.py
--rw-r--r--   0        0        0     2065 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/pep_654_style.py
--rw-r--r--   0        0        0      485 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/percent_precedence.py
--rw-r--r--   0        0        0       94 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/power_op_newline.py
--rw-r--r--   0        0        0     3533 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/power_op_spacing.py
--rw-r--r--   0        0        0     2500 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/power_op_spacing_long.py
--rw-r--r--   0        0        0     3270 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/prefer_rhs_split.py
--rw-r--r--   0        0        0     1106 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/prefer_rhs_split_reformatted.py
--rw-r--r--   0        0        0     3328 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_cantfit.py
--rw-r--r--   0        0        0      829 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_cantfit_string.py
--rw-r--r--   0        0        0     8996 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_comments7.py
--rw-r--r--   0        0        0      632 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_format_unicode_escape_seq.py
--rw-r--r--   0        0        0     5823 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets.py
--rw-r--r--   0        0        0     4093 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets_no_ll1.py
--rw-r--r--   0        0        0     3982 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_dict_values.py
--rw-r--r--   0        0        0    36538 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings.py
--rw-r--r--   0        0        0     1439 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings__east_asian_width.py
--rw-r--r--   0        0        0     6556 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings__edge_case.py
--rw-r--r--   0        0        0    45834 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings__regression.py
--rw-r--r--   0        0        0     1094 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_long_strings__type_annotations.py
--rw-r--r--   0        0        0     7861 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_multiline_strings.py
--rw-r--r--   0        0        0      742 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/preview_return_annotation_brackets_string.py
--rw-r--r--   0        0        0      173 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/py310_pep572.py
--rw-r--r--   0        0        0     1178 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/python37.py
--rw-r--r--   0        0        0      813 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/python38.py
--rw-r--r--   0        0        0      662 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/python39.py
--rw-r--r--   0        0        0      292 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/raw_docstring.py
--rw-r--r--   0        0        0      394 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/raw_docstring_no_string_normalization.py
--rw-r--r--   0        0        0     3538 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_await_parens.py
--rw-r--r--   0        0        0     2025 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_except_parens.py
--rw-r--r--   0        0        0     1460 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_for_brackets.py
--rw-r--r--   0        0        0     3218 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_newline_after_code_block_open.py
--rw-r--r--   0        0        0     3493 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_parens.py
--rw-r--r--   0        0        0     1496 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_redundant_parens_in_case_guard.py
--rw-r--r--   0        0        0     2606 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/remove_with_brackets.py
--rw-r--r--   0        0        0     5207 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/return_annotation_brackets.py
--rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/single_line_format_skip_with_multiple_comments.py
--rw-r--r--   0        0        0     1435 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/skip_magic_trailing_comma.py
--rw-r--r--   0        0        0      787 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/slices.py
--rw-r--r--   0        0        0      817 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/split_delimiter_comments.py
--rw-r--r--   0        0        0      412 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/starred_for_target.py
--rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/string_prefixes.py
--rw-r--r--   0        0        0     2281 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/stub.py
--rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/torture.py
--rw-r--r--   0        0        0      655 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_comma.py
--rw-r--r--   0        0        0     1615 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_comma_optional_parens1.py
--rw-r--r--   0        0        0      248 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_comma_optional_parens2.py
--rw-r--r--   0        0        0      967 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_comma_optional_parens3.py
--rw-r--r--   0        0        0     2123 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/trailing_commas_in_leading_parts.py
--rw-r--r--   0        0        0       80 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/tricky_unicode_symbols.py
--rw-r--r--   0        0        0      510 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/tupleassign.py
--rw-r--r--   0        0        0      458 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/type_aliases.py
--rw-r--r--   0        0        0       93 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/type_comment_syntax_error.py
--rw-r--r--   0        0        0     1144 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/type_params.py
--rw-r--r--   0        0        0      544 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/typed_params_trailing_comma.py
--rw-r--r--   0        0        0      269 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/walrus_in_dict.py
--rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/cases/whitespace.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/dir1/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/dir1/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/dir2/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/gitignore_used_on_multiple_sources/dir2/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/ignore_subfolders_gitignore_tests/a.py
--rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/ignore_subfolders_gitignore_tests/subdir/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/ignore_subfolders_gitignore_tests/subdir/b.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/ignore_subfolders_gitignore_tests/subdir/subdir/c.py
--rw-r--r--   0        0        0       14 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/.gitignore
--rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/dont_exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/dont_exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/exclude/a.pie
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/exclude/a.py
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/include_exclude_tests/b/exclude/a.pyi
--rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_gitignore_tests/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_gitignore_tests/a.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_nested_gitignore_tests/a.py
--rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_nested_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_nested_gitignore_tests/a/.gitignore
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/invalid_nested_gitignore_tests/a/a.py
--rw-r--r--   0        0        0      436 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/non_python_notebook.ipynb
--rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_empty_metadata.ipynb
--rw-r--r--   0        0        0      638 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb
--rw-r--r--   0        0        0      639 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_trailing_newline.ipynb
--rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
--rw-r--r--   0        0        0      762 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/jupyter/notebook_without_changes.ipynb
--rw-r--r--   0        0        0      853 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/line_ranges_formatted/basic.py
--rw-r--r--   0        0        0      537 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/line_ranges_formatted/pattern_matching.py
--rw-r--r--   0        0        0      495 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/async_as_identifier.py
--rw-r--r--   0        0        0      255 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/blackd_diff.diff
--rw-r--r--   0        0        0       98 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/blackd_diff.py
--rw-r--r--   0        0        0    15604 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/debug_visitor.out
--rw-r--r--   0        0        0     1193 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/debug_visitor.py
--rw-r--r--   0        0        0     1774 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/decorators.py
--rw-r--r--   0        0        0    15711 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
--rw-r--r--   0        0        0      600 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/force_py36.py
--rw-r--r--   0        0        0      808 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/force_pyi.py
--rw-r--r--   0        0        0       59 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/invalid_header.py
--rw-r--r--   0        0        0      293 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/missing_final_newline.diff
--rw-r--r--   0        0        0      145 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/missing_final_newline.py
--rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/pattern_matching_invalid.py
--rw-r--r--   0        0        0      758 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/python2_detection.py
--rw-r--r--   0        0        0     2363 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/miscellaneous/string_quotes.py
--rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/pyproject.toml
--rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/x.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/.gitignore
--rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/a.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/b.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/c.py
--rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/child/.gitignore
--rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/child/a.py
--rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/child/b.py
--rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/nested_gitignore_tests/root/child/c.py
--rw-r--r--   0        0        0      132 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/project_metadata/both_pyproject.toml
--rw-r--r--   0        0        0       73 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/project_metadata/neither_pyproject.toml
--rw-r--r--   0        0        0      100 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/project_metadata/only_black_pyproject.toml
--rw-r--r--   0        0        0      105 2020-02-02 00:00:00.000000 black-24.4.0/tests/data/project_metadata/only_metadata_pyproject.toml
--rw-r--r--   0        0        0      302 2020-02-02 00:00:00.000000 black-24.4.0/.gitignore
--rw-r--r--   0        0        0     8092 2020-02-02 00:00:00.000000 black-24.4.0/AUTHORS.md
--rw-r--r--   0        0        0     1080 2020-02-02 00:00:00.000000 black-24.4.0/LICENSE
--rw-r--r--   0        0        0     8736 2020-02-02 00:00:00.000000 black-24.4.0/pyproject.toml
--rw-r--r--   0        0        0    76430 2020-02-02 00:00:00.000000 black-24.4.0/PKG-INFO
+-rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-24.4.1/.flake8
+-rw-r--r--   0        0        0      125 2020-02-02 00:00:00.000000 black-24.4.1/.git_archival.txt
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.4.1/.gitattributes
+-rw-r--r--   0        0        0     2340 2020-02-02 00:00:00.000000 black-24.4.1/.pre-commit-config.yaml
+-rw-r--r--   0        0        0      681 2020-02-02 00:00:00.000000 black-24.4.1/.pre-commit-hooks.yaml
+-rw-r--r--   0        0        0       49 2020-02-02 00:00:00.000000 black-24.4.1/.prettierrc.yaml
+-rw-r--r--   0        0        0      221 2020-02-02 00:00:00.000000 black-24.4.1/.readthedocs.yaml
+-rw-r--r--   0        0        0    65097 2020-02-02 00:00:00.000000 black-24.4.1/CHANGES.md
+-rw-r--r--   0        0        0      933 2020-02-02 00:00:00.000000 black-24.4.1/CITATION.cff
+-rw-r--r--   0        0        0      422 2020-02-02 00:00:00.000000 black-24.4.1/CONTRIBUTING.md
+-rw-r--r--   0        0        0      718 2020-02-02 00:00:00.000000 black-24.4.1/Dockerfile
+-rw-r--r--   0        0        0     9778 2020-02-02 00:00:00.000000 black-24.4.1/README.md
+-rw-r--r--   0        0        0      289 2020-02-02 00:00:00.000000 black-24.4.1/SECURITY.md
+-rw-r--r--   0        0        0     2391 2020-02-02 00:00:00.000000 black-24.4.1/action.yml
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.1/test_requirements.txt
+-rw-r--r--   0        0        0     3148 2020-02-02 00:00:00.000000 black-24.4.1/tox.ini
+-rw-r--r--   0        0        0      554 2020-02-02 00:00:00.000000 black-24.4.1/.github/CODE_OF_CONDUCT.md
+-rw-r--r--   0        0        0     1536 2020-02-02 00:00:00.000000 black-24.4.1/.github/PULL_REQUEST_TEMPLATE.md
+-rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-24.4.1/.github/dependabot.yml
+-rw-r--r--   0        0        0     1554 2020-02-02 00:00:00.000000 black-24.4.1/.github/ISSUE_TEMPLATE/bug_report.md
+-rw-r--r--   0        0        0      545 2020-02-02 00:00:00.000000 black-24.4.1/.github/ISSUE_TEMPLATE/config.yml
+-rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-24.4.1/.github/ISSUE_TEMPLATE/docs-issue.md
+-rw-r--r--   0        0        0      649 2020-02-02 00:00:00.000000 black-24.4.1/.github/ISSUE_TEMPLATE/feature_request.md
+-rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-24.4.1/.github/ISSUE_TEMPLATE/style_issue.md
+-rw-r--r--   0        0        0      684 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/changelog.yml
+-rw-r--r--   0        0        0     5325 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/diff_shades.yml
+-rw-r--r--   0        0        0     1534 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/diff_shades_comment.yml
+-rw-r--r--   0        0        0     1054 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/doc.yml
+-rw-r--r--   0        0        0     1889 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/docker.yml
+-rw-r--r--   0        0        0     1128 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/fuzz.yml
+-rw-r--r--   0        0        0     1359 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/lint.yml
+-rw-r--r--   0        0        0     3795 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/pypi_upload.yml
+-rw-r--r--   0        0        0     1668 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/release_tests.yml
+-rw-r--r--   0        0        0     3176 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/test.yml
+-rw-r--r--   0        0        0     1910 2020-02-02 00:00:00.000000 black-24.4.1/.github/workflows/upload_binary.yml
+-rw-r--r--   0        0        0     5580 2020-02-02 00:00:00.000000 black-24.4.1/action/main.py
+-rw-r--r--   0        0        0     7597 2020-02-02 00:00:00.000000 black-24.4.1/autoload/black.vim
+-rw-r--r--   0        0        0      603 2020-02-02 00:00:00.000000 black-24.4.1/docs/Makefile
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.4.1/docs/authors.md
+-rw-r--r--   0        0        0       32 2020-02-02 00:00:00.000000 black-24.4.1/docs/change_log.md
+-rw-r--r--   0        0        0     6841 2020-02-02 00:00:00.000000 black-24.4.1/docs/conf.py
+-rw-r--r--   0        0        0     5708 2020-02-02 00:00:00.000000 black-24.4.1/docs/faq.md
+-rw-r--r--   0        0        0     1680 2020-02-02 00:00:00.000000 black-24.4.1/docs/getting_started.md
+-rw-r--r--   0        0        0     3662 2020-02-02 00:00:00.000000 black-24.4.1/docs/index.md
+-rw-r--r--   0        0        0       62 2020-02-02 00:00:00.000000 black-24.4.1/docs/license.md
+-rw-r--r--   0        0        0      773 2020-02-02 00:00:00.000000 black-24.4.1/docs/make.bat
+-rw-r--r--   0        0        0      260 2020-02-02 00:00:00.000000 black-24.4.1/docs/requirements.txt
+-rw-r--r--   0        0        0      950 2020-02-02 00:00:00.000000 black-24.4.1/docs/_static/license.svg
+-rw-r--r--   0        0        0    99591 2020-02-02 00:00:00.000000 black-24.4.1/docs/_static/logo2-readme.png
+-rw-r--r--   0        0        0   128768 2020-02-02 00:00:00.000000 black-24.4.1/docs/_static/logo2.png
+-rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-24.4.1/docs/_static/pypi_template.svg
+-rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/flake8/.flake8
+-rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/flake8/setup.cfg
+-rw-r--r--   0        0        0       56 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/flake8/tox.ini
+-rw-r--r--   0        0        0       23 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/isort/.editorconfig
+-rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/isort/.isort.cfg
+-rw-r--r--   0        0        0       31 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/isort/pyproject.toml
+-rw-r--r--   0        0        0       24 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/isort/setup.cfg
+-rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/pycodestyle/.flake8
+-rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/pycodestyle/setup.cfg
+-rw-r--r--   0        0        0       54 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/pycodestyle/tox.ini
+-rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/pylint/pylintrc
+-rw-r--r--   0        0        0       44 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/pylint/pyproject.toml
+-rw-r--r--   0        0        0       30 2020-02-02 00:00:00.000000 black-24.4.1/docs/compatible_configs/pylint/setup.cfg
+-rw-r--r--   0        0        0     2758 2020-02-02 00:00:00.000000 black-24.4.1/docs/contributing/gauging_changes.md
+-rw-r--r--   0        0        0     1318 2020-02-02 00:00:00.000000 black-24.4.1/docs/contributing/index.md
+-rw-r--r--   0        0        0     9266 2020-02-02 00:00:00.000000 black-24.4.1/docs/contributing/issue_triage.md
+-rw-r--r--   0        0        0     8542 2020-02-02 00:00:00.000000 black-24.4.1/docs/contributing/release_process.md
+-rw-r--r--   0        0        0     5051 2020-02-02 00:00:00.000000 black-24.4.1/docs/contributing/the_basics.md
+-rw-r--r--   0        0        0      310 2020-02-02 00:00:00.000000 black-24.4.1/docs/guides/index.md
+-rw-r--r--   0        0        0     2407 2020-02-02 00:00:00.000000 black-24.4.1/docs/guides/introducing_black_to_your_project.md
+-rw-r--r--   0        0        0     7928 2020-02-02 00:00:00.000000 black-24.4.1/docs/guides/using_black_with_other_tools.md
+-rw-r--r--   0        0        0    12292 2020-02-02 00:00:00.000000 black-24.4.1/docs/integrations/editors.md
+-rw-r--r--   0        0        0     2757 2020-02-02 00:00:00.000000 black-24.4.1/docs/integrations/github_actions.md
+-rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-24.4.1/docs/integrations/index.md
+-rw-r--r--   0        0        0     1962 2020-02-02 00:00:00.000000 black-24.4.1/docs/integrations/source_version_control.md
+-rw-r--r--   0        0        0    20363 2020-02-02 00:00:00.000000 black-24.4.1/docs/the_black_code_style/current_style.md
+-rw-r--r--   0        0        0     8309 2020-02-02 00:00:00.000000 black-24.4.1/docs/the_black_code_style/future_style.md
+-rw-r--r--   0        0        0     2346 2020-02-02 00:00:00.000000 black-24.4.1/docs/the_black_code_style/index.md
+-rw-r--r--   0        0        0     4684 2020-02-02 00:00:00.000000 black-24.4.1/docs/usage_and_configuration/black_as_a_server.md
+-rw-r--r--   0        0        0     2173 2020-02-02 00:00:00.000000 black-24.4.1/docs/usage_and_configuration/black_docker_image.md
+-rw-r--r--   0        0        0     1870 2020-02-02 00:00:00.000000 black-24.4.1/docs/usage_and_configuration/file_collection_and_discovery.md
+-rw-r--r--   0        0        0      969 2020-02-02 00:00:00.000000 black-24.4.1/docs/usage_and_configuration/index.md
+-rw-r--r--   0        0        0    19326 2020-02-02 00:00:00.000000 black-24.4.1/docs/usage_and_configuration/the_basics.md
+-rw-r--r--   0        0        0      342 2020-02-02 00:00:00.000000 black-24.4.1/gallery/Dockerfile
+-rw-r--r--   0        0        0     1595 2020-02-02 00:00:00.000000 black-24.4.1/gallery/README.md
+-rwxr-xr-x   0        0        0     9105 2020-02-02 00:00:00.000000 black-24.4.1/gallery/gallery.py
+-rw-r--r--   0        0        0     2176 2020-02-02 00:00:00.000000 black-24.4.1/plugin/black.vim
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/scripts/__init__.py
+-rw-r--r--   0        0        0     1863 2020-02-02 00:00:00.000000 black-24.4.1/scripts/check_pre_commit_rev_in_example.py
+-rw-r--r--   0        0        0     1618 2020-02-02 00:00:00.000000 black-24.4.1/scripts/check_version_in_basics_example.py
+-rw-r--r--   0        0        0     8987 2020-02-02 00:00:00.000000 black-24.4.1/scripts/diff_shades_gha_helper.py
+-rw-r--r--   0        0        0     3553 2020-02-02 00:00:00.000000 black-24.4.1/scripts/fuzz.py
+-rwxr-xr-x   0        0        0     2381 2020-02-02 00:00:00.000000 black-24.4.1/scripts/generate_schema.py
+-rw-r--r--   0        0        0     2358 2020-02-02 00:00:00.000000 black-24.4.1/scripts/make_width_table.py
+-rwxr-xr-x   0        0        0     2987 2020-02-02 00:00:00.000000 black-24.4.1/scripts/migrate-black.py
+-rwxr-xr-x   0        0        0     7496 2020-02-02 00:00:00.000000 black-24.4.1/scripts/release.py
+-rw-r--r--   0        0        0     2321 2020-02-02 00:00:00.000000 black-24.4.1/scripts/release_tests.py
+-rw-r--r--   0        0        0       19 2020-02-02 00:00:00.000000 black-24.4.1/src/_black_version.py
+-rw-r--r--   0        0        0    51931 2020-02-02 00:00:00.000000 black-24.4.1/src/black/__init__.py
+-rw-r--r--   0        0        0       47 2020-02-02 00:00:00.000000 black-24.4.1/src/black/__main__.py
+-rw-r--r--   0        0        0    10761 2020-02-02 00:00:00.000000 black-24.4.1/src/black/_width_table.py
+-rw-r--r--   0        0        0    12426 2020-02-02 00:00:00.000000 black-24.4.1/src/black/brackets.py
+-rw-r--r--   0        0        0     4835 2020-02-02 00:00:00.000000 black-24.4.1/src/black/cache.py
+-rw-r--r--   0        0        0    15983 2020-02-02 00:00:00.000000 black-24.4.1/src/black/comments.py
+-rw-r--r--   0        0        0     6410 2020-02-02 00:00:00.000000 black-24.4.1/src/black/concurrency.py
+-rw-r--r--   0        0        0      321 2020-02-02 00:00:00.000000 black-24.4.1/src/black/const.py
+-rw-r--r--   0        0        0     1906 2020-02-02 00:00:00.000000 black-24.4.1/src/black/debug.py
+-rw-r--r--   0        0        0    14665 2020-02-02 00:00:00.000000 black-24.4.1/src/black/files.py
+-rw-r--r--   0        0        0    13364 2020-02-02 00:00:00.000000 black-24.4.1/src/black/handle_ipynb_magics.py
+-rw-r--r--   0        0        0    68966 2020-02-02 00:00:00.000000 black-24.4.1/src/black/linegen.py
+-rw-r--r--   0        0        0    39492 2020-02-02 00:00:00.000000 black-24.4.1/src/black/lines.py
+-rw-r--r--   0        0        0     9313 2020-02-02 00:00:00.000000 black-24.4.1/src/black/mode.py
+-rw-r--r--   0        0        0    29742 2020-02-02 00:00:00.000000 black-24.4.1/src/black/nodes.py
+-rw-r--r--   0        0        0     1655 2020-02-02 00:00:00.000000 black-24.4.1/src/black/numerics.py
+-rw-r--r--   0        0        0     3939 2020-02-02 00:00:00.000000 black-24.4.1/src/black/output.py
+-rw-r--r--   0        0        0     8428 2020-02-02 00:00:00.000000 black-24.4.1/src/black/parsing.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/src/black/py.typed
+-rw-r--r--   0        0        0    19695 2020-02-02 00:00:00.000000 black-24.4.1/src/black/ranges.py
+-rw-r--r--   0        0        0     3452 2020-02-02 00:00:00.000000 black-24.4.1/src/black/report.py
+-rw-r--r--   0        0        0      557 2020-02-02 00:00:00.000000 black-24.4.1/src/black/rusty.py
+-rw-r--r--   0        0        0      617 2020-02-02 00:00:00.000000 black-24.4.1/src/black/schema.py
+-rw-r--r--   0        0        0    13172 2020-02-02 00:00:00.000000 black-24.4.1/src/black/strings.py
+-rw-r--r--   0        0        0    95476 2020-02-02 00:00:00.000000 black-24.4.1/src/black/trans.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/src/black/resources/__init__.py
+-rw-r--r--   0        0        0     7452 2020-02-02 00:00:00.000000 black-24.4.1/src/black/resources/black.schema.json
+-rw-r--r--   0        0        0     8867 2020-02-02 00:00:00.000000 black-24.4.1/src/blackd/__init__.py
+-rw-r--r--   0        0        0       37 2020-02-02 00:00:00.000000 black-24.4.1/src/blackd/__main__.py
+-rw-r--r--   0        0        0     1585 2020-02-02 00:00:00.000000 black-24.4.1/src/blackd/middlewares.py
+-rw-r--r--   0        0        0    11700 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/Grammar.txt
+-rw-r--r--   0        0        0    12762 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/LICENSE
+-rw-r--r--   0        0        0      793 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/PatternGrammar.txt
+-rw-r--r--   0        0        0     1074 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/README
+-rw-r--r--   0        0        0        8 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/__init__.py
+-rw-r--r--   0        0        0     4915 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pygram.py
+-rw-r--r--   0        0        0    32666 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pytree.py
+-rw-r--r--   0        0        0      143 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pgen2/__init__.py
+-rw-r--r--   0        0        0     9587 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pgen2/conv.py
+-rw-r--r--   0        0        0    10832 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pgen2/driver.py
+-rw-r--r--   0        0        0     6865 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pgen2/grammar.py
+-rw-r--r--   0        0        0     1614 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pgen2/literals.py
+-rw-r--r--   0        0        0    15658 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pgen2/parse.py
+-rw-r--r--   0        0        0    15428 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pgen2/pgen.py
+-rw-r--r--   0        0        0     1899 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pgen2/token.py
+-rw-r--r--   0        0        0    38870 2020-02-02 00:00:00.000000 black-24.4.1/src/blib2to3/pgen2/tokenize.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/__init__.py
+-rw-r--r--   0        0        0      727 2020-02-02 00:00:00.000000 black-24.4.1/tests/conftest.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.1/tests/empty.toml
+-rw-r--r--   0        0        0     4530 2020-02-02 00:00:00.000000 black-24.4.1/tests/optional.py
+-rw-r--r--   0        0        0      388 2020-02-02 00:00:00.000000 black-24.4.1/tests/test.toml
+-rw-r--r--   0        0        0   119889 2020-02-02 00:00:00.000000 black-24.4.1/tests/test_black.py
+-rw-r--r--   0        0        0     9375 2020-02-02 00:00:00.000000 black-24.4.1/tests/test_blackd.py
+-rw-r--r--   0        0        0     2531 2020-02-02 00:00:00.000000 black-24.4.1/tests/test_docs.py
+-rw-r--r--   0        0        0     2683 2020-02-02 00:00:00.000000 black-24.4.1/tests/test_format.py
+-rw-r--r--   0        0        0    16073 2020-02-02 00:00:00.000000 black-24.4.1/tests/test_ipynb.py
+-rw-r--r--   0        0        0     1247 2020-02-02 00:00:00.000000 black-24.4.1/tests/test_no_ipynb.py
+-rw-r--r--   0        0        0     4538 2020-02-02 00:00:00.000000 black-24.4.1/tests/test_ranges.py
+-rw-r--r--   0        0        0      560 2020-02-02 00:00:00.000000 black-24.4.1/tests/test_schema.py
+-rw-r--r--   0        0        0     2238 2020-02-02 00:00:00.000000 black-24.4.1/tests/test_trans.py
+-rw-r--r--   0        0        0    12198 2020-02-02 00:00:00.000000 black-24.4.1/tests/util.py
+-rw-r--r--   0        0        0       99 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/empty_pyproject.toml
+-rw-r--r--   0        0        0       88 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/incorrect_spelling.toml
+-rw-r--r--   0        0        0       33 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/invalid_line_ranges.toml
+-rw-r--r--   0        0        0     1794 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/allow_empty_first_line.py
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/async_stmts.py
+-rw-r--r--   0        0        0      907 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/attribute_access_on_number_literals.py
+-rw-r--r--   0        0        0       63 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/beginning_backslash.py
+-rw-r--r--   0        0        0      333 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/bracketmatch.py
+-rw-r--r--   0        0        0      511 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/bytes_docstring.py
+-rw-r--r--   0        0        0     1092 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/class_blank_parentheses.py
+-rw-r--r--   0        0        0     4318 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/class_methods_new_line.py
+-rw-r--r--   0        0        0     3294 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/collections.py
+-rw-r--r--   0        0        0      212 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comment_after_escaped_newline.py
+-rw-r--r--   0        0        0      174 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comment_type_hint.py
+-rw-r--r--   0        0        0     1909 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments.py
+-rw-r--r--   0        0        0     7640 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments2.py
+-rw-r--r--   0        0        0     1573 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments3.py
+-rw-r--r--   0        0        0     3532 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments4.py
+-rw-r--r--   0        0        0     1184 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments5.py
+-rw-r--r--   0        0        0     2479 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments6.py
+-rw-r--r--   0        0        0      298 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments8.py
+-rw-r--r--   0        0        0     5279 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments9.py
+-rw-r--r--   0        0        0     2150 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments_in_blocks.py
+-rw-r--r--   0        0        0     1142 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments_in_double_parens.py
+-rw-r--r--   0        0        0      994 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/comments_non_breaking_space.py
+-rw-r--r--   0        0        0     5596 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/composition.py
+-rw-r--r--   0        0        0    11196 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/composition_no_trailing_comma.py
+-rw-r--r--   0        0        0     4910 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/conditional_expression.py
+-rw-r--r--   0        0        0     1171 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/context_managers_38.py
+-rw-r--r--   0        0        0     3392 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/context_managers_39.py
+-rw-r--r--   0        0        0      627 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/context_managers_autodetect_310.py
+-rw-r--r--   0        0        0      585 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/context_managers_autodetect_311.py
+-rw-r--r--   0        0        0     1058 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/context_managers_autodetect_38.py
+-rw-r--r--   0        0        0      654 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/context_managers_autodetect_39.py
+-rw-r--r--   0        0        0     7978 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/docstring.py
+-rw-r--r--   0        0        0      118 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/docstring_newline_preview.py
+-rw-r--r--   0        0        0      140 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/docstring_no_extra_empty_line_before_eof.py
+-rw-r--r--   0        0        0     3638 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/docstring_no_string_normalization.py
+-rw-r--r--   0        0        0     3518 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/docstring_preview.py
+-rw-r--r--   0        0        0     3384 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/dummy_implementations.py
+-rw-r--r--   0        0        0     4597 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/empty_lines.py
+-rw-r--r--   0        0        0    15801 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/expression.diff
+-rw-r--r--   0        0        0    18624 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/expression.py
+-rw-r--r--   0        0        0      234 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/f_docstring.py
+-rw-r--r--   0        0        0     9635 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtonoff.py
+-rw-r--r--   0        0        0      604 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtonoff2.py
+-rw-r--r--   0        0        0      251 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtonoff3.py
+-rw-r--r--   0        0        0      278 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtonoff4.py
+-rw-r--r--   0        0        0     3619 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtonoff5.py
+-rw-r--r--   0        0        0      277 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtpass_imports.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtskip.py
+-rw-r--r--   0        0        0      708 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtskip2.py
+-rw-r--r--   0        0        0      362 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtskip3.py
+-rw-r--r--   0        0        0       92 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtskip4.py
+-rw-r--r--   0        0        0      301 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtskip5.py
+-rw-r--r--   0        0        0      235 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtskip6.py
+-rw-r--r--   0        0        0      356 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtskip7.py
+-rw-r--r--   0        0        0     1705 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtskip8.py
+-rw-r--r--   0        0        0      113 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fmtskip9.py
+-rw-r--r--   0        0        0     1932 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/form_feeds.py
+-rw-r--r--   0        0        0      989 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/fstring.py
+-rw-r--r--   0        0        0     5786 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/funcdef_return_type_trailing_comma.py
+-rw-r--r--   0        0        0     6408 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/function.py
+-rw-r--r--   0        0        0     2419 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/function2.py
+-rw-r--r--   0        0        0     3605 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/function_trailing_comma.py
+-rw-r--r--   0        0        0      520 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/ignore_pyi.py
+-rw-r--r--   0        0        0     2542 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/import_spacing.py
+-rw-r--r--   0        0        0      565 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/is_simple_lookup_for_doublestar_expression.py
+-rw-r--r--   0        0        0      547 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/keep_newline_after_match.py
+-rw-r--r--   0        0        0     3519 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_basic.py
+-rw-r--r--   0        0        0      954 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_diff_edge_case.py
+-rw-r--r--   0        0        0     1276 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_exceeding_end.py
+-rw-r--r--   0        0        0     1373 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_fmt_off.py
+-rw-r--r--   0        0        0      998 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_fmt_off_decorator.py
+-rw-r--r--   0        0        0     1155 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_fmt_off_overlap.py
+-rw-r--r--   0        0        0      346 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_imports.py
+-rw-r--r--   0        0        0      633 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_indentation.py
+-rw-r--r--   0        0        0      619 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_outside_source.py
+-rw-r--r--   0        0        0     1065 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_two_passes.py
+-rw-r--r--   0        0        0      591 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/line_ranges_unwrapping.py
+-rw-r--r--   0        0        0      126 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/linelength6.py
+-rw-r--r--   0        0        0    11608 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/long_strings_flag_disabled.py
+-rw-r--r--   0        0        0      329 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/module_docstring_1.py
+-rw-r--r--   0        0        0     2252 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/module_docstring_2.py
+-rw-r--r--   0        0        0      181 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/module_docstring_3.py
+-rw-r--r--   0        0        0      182 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/module_docstring_4.py
+-rw-r--r--   0        0        0      180 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/module_docstring_followed_by_class.py
+-rw-r--r--   0        0        0      196 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/module_docstring_followed_by_function.py
+-rw-r--r--   0        0        0      644 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/multiline_consecutive_open_parentheses_ignore.py
+-rw-r--r--   0        0        0     1243 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/nested_stub.py
+-rw-r--r--   0        0        0      988 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/no_blank_line_before_docstring.py
+-rw-r--r--   0        0        0      544 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/numeric_literals.py
+-rw-r--r--   0        0        0      215 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/numeric_literals_skip_underscores.py
+-rw-r--r--   0        0        0      674 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/one_element_subscript.py
+-rw-r--r--   0        0        0      797 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/parenthesized_context_managers.py
+-rw-r--r--   0        0        0     2965 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pattern_matching_complex.py
+-rw-r--r--   0        0        0     1796 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pattern_matching_extras.py
+-rw-r--r--   0        0        0     3098 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pattern_matching_generic.py
+-rw-r--r--   0        0        0      692 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pattern_matching_long.py
+-rw-r--r--   0        0        0     2673 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pattern_matching_simple.py
+-rw-r--r--   0        0        0     1093 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pattern_matching_style.py
+-rw-r--r--   0        0        0      547 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pattern_matching_trailing_comma.py
+-rw-r--r--   0        0        0     2190 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pattern_matching_with_if_stmt.py
+-rw-r--r--   0        0        0     4689 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep604_union_types_line_breaks.py
+-rw-r--r--   0        0        0      711 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_570.py
+-rw-r--r--   0        0        0     1001 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_572.py
+-rw-r--r--   0        0        0      514 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_572_do_not_remove_parens.py
+-rw-r--r--   0        0        0      531 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_572_py310.py
+-rw-r--r--   0        0        0      282 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_572_py39.py
+-rw-r--r--   0        0        0     1919 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_572_remove_parens.py
+-rw-r--r--   0        0        0       60 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_572_slices.py
+-rw-r--r--   0        0        0      583 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_604.py
+-rw-r--r--   0        0        0     2146 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_646.py
+-rw-r--r--   0        0        0     1004 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_654.py
+-rw-r--r--   0        0        0     2065 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_654_style.py
+-rw-r--r--   0        0        0     4129 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/pep_701.py
+-rw-r--r--   0        0        0      485 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/percent_precedence.py
+-rw-r--r--   0        0        0       94 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/power_op_newline.py
+-rw-r--r--   0        0        0     3533 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/power_op_spacing.py
+-rw-r--r--   0        0        0     2500 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/power_op_spacing_long.py
+-rw-r--r--   0        0        0     3270 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/prefer_rhs_split.py
+-rw-r--r--   0        0        0     1106 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/prefer_rhs_split_reformatted.py
+-rw-r--r--   0        0        0     3328 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_cantfit.py
+-rw-r--r--   0        0        0      829 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_cantfit_string.py
+-rw-r--r--   0        0        0     8996 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_comments7.py
+-rw-r--r--   0        0        0      632 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_format_unicode_escape_seq.py
+-rw-r--r--   0        0        0     5823 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets.py
+-rw-r--r--   0        0        0     4093 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets_no_ll1.py
+-rw-r--r--   0        0        0     3982 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_long_dict_values.py
+-rw-r--r--   0        0        0    36538 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_long_strings.py
+-rw-r--r--   0        0        0     1439 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_long_strings__east_asian_width.py
+-rw-r--r--   0        0        0     6556 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_long_strings__edge_case.py
+-rw-r--r--   0        0        0    45834 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_long_strings__regression.py
+-rw-r--r--   0        0        0     1094 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_long_strings__type_annotations.py
+-rw-r--r--   0        0        0     7861 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_multiline_strings.py
+-rw-r--r--   0        0        0      742 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/preview_return_annotation_brackets_string.py
+-rw-r--r--   0        0        0      173 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/py310_pep572.py
+-rw-r--r--   0        0        0     1178 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/python37.py
+-rw-r--r--   0        0        0      813 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/python38.py
+-rw-r--r--   0        0        0      662 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/python39.py
+-rw-r--r--   0        0        0      292 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/raw_docstring.py
+-rw-r--r--   0        0        0      394 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/raw_docstring_no_string_normalization.py
+-rw-r--r--   0        0        0     3538 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/remove_await_parens.py
+-rw-r--r--   0        0        0     2025 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/remove_except_parens.py
+-rw-r--r--   0        0        0     1460 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/remove_for_brackets.py
+-rw-r--r--   0        0        0     3218 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/remove_newline_after_code_block_open.py
+-rw-r--r--   0        0        0     3493 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/remove_parens.py
+-rw-r--r--   0        0        0     1496 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/remove_redundant_parens_in_case_guard.py
+-rw-r--r--   0        0        0     2606 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/remove_with_brackets.py
+-rw-r--r--   0        0        0     5207 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/return_annotation_brackets.py
+-rw-r--r--   0        0        0      646 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/single_line_format_skip_with_multiple_comments.py
+-rw-r--r--   0        0        0     1435 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/skip_magic_trailing_comma.py
+-rw-r--r--   0        0        0      787 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/slices.py
+-rw-r--r--   0        0        0      817 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/split_delimiter_comments.py
+-rw-r--r--   0        0        0      412 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/starred_for_target.py
+-rw-r--r--   0        0        0      845 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/string_prefixes.py
+-rw-r--r--   0        0        0     2281 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/stub.py
+-rw-r--r--   0        0        0     2279 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/torture.py
+-rw-r--r--   0        0        0      655 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/trailing_comma.py
+-rw-r--r--   0        0        0     1615 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/trailing_comma_optional_parens1.py
+-rw-r--r--   0        0        0      248 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/trailing_comma_optional_parens2.py
+-rw-r--r--   0        0        0      967 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/trailing_comma_optional_parens3.py
+-rw-r--r--   0        0        0     2123 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/trailing_commas_in_leading_parts.py
+-rw-r--r--   0        0        0       80 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/tricky_unicode_symbols.py
+-rw-r--r--   0        0        0      510 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/tupleassign.py
+-rw-r--r--   0        0        0      458 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/type_aliases.py
+-rw-r--r--   0        0        0       93 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/type_comment_syntax_error.py
+-rw-r--r--   0        0        0     1542 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/type_param_defaults.py
+-rw-r--r--   0        0        0     1144 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/type_params.py
+-rw-r--r--   0        0        0      544 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/typed_params_trailing_comma.py
+-rw-r--r--   0        0        0      269 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/walrus_in_dict.py
+-rw-r--r--   0        0        0       27 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/cases/whitespace.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/gitignore_used_on_multiple_sources/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/gitignore_used_on_multiple_sources/dir1/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/gitignore_used_on_multiple_sources/dir1/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/gitignore_used_on_multiple_sources/dir2/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/gitignore_used_on_multiple_sources/dir2/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/ignore_subfolders_gitignore_tests/a.py
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/ignore_subfolders_gitignore_tests/subdir/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/ignore_subfolders_gitignore_tests/subdir/b.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/ignore_subfolders_gitignore_tests/subdir/subdir/c.py
+-rw-r--r--   0        0        0       14 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/.gitignore
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/b/.definitely_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/b/.definitely_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/b/.definitely_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/b/dont_exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/b/dont_exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/b/dont_exclude/a.pyi
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/b/exclude/a.pie
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/b/exclude/a.py
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/include_exclude_tests/b/exclude/a.pyi
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/invalid_gitignore_tests/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/invalid_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/invalid_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/invalid_nested_gitignore_tests/a.py
+-rw-r--r--   0        0        0       89 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/invalid_nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        2 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/invalid_nested_gitignore_tests/a/.gitignore
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/invalid_nested_gitignore_tests/a/a.py
+-rw-r--r--   0        0        0      436 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/jupyter/non_python_notebook.ipynb
+-rw-r--r--   0        0        0      369 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/jupyter/notebook_empty_metadata.ipynb
+-rw-r--r--   0        0        0      638 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/jupyter/notebook_no_trailing_newline.ipynb
+-rw-r--r--   0        0        0      639 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/jupyter/notebook_trailing_newline.ipynb
+-rw-r--r--   0        0        0        4 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/jupyter/notebook_which_cant_be_parsed.ipynb
+-rw-r--r--   0        0        0      762 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/jupyter/notebook_without_changes.ipynb
+-rw-r--r--   0        0        0      853 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/line_ranges_formatted/basic.py
+-rw-r--r--   0        0        0      537 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/line_ranges_formatted/pattern_matching.py
+-rw-r--r--   0        0        0      495 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/async_as_identifier.py
+-rw-r--r--   0        0        0      255 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/blackd_diff.diff
+-rw-r--r--   0        0        0       98 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/blackd_diff.py
+-rw-r--r--   0        0        0    19207 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/debug_visitor.out
+-rw-r--r--   0        0        0     1193 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/debug_visitor.py
+-rw-r--r--   0        0        0     1774 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/decorators.py
+-rw-r--r--   0        0        0    15711 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff
+-rw-r--r--   0        0        0      600 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/force_py36.py
+-rw-r--r--   0        0        0      808 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/force_pyi.py
+-rw-r--r--   0        0        0       59 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/invalid_header.py
+-rw-r--r--   0        0        0      293 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/missing_final_newline.diff
+-rw-r--r--   0        0        0      145 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/missing_final_newline.py
+-rw-r--r--   0        0        0      279 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/pattern_matching_invalid.py
+-rw-r--r--   0        0        0      758 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/python2_detection.py
+-rw-r--r--   0        0        0     2363 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/miscellaneous/string_quotes.py
+-rw-r--r--   0        0        0      114 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/pyproject.toml
+-rw-r--r--   0        0        0        0 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/x.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/root/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/root/a.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/root/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/root/c.py
+-rw-r--r--   0        0        0        5 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/root/child/.gitignore
+-rw-r--r--   0        0        0       39 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/root/child/a.py
+-rw-r--r--   0        0        0       40 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/root/child/b.py
+-rw-r--r--   0        0        0       21 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/nested_gitignore_tests/root/child/c.py
+-rw-r--r--   0        0        0      132 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/project_metadata/both_pyproject.toml
+-rw-r--r--   0        0        0       73 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/project_metadata/neither_pyproject.toml
+-rw-r--r--   0        0        0      100 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/project_metadata/only_black_pyproject.toml
+-rw-r--r--   0        0        0      105 2020-02-02 00:00:00.000000 black-24.4.1/tests/data/project_metadata/only_metadata_pyproject.toml
+-rw-r--r--   0        0        0      302 2020-02-02 00:00:00.000000 black-24.4.1/.gitignore
+-rw-r--r--   0        0        0     8092 2020-02-02 00:00:00.000000 black-24.4.1/AUTHORS.md
+-rw-r--r--   0        0        0     1080 2020-02-02 00:00:00.000000 black-24.4.1/LICENSE
+-rw-r--r--   0        0        0     8736 2020-02-02 00:00:00.000000 black-24.4.1/pyproject.toml
+-rw-r--r--   0        0        0    76846 2020-02-02 00:00:00.000000 black-24.4.1/PKG-INFO
```

### Comparing `black-24.4.0/.pre-commit-config.yaml` & `black-24.4.1/.pre-commit-config.yaml`

 * *Files 5% similar despite different names*

```diff
@@ -29,15 +29,15 @@
       - id: isort
 
   - repo: https://github.com/pycqa/flake8
     rev: 7.0.0
     hooks:
       - id: flake8
         additional_dependencies:
-          - flake8-bugbear
+          - flake8-bugbear==24.2.6
           - flake8-comprehensions
           - flake8-simplify
         exclude: ^src/blib2to3/
 
   - repo: https://github.com/pre-commit/mirrors-mypy
     rev: v1.9.0
     hooks:
```

### Comparing `black-24.4.0/.pre-commit-hooks.yaml` & `black-24.4.1/.pre-commit-hooks.yaml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/CHANGES.md` & `black-24.4.1/CHANGES.md`

 * *Files 1% similar despite different names*

```diff
@@ -1,9 +1,28 @@
 # Change Log
 
+## 24.4.1
+
+### Highlights
+
+- Add support for the new Python 3.12 f-string syntax introduced by PEP 701 (#3822)
+
+### Stable style
+
+- Fix crash involving indented dummy functions containing newlines (#4318)
+
+### Parser
+
+- Add support for type parameter defaults, a new syntactic feature added to Python 3.13
+  by PEP 696 (#4327)
+
+### Integrations
+
+- Github Action now works even when `git archive` is skipped (#4313)
+
 ## 24.4.0
 
 ### Stable style
 
 - Fix unwanted crashes caused by AST equivalency check (#4290)
 
 ### Preview style
```

### Comparing `black-24.4.0/CITATION.cff` & `black-24.4.1/CITATION.cff`

 * *Files identical despite different names*

### Comparing `black-24.4.0/Dockerfile` & `black-24.4.1/Dockerfile`

 * *Files identical despite different names*

### Comparing `black-24.4.0/README.md` & `black-24.4.1/README.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/action.yml` & `black-24.4.1/action.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tox.ini` & `black-24.4.1/tox.ini`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/CODE_OF_CONDUCT.md` & `black-24.4.1/.github/CODE_OF_CONDUCT.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/PULL_REQUEST_TEMPLATE.md` & `black-24.4.1/.github/PULL_REQUEST_TEMPLATE.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/dependabot.yml` & `black-24.4.1/.github/dependabot.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/ISSUE_TEMPLATE/bug_report.md` & `black-24.4.1/.github/ISSUE_TEMPLATE/bug_report.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/ISSUE_TEMPLATE/config.yml` & `black-24.4.1/.github/ISSUE_TEMPLATE/config.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/ISSUE_TEMPLATE/docs-issue.md` & `black-24.4.1/.github/ISSUE_TEMPLATE/docs-issue.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/ISSUE_TEMPLATE/feature_request.md` & `black-24.4.1/.github/ISSUE_TEMPLATE/feature_request.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/ISSUE_TEMPLATE/style_issue.md` & `black-24.4.1/.github/ISSUE_TEMPLATE/style_issue.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/changelog.yml` & `black-24.4.1/.github/workflows/changelog.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/diff_shades.yml` & `black-24.4.1/.github/workflows/diff_shades.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/diff_shades_comment.yml` & `black-24.4.1/.github/workflows/diff_shades_comment.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/doc.yml` & `black-24.4.1/.github/workflows/doc.yml`

 * *Files 16% similar despite different names*

```diff
@@ -26,13 +26,13 @@
       - name: Set up latest Python
         uses: actions/setup-python@v5
         with:
           python-version: "*"
 
       - name: Install dependencies
         run: |
-          python -m pip install --upgrade pip setuptools wheel
-          python -m pip install -e ".[d]"
-          python -m pip install -r "docs/requirements.txt"
+          python -m pip install uv
+          python -m uv pip install --system -e ".[d]"
+          python -m uv pip install --system -r "docs/requirements.txt"
 
       - name: Build documentation
         run: sphinx-build -a -b html -W --keep-going docs/ docs/_build
```

### Comparing `black-24.4.0/.github/workflows/docker.yml` & `black-24.4.1/.github/workflows/docker.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/fuzz.yml` & `black-24.4.1/.github/workflows/fuzz.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/lint.yml` & `black-24.4.1/.github/workflows/lint.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/pypi_upload.yml` & `black-24.4.1/.github/workflows/pypi_upload.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/release_tests.yml` & `black-24.4.1/.github/workflows/release_tests.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/test.yml` & `black-24.4.1/.github/workflows/test.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/.github/workflows/upload_binary.yml` & `black-24.4.1/.github/workflows/upload_binary.yml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/action/main.py` & `black-24.4.1/action/main.py`

 * *Files 4% similar despite different names*

```diff
@@ -15,14 +15,15 @@
 JUPYTER = os.getenv("INPUT_JUPYTER") == "true"
 BLACK_ARGS = os.getenv("INPUT_BLACK_ARGS", default="")
 VERSION = os.getenv("INPUT_VERSION", default="")
 USE_PYPROJECT = os.getenv("INPUT_USE_PYPROJECT") == "true"
 
 BLACK_VERSION_RE = re.compile(r"^black([^A-Z0-9._-]+.*)$", re.IGNORECASE)
 EXTRAS_RE = re.compile(r"\[.*\]")
+EXPORT_SUBST_FAIL_RE = re.compile(r"\$Format:.*\$")
 
 
 def determine_version_specifier() -> str:
     """Determine the version of Black to install.
 
     The version can be specified either via the `with.version` input or via the
     pyproject.toml file if `with.use_pyproject` is set to `true`.
@@ -131,15 +132,19 @@
                 break
     if not describe_name:
         print("::error::Failed to detect action version.", file=sys.stderr, flush=True)
         sys.exit(1)
     # expected format is one of:
     # - 23.1.0
     # - 23.1.0-51-g448bba7
-    if describe_name.count("-") < 2:
+    # - $Format:%(describe:tags=true,match=*[0-9]*)$ (if export-subst fails)
+    if (
+        describe_name.count("-") < 2
+        and EXPORT_SUBST_FAIL_RE.match(describe_name) is None
+    ):
         # the action's commit matches a tag exactly, install exact version from PyPI
         req = f"black{extra_deps}=={describe_name}"
     else:
         # the action's commit does not match any tag, install from the local git repo
         req = f".{extra_deps}"
 print(f"Installing {req}...", flush=True)
 pip_proc = run(
```

### Comparing `black-24.4.0/autoload/black.vim` & `black-24.4.1/autoload/black.vim`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/Makefile` & `black-24.4.1/docs/Makefile`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/conf.py` & `black-24.4.1/docs/conf.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/faq.md` & `black-24.4.1/docs/faq.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/getting_started.md` & `black-24.4.1/docs/getting_started.md`

 * *Files 3% similar despite different names*

```diff
@@ -15,14 +15,16 @@
 [Black Playground](https://black.vercel.app) generously created by José Padilla.
 
 ## Installation
 
 _Black_ can be installed by running `pip install black`. It requires Python 3.8+ to run.
 If you want to format Jupyter Notebooks, install with `pip install "black[jupyter]"`.
 
+If you use pipx, you can install Black with `pipx install black`.
+
 If you can't wait for the latest _hotness_ and want to install from GitHub, use:
 
 `pip install git+https://github.com/psf/black`
 
 ## Basic usage
 
 To get started right away with sensible defaults:
```

### Comparing `black-24.4.0/docs/index.md` & `black-24.4.1/docs/index.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/make.bat` & `black-24.4.1/docs/make.bat`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/_static/license.svg` & `black-24.4.1/docs/_static/license.svg`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/_static/logo2-readme.png` & `black-24.4.1/docs/_static/logo2-readme.png`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/_static/logo2.png` & `black-24.4.1/docs/_static/logo2.png`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/_static/pypi_template.svg` & `black-24.4.1/docs/_static/pypi_template.svg`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/contributing/gauging_changes.md` & `black-24.4.1/docs/contributing/gauging_changes.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/contributing/index.md` & `black-24.4.1/docs/contributing/index.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/contributing/issue_triage.md` & `black-24.4.1/docs/contributing/issue_triage.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/contributing/release_process.md` & `black-24.4.1/docs/contributing/release_process.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/contributing/the_basics.md` & `black-24.4.1/docs/contributing/the_basics.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/guides/introducing_black_to_your_project.md` & `black-24.4.1/docs/guides/introducing_black_to_your_project.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/guides/using_black_with_other_tools.md` & `black-24.4.1/docs/guides/using_black_with_other_tools.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/integrations/editors.md` & `black-24.4.1/docs/integrations/editors.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/integrations/github_actions.md` & `black-24.4.1/docs/integrations/github_actions.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/integrations/index.md` & `black-24.4.1/docs/integrations/index.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/integrations/source_version_control.md` & `black-24.4.1/docs/integrations/source_version_control.md`

 * *Files 1% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 [have it installed](https://pre-commit.com/#install), add this to the
 `.pre-commit-config.yaml` in your repository:
 
 ```yaml
 repos:
   # Using this mirror lets us use mypyc-compiled black, which is about 2x faster
   - repo: https://github.com/psf/black-pre-commit-mirror
-    rev: 24.4.0
+    rev: 24.4.1
     hooks:
       - id: black
         # It is recommended to specify the latest version of Python
         # supported by your project here, or alternatively use
         # pre-commit's default_language_version, see
         # https://pre-commit.com/#top_level-default_language_version
         language_version: python3.11
@@ -31,15 +31,15 @@
 include Jupyter Notebooks. To use this hook, simply replace the hook's `id: black` with
 `id: black-jupyter` in the `.pre-commit-config.yaml`:
 
 ```yaml
 repos:
   # Using this mirror lets us use mypyc-compiled black, which is about 2x faster
   - repo: https://github.com/psf/black-pre-commit-mirror
-    rev: 24.4.0
+    rev: 24.4.1
     hooks:
       - id: black-jupyter
         # It is recommended to specify the latest version of Python
         # supported by your project here, or alternatively use
         # pre-commit's default_language_version, see
         # https://pre-commit.com/#top_level-default_language_version
         language_version: python3.11
```

### Comparing `black-24.4.0/docs/the_black_code_style/current_style.md` & `black-24.4.1/docs/the_black_code_style/current_style.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/the_black_code_style/future_style.md` & `black-24.4.1/docs/the_black_code_style/future_style.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/the_black_code_style/index.md` & `black-24.4.1/docs/the_black_code_style/index.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/usage_and_configuration/black_as_a_server.md` & `black-24.4.1/docs/usage_and_configuration/black_as_a_server.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/usage_and_configuration/black_docker_image.md` & `black-24.4.1/docs/usage_and_configuration/black_docker_image.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/usage_and_configuration/file_collection_and_discovery.md` & `black-24.4.1/docs/usage_and_configuration/file_collection_and_discovery.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/usage_and_configuration/index.md` & `black-24.4.1/docs/usage_and_configuration/index.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/docs/usage_and_configuration/the_basics.md` & `black-24.4.1/docs/usage_and_configuration/the_basics.md`

 * *Files 0% similar despite different names*

```diff
@@ -265,16 +265,16 @@
 Require a specific version of _Black_ to be running. This is useful for ensuring that
 all contributors to your project are using the same version, because different versions
 of _Black_ may format code a little differently. This option can be set in a
 configuration file for consistent results across environments.
 
 ```console
 $ black --version
-black, 24.4.0 (compiled: yes)
-$ black --required-version 24.4.0 -c "format = 'this'"
+black, 24.4.1 (compiled: yes)
+$ black --required-version 24.4.1 -c "format = 'this'"
 format = "this"
 $ black --required-version 31.5b2 -c "still = 'beta?!'"
 Oh no! 💥 💔 💥 The required version does not match the running version!
 ```
 
 You can also pass just the major version:
 
@@ -362,15 +362,15 @@
 
 #### `--version`
 
 You can check the version of _Black_ you have installed using the `--version` flag.
 
 ```console
 $ black --version
-black, 24.4.0
+black, 24.4.1
 ```
 
 #### `--config`
 
 Read configuration options from a configuration file. See
 [below](#configuration-via-a-file) for more details on the configuration file.
```

### Comparing `black-24.4.0/gallery/README.md` & `black-24.4.1/gallery/README.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/gallery/gallery.py` & `black-24.4.1/gallery/gallery.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/plugin/black.vim` & `black-24.4.1/plugin/black.vim`

 * *Files identical despite different names*

### Comparing `black-24.4.0/scripts/check_pre_commit_rev_in_example.py` & `black-24.4.1/scripts/check_pre_commit_rev_in_example.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/scripts/check_version_in_basics_example.py` & `black-24.4.1/scripts/check_version_in_basics_example.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/scripts/diff_shades_gha_helper.py` & `black-24.4.1/scripts/diff_shades_gha_helper.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/scripts/fuzz.py` & `black-24.4.1/scripts/fuzz.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/scripts/generate_schema.py` & `black-24.4.1/scripts/generate_schema.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/scripts/make_width_table.py` & `black-24.4.1/scripts/make_width_table.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/scripts/migrate-black.py` & `black-24.4.1/scripts/migrate-black.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/scripts/release.py` & `black-24.4.1/scripts/release.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/scripts/release_tests.py` & `black-24.4.1/scripts/release_tests.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/__init__.py` & `black-24.4.1/src/black/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -65,21 +65,15 @@
     unmask_cell,
 )
 from black.linegen import LN, LineGenerator, transform_line
 from black.lines import EmptyLineTracker, LinesBlock
 from black.mode import FUTURE_FLAG_TO_FEATURE, VERSION_TO_FEATURES, Feature
 from black.mode import Mode as Mode  # re-exported
 from black.mode import Preview, TargetVersion, supports_feature
-from black.nodes import (
-    STARS,
-    is_number_token,
-    is_simple_decorator_expression,
-    is_string_token,
-    syms,
-)
+from black.nodes import STARS, is_number_token, is_simple_decorator_expression, syms
 from black.output import color_diff, diff, dump_to_file, err, ipynb_diff, out
 from black.parsing import (  # noqa F401
     ASTSafetyError,
     InvalidInput,
     lib2to3_parse,
     parse_ast,
     stringify_ast,
@@ -87,15 +81,14 @@
 from black.ranges import (
     adjusted_lines,
     convert_unchanged_lines,
     parse_line_ranges,
     sanitized_lines,
 )
 from black.report import Changed, NothingChanged, Report
-from black.trans import iter_fexpr_spans
 from blib2to3.pgen2 import token
 from blib2to3.pytree import Leaf, Node
 
 COMPILED = Path(__file__).suffix in (".pyd", ".so")
 
 # types
 FileContent = str
@@ -1261,15 +1254,18 @@
         # This should be called after normalize_fmt_off.
         convert_unchanged_lines(src_node, lines)
 
     line_generator = LineGenerator(mode=mode, features=context_manager_features)
     elt = EmptyLineTracker(mode=mode)
     split_line_features = {
         feature
-        for feature in {Feature.TRAILING_COMMA_IN_CALL, Feature.TRAILING_COMMA_IN_DEF}
+        for feature in {
+            Feature.TRAILING_COMMA_IN_CALL,
+            Feature.TRAILING_COMMA_IN_DEF,
+        }
         if supports_feature(versions, feature)
     }
     block: Optional[LinesBlock] = None
     for current_line in line_generator.visit(src_node):
         block = elt.maybe_empty_lines(current_line)
         dst_blocks.append(block)
         for line in transform_line(
@@ -1333,23 +1329,22 @@
         features |= {
             FUTURE_FLAG_TO_FEATURE[future_import]
             for future_import in future_imports
             if future_import in FUTURE_FLAG_TO_FEATURE
         }
 
     for n in node.pre_order():
-        if is_string_token(n):
-            value_head = n.value[:2]
-            if value_head in {'f"', 'F"', "f'", "F'", "rf", "fr", "RF", "FR"}:
-                features.add(Feature.F_STRINGS)
-                if Feature.DEBUG_F_STRINGS not in features:
-                    for span_beg, span_end in iter_fexpr_spans(n.value):
-                        if n.value[span_beg : span_end - 1].rstrip().endswith("="):
-                            features.add(Feature.DEBUG_F_STRINGS)
-                            break
+        if n.type == token.FSTRING_START:
+            features.add(Feature.F_STRINGS)
+        elif (
+            n.type == token.RBRACE
+            and n.parent is not None
+            and any(child.type == token.EQUAL for child in n.parent.children)
+        ):
+            features.add(Feature.DEBUG_F_STRINGS)
 
         elif is_number_token(n):
             if "_" in n.value:
                 features.add(Feature.NUMERIC_UNDERSCORES)
 
         elif n.type == token.SLASH:
             if n.parent and n.parent.type in {
@@ -1437,14 +1432,20 @@
             and n.children[2].type == syms.star_expr
         ):
             features.add(Feature.VARIADIC_GENERICS)
 
         elif n.type in (syms.type_stmt, syms.typeparams):
             features.add(Feature.TYPE_PARAMS)
 
+        elif (
+            n.type in (syms.typevartuple, syms.paramspec, syms.typevar)
+            and n.children[-2].type == token.EQUAL
+        ):
+            features.add(Feature.TYPE_PARAM_DEFAULTS)
+
     return features
 
 
 def _contains_asexpr(node: Union[Node, Leaf]) -> bool:
     """Return True if `node` contains an as-pattern."""
     if node.type == syms.asexpr_test:
         return True
```

### Comparing `black-24.4.0/src/black/_width_table.py` & `black-24.4.1/src/black/_width_table.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/brackets.py` & `black-24.4.1/src/black/brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/cache.py` & `black-24.4.1/src/black/cache.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/comments.py` & `black-24.4.1/src/black/comments.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/concurrency.py` & `black-24.4.1/src/black/concurrency.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/debug.py` & `black-24.4.1/src/black/debug.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/files.py` & `black-24.4.1/src/black/files.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/handle_ipynb_magics.py` & `black-24.4.1/src/black/handle_ipynb_magics.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/linegen.py` & `black-24.4.1/src/black/linegen.py`

 * *Files 2% similar despite different names*

```diff
@@ -33,14 +33,15 @@
     CLOSING_BRACKETS,
     OPENING_BRACKETS,
     STANDALONE_COMMENT,
     STATEMENT,
     WHITESPACE,
     Visitor,
     ensure_visible,
+    fstring_to_string,
     get_annotation_type,
     is_arith_like,
     is_async_stmt_or_funcdef,
     is_atom_with_invisible_parens,
     is_docstring,
     is_empty_tuple,
     is_lpar_token,
@@ -148,19 +149,14 @@
                     yield from self.line()
 
                     self.current_line.append(comment)
                     yield from self.line()
 
             if any_open_brackets:
                 node.prefix = ""
-            if self.mode.string_normalization and node.type == token.STRING:
-                node.value = normalize_string_prefix(node.value)
-                node.value = normalize_string_quotes(node.value)
-            if node.type == token.NUMBER:
-                normalize_numeric_literal(node)
             if node.type not in WHITESPACE:
                 self.current_line.append(node)
         yield from super().visit_default(node)
 
     def visit_test(self, node: Node) -> Iterator[Line]:
         """Visit an `x if y else z` test"""
 
@@ -309,16 +305,19 @@
                 yield from self.visit_default(node)
             else:
                 yield from self.line(+1)
                 yield from self.visit_default(node)
                 yield from self.line(-1)
 
         else:
-            if not node.parent or not is_stub_suite(node.parent):
-                yield from self.line()
+            if node.parent and is_stub_suite(node.parent):
+                node.prefix = ""
+                yield from self.visit_default(node)
+                return
+            yield from self.line()
             yield from self.visit_default(node)
 
     def visit_async_stmt(self, node: Node) -> Iterator[Line]:
         """Visit `async def`, `async for`, `async with`."""
         yield from self.line()
 
         children = iter(node.children)
@@ -416,20 +415,19 @@
             normalize_unicode_escape_sequences(leaf)
 
         if is_docstring(leaf, self.mode) and not re.search(r"\\\s*\n", leaf.value):
             # We're ignoring docstrings with backslash newline escapes because changing
             # indentation of those changes the AST representation of the code.
             if self.mode.string_normalization:
                 docstring = normalize_string_prefix(leaf.value)
-                # visit_default() does handle string normalization for us, but
-                # since this method acts differently depending on quote style (ex.
+                # We handle string normalization at the end of this method, but since
+                # what we do right now acts differently depending on quote style (ex.
                 # see padding logic below), there's a possibility for unstable
-                # formatting as visit_default() is called *after*. To avoid a
-                # situation where this function formats a docstring differently on
-                # the second pass, normalize it early.
+                # formatting. To avoid a situation where this function formats a
+                # docstring differently on the second pass, normalize it early.
                 docstring = normalize_string_quotes(docstring)
             else:
                 docstring = leaf.value
             prefix = get_string_prefix(docstring)
             docstring = docstring[len(prefix) :]  # Remove the prefix
             quote_char = docstring[0]
             # A natural way to remove the outer quotes is to do:
@@ -495,16 +493,62 @@
                     else:
                         leaf.value = prefix + quote + docstring + "\n" + indent + quote
                 else:
                     leaf.value = prefix + quote + docstring + quote
             else:
                 leaf.value = prefix + quote + docstring + quote
 
+        if self.mode.string_normalization and leaf.type == token.STRING:
+            leaf.value = normalize_string_prefix(leaf.value)
+            leaf.value = normalize_string_quotes(leaf.value)
         yield from self.visit_default(leaf)
 
+    def visit_NUMBER(self, leaf: Leaf) -> Iterator[Line]:
+        normalize_numeric_literal(leaf)
+        yield from self.visit_default(leaf)
+
+    def visit_fstring(self, node: Node) -> Iterator[Line]:
+        # currently we don't want to format and split f-strings at all.
+        string_leaf = fstring_to_string(node)
+        node.replace(string_leaf)
+        yield from self.visit_STRING(string_leaf)
+
+        # TODO: Uncomment Implementation to format f-string children
+        # fstring_start = node.children[0]
+        # fstring_end = node.children[-1]
+        # assert isinstance(fstring_start, Leaf)
+        # assert isinstance(fstring_end, Leaf)
+
+        # quote_char = fstring_end.value[0]
+        # quote_idx = fstring_start.value.index(quote_char)
+        # prefix, quote = (
+        #     fstring_start.value[:quote_idx],
+        #     fstring_start.value[quote_idx:]
+        # )
+
+        # if not is_docstring(node, self.mode):
+        #     prefix = normalize_string_prefix(prefix)
+
+        # assert quote == fstring_end.value
+
+        # is_raw_fstring = "r" in prefix or "R" in prefix
+        # middles = [
+        #     leaf
+        #     for leaf in node.leaves()
+        #     if leaf.type == token.FSTRING_MIDDLE
+        # ]
+
+        # if self.mode.string_normalization:
+        #     middles, quote = normalize_fstring_quotes(quote, middles, is_raw_fstring)
+
+        # fstring_start.value = prefix + quote
+        # fstring_end.value = quote
+
+        # yield from self.visit_default(node)
+
     def __post_init__(self) -> None:
         """You are in a twisty little maze of passages."""
         self.current_line = Line(mode=self.mode)
 
         v = self.visit_stmt
         Ø: Set[str] = set()
         self.visit_assert_stmt = partial(v, keywords={"assert"}, parens={"assert", ","})
@@ -1371,15 +1415,15 @@
                 and child.next_sibling.type == token.COLON
                 and child.value == "case"
             ):
                 # A special patch for "case case:" scenario, the second occurrence
                 # of case will be not parsed as a Python keyword.
                 break
 
-            elif not (isinstance(child, Leaf) and is_multiline_string(child)):
+            elif not is_multiline_string(child):
                 wrap_in_parentheses(node, child, visible=False)
 
         comma_check = child.type == token.COMMA
 
         check_lpar = isinstance(child, Leaf) and (
             child.value in parens_after or comma_check
         )
```

### Comparing `black-24.4.0/src/black/lines.py` & `black-24.4.1/src/black/lines.py`

 * *Files 0% similar despite different names*

```diff
@@ -68,15 +68,20 @@
         Unless `preformatted` is True, the `leaf` will receive a new consistent
         whitespace prefix and metadata applied by :class:`BracketTracker`.
         Trailing commas are maybe removed, unpacked for loop variables are
         demoted from being delimiters.
 
         Inline comments are put aside.
         """
-        has_value = leaf.type in BRACKETS or bool(leaf.value.strip())
+        has_value = (
+            leaf.type in BRACKETS
+            # empty fstring-middles must not be truncated
+            or leaf.type == token.FSTRING_MIDDLE
+            or bool(leaf.value.strip())
+        )
         if not has_value:
             return
 
         if token.COLON == leaf.type and self.is_class_paren_empty:
             del self.leaves[-2:]
         if self.leaves and not preformatted:
             # Note: at this point leaf.prefix should be empty except for
```

### Comparing `black-24.4.0/src/black/mode.py` & `black-24.4.1/src/black/mode.py`

 * *Files 16% similar despite different names*

```diff
@@ -20,14 +20,15 @@
     PY36 = 6
     PY37 = 7
     PY38 = 8
     PY39 = 9
     PY310 = 10
     PY311 = 11
     PY312 = 12
+    PY313 = 13
 
 
 class Feature(Enum):
     F_STRINGS = 2
     NUMERIC_UNDERSCORES = 3
     TRAILING_COMMA_IN_CALL = 4
     TRAILING_COMMA_IN_DEF = 5
@@ -42,14 +43,16 @@
     UNPACKING_ON_FLOW = 12
     ANN_ASSIGN_EXTENDED_RHS = 13
     EXCEPT_STAR = 14
     VARIADIC_GENERICS = 15
     DEBUG_F_STRINGS = 16
     PARENTHESIZED_CONTEXT_MANAGERS = 17
     TYPE_PARAMS = 18
+    FSTRING_PARSING = 19
+    TYPE_PARAM_DEFAULTS = 20
     FORCE_OPTIONAL_PARENTHESES = 50
 
     # __future__ flags
     FUTURE_ANNOTATIONS = 51
 
 
 FUTURE_FLAG_TO_FEATURE: Final = {
@@ -152,14 +155,36 @@
         Feature.UNPACKING_ON_FLOW,
         Feature.ANN_ASSIGN_EXTENDED_RHS,
         Feature.PARENTHESIZED_CONTEXT_MANAGERS,
         Feature.PATTERN_MATCHING,
         Feature.EXCEPT_STAR,
         Feature.VARIADIC_GENERICS,
         Feature.TYPE_PARAMS,
+        Feature.FSTRING_PARSING,
+    },
+    TargetVersion.PY313: {
+        Feature.F_STRINGS,
+        Feature.DEBUG_F_STRINGS,
+        Feature.NUMERIC_UNDERSCORES,
+        Feature.TRAILING_COMMA_IN_CALL,
+        Feature.TRAILING_COMMA_IN_DEF,
+        Feature.ASYNC_KEYWORDS,
+        Feature.FUTURE_ANNOTATIONS,
+        Feature.ASSIGNMENT_EXPRESSIONS,
+        Feature.RELAXED_DECORATORS,
+        Feature.POS_ONLY_ARGUMENTS,
+        Feature.UNPACKING_ON_FLOW,
+        Feature.ANN_ASSIGN_EXTENDED_RHS,
+        Feature.PARENTHESIZED_CONTEXT_MANAGERS,
+        Feature.PATTERN_MATCHING,
+        Feature.EXCEPT_STAR,
+        Feature.VARIADIC_GENERICS,
+        Feature.TYPE_PARAMS,
+        Feature.FSTRING_PARSING,
+        Feature.TYPE_PARAM_DEFAULTS,
     },
 }
 
 
 def supports_feature(target_versions: Set[TargetVersion], feature: Feature) -> bool:
     return all(feature in VERSION_TO_FEATURES[version] for version in target_versions)
```

### Comparing `black-24.4.0/src/black/nodes.py` & `black-24.4.1/src/black/nodes.py`

 * *Files 2% similar despite different names*

```diff
@@ -141,15 +141,21 @@
     token.LPAR: token.RPAR,
     token.LSQB: token.RSQB,
     token.LBRACE: token.RBRACE,
 }
 OPENING_BRACKETS: Final = set(BRACKET.keys())
 CLOSING_BRACKETS: Final = set(BRACKET.values())
 BRACKETS: Final = OPENING_BRACKETS | CLOSING_BRACKETS
-ALWAYS_NO_SPACE: Final = CLOSING_BRACKETS | {token.COMMA, STANDALONE_COMMENT}
+ALWAYS_NO_SPACE: Final = CLOSING_BRACKETS | {
+    token.COMMA,
+    STANDALONE_COMMENT,
+    token.FSTRING_MIDDLE,
+    token.FSTRING_END,
+    token.BANG,
+}
 
 RARROW = 55
 
 
 @mypyc_attr(allow_interpreted_subclasses=True)
 class Visitor(Generic[T]):
     """Basic lib2to3 visitor that yields things of type `T` on `visit()`."""
@@ -207,14 +213,17 @@
     if t == token.COLON and p.type not in {
         syms.subscript,
         syms.subscriptlist,
         syms.sliceop,
     }:
         return NO
 
+    if t == token.LBRACE and p.type == syms.fstring_replacement_field:
+        return NO
+
     prev = leaf.prev_sibling
     if not prev:
         prevp = preceding_leaf(p)
         if not prevp or prevp.type in OPENING_BRACKETS:
             return NO
 
         if t == token.COLON:
@@ -268,14 +277,17 @@
         elif prevp.type == token.AT and p.parent and p.parent.type == syms.decorator:
             # no space in decorators
             return NO
 
     elif prev.type in OPENING_BRACKETS:
         return NO
 
+    elif prev.type == token.BANG:
+        return NO
+
     if p.type in {syms.parameters, syms.arglist}:
         # untyped function signatures or calls
         if not prev or prev.type != token.COMMA:
             return NO
 
     elif p.type == syms.varargslist:
         # lambdas
@@ -389,14 +401,15 @@
                 syms.sliceop,
             }:
                 return NO
 
             elif prevp.type == token.EQUAL and prevp_parent.type == syms.argument:
                 return NO
 
+        # TODO: add fstring here?
         elif t in {token.NAME, token.NUMBER, token.STRING}:
             return NO
 
     elif p.type == syms.import_from:
         if t == token.DOT:
             if prev and prev.type == token.DOT:
                 return NO
@@ -538,39 +551,40 @@
         syms.arith_expr,
         syms.shift_expr,
         syms.xor_expr,
         syms.and_expr,
     }
 
 
-def is_docstring(leaf: Leaf, mode: Mode) -> bool:
-    if leaf.type != token.STRING:
-        return False
+def is_docstring(node: NL, mode: Mode) -> bool:
+    if isinstance(node, Leaf):
+        if node.type != token.STRING:
+            return False
 
-    prefix = get_string_prefix(leaf.value)
-    if set(prefix).intersection("bBfF"):
-        return False
+        prefix = get_string_prefix(node.value)
+        if set(prefix).intersection("bBfF"):
+            return False
 
     if (
         Preview.unify_docstring_detection in mode
-        and leaf.parent
-        and leaf.parent.type == syms.simple_stmt
-        and not leaf.parent.prev_sibling
-        and leaf.parent.parent
-        and leaf.parent.parent.type == syms.file_input
+        and node.parent
+        and node.parent.type == syms.simple_stmt
+        and not node.parent.prev_sibling
+        and node.parent.parent
+        and node.parent.parent.type == syms.file_input
     ):
         return True
 
     if prev_siblings_are(
-        leaf.parent, [None, token.NEWLINE, token.INDENT, syms.simple_stmt]
+        node.parent, [None, token.NEWLINE, token.INDENT, syms.simple_stmt]
     ):
         return True
 
     # Multiline docstring on the same line as the `def`.
-    if prev_siblings_are(leaf.parent, [syms.parameters, token.COLON, syms.simple_stmt]):
+    if prev_siblings_are(node.parent, [syms.parameters, token.COLON, syms.simple_stmt]):
         # `syms.parameters` is only used in funcdefs and async_funcdefs in the Python
         # grammar. We're safe to return True without further checks.
         return True
 
     return False
 
 
@@ -744,16 +758,36 @@
             return False
 
         p = p.parent
 
     return p.type in within
 
 
-def is_multiline_string(leaf: Leaf) -> bool:
+def is_fstring(node: Node) -> bool:
+    """Return True if the node is an f-string"""
+    return node.type == syms.fstring
+
+
+def fstring_to_string(node: Node) -> Leaf:
+    """Converts an fstring node back to a string node."""
+    string_without_prefix = str(node)[len(node.prefix) :]
+    string_leaf = Leaf(token.STRING, string_without_prefix, prefix=node.prefix)
+    string_leaf.lineno = node.get_lineno() or 0
+    return string_leaf
+
+
+def is_multiline_string(node: LN) -> bool:
     """Return True if `leaf` is a multiline string that actually spans many lines."""
+    if isinstance(node, Node) and is_fstring(node):
+        leaf = fstring_to_string(node)
+    elif isinstance(node, Leaf):
+        leaf = node
+    else:
+        return False
+
     return has_triple_quotes(leaf.value) and "\n" in leaf.value
 
 
 def is_parent_function_or_class(node: Node) -> bool:
     assert node.type in {syms.suite, syms.simple_stmt}
     assert node.parent is not None
     # Note this works for suites / simple_stmts in async def as well
@@ -950,18 +984,14 @@
     return nl.type == token.LPAR
 
 
 def is_rpar_token(nl: NL) -> TypeGuard[Leaf]:
     return nl.type == token.RPAR
 
 
-def is_string_token(nl: NL) -> TypeGuard[Leaf]:
-    return nl.type == token.STRING
-
-
 def is_number_token(nl: NL) -> TypeGuard[Leaf]:
     return nl.type == token.NUMBER
 
 
 def get_annotation_type(leaf: Leaf) -> Literal["return", "param", None]:
     """Returns the type of annotation this leaf is part of, if any."""
     ancestor = leaf.parent
```

### Comparing `black-24.4.0/src/black/numerics.py` & `black-24.4.1/src/black/numerics.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/output.py` & `black-24.4.1/src/black/output.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/parsing.py` & `black-24.4.1/src/black/parsing.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/ranges.py` & `black-24.4.1/src/black/ranges.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/report.py` & `black-24.4.1/src/black/report.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/rusty.py` & `black-24.4.1/src/black/rusty.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/schema.py` & `black-24.4.1/src/black/schema.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/strings.py` & `black-24.4.1/src/black/strings.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 """
 Simple formatting on strings. Further string formatting code is in trans.py.
 """
 
 import re
 import sys
 from functools import lru_cache
-from typing import Final, List, Match, Pattern
+from typing import Final, List, Match, Pattern, Tuple
 
 from black._width_table import WIDTH_TABLE
 from blib2to3.pytree import Leaf
 
 STRING_PREFIX_CHARS: Final = "furbFURB"  # All possible string prefix characters.
 STRING_PREFIX_RE: Final = re.compile(
     r"^([" + STRING_PREFIX_CHARS + r"]*)(.*)$", re.DOTALL
@@ -165,16 +165,15 @@
 def _cached_compile(pattern: str) -> Pattern[str]:
     return re.compile(pattern)
 
 
 def normalize_string_quotes(s: str) -> str:
     """Prefer double quotes but only if it doesn't cause more escaping.
 
-    Adds or removes backslashes as appropriate. Doesn't parse and fix
-    strings nested in f-strings.
+    Adds or removes backslashes as appropriate.
     """
     value = s.lstrip(STRING_PREFIX_CHARS)
     if value[:3] == '"""':
         return s
 
     elif value[:3] == "'''":
         orig_quote = "'''"
@@ -207,14 +206,15 @@
         new_body = sub_twice(escaped_new_quote, rf"\1\2{new_quote}", body)
         if body != new_body:
             # Consider the string without unnecessary escapes as the original
             body = new_body
             s = f"{prefix}{orig_quote}{body}{orig_quote}"
         new_body = sub_twice(escaped_orig_quote, rf"\1\2{orig_quote}", new_body)
         new_body = sub_twice(unescaped_new_quote, rf"\1\\{new_quote}", new_body)
+
     if "f" in prefix.casefold():
         matches = re.findall(
             r"""
             (?:(?<!\{)|^)\{  # start of the string or a non-{ followed by a single {
                 ([^{].*?)  # contents of the brackets except if begins with {{
             \}(?:(?!\})|$)  # A } followed by end of the string or a non-}
             """,
@@ -236,14 +236,79 @@
 
     if new_escape_count == orig_escape_count and orig_quote == '"':
         return s  # Prefer double quotes
 
     return f"{prefix}{new_quote}{new_body}{new_quote}"
 
 
+def normalize_fstring_quotes(
+    quote: str,
+    middles: List[Leaf],
+    is_raw_fstring: bool,
+) -> Tuple[List[Leaf], str]:
+    """Prefer double quotes but only if it doesn't cause more escaping.
+
+    Adds or removes backslashes as appropriate.
+    """
+    if quote == '"""':
+        return middles, quote
+
+    elif quote == "'''":
+        new_quote = '"""'
+    elif quote == '"':
+        new_quote = "'"
+    else:
+        new_quote = '"'
+
+    unescaped_new_quote = _cached_compile(rf"(([^\\]|^)(\\\\)*){new_quote}")
+    escaped_new_quote = _cached_compile(rf"([^\\]|^)\\((?:\\\\)*){new_quote}")
+    escaped_orig_quote = _cached_compile(rf"([^\\]|^)\\((?:\\\\)*){quote}")
+    if is_raw_fstring:
+        for middle in middles:
+            if unescaped_new_quote.search(middle.value):
+                # There's at least one unescaped new_quote in this raw string
+                # so converting is impossible
+                return middles, quote
+
+        # Do not introduce or remove backslashes in raw strings, just use double quote
+        return middles, '"'
+
+    new_segments = []
+    for middle in middles:
+        segment = middle.value
+        # remove unnecessary escapes
+        new_segment = sub_twice(escaped_new_quote, rf"\1\2{new_quote}", segment)
+        if segment != new_segment:
+            # Consider the string without unnecessary escapes as the original
+            middle.value = new_segment
+
+        new_segment = sub_twice(escaped_orig_quote, rf"\1\2{quote}", new_segment)
+        new_segment = sub_twice(unescaped_new_quote, rf"\1\\{new_quote}", new_segment)
+        new_segments.append(new_segment)
+
+    if new_quote == '"""' and new_segments[-1].endswith('"'):
+        # edge case:
+        new_segments[-1] = new_segments[-1][:-1] + '\\"'
+
+    for middle, new_segment in zip(middles, new_segments):
+        orig_escape_count = middle.value.count("\\")
+        new_escape_count = new_segment.count("\\")
+
+    if new_escape_count > orig_escape_count:
+        return middles, quote  # Do not introduce more escaping
+
+    if new_escape_count == orig_escape_count and quote == '"':
+        return middles, quote  # Prefer double quotes
+
+    for middle, new_segment in zip(middles, new_segments):
+        middle.value = new_segment
+
+    return middles, new_quote
+
+
 def normalize_unicode_escape_sequences(leaf: Leaf) -> None:
     """Replace hex codes in Unicode escape sequences with lowercase representation."""
     text = leaf.value
     prefix = get_string_prefix(text)
     if "r" in prefix.lower():
         return
```

### Comparing `black-24.4.0/src/black/trans.py` & `black-24.4.1/src/black/trans.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/black/resources/black.schema.json` & `black-24.4.1/src/black/resources/black.schema.json`

 * *Files 1% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.9999868476430976%*

 * *Differences: {"'properties'": "{'target-version': {'items': {'enum': {insert: [(10, 'py313')]}}}}"}*

```diff
@@ -125,15 +125,16 @@
                     "py35",
                     "py36",
                     "py37",
                     "py38",
                     "py39",
                     "py310",
                     "py311",
-                    "py312"
+                    "py312",
+                    "py313"
                 ]
             },
             "type": "array"
         },
         "unstable": {
             "default": false,
             "description": "Enable potentially disruptive style changes that have known bugs or are not currently expected to make it into the stable style Black's next major release. Implies --preview.",
```

### Comparing `black-24.4.0/src/blackd/__init__.py` & `black-24.4.1/src/blackd/__init__.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blackd/middlewares.py` & `black-24.4.1/src/blackd/middlewares.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blib2to3/Grammar.txt` & `black-24.4.1/src/blib2to3/Grammar.txt`

 * *Files 4% similar despite different names*

```diff
@@ -8,17 +8,17 @@
 #	single_input is a single interactive statement;
 #	eval_input is the input for the eval() and input() functions.
 # NB: compound_stmt in single_input is followed by extra NEWLINE!
 file_input: (NEWLINE | stmt)* ENDMARKER
 single_input: NEWLINE | simple_stmt | compound_stmt NEWLINE
 eval_input: testlist NEWLINE* ENDMARKER
 
-typevar: NAME [':' expr]
-paramspec: '**' NAME
-typevartuple: '*' NAME
+typevar: NAME [':' expr] ['=' expr]
+paramspec: '**' NAME ['=' expr]
+typevartuple: '*' NAME ['=' (expr|star_expr)]
 typeparam: typevar | paramspec | typevartuple
 typeparams: '[' typeparam (',' typeparam)* [','] ']'
 
 decorator: '@' namedexpr_test NEWLINE
 decorators: decorator+
 decorated: decorators (classdef | funcdef | async_funcdef)
 async_funcdef: ASYNC funcdef
@@ -159,15 +159,15 @@
 term: factor (('*'|'@'|'/'|'%'|'//') factor)*
 factor: ('+'|'-'|'~') factor | power
 power: [AWAIT] atom trailer* ['**' factor]
 atom: ('(' [yield_expr|testlist_gexp] ')' |
        '[' [listmaker] ']' |
        '{' [dictsetmaker] '}' |
        '`' testlist1 '`' |
-       NAME | NUMBER | STRING+ | '.' '.' '.')
+       NAME | NUMBER | (STRING | fstring)+ | '.' '.' '.')
 listmaker: (namedexpr_test|star_expr) ( old_comp_for | (',' (namedexpr_test|star_expr))* [','] )
 testlist_gexp: (namedexpr_test|star_expr) ( old_comp_for | (',' (namedexpr_test|star_expr))* [','] )
 lambdef: 'lambda' [varargslist] ':' test
 trailer: '(' [arglist] ')' | '[' subscriptlist ']' | '.' NAME
 subscriptlist: (subscript|star_expr) (',' (subscript|star_expr))* [',']
 subscript: test [':=' test] | [test] ':' [test] [sliceop]
 sliceop: ':' [test]
@@ -250,7 +250,12 @@
 subject_expr: (namedexpr_test|star_expr) (',' (namedexpr_test|star_expr))* [',']
 
 # cases
 case_block: "case" patterns [guard] ':' suite
 guard: 'if' namedexpr_test
 patterns: pattern (',' pattern)* [',']
 pattern: (expr|star_expr) ['as' expr]
+
+fstring: FSTRING_START fstring_middle* FSTRING_END
+fstring_middle: fstring_replacement_field | FSTRING_MIDDLE
+fstring_replacement_field: '{' (yield_expr | testlist_star_expr) ['='] [ "!" NAME ] [ ':' fstring_format_spec* ] '}'
+fstring_format_spec: FSTRING_MIDDLE | fstring_replacement_field
```

### Comparing `black-24.4.0/src/blib2to3/LICENSE` & `black-24.4.1/src/blib2to3/LICENSE`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blib2to3/PatternGrammar.txt` & `black-24.4.1/src/blib2to3/PatternGrammar.txt`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blib2to3/README` & `black-24.4.1/src/blib2to3/README`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blib2to3/pygram.py` & `black-24.4.1/src/blib2to3/pygram.py`

 * *Files 2% similar despite different names*

```diff
@@ -66,14 +66,18 @@
     expr: int
     expr_stmt: int
     exprlist: int
     factor: int
     file_input: int
     flow_stmt: int
     for_stmt: int
+    fstring: int
+    fstring_format_spec: int
+    fstring_middle: int
+    fstring_replacement_field: int
     funcdef: int
     global_stmt: int
     guard: int
     if_stmt: int
     import_as_name: int
     import_as_names: int
     import_from: int
```

### Comparing `black-24.4.0/src/blib2to3/pytree.py` & `black-24.4.1/src/blib2to3/pytree.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blib2to3/pgen2/conv.py` & `black-24.4.1/src/blib2to3/pgen2/conv.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blib2to3/pgen2/driver.py` & `black-24.4.1/src/blib2to3/pgen2/driver.py`

 * *Files 1% similar despite different names*

```diff
@@ -163,15 +163,17 @@
                 if debug:
                     self.logger.debug("Stop.")
                 break
             prefix = ""
             if type in {token.INDENT, token.DEDENT}:
                 prefix = _prefix
             lineno, column = end
-            if value.endswith("\n"):
+            # FSTRING_MIDDLE is the only token that can end with a newline, and
+            # `end` will point to the next line. For that case, don't increment lineno.
+            if value.endswith("\n") and type != token.FSTRING_MIDDLE:
                 lineno += 1
                 column = 0
         else:
             # We never broke out -- EOF is too soon (how can this happen???)
             assert start is not None
             raise parse.ParseError("incomplete input", type, value, (prefix, start))
         assert p.rootnode is not None
```

### Comparing `black-24.4.0/src/blib2to3/pgen2/grammar.py` & `black-24.4.1/src/blib2to3/pgen2/grammar.py`

 * *Files 2% similar despite different names*

```diff
@@ -214,14 +214,15 @@
 <<= LEFTSHIFTEQUAL
 >>= RIGHTSHIFTEQUAL
 **= DOUBLESTAREQUAL
 // DOUBLESLASH
 //= DOUBLESLASHEQUAL
 -> RARROW
 := COLONEQUAL
+! BANG
 """
 
 opmap = {}
 for line in opmap_raw.splitlines():
     if line:
         op, name = line.split()
         opmap[op] = getattr(token, name)
```

### Comparing `black-24.4.0/src/blib2to3/pgen2/literals.py` & `black-24.4.1/src/blib2to3/pgen2/literals.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blib2to3/pgen2/parse.py` & `black-24.4.1/src/blib2to3/pgen2/parse.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blib2to3/pgen2/pgen.py` & `black-24.4.1/src/blib2to3/pgen2/pgen.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/src/blib2to3/pgen2/token.py` & `black-24.4.1/src/blib2to3/pgen2/token.py`

 * *Files 9% similar despite different names*

```diff
@@ -62,15 +62,19 @@
 COMMENT: Final = 53
 NL: Final = 54
 RARROW: Final = 55
 AWAIT: Final = 56
 ASYNC: Final = 57
 ERRORTOKEN: Final = 58
 COLONEQUAL: Final = 59
-N_TOKENS: Final = 60
+FSTRING_START: Final = 60
+FSTRING_MIDDLE: Final = 61
+FSTRING_END: Final = 62
+BANG: Final = 63
+N_TOKENS: Final = 64
 NT_OFFSET: Final = 256
 # --end constants--
 
 tok_name: Final[Dict[int, str]] = {}
 for _name, _value in list(globals().items()):
     if type(_value) is int:
         tok_name[_value] = _name
```

### Comparing `black-24.4.0/tests/conftest.py` & `black-24.4.1/tests/conftest.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/optional.py` & `black-24.4.1/tests/optional.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/test_black.py` & `black-24.4.1/tests/test_black.py`

 * *Files 1% similar despite different names*

```diff
@@ -526,928 +526,928 @@
 000020d0: 203d 2062 6c61 636b 2e64 6574 6563 745f   = black.detect_
 000020e0: 7461 7267 6574 5f76 6572 7369 6f6e 7328  target_versions(
 000020f0: 726f 6f74 290a 2020 2020 2020 2020 2020  root).          
 00002100: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
 00002110: 626c 6163 6b2e 5461 7267 6574 5665 7273  black.TargetVers
 00002120: 696f 6e2e 5059 3331 322c 2076 6572 7369  ion.PY312, versi
 00002130: 6f6e 7329 0a0a 2020 2020 6465 6620 7465  ons)..    def te
-00002140: 7374 5f65 7870 7265 7373 696f 6e5f 6666  st_expression_ff
-00002150: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00002160: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
-00002170: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
-00002180: 6461 7461 2822 6361 7365 7322 2c20 2265  data("cases", "e
-00002190: 7870 7265 7373 696f 6e2e 7079 2229 0a20  xpression.py"). 
-000021a0: 2020 2020 2020 2074 6d70 5f66 696c 6520         tmp_file 
-000021b0: 3d20 5061 7468 2862 6c61 636b 2e64 756d  = Path(black.dum
-000021c0: 705f 746f 5f66 696c 6528 736f 7572 6365  p_to_file(source
-000021d0: 2929 0a20 2020 2020 2020 2074 7279 3a0a  )).        try:.
-000021e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000021f0: 2e61 7373 6572 7454 7275 6528 6666 2874  .assertTrue(ff(t
-00002200: 6d70 5f66 696c 652c 2077 7269 7465 5f62  mp_file, write_b
-00002210: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
-00002220: 6163 6b2e 5945 5329 290a 2020 2020 2020  ack.YES)).      
-00002230: 2020 2020 2020 6163 7475 616c 203d 2074        actual = t
-00002240: 6d70 5f66 696c 652e 7265 6164 5f74 6578  mp_file.read_tex
-00002250: 7428 656e 636f 6469 6e67 3d22 7574 662d  t(encoding="utf-
-00002260: 3822 290a 2020 2020 2020 2020 6669 6e61  8").        fina
-00002270: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
-00002280: 206f 732e 756e 6c69 6e6b 2874 6d70 5f66   os.unlink(tmp_f
-00002290: 696c 6529 0a20 2020 2020 2020 2073 656c  ile).        sel
-000022a0: 662e 6173 7365 7274 466f 726d 6174 4571  f.assertFormatEq
-000022b0: 7561 6c28 6578 7065 6374 6564 2c20 6163  ual(expected, ac
-000022c0: 7475 616c 290a 2020 2020 2020 2020 7769  tual).        wi
-000022d0: 7468 2070 6174 6368 2822 626c 6163 6b2e  th patch("black.
-000022e0: 6475 6d70 5f74 6f5f 6669 6c65 222c 2064  dump_to_file", d
-000022f0: 756d 705f 746f 5f73 7464 6572 7229 3a0a  ump_to_stderr):.
-00002300: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-00002310: 6b2e 6173 7365 7274 5f65 7175 6976 616c  k.assert_equival
-00002320: 656e 7428 736f 7572 6365 2c20 6163 7475  ent(source, actu
-00002330: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
-00002340: 626c 6163 6b2e 6173 7365 7274 5f73 7461  black.assert_sta
-00002350: 626c 6528 736f 7572 6365 2c20 6163 7475  ble(source, actu
-00002360: 616c 2c20 4445 4641 554c 545f 4d4f 4445  al, DEFAULT_MODE
-00002370: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00002380: 6578 7072 6573 7369 6f6e 5f64 6966 6628  expression_diff(
-00002390: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000023a0: 2020 2020 2020 2073 6f75 7263 652c 205f         source, _
-000023b0: 203d 2072 6561 645f 6461 7461 2822 6361   = read_data("ca
-000023c0: 7365 7322 2c20 2265 7870 7265 7373 696f  ses", "expressio
-000023d0: 6e2e 7079 2229 0a20 2020 2020 2020 2065  n.py").        e
-000023e0: 7870 6563 7465 642c 205f 203d 2072 6561  xpected, _ = rea
-000023f0: 645f 6461 7461 2822 6361 7365 7322 2c20  d_data("cases", 
-00002400: 2265 7870 7265 7373 696f 6e2e 6469 6666  "expression.diff
-00002410: 2229 0a20 2020 2020 2020 2074 6d70 5f66  ").        tmp_f
-00002420: 696c 6520 3d20 5061 7468 2862 6c61 636b  ile = Path(black
-00002430: 2e64 756d 705f 746f 5f66 696c 6528 736f  .dump_to_file(so
-00002440: 7572 6365 2929 0a20 2020 2020 2020 2064  urce)).        d
-00002450: 6966 665f 6865 6164 6572 203d 2072 652e  iff_header = re.
-00002460: 636f 6d70 696c 6528 0a20 2020 2020 2020  compile(.       
-00002470: 2020 2020 2072 6622 7b72 652e 6573 6361       rf"{re.esca
-00002480: 7065 2873 7472 2874 6d70 5f66 696c 6529  pe(str(tmp_file)
-00002490: 297d 5c74 5c64 5c64 5c64 5c64 2d5c 645c  )}\t\d\d\d\d-\d\
-000024a0: 642d 5c64 5c64 2022 0a20 2020 2020 2020  d-\d\d ".       
-000024b0: 2020 2020 2072 225c 645c 643a 5c64 5c64       r"\d\d:\d\d
-000024c0: 3a5c 645c 645c 2e5c 645c 645c 645c 645c  :\d\d\.\d\d\d\d\
-000024d0: 645c 645c 2b5c 645c 643a 5c64 5c64 220a  d\d\+\d\d:\d\d".
-000024e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000024f0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00002500: 2020 2072 6573 756c 7420 3d20 426c 6163     result = Blac
-00002510: 6b52 756e 6e65 7228 292e 696e 766f 6b65  kRunner().invoke
-00002520: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00002530: 2020 626c 6163 6b2e 6d61 696e 2c20 5b22    black.main, ["
-00002540: 2d2d 6469 6666 222c 2073 7472 2874 6d70  --diff", str(tmp
-00002550: 5f66 696c 6529 2c20 6622 2d2d 636f 6e66  _file), f"--conf
-00002560: 6967 3d7b 454d 5054 595f 434f 4e46 4947  ig={EMPTY_CONFIG
-00002570: 7d22 5d0a 2020 2020 2020 2020 2020 2020  }"].            
-00002580: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00002590: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-000025a0: 6573 756c 742e 6578 6974 5f63 6f64 652c  esult.exit_code,
-000025b0: 2030 290a 2020 2020 2020 2020 6669 6e61   0).        fina
-000025c0: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
-000025d0: 206f 732e 756e 6c69 6e6b 2874 6d70 5f66   os.unlink(tmp_f
-000025e0: 696c 6529 0a20 2020 2020 2020 2061 6374  ile).        act
-000025f0: 7561 6c20 3d20 7265 7375 6c74 2e6f 7574  ual = result.out
-00002600: 7075 740a 2020 2020 2020 2020 6163 7475  put.        actu
-00002610: 616c 203d 2064 6966 665f 6865 6164 6572  al = diff_header
-00002620: 2e73 7562 2844 4554 4552 4d49 4e49 5354  .sub(DETERMINIST
-00002630: 4943 5f48 4541 4445 522c 2061 6374 7561  IC_HEADER, actua
-00002640: 6c29 0a20 2020 2020 2020 2069 6620 6578  l).        if ex
-00002650: 7065 6374 6564 2021 3d20 6163 7475 616c  pected != actual
-00002660: 3a0a 2020 2020 2020 2020 2020 2020 6475  :.            du
-00002670: 6d70 203d 2062 6c61 636b 2e64 756d 705f  mp = black.dump_
-00002680: 746f 5f66 696c 6528 6163 7475 616c 290a  to_file(actual).
-00002690: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-000026a0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-000026b0: 2020 2020 2245 7870 6563 7465 6420 6469      "Expected di
-000026c0: 6666 2069 736e 2774 2065 7175 616c 2074  ff isn't equal t
-000026d0: 6f20 7468 6520 6163 7475 616c 2e20 4966  o the actual. If
-000026e0: 2079 6f75 206d 6164 6520 6368 616e 6765   you made change
-000026f0: 7320 746f 220a 2020 2020 2020 2020 2020  s to".          
-00002700: 2020 2020 2020 2220 6578 7072 6573 7369        " expressi
-00002710: 6f6e 2e70 7920 616e 6420 7468 6973 2069  on.py and this i
-00002720: 7320 616e 2061 6e74 6963 6970 6174 6564  s an anticipated
-00002730: 2064 6966 6665 7265 6e63 652c 206f 7665   difference, ove
-00002740: 7277 7269 7465 220a 2020 2020 2020 2020  rwrite".        
-00002750: 2020 2020 2020 2020 6622 2074 6573 7473          f" tests
-00002760: 2f64 6174 612f 6361 7365 732f 6578 7072  /data/cases/expr
-00002770: 6573 7369 6f6e 2e64 6966 6620 7769 7468  ession.diff with
-00002780: 207b 6475 6d70 7d22 0a20 2020 2020 2020   {dump}".       
-00002790: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000027a0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000027b0: 7561 6c28 6578 7065 6374 6564 2c20 6163  ual(expected, ac
-000027c0: 7475 616c 2c20 6d73 6729 0a0a 2020 2020  tual, msg)..    
-000027d0: 6465 6620 7465 7374 5f65 7870 7265 7373  def test_express
-000027e0: 696f 6e5f 6469 6666 5f77 6974 685f 636f  ion_diff_with_co
-000027f0: 6c6f 7228 7365 6c66 2920 2d3e 204e 6f6e  lor(self) -> Non
-00002800: 653a 0a20 2020 2020 2020 2073 6f75 7263  e:.        sourc
-00002810: 652c 205f 203d 2072 6561 645f 6461 7461  e, _ = read_data
-00002820: 2822 6361 7365 7322 2c20 2265 7870 7265  ("cases", "expre
-00002830: 7373 696f 6e2e 7079 2229 0a20 2020 2020  ssion.py").     
-00002840: 2020 2065 7870 6563 7465 642c 205f 203d     expected, _ =
-00002850: 2072 6561 645f 6461 7461 2822 6361 7365   read_data("case
-00002860: 7322 2c20 2265 7870 7265 7373 696f 6e2e  s", "expression.
-00002870: 6469 6666 2229 0a20 2020 2020 2020 2074  diff").        t
-00002880: 6d70 5f66 696c 6520 3d20 5061 7468 2862  mp_file = Path(b
-00002890: 6c61 636b 2e64 756d 705f 746f 5f66 696c  lack.dump_to_fil
-000028a0: 6528 736f 7572 6365 2929 0a20 2020 2020  e(source)).     
-000028b0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000028c0: 2020 2020 7265 7375 6c74 203d 2042 6c61      result = Bla
-000028d0: 636b 5275 6e6e 6572 2829 2e69 6e76 6f6b  ckRunner().invok
-000028e0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-000028f0: 2020 2062 6c61 636b 2e6d 6169 6e2c 0a20     black.main,. 
-00002900: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00002910: 222d 2d64 6966 6622 2c20 222d 2d63 6f6c  "--diff", "--col
-00002920: 6f72 222c 2073 7472 2874 6d70 5f66 696c  or", str(tmp_fil
-00002930: 6529 2c20 6622 2d2d 636f 6e66 6967 3d7b  e), f"--config={
-00002940: 454d 5054 595f 434f 4e46 4947 7d22 5d2c  EMPTY_CONFIG}"],
-00002950: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00002960: 2020 2020 2020 2066 696e 616c 6c79 3a0a         finally:.
-00002970: 2020 2020 2020 2020 2020 2020 6f73 2e75              os.u
-00002980: 6e6c 696e 6b28 746d 705f 6669 6c65 290a  nlink(tmp_file).
-00002990: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-000029a0: 2072 6573 756c 742e 6f75 7470 7574 0a20   result.output. 
-000029b0: 2020 2020 2020 2023 2057 6520 6368 6563         # We chec
-000029c0: 6b20 7468 6520 636f 6e74 656e 7473 206f  k the contents o
-000029d0: 6620 7468 6520 6469 6666 2069 6e20 6074  f the diff in `t
-000029e0: 6573 745f 6578 7072 6573 7369 6f6e 5f64  est_expression_d
-000029f0: 6966 6660 2e20 416c 6c0a 2020 2020 2020  iff`. All.      
-00002a00: 2020 2320 7765 206e 6565 6420 746f 2063    # we need to c
-00002a10: 6865 636b 2068 6572 6520 6973 2074 6861  heck here is tha
-00002a20: 7420 636f 6c6f 7220 636f 6465 7320 6578  t color codes ex
-00002a30: 6973 7420 696e 2074 6865 2072 6573 756c  ist in the resul
-00002a40: 742e 0a20 2020 2020 2020 2073 656c 662e  t..        self.
-00002a50: 6173 7365 7274 496e 2822 5c30 3333 5b31  assertIn("\033[1
-00002a60: 6d22 2c20 6163 7475 616c 290a 2020 2020  m", actual).    
-00002a70: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00002a80: 6e28 225c 3033 335b 3336 6d22 2c20 6163  n("\033[36m", ac
-00002a90: 7475 616c 290a 2020 2020 2020 2020 7365  tual).        se
-00002aa0: 6c66 2e61 7373 6572 7449 6e28 225c 3033  lf.assertIn("\03
-00002ab0: 335b 3332 6d22 2c20 6163 7475 616c 290a  3[32m", actual).
-00002ac0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00002ad0: 6572 7449 6e28 225c 3033 335b 3331 6d22  ertIn("\033[31m"
-00002ae0: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-00002af0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-00002b00: 225c 3033 335b 306d 222c 2061 6374 7561  "\033[0m", actua
-00002b10: 6c29 0a0a 2020 2020 6465 6620 7465 7374  l)..    def test
-00002b20: 5f64 6574 6563 745f 706f 735f 6f6e 6c79  _detect_pos_only
-00002b30: 5f61 7267 756d 656e 7473 2873 656c 6629  _arguments(self)
-00002b40: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00002b50: 2020 736f 7572 6365 2c20 5f20 3d20 7265    source, _ = re
-00002b60: 6164 5f64 6174 6128 2263 6173 6573 222c  ad_data("cases",
-00002b70: 2022 7065 705f 3537 3022 290a 2020 2020   "pep_570").    
-00002b80: 2020 2020 726f 6f74 203d 2062 6c61 636b      root = black
-00002b90: 2e6c 6962 3274 6f33 5f70 6172 7365 2873  .lib2to3_parse(s
-00002ba0: 6f75 7263 6529 0a20 2020 2020 2020 2066  ource).        f
-00002bb0: 6561 7475 7265 7320 3d20 626c 6163 6b2e  eatures = black.
-00002bc0: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
-00002bd0: 6428 726f 6f74 290a 2020 2020 2020 2020  d(root).        
-00002be0: 7365 6c66 2e61 7373 6572 7449 6e28 626c  self.assertIn(bl
-00002bf0: 6163 6b2e 4665 6174 7572 652e 504f 535f  ack.Feature.POS_
-00002c00: 4f4e 4c59 5f41 5247 554d 454e 5453 2c20  ONLY_ARGUMENTS, 
-00002c10: 6665 6174 7572 6573 290a 2020 2020 2020  features).      
-00002c20: 2020 7665 7273 696f 6e73 203d 2062 6c61    versions = bla
-00002c30: 636b 2e64 6574 6563 745f 7461 7267 6574  ck.detect_target
-00002c40: 5f76 6572 7369 6f6e 7328 726f 6f74 290a  _versions(root).
-00002c50: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00002c60: 6572 7449 6e28 626c 6163 6b2e 5461 7267  ertIn(black.Targ
-00002c70: 6574 5665 7273 696f 6e2e 5059 3338 2c20  etVersion.PY38, 
-00002c80: 7665 7273 696f 6e73 290a 0a20 2020 2064  versions)..    d
-00002c90: 6566 2074 6573 745f 6465 7465 6374 5f64  ef test_detect_d
-00002ca0: 6562 7567 5f66 5f73 7472 696e 6773 2873  ebug_f_strings(s
-00002cb0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00002cc0: 2020 2020 2020 726f 6f74 203d 2062 6c61        root = bla
-00002cd0: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
-00002ce0: 2822 2222 6622 7b78 3d7d 2220 2222 2229  ("""f"{x=}" """)
-00002cf0: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-00002d00: 7320 3d20 626c 6163 6b2e 6765 745f 6665  s = black.get_fe
-00002d10: 6174 7572 6573 5f75 7365 6428 726f 6f74  atures_used(root
-00002d20: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00002d30: 7373 6572 7449 6e28 626c 6163 6b2e 4665  ssertIn(black.Fe
-00002d40: 6174 7572 652e 4445 4255 475f 465f 5354  ature.DEBUG_F_ST
-00002d50: 5249 4e47 532c 2066 6561 7475 7265 7329  RINGS, features)
-00002d60: 0a20 2020 2020 2020 2076 6572 7369 6f6e  .        version
-00002d70: 7320 3d20 626c 6163 6b2e 6465 7465 6374  s = black.detect
-00002d80: 5f74 6172 6765 745f 7665 7273 696f 6e73  _target_versions
-00002d90: 2872 6f6f 7429 0a20 2020 2020 2020 2073  (root).        s
-00002da0: 656c 662e 6173 7365 7274 496e 2862 6c61  elf.assertIn(bla
-00002db0: 636b 2e54 6172 6765 7456 6572 7369 6f6e  ck.TargetVersion
-00002dc0: 2e50 5933 382c 2076 6572 7369 6f6e 7329  .PY38, versions)
-00002dd0: 0a0a 2020 2020 2020 2020 726f 6f74 203d  ..        root =
-00002de0: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
-00002df0: 6172 7365 280a 2020 2020 2020 2020 2020  arse(.          
-00002e00: 2020 2222 2266 227b 787d 225c 6e66 277b    """f"{x}"\nf'{
-00002e10: 223d 227d 275c 6e66 277b 2878 3a3d 3529  "="}'\nf'{(x:=5)
-00002e20: 7d27 5c6e 6627 7b66 2861 3d22 333d 2229  }'\nf'{f(a="3=")
-00002e30: 7d27 5c6e 6627 7b78 3a3d 3130 7d27 5c6e  }'\nf'{x:=10}'\n
-00002e40: 2222 220a 2020 2020 2020 2020 290a 2020  """.        ).  
-00002e50: 2020 2020 2020 6665 6174 7572 6573 203d        features =
-00002e60: 2062 6c61 636b 2e67 6574 5f66 6561 7475   black.get_featu
-00002e70: 7265 735f 7573 6564 2872 6f6f 7429 0a20  res_used(root). 
-00002e80: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00002e90: 7274 4e6f 7449 6e28 626c 6163 6b2e 4665  rtNotIn(black.Fe
-00002ea0: 6174 7572 652e 4445 4255 475f 465f 5354  ature.DEBUG_F_ST
-00002eb0: 5249 4e47 532c 2066 6561 7475 7265 7329  RINGS, features)
-00002ec0: 0a0a 2020 2020 2020 2020 2320 5765 2064  ..        # We d
-00002ed0: 6f6e 2774 2079 6574 2073 7570 706f 7274  on't yet support
-00002ee0: 2066 6561 7475 7265 2076 6572 7369 6f6e   feature version
-00002ef0: 2064 6574 6563 7469 6f6e 2069 6e20 6e65   detection in ne
-00002f00: 7374 6564 2066 2d73 7472 696e 6773 0a20  sted f-strings. 
-00002f10: 2020 2020 2020 2072 6f6f 7420 3d20 626c         root = bl
-00002f20: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00002f30: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
-00002f40: 2222 6622 6865 6172 6420 6120 7275 6d6f  ""f"heard a rumo
-00002f50: 7572 2074 6861 7420 7b20 6627 7b31 2b31  ur that { f'{1+1
-00002f60: 3d7d 2720 7d20 2e2e 2e20 7365 656d 7320  =}' } ... seems 
-00002f70: 6c69 6b65 2069 7420 636f 756c 6420 6265  like it could be
-00002f80: 2074 7275 6522 2022 2222 0a20 2020 2020   true" """.     
-00002f90: 2020 2029 0a20 2020 2020 2020 2066 6561     ).        fea
-00002fa0: 7475 7265 7320 3d20 626c 6163 6b2e 6765  tures = black.ge
-00002fb0: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
-00002fc0: 726f 6f74 290a 2020 2020 2020 2020 7365  root).        se
-00002fd0: 6c66 2e61 7373 6572 744e 6f74 496e 2862  lf.assertNotIn(b
-00002fe0: 6c61 636b 2e46 6561 7475 7265 2e44 4542  lack.Feature.DEB
-00002ff0: 5547 5f46 5f53 5452 494e 4753 2c20 6665  UG_F_STRINGS, fe
-00003000: 6174 7572 6573 290a 0a20 2020 2040 7061  atures)..    @pa
-00003010: 7463 6828 2262 6c61 636b 2e64 756d 705f  tch("black.dump_
-00003020: 746f 5f66 696c 6522 2c20 6475 6d70 5f74  to_file", dump_t
-00003030: 6f5f 7374 6465 7272 290a 2020 2020 6465  o_stderr).    de
-00003040: 6620 7465 7374 5f73 7472 696e 675f 7175  f test_string_qu
-00003050: 6f74 6573 2873 656c 6629 202d 3e20 4e6f  otes(self) -> No
-00003060: 6e65 3a0a 2020 2020 2020 2020 736f 7572  ne:.        sour
-00003070: 6365 2c20 6578 7065 6374 6564 203d 2072  ce, expected = r
-00003080: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
-00003090: 6c61 6e65 6f75 7322 2c20 2273 7472 696e  laneous", "strin
-000030a0: 675f 7175 6f74 6573 2229 0a20 2020 2020  g_quotes").     
-000030b0: 2020 206d 6f64 6520 3d20 626c 6163 6b2e     mode = black.
-000030c0: 4d6f 6465 2875 6e73 7461 626c 653d 5472  Mode(unstable=Tr
-000030d0: 7565 290a 2020 2020 2020 2020 6173 7365  ue).        asse
-000030e0: 7274 5f66 6f72 6d61 7428 736f 7572 6365  rt_format(source
-000030f0: 2c20 6578 7065 6374 6564 2c20 6d6f 6465  , expected, mode
-00003100: 290a 2020 2020 2020 2020 6d6f 6465 203d  ).        mode =
-00003110: 2072 6570 6c61 6365 286d 6f64 652c 2073   replace(mode, s
-00003120: 7472 696e 675f 6e6f 726d 616c 697a 6174  tring_normalizat
-00003130: 696f 6e3d 4661 6c73 6529 0a20 2020 2020  ion=False).     
-00003140: 2020 206e 6f74 5f6e 6f72 6d61 6c69 7a65     not_normalize
-00003150: 6420 3d20 6673 2873 6f75 7263 652c 206d  d = fs(source, m
-00003160: 6f64 653d 6d6f 6465 290a 2020 2020 2020  ode=mode).      
-00003170: 2020 7365 6c66 2e61 7373 6572 7446 6f72    self.assertFor
-00003180: 6d61 7445 7175 616c 2873 6f75 7263 652e  matEqual(source.
-00003190: 7265 706c 6163 6528 225c 5c5c 6e22 2c20  replace("\\\n", 
-000031a0: 2222 292c 206e 6f74 5f6e 6f72 6d61 6c69  ""), not_normali
-000031b0: 7a65 6429 0a20 2020 2020 2020 2062 6c61  zed).        bla
-000031c0: 636b 2e61 7373 6572 745f 6571 7569 7661  ck.assert_equiva
-000031d0: 6c65 6e74 2873 6f75 7263 652c 206e 6f74  lent(source, not
-000031e0: 5f6e 6f72 6d61 6c69 7a65 6429 0a20 2020  _normalized).   
-000031f0: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
-00003200: 745f 7374 6162 6c65 2873 6f75 7263 652c  t_stable(source,
-00003210: 206e 6f74 5f6e 6f72 6d61 6c69 7a65 642c   not_normalized,
-00003220: 206d 6f64 653d 6d6f 6465 290a 0a20 2020   mode=mode)..   
-00003230: 2064 6566 2074 6573 745f 736b 6970 5f73   def test_skip_s
-00003240: 6f75 7263 655f 6669 7273 745f 6c69 6e65  ource_first_line
-00003250: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00003260: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
-00003270: 5f20 3d20 7265 6164 5f64 6174 6128 226d  _ = read_data("m
-00003280: 6973 6365 6c6c 616e 656f 7573 222c 2022  iscellaneous", "
-00003290: 696e 7661 6c69 645f 6865 6164 6572 2229  invalid_header")
-000032a0: 0a20 2020 2020 2020 2074 6d70 5f66 696c  .        tmp_fil
-000032b0: 6520 3d20 5061 7468 2862 6c61 636b 2e64  e = Path(black.d
-000032c0: 756d 705f 746f 5f66 696c 6528 736f 7572  ump_to_file(sour
-000032d0: 6365 2929 0a20 2020 2020 2020 2023 2046  ce)).        # F
-000032e0: 756c 6c20 736f 7572 6365 2073 686f 756c  ull source shoul
-000032f0: 6420 6661 696c 2028 696e 7661 6c69 6420  d fail (invalid 
-00003300: 7379 6e74 6178 2061 7420 6865 6164 6572  syntax at header
-00003310: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
-00003320: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
-00003330: 746d 705f 6669 6c65 292c 2022 2d2d 6469  tmp_file), "--di
-00003340: 6666 222c 2022 2d2d 6368 6563 6b22 5d2c  ff", "--check"],
-00003350: 2065 7869 745f 636f 6465 3d31 3233 290a   exit_code=123).
-00003360: 2020 2020 2020 2020 2320 536f 2c20 736b          # So, sk
-00003370: 6970 7069 6e67 2074 6865 2066 6972 7374  ipping the first
-00003380: 206c 696e 6520 7368 6f75 6c64 2077 6f72   line should wor
-00003390: 6b0a 2020 2020 2020 2020 7265 7375 6c74  k.        result
-000033a0: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
-000033b0: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
-000033c0: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
-000033d0: 205b 7374 7228 746d 705f 6669 6c65 292c   [str(tmp_file),
-000033e0: 2022 2d78 222c 2066 222d 2d63 6f6e 6669   "-x", f"--confi
-000033f0: 673d 7b45 4d50 5459 5f43 4f4e 4649 477d  g={EMPTY_CONFIG}
-00003400: 225d 0a20 2020 2020 2020 2029 0a20 2020  "].        ).   
-00003410: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00003420: 4571 7561 6c28 7265 7375 6c74 2e65 7869  Equal(result.exi
-00003430: 745f 636f 6465 2c20 3029 0a20 2020 2020  t_code, 0).     
-00003440: 2020 2061 6374 7561 6c20 3d20 746d 705f     actual = tmp_
-00003450: 6669 6c65 2e72 6561 645f 7465 7874 2865  file.read_text(e
-00003460: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
-00003470: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00003480: 7365 7274 466f 726d 6174 4571 7561 6c28  sertFormatEqual(
-00003490: 736f 7572 6365 2c20 6163 7475 616c 290a  source, actual).
-000034a0: 0a20 2020 2064 6566 2074 6573 745f 736b  .    def test_sk
-000034b0: 6970 5f73 6f75 7263 655f 6669 7273 745f  ip_source_first_
-000034c0: 6c69 6e65 5f77 6865 6e5f 6d69 7869 6e67  line_when_mixing
-000034d0: 5f6e 6577 6c69 6e65 7328 7365 6c66 2920  _newlines(self) 
-000034e0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000034f0: 2063 6f64 655f 6d69 7869 6e67 5f6e 6577   code_mixing_new
-00003500: 6c69 6e65 7320 3d20 6222 4865 6164 6572  lines = b"Header
-00003510: 2077 696c 6c20 6265 2073 6b69 7070 6564   will be skipped
-00003520: 5c72 5c6e 6920 3d20 5b31 2c32 2c33 5d5c  \r\ni = [1,2,3]\
-00003530: 6e6a 203d 205b 312c 322c 335d 5c6e 220a  nj = [1,2,3]\n".
-00003540: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-00003550: 203d 2062 2248 6561 6465 7220 7769 6c6c   = b"Header will
-00003560: 2062 6520 736b 6970 7065 645c 725c 6e69   be skipped\r\ni
-00003570: 203d 205b 312c 2032 2c20 335d 5c6e 6a20   = [1, 2, 3]\nj 
-00003580: 3d20 5b31 2c20 322c 2033 5d5c 6e22 0a20  = [1, 2, 3]\n". 
-00003590: 2020 2020 2020 2077 6974 6820 5465 6d70         with Temp
-000035a0: 6f72 6172 7944 6972 6563 746f 7279 2829  oraryDirectory()
-000035b0: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
-000035c0: 2020 2020 2020 2020 2020 2074 6573 745f             test_
-000035d0: 6669 6c65 203d 2050 6174 6828 776f 726b  file = Path(work
-000035e0: 7370 6163 6529 202f 2022 736b 6970 5f68  space) / "skip_h
-000035f0: 6561 6465 722e 7079 220a 2020 2020 2020  eader.py".      
-00003600: 2020 2020 2020 7465 7374 5f66 696c 652e        test_file.
-00003610: 7772 6974 655f 6279 7465 7328 636f 6465  write_bytes(code
-00003620: 5f6d 6978 696e 675f 6e65 776c 696e 6573  _mixing_newlines
-00003630: 290a 2020 2020 2020 2020 2020 2020 6d6f  ).            mo
-00003640: 6465 203d 2072 6570 6c61 6365 2844 4546  de = replace(DEF
-00003650: 4155 4c54 5f4d 4f44 452c 2073 6b69 705f  AULT_MODE, skip_
-00003660: 736f 7572 6365 5f66 6972 7374 5f6c 696e  source_first_lin
-00003670: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00003680: 2020 2020 6666 2874 6573 745f 6669 6c65      ff(test_file
-00003690: 2c20 6d6f 6465 3d6d 6f64 652c 2077 7269  , mode=mode, wri
-000036a0: 7465 5f62 6163 6b3d 626c 6163 6b2e 5772  te_back=black.Wr
-000036b0: 6974 6542 6163 6b2e 5945 5329 0a20 2020  iteBack.YES).   
-000036c0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000036d0: 7365 7274 4571 7561 6c28 7465 7374 5f66  sertEqual(test_f
-000036e0: 696c 652e 7265 6164 5f62 7974 6573 2829  ile.read_bytes()
-000036f0: 2c20 6578 7065 6374 6564 290a 0a20 2020  , expected)..   
-00003700: 2064 6566 2074 6573 745f 736b 6970 5f6d   def test_skip_m
-00003710: 6167 6963 5f74 7261 696c 696e 675f 636f  agic_trailing_co
-00003720: 6d6d 6128 7365 6c66 2920 2d3e 204e 6f6e  mma(self) -> Non
-00003730: 653a 0a20 2020 2020 2020 2073 6f75 7263  e:.        sourc
-00003740: 652c 205f 203d 2072 6561 645f 6461 7461  e, _ = read_data
-00003750: 2822 6361 7365 7322 2c20 2265 7870 7265  ("cases", "expre
-00003760: 7373 696f 6e22 290a 2020 2020 2020 2020  ssion").        
-00003770: 6578 7065 6374 6564 2c20 5f20 3d20 7265  expected, _ = re
-00003780: 6164 5f64 6174 6128 0a20 2020 2020 2020  ad_data(.       
-00003790: 2020 2020 2022 6d69 7363 656c 6c61 6e65       "miscellane
-000037a0: 6f75 7322 2c20 2265 7870 7265 7373 696f  ous", "expressio
-000037b0: 6e5f 736b 6970 5f6d 6167 6963 5f74 7261  n_skip_magic_tra
-000037c0: 696c 696e 675f 636f 6d6d 612e 6469 6666  iling_comma.diff
-000037d0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-000037e0: 2020 2020 746d 705f 6669 6c65 203d 2050      tmp_file = P
-000037f0: 6174 6828 626c 6163 6b2e 6475 6d70 5f74  ath(black.dump_t
-00003800: 6f5f 6669 6c65 2873 6f75 7263 6529 290a  o_file(source)).
-00003810: 2020 2020 2020 2020 6469 6666 5f68 6561          diff_hea
-00003820: 6465 7220 3d20 7265 2e63 6f6d 7069 6c65  der = re.compile
-00003830: 280a 2020 2020 2020 2020 2020 2020 7266  (.            rf
-00003840: 227b 7265 2e65 7363 6170 6528 7374 7228  "{re.escape(str(
-00003850: 746d 705f 6669 6c65 2929 7d5c 745c 645c  tmp_file))}\t\d\
-00003860: 645c 645c 642d 5c64 5c64 2d5c 645c 6420  d\d\d-\d\d-\d\d 
-00003870: 220a 2020 2020 2020 2020 2020 2020 7222  ".            r"
-00003880: 5c64 5c64 3a5c 645c 643a 5c64 5c64 5c2e  \d\d:\d\d:\d\d\.
-00003890: 5c64 5c64 5c64 5c64 5c64 5c64 5c2b 5c64  \d\d\d\d\d\d\+\d
-000038a0: 5c64 3a5c 645c 6422 0a20 2020 2020 2020  \d:\d\d".       
-000038b0: 2029 0a20 2020 2020 2020 2074 7279 3a0a   ).        try:.
-000038c0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000038d0: 6c74 203d 2042 6c61 636b 5275 6e6e 6572  lt = BlackRunner
-000038e0: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
-000038f0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-00003900: 2e6d 6169 6e2c 205b 222d 4322 2c20 222d  .main, ["-C", "-
-00003910: 2d64 6966 6622 2c20 7374 7228 746d 705f  -diff", str(tmp_
-00003920: 6669 6c65 292c 2066 222d 2d63 6f6e 6669  file), f"--confi
-00003930: 673d 7b45 4d50 5459 5f43 4f4e 4649 477d  g={EMPTY_CONFIG}
-00003940: 225d 0a20 2020 2020 2020 2020 2020 2029  "].            )
-00003950: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00003960: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-00003970: 7375 6c74 2e65 7869 745f 636f 6465 2c20  sult.exit_code, 
-00003980: 3029 0a20 2020 2020 2020 2066 696e 616c  0).        final
-00003990: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-000039a0: 6f73 2e75 6e6c 696e 6b28 746d 705f 6669  os.unlink(tmp_fi
-000039b0: 6c65 290a 2020 2020 2020 2020 6163 7475  le).        actu
-000039c0: 616c 203d 2072 6573 756c 742e 6f75 7470  al = result.outp
-000039d0: 7574 0a20 2020 2020 2020 2061 6374 7561  ut.        actua
-000039e0: 6c20 3d20 6469 6666 5f68 6561 6465 722e  l = diff_header.
-000039f0: 7375 6228 4445 5445 524d 494e 4953 5449  sub(DETERMINISTI
-00003a00: 435f 4845 4144 4552 2c20 6163 7475 616c  C_HEADER, actual
-00003a10: 290a 2020 2020 2020 2020 6163 7475 616c  ).        actual
-00003a20: 203d 2061 6374 7561 6c2e 7273 7472 6970   = actual.rstrip
-00003a30: 2829 202b 2022 5c6e 2220 2023 2074 6865  () + "\n"  # the
-00003a40: 2064 6966 6620 6f75 7470 7574 2068 6173   diff output has
-00003a50: 2061 2074 7261 696c 696e 6720 7370 6163   a trailing spac
-00003a60: 650a 2020 2020 2020 2020 6966 2065 7870  e.        if exp
-00003a70: 6563 7465 6420 213d 2061 6374 7561 6c3a  ected != actual:
-00003a80: 0a20 2020 2020 2020 2020 2020 2064 756d  .            dum
-00003a90: 7020 3d20 626c 6163 6b2e 6475 6d70 5f74  p = black.dump_t
-00003aa0: 6f5f 6669 6c65 2861 6374 7561 6c29 0a20  o_file(actual). 
-00003ab0: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
-00003ac0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00003ad0: 2020 2022 4578 7065 6374 6564 2064 6966     "Expected dif
-00003ae0: 6620 6973 6e27 7420 6571 7561 6c20 746f  f isn't equal to
-00003af0: 2074 6865 2061 6374 7561 6c2e 2049 6620   the actual. If 
-00003b00: 796f 7520 6d61 6465 2063 6861 6e67 6573  you made changes
-00003b10: 2074 6f22 0a20 2020 2020 2020 2020 2020   to".           
-00003b20: 2020 2020 2022 2065 7870 7265 7373 696f       " expressio
-00003b30: 6e2e 7079 2061 6e64 2074 6869 7320 6973  n.py and this is
-00003b40: 2061 6e20 616e 7469 6369 7061 7465 6420   an anticipated 
-00003b50: 6469 6666 6572 656e 6365 2c20 6f76 6572  difference, over
-00003b60: 7772 6974 6522 0a20 2020 2020 2020 2020  write".         
-00003b70: 2020 2020 2020 2022 2074 6573 7473 2f64         " tests/d
-00003b80: 6174 612f 6d69 7363 656c 6c61 6e65 6f75  ata/miscellaneou
-00003b90: 732f 6578 7072 6573 7369 6f6e 5f73 6b69  s/expression_ski
-00003ba0: 705f 6d61 6769 635f 7472 6169 6c69 6e67  p_magic_trailing
-00003bb0: 5f63 6f6d 6d61 2e64 6966 6622 0a20 2020  _comma.diff".   
-00003bc0: 2020 2020 2020 2020 2020 2020 2066 2220               f" 
-00003bd0: 7769 7468 207b 6475 6d70 7d22 0a20 2020  with {dump}".   
-00003be0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00003bf0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00003c00: 7274 4571 7561 6c28 6578 7065 6374 6564  rtEqual(expected
-00003c10: 2c20 6163 7475 616c 2c20 6d73 6729 0a0a  , actual, msg)..
-00003c20: 2020 2020 4070 6174 6368 2822 626c 6163      @patch("blac
-00003c30: 6b2e 6475 6d70 5f74 6f5f 6669 6c65 222c  k.dump_to_file",
-00003c40: 2064 756d 705f 746f 5f73 7464 6572 7229   dump_to_stderr)
-00003c50: 0a20 2020 2064 6566 2074 6573 745f 6173  .    def test_as
-00003c60: 796e 635f 6173 5f69 6465 6e74 6966 6965  ync_as_identifie
-00003c70: 7228 7365 6c66 2920 2d3e 204e 6f6e 653a  r(self) -> None:
-00003c80: 0a20 2020 2020 2020 2073 6f75 7263 655f  .        source_
-00003c90: 7061 7468 203d 2067 6574 5f63 6173 655f  path = get_case_
-00003ca0: 7061 7468 2822 6d69 7363 656c 6c61 6e65  path("miscellane
-00003cb0: 6f75 7322 2c20 2261 7379 6e63 5f61 735f  ous", "async_as_
-00003cc0: 6964 656e 7469 6669 6572 2229 0a20 2020  identifier").   
-00003cd0: 2020 2020 205f 2c20 736f 7572 6365 2c20       _, source, 
-00003ce0: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
-00003cf0: 6461 7461 5f66 726f 6d5f 6669 6c65 2873  data_from_file(s
-00003d00: 6f75 7263 655f 7061 7468 290a 2020 2020  ource_path).    
-00003d10: 2020 2020 6163 7475 616c 203d 2066 7328      actual = fs(
-00003d20: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
-00003d30: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
-00003d40: 7445 7175 616c 2865 7870 6563 7465 642c  tEqual(expected,
-00003d50: 2061 6374 7561 6c29 0a20 2020 2020 2020   actual).       
-00003d60: 206d 616a 6f72 2c20 6d69 6e6f 7220 3d20   major, minor = 
-00003d70: 7379 732e 7665 7273 696f 6e5f 696e 666f  sys.version_info
-00003d80: 5b3a 325d 0a20 2020 2020 2020 2069 6620  [:2].        if 
-00003d90: 6d61 6a6f 7220 3c20 3320 6f72 2028 6d61  major < 3 or (ma
-00003da0: 6a6f 7220 3c3d 2033 2061 6e64 206d 696e  jor <= 3 and min
-00003db0: 6f72 203c 2037 293a 0a20 2020 2020 2020  or < 7):.       
-00003dc0: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
-00003dd0: 745f 6571 7569 7661 6c65 6e74 2873 6f75  t_equivalent(sou
-00003de0: 7263 652c 2061 6374 7561 6c29 0a20 2020  rce, actual).   
-00003df0: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
-00003e00: 745f 7374 6162 6c65 2873 6f75 7263 652c  t_stable(source,
-00003e10: 2061 6374 7561 6c2c 2044 4546 4155 4c54   actual, DEFAULT
-00003e20: 5f4d 4f44 4529 0a20 2020 2020 2020 2023  _MODE).        #
-00003e30: 2065 6e73 7572 6520 626c 6163 6b20 6361   ensure black ca
-00003e40: 6e20 7061 7273 6520 7468 6973 2077 6865  n parse this whe
-00003e50: 6e20 7468 6520 7461 7267 6574 2069 7320  n the target is 
-00003e60: 332e 360a 2020 2020 2020 2020 7365 6c66  3.6.        self
-00003e70: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
-00003e80: 7228 736f 7572 6365 5f70 6174 6829 2c20  r(source_path), 
-00003e90: 222d 2d74 6172 6765 742d 7665 7273 696f  "--target-versio
-00003ea0: 6e22 2c20 2270 7933 3622 5d29 0a20 2020  n", "py36"]).   
-00003eb0: 2020 2020 2023 2062 7574 206e 6f74 206f       # but not o
-00003ec0: 6e20 332e 372c 2062 6563 6175 7365 2061  n 3.7, because a
-00003ed0: 7379 6e63 2f61 7761 6974 2069 7320 6e6f  sync/await is no
-00003ee0: 206c 6f6e 6765 7220 616e 2069 6465 6e74   longer an ident
-00003ef0: 6966 6965 720a 2020 2020 2020 2020 7365  ifier.        se
-00003f00: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
-00003f10: 7374 7228 736f 7572 6365 5f70 6174 6829  str(source_path)
-00003f20: 2c20 222d 2d74 6172 6765 742d 7665 7273  , "--target-vers
-00003f30: 696f 6e22 2c20 2270 7933 3722 5d2c 2065  ion", "py37"], e
-00003f40: 7869 745f 636f 6465 3d31 3233 290a 0a20  xit_code=123).. 
-00003f50: 2020 2040 7061 7463 6828 2262 6c61 636b     @patch("black
-00003f60: 2e64 756d 705f 746f 5f66 696c 6522 2c20  .dump_to_file", 
-00003f70: 6475 6d70 5f74 6f5f 7374 6465 7272 290a  dump_to_stderr).
-00003f80: 2020 2020 6465 6620 7465 7374 5f70 7974      def test_pyt
-00003f90: 686f 6e33 3728 7365 6c66 2920 2d3e 204e  hon37(self) -> N
-00003fa0: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
-00003fb0: 7263 655f 7061 7468 203d 2067 6574 5f63  rce_path = get_c
-00003fc0: 6173 655f 7061 7468 2822 6361 7365 7322  ase_path("cases"
-00003fd0: 2c20 2270 7974 686f 6e33 3722 290a 2020  , "python37").  
-00003fe0: 2020 2020 2020 5f2c 2073 6f75 7263 652c        _, source,
-00003ff0: 2065 7870 6563 7465 6420 3d20 7265 6164   expected = read
-00004000: 5f64 6174 615f 6672 6f6d 5f66 696c 6528  _data_from_file(
-00004010: 736f 7572 6365 5f70 6174 6829 0a20 2020  source_path).   
-00004020: 2020 2020 2061 6374 7561 6c20 3d20 6673       actual = fs
-00004030: 2873 6f75 7263 6529 0a20 2020 2020 2020  (source).       
-00004040: 2073 656c 662e 6173 7365 7274 466f 726d   self.assertForm
-00004050: 6174 4571 7561 6c28 6578 7065 6374 6564  atEqual(expected
-00004060: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
-00004070: 2020 6d61 6a6f 722c 206d 696e 6f72 203d    major, minor =
-00004080: 2073 7973 2e76 6572 7369 6f6e 5f69 6e66   sys.version_inf
-00004090: 6f5b 3a32 5d0a 2020 2020 2020 2020 6966  o[:2].        if
-000040a0: 206d 616a 6f72 203e 2033 206f 7220 286d   major > 3 or (m
-000040b0: 616a 6f72 203d 3d20 3320 616e 6420 6d69  ajor == 3 and mi
-000040c0: 6e6f 7220 3e3d 2037 293a 0a20 2020 2020  nor >= 7):.     
-000040d0: 2020 2020 2020 2062 6c61 636b 2e61 7373         black.ass
-000040e0: 6572 745f 6571 7569 7661 6c65 6e74 2873  ert_equivalent(s
-000040f0: 6f75 7263 652c 2061 6374 7561 6c29 0a20  ource, actual). 
-00004100: 2020 2020 2020 2062 6c61 636b 2e61 7373         black.ass
-00004110: 6572 745f 7374 6162 6c65 2873 6f75 7263  ert_stable(sourc
-00004120: 652c 2061 6374 7561 6c2c 2044 4546 4155  e, actual, DEFAU
-00004130: 4c54 5f4d 4f44 4529 0a20 2020 2020 2020  LT_MODE).       
-00004140: 2023 2065 6e73 7572 6520 626c 6163 6b20   # ensure black 
-00004150: 6361 6e20 7061 7273 6520 7468 6973 2077  can parse this w
-00004160: 6865 6e20 7468 6520 7461 7267 6574 2069  hen the target i
-00004170: 7320 332e 370a 2020 2020 2020 2020 7365  s 3.7.        se
-00004180: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
-00004190: 7374 7228 736f 7572 6365 5f70 6174 6829  str(source_path)
-000041a0: 2c20 222d 2d74 6172 6765 742d 7665 7273  , "--target-vers
-000041b0: 696f 6e22 2c20 2270 7933 3722 5d29 0a20  ion", "py37"]). 
-000041c0: 2020 2020 2020 2023 2062 7574 206e 6f74         # but not
-000041d0: 206f 6e20 332e 362c 2062 6563 6175 7365   on 3.6, because
-000041e0: 2077 6520 7573 6520 6173 796e 6320 6173   we use async as
-000041f0: 2061 2072 6573 6572 7665 6420 6b65 7977   a reserved keyw
-00004200: 6f72 640a 2020 2020 2020 2020 7365 6c66  ord.        self
-00004210: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
-00004220: 7228 736f 7572 6365 5f70 6174 6829 2c20  r(source_path), 
-00004230: 222d 2d74 6172 6765 742d 7665 7273 696f  "--target-versio
-00004240: 6e22 2c20 2270 7933 3622 5d2c 2065 7869  n", "py36"], exi
-00004250: 745f 636f 6465 3d31 3233 290a 0a20 2020  t_code=123)..   
-00004260: 2064 6566 2074 6573 745f 7461 625f 636f   def test_tab_co
-00004270: 6d6d 656e 745f 696e 6465 6e74 6174 696f  mment_indentatio
-00004280: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
-00004290: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
-000042a0: 735f 7461 6220 3d20 2269 6620 313a 5c6e  s_tab = "if 1:\n
-000042b0: 5c74 6966 2032 3a5c 6e5c 745c 7470 6173  \tif 2:\n\t\tpas
-000042c0: 735c 6e5c 7423 2063 6f6d 6d65 6e74 5c6e  s\n\t# comment\n
-000042d0: 5c74 7061 7373 5c6e 220a 2020 2020 2020  \tpass\n".      
-000042e0: 2020 636f 6e74 656e 7473 5f73 7063 203d    contents_spc =
-000042f0: 2022 6966 2031 3a5c 6e20 2020 2069 6620   "if 1:\n    if 
-00004300: 323a 5c6e 2020 2020 2020 2020 7061 7373  2:\n        pass
-00004310: 5c6e 2020 2020 2320 636f 6d6d 656e 745c  \n    # comment\
-00004320: 6e20 2020 2070 6173 735c 6e22 0a20 2020  n    pass\n".   
-00004330: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00004340: 466f 726d 6174 4571 7561 6c28 636f 6e74  FormatEqual(cont
-00004350: 656e 7473 5f73 7063 2c20 6673 2863 6f6e  ents_spc, fs(con
-00004360: 7465 6e74 735f 7370 6329 290a 2020 2020  tents_spc)).    
-00004370: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
-00004380: 6f72 6d61 7445 7175 616c 2863 6f6e 7465  ormatEqual(conte
-00004390: 6e74 735f 7370 632c 2066 7328 636f 6e74  nts_spc, fs(cont
-000043a0: 656e 7473 5f74 6162 2929 0a0a 2020 2020  ents_tab))..    
-000043b0: 2020 2020 636f 6e74 656e 7473 5f74 6162      contents_tab
-000043c0: 203d 2022 6966 2031 3a5c 6e5c 7469 6620   = "if 1:\n\tif 
-000043d0: 323a 5c6e 5c74 5c74 7061 7373 5c6e 5c74  2:\n\t\tpass\n\t
-000043e0: 5c74 2320 636f 6d6d 656e 745c 6e5c 7470  \t# comment\n\tp
-000043f0: 6173 735c 6e22 0a20 2020 2020 2020 2063  ass\n".        c
-00004400: 6f6e 7465 6e74 735f 7370 6320 3d20 2269  ontents_spc = "i
-00004410: 6620 313a 5c6e 2020 2020 6966 2032 3a5c  f 1:\n    if 2:\
-00004420: 6e20 2020 2020 2020 2070 6173 735c 6e20  n        pass\n 
-00004430: 2020 2020 2020 2023 2063 6f6d 6d65 6e74         # comment
-00004440: 5c6e 2020 2020 7061 7373 5c6e 220a 2020  \n    pass\n".  
-00004450: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00004460: 7446 6f72 6d61 7445 7175 616c 2863 6f6e  tFormatEqual(con
-00004470: 7465 6e74 735f 7370 632c 2066 7328 636f  tents_spc, fs(co
-00004480: 6e74 656e 7473 5f73 7063 2929 0a20 2020  ntents_spc)).   
-00004490: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000044a0: 466f 726d 6174 4571 7561 6c28 636f 6e74  FormatEqual(cont
-000044b0: 656e 7473 5f73 7063 2c20 6673 2863 6f6e  ents_spc, fs(con
-000044c0: 7465 6e74 735f 7461 6229 290a 0a20 2020  tents_tab))..   
-000044d0: 2020 2020 2023 206d 6978 6564 2074 6162       # mixed tab
-000044e0: 7320 616e 6420 7370 6163 6573 2028 7661  s and spaces (va
-000044f0: 6c69 6420 5079 7468 6f6e 2032 2063 6f64  lid Python 2 cod
-00004500: 6529 0a20 2020 2020 2020 2063 6f6e 7465  e).        conte
-00004510: 6e74 735f 7461 6220 3d20 2269 6620 313a  nts_tab = "if 1:
-00004520: 5c6e 2020 2020 2020 2020 6966 2032 3a5c  \n        if 2:\
-00004530: 6e5c 745c 7470 6173 735c 6e5c 7423 2063  n\t\tpass\n\t# c
-00004540: 6f6d 6d65 6e74 5c6e 2020 2020 2020 2020  omment\n        
-00004550: 7061 7373 5c6e 220a 2020 2020 2020 2020  pass\n".        
-00004560: 636f 6e74 656e 7473 5f73 7063 203d 2022  contents_spc = "
-00004570: 6966 2031 3a5c 6e20 2020 2069 6620 323a  if 1:\n    if 2:
-00004580: 5c6e 2020 2020 2020 2020 7061 7373 5c6e  \n        pass\n
-00004590: 2020 2020 2320 636f 6d6d 656e 745c 6e20      # comment\n 
-000045a0: 2020 2070 6173 735c 6e22 0a20 2020 2020     pass\n".     
-000045b0: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
-000045c0: 726d 6174 4571 7561 6c28 636f 6e74 656e  rmatEqual(conten
-000045d0: 7473 5f73 7063 2c20 6673 2863 6f6e 7465  ts_spc, fs(conte
-000045e0: 6e74 735f 7370 6329 290a 2020 2020 2020  nts_spc)).      
-000045f0: 2020 7365 6c66 2e61 7373 6572 7446 6f72    self.assertFor
-00004600: 6d61 7445 7175 616c 2863 6f6e 7465 6e74  matEqual(content
-00004610: 735f 7370 632c 2066 7328 636f 6e74 656e  s_spc, fs(conten
-00004620: 7473 5f74 6162 2929 0a0a 2020 2020 2020  ts_tab))..      
-00004630: 2020 636f 6e74 656e 7473 5f74 6162 203d    contents_tab =
-00004640: 2022 6966 2031 3a5c 6e20 2020 2020 2020   "if 1:\n       
-00004650: 2069 6620 323a 5c6e 5c74 5c74 7061 7373   if 2:\n\t\tpass
-00004660: 5c6e 5c74 5c74 2320 636f 6d6d 656e 745c  \n\t\t# comment\
-00004670: 6e20 2020 2020 2020 2070 6173 735c 6e22  n        pass\n"
-00004680: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
-00004690: 735f 7370 6320 3d20 2269 6620 313a 5c6e  s_spc = "if 1:\n
-000046a0: 2020 2020 6966 2032 3a5c 6e20 2020 2020      if 2:\n     
-000046b0: 2020 2070 6173 735c 6e20 2020 2020 2020     pass\n       
-000046c0: 2023 2063 6f6d 6d65 6e74 5c6e 2020 2020   # comment\n    
-000046d0: 7061 7373 5c6e 220a 2020 2020 2020 2020  pass\n".        
-000046e0: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
-000046f0: 7445 7175 616c 2863 6f6e 7465 6e74 735f  tEqual(contents_
-00004700: 7370 632c 2066 7328 636f 6e74 656e 7473  spc, fs(contents
-00004710: 5f73 7063 2929 0a20 2020 2020 2020 2073  _spc)).        s
-00004720: 656c 662e 6173 7365 7274 466f 726d 6174  elf.assertFormat
-00004730: 4571 7561 6c28 636f 6e74 656e 7473 5f73  Equal(contents_s
-00004740: 7063 2c20 6673 2863 6f6e 7465 6e74 735f  pc, fs(contents_
-00004750: 7461 6229 290a 0a20 2020 2064 6566 2074  tab))..    def t
-00004760: 6573 745f 6661 6c73 655f 706f 7369 7469  est_false_positi
-00004770: 7665 5f73 796d 6c69 6e6b 5f6f 7574 7075  ve_symlink_outpu
-00004780: 745f 6973 7375 655f 3333 3834 2873 656c  t_issue_3384(sel
-00004790: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-000047a0: 2020 2020 2320 456d 756c 6174 6520 7468      # Emulate th
-000047b0: 6520 6265 6861 7669 6f72 2077 6865 6e20  e behavior when 
-000047c0: 7573 696e 6720 7468 6520 434c 4920 2860  using the CLI (`
-000047d0: 626c 6163 6b20 2e2f 6368 696c 6420 202d  black ./child  -
-000047e0: 2d76 6572 626f 7365 6029 2c20 7768 6963  -verbose`), whic
-000047f0: 680a 2020 2020 2020 2020 2320 696e 766f  h.        # invo
-00004800: 6c76 6573 2070 6174 6368 696e 6720 736f  lves patching so
-00004810: 6d65 2060 7061 7468 6c69 622e 5061 7468  me `pathlib.Path
-00004820: 6020 6d65 7468 6f64 732e 2049 6e20 7061  ` methods. In pa
-00004830: 7274 6963 756c 6172 2c20 6069 735f 6469  rticular, `is_di
-00004840: 7260 2069 730a 2020 2020 2020 2020 2320  r` is.        # 
-00004850: 7061 7463 6865 6420 6f6e 6c79 206f 6e20  patched only on 
-00004860: 6974 7320 6669 7273 7420 6361 6c6c 3a20  its first call: 
-00004870: 7768 656e 2063 6865 636b 696e 6720 6966  when checking if
-00004880: 2022 2e2f 6368 696c 6422 2069 7320 6120   "./child" is a 
-00004890: 6469 7265 6374 6f72 7920 6974 0a20 2020  directory it.   
-000048a0: 2020 2020 2023 2073 686f 756c 6420 7265       # should re
-000048b0: 7475 726e 2054 7275 652e 2054 6865 2022  turn True. The "
-000048c0: 2e2f 6368 696c 6422 2066 6f6c 6465 7220  ./child" folder 
-000048d0: 6578 6973 7473 2072 656c 6174 6976 6520  exists relative 
-000048e0: 746f 2074 6865 2063 7764 2077 6865 6e0a  to the cwd when.
-000048f0: 2020 2020 2020 2020 2320 7275 6e6e 696e          # runnin
-00004900: 6720 6672 6f6d 2043 4c49 2c20 6275 7420  g from CLI, but 
-00004910: 6661 696c 7320 7768 656e 2072 756e 6e69  fails when runni
-00004920: 6e67 2074 6865 2074 6573 7473 2062 6563  ng the tests bec
-00004930: 6175 7365 2063 7764 2069 7320 6469 6666  ause cwd is diff
-00004940: 6572 656e 740a 2020 2020 2020 2020 7072  erent.        pr
-00004950: 6f6a 6563 745f 726f 6f74 203d 2050 6174  oject_root = Pat
-00004960: 6828 5448 4953 5f44 4952 202f 2022 6461  h(THIS_DIR / "da
-00004970: 7461 2220 2f20 226e 6573 7465 645f 6769  ta" / "nested_gi
-00004980: 7469 676e 6f72 655f 7465 7374 7322 290a  tignore_tests").
-00004990: 2020 2020 2020 2020 776f 726b 696e 675f          working_
-000049a0: 6469 7265 6374 6f72 7920 3d20 7072 6f6a  directory = proj
-000049b0: 6563 745f 726f 6f74 202f 2022 726f 6f74  ect_root / "root
-000049c0: 220a 0a20 2020 2020 2020 2077 6974 6820  "..        with 
-000049d0: 6368 616e 6765 5f64 6972 6563 746f 7279  change_directory
-000049e0: 2877 6f72 6b69 6e67 5f64 6972 6563 746f  (working_directo
-000049f0: 7279 293a 0a20 2020 2020 2020 2020 2020  ry):.           
-00004a00: 2023 204e 6f74 6520 7468 6174 2074 6865   # Note that the
-00004a10: 2072 6f6f 7420 666f 6c64 6572 2028 7072   root folder (pr
-00004a20: 6f6a 6563 745f 726f 6f74 2920 6973 6e27  oject_root) isn'
-00004a30: 7420 7468 6520 666f 6c64 6572 0a20 2020  t the folder.   
-00004a40: 2020 2020 2020 2020 2023 206e 616d 6564           # named
-00004a50: 2022 726f 6f74 2220 2861 6b61 2077 6f72   "root" (aka wor
-00004a60: 6b69 6e67 5f64 6972 6563 746f 7279 290a  king_directory).
-00004a70: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00004a80: 7274 203d 204d 6167 6963 4d6f 636b 2876  rt = MagicMock(v
-00004a90: 6572 626f 7365 3d54 7275 6529 0a20 2020  erbose=True).   
-00004aa0: 2020 2020 2020 2020 2062 6c61 636b 2e67           black.g
-00004ab0: 6574 5f73 6f75 7263 6573 280a 2020 2020  et_sources(.    
-00004ac0: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-00004ad0: 3d70 726f 6a65 6374 5f72 6f6f 742c 0a20  =project_root,. 
-00004ae0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00004af0: 7263 3d28 222e 2f63 6869 6c64 222c 292c  rc=("./child",),
-00004b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004b10: 2071 7569 6574 3d46 616c 7365 2c0a 2020   quiet=False,.  
-00004b20: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-00004b30: 7262 6f73 653d 5472 7565 2c0a 2020 2020  rbose=True,.    
-00004b40: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00004b50: 7564 653d 4445 4641 554c 545f 494e 434c  ude=DEFAULT_INCL
-00004b60: 5544 452c 0a20 2020 2020 2020 2020 2020  UDE,.           
-00004b70: 2020 2020 2065 7863 6c75 6465 3d4e 6f6e       exclude=Non
-00004b80: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00004b90: 2020 2072 6570 6f72 743d 7265 706f 7274     report=report
-00004ba0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004bb0: 2020 6578 7465 6e64 5f65 7863 6c75 6465    extend_exclude
-00004bc0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-00004bd0: 2020 2020 2020 2066 6f72 6365 5f65 7863         force_exc
-00004be0: 6c75 6465 3d4e 6f6e 652c 0a20 2020 2020  lude=None,.     
-00004bf0: 2020 2020 2020 2020 2020 2073 7464 696e             stdin
-00004c00: 5f66 696c 656e 616d 653d 4e6f 6e65 2c0a  _filename=None,.
-00004c10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00004c20: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
-00004c30: 2061 6e79 280a 2020 2020 2020 2020 2020   any(.          
-00004c40: 2020 6d6f 636b 5f61 7267 735b 315d 2e73    mock_args[1].s
-00004c50: 7461 7274 7377 6974 6828 2269 7320 6120  tartswith("is a 
-00004c60: 7379 6d62 6f6c 6963 206c 696e 6b20 7468  symbolic link th
-00004c70: 6174 2070 6f69 6e74 7320 6f75 7473 6964  at points outsid
-00004c80: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-00004c90: 666f 7220 5f2c 206d 6f63 6b5f 6172 6773  for _, mock_args
-00004ca0: 2c20 5f20 696e 2072 6570 6f72 742e 7061  , _ in report.pa
-00004cb0: 7468 5f69 676e 6f72 6564 2e6d 6f63 6b5f  th_ignored.mock_
-00004cc0: 6361 6c6c 730a 2020 2020 2020 2020 292c  calls.        ),
-00004cd0: 2022 4120 7379 6d62 6f6c 6963 206c 696e   "A symbolic lin
-00004ce0: 6b20 7761 7320 7265 706f 7274 6564 2e22  k was reported."
-00004cf0: 0a20 2020 2020 2020 2072 6570 6f72 742e  .        report.
-00004d00: 7061 7468 5f69 676e 6f72 6564 2e61 7373  path_ignored.ass
-00004d10: 6572 745f 6361 6c6c 6564 5f6f 6e63 655f  ert_called_once_
-00004d20: 7769 7468 280a 2020 2020 2020 2020 2020  with(.          
-00004d30: 2020 5061 7468 2877 6f72 6b69 6e67 5f64    Path(working_d
-00004d40: 6972 6563 746f 7279 2c20 2263 6869 6c64  irectory, "child
-00004d50: 222c 2022 622e 7079 2229 2c0a 2020 2020  ", "b.py"),.    
-00004d60: 2020 2020 2020 2020 226d 6174 6368 6573          "matches
-00004d70: 2061 202e 6769 7469 676e 6f72 6520 6669   a .gitignore fi
-00004d80: 6c65 2063 6f6e 7465 6e74 222c 0a20 2020  le content",.   
-00004d90: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00004da0: 7465 7374 5f72 6570 6f72 745f 7665 7262  test_report_verb
-00004db0: 6f73 6528 7365 6c66 2920 2d3e 204e 6f6e  ose(self) -> Non
-00004dc0: 653a 0a20 2020 2020 2020 2072 6570 6f72  e:.        repor
-00004dd0: 7420 3d20 5265 706f 7274 2876 6572 626f  t = Report(verbo
-00004de0: 7365 3d54 7275 6529 0a20 2020 2020 2020  se=True).       
-00004df0: 206f 7574 5f6c 696e 6573 203d 205b 5d0a   out_lines = [].
-00004e00: 2020 2020 2020 2020 6572 725f 6c69 6e65          err_line
-00004e10: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
-00004e20: 6465 6620 6f75 7428 6d73 673a 2073 7472  def out(msg: str
-00004e30: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
-00004e40: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00004e50: 2020 2020 2020 6f75 745f 6c69 6e65 732e        out_lines.
-00004e60: 6170 7065 6e64 286d 7367 290a 0a20 2020  append(msg)..   
-00004e70: 2020 2020 2064 6566 2065 7272 286d 7367       def err(msg
-00004e80: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
-00004e90: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
-00004ea0: 2020 2020 2020 2020 2020 2065 7272 5f6c             err_l
-00004eb0: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
-00004ec0: 0a0a 2020 2020 2020 2020 7769 7468 2070  ..        with p
-00004ed0: 6174 6368 2822 626c 6163 6b2e 6f75 7470  atch("black.outp
-00004ee0: 7574 2e5f 6f75 7422 2c20 6f75 7429 2c20  ut._out", out), 
-00004ef0: 7061 7463 6828 2262 6c61 636b 2e6f 7574  patch("black.out
-00004f00: 7075 742e 5f65 7272 222c 2065 7272 293a  put._err", err):
-00004f10: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00004f20: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
-00004f30: 3122 292c 2062 6c61 636b 2e43 6861 6e67  1"), black.Chang
-00004f40: 6564 2e4e 4f29 0a20 2020 2020 2020 2020  ed.NO).         
-00004f50: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00004f60: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
-00004f70: 7329 2c20 3129 0a20 2020 2020 2020 2020  s), 1).         
-00004f80: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00004f90: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
-00004fa0: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
-00004fb0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00004fc0: 7561 6c28 6f75 745f 6c69 6e65 735b 2d31  ual(out_lines[-1
-00004fd0: 5d2c 2022 6631 2061 6c72 6561 6479 2077  ], "f1 already w
-00004fe0: 656c 6c20 666f 726d 6174 7465 642c 2067  ell formatted, g
-00004ff0: 6f6f 6420 6a6f 622e 2229 0a20 2020 2020  ood job.").     
-00005000: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00005010: 7274 4571 7561 6c28 756e 7374 796c 6528  rtEqual(unstyle(
-00005020: 7374 7228 7265 706f 7274 2929 2c20 2231  str(report)), "1
-00005030: 2066 696c 6520 6c65 6674 2075 6e63 6861   file left uncha
-00005040: 6e67 6564 2e22 290a 2020 2020 2020 2020  nged.").        
-00005050: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005060: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-00005070: 726e 5f63 6f64 652c 2030 290a 2020 2020  rn_code, 0).    
-00005080: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
-00005090: 6f6e 6528 5061 7468 2822 6632 2229 2c20  one(Path("f2"), 
-000050a0: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
-000050b0: 5329 0a20 2020 2020 2020 2020 2020 2073  S).            s
-000050c0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000050d0: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
-000050e0: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
-000050f0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005100: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
-00005110: 3029 0a20 2020 2020 2020 2020 2020 2073  0).            s
-00005120: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005130: 6f75 745f 6c69 6e65 735b 2d31 5d2c 2022  out_lines[-1], "
-00005140: 7265 666f 726d 6174 7465 6420 6632 2229  reformatted f2")
-00005150: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005160: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00005170: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00005180: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
-00005190: 7429 292c 2022 3120 6669 6c65 2072 6566  t)), "1 file ref
-000051a0: 6f72 6d61 7474 6564 2c20 3120 6669 6c65  ormatted, 1 file
-000051b0: 206c 6566 7420 756e 6368 616e 6765 642e   left unchanged.
-000051c0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-000051d0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-000051e0: 7274 2e64 6f6e 6528 5061 7468 2822 6633  rt.done(Path("f3
-000051f0: 2229 2c20 626c 6163 6b2e 4368 616e 6765  "), black.Change
-00005200: 642e 4341 4348 4544 290a 2020 2020 2020  d.CACHED).      
-00005210: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005220: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
-00005230: 696e 6573 292c 2033 290a 2020 2020 2020  ines), 3).      
-00005240: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005250: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
-00005260: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
-00005270: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005280: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00005290: 2020 2020 2020 2020 6f75 745f 6c69 6e65          out_line
-000052a0: 735b 2d31 5d2c 2022 6633 2077 6173 6e27  s[-1], "f3 wasn'
-000052b0: 7420 6d6f 6469 6669 6564 206f 6e20 6469  t modified on di
-000052c0: 736b 2073 696e 6365 206c 6173 7420 7275  sk since last ru
-000052d0: 6e2e 220a 2020 2020 2020 2020 2020 2020  n.".            
-000052e0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000052f0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-00005300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005310: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-00005320: 7274 2929 2c20 2231 2066 696c 6520 7265  rt)), "1 file re
-00005330: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
-00005340: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
-00005350: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
-00005360: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005370: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00005380: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
-00005390: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
-000053a0: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
-000053b0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-000053c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000053d0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
-000053e0: 5f63 6f64 652c 2031 290a 2020 2020 2020  _code, 1).      
-000053f0: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
-00005400: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
-00005410: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
-00005420: 696c 6564 2850 6174 6828 2265 3122 292c  iled(Path("e1"),
-00005430: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
-00005440: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005450: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00005460: 6e65 7329 2c20 3329 0a20 2020 2020 2020  nes), 3).       
-00005470: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00005480: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00005490: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
-000054a0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000054b0: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
-000054c0: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
-000054d0: 6e6f 7420 666f 726d 6174 2065 313a 2062  not format e1: b
-000054e0: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
-000054f0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00005500: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00005510: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-00005520: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00005530: 2020 2020 2020 2020 2020 2231 2066 696c            "1 fil
-00005540: 6520 7265 666f 726d 6174 7465 642c 2032  e reformatted, 2
-00005550: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
-00005560: 616e 6765 642c 2031 2066 696c 6520 6661  anged, 1 file fa
-00005570: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
-00005580: 2020 2020 2020 2020 2022 2072 6566 6f72           " refor
-00005590: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
-000055a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-000055b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000055c0: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
-000055d0: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
-000055e0: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
-000055f0: 6e65 2850 6174 6828 2266 3322 292c 2062  ne(Path("f3"), b
-00005600: 6c61 636b 2e43 6861 6e67 6564 2e59 4553  lack.Changed.YES
-00005610: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005620: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00005630: 656e 286f 7574 5f6c 696e 6573 292c 2034  en(out_lines), 4
-00005640: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005650: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00005660: 656e 2865 7272 5f6c 696e 6573 292c 2031  en(err_lines), 1
-00005670: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005680: 6c66 2e61 7373 6572 7445 7175 616c 286f  lf.assertEqual(o
-00005690: 7574 5f6c 696e 6573 5b2d 315d 2c20 2272  ut_lines[-1], "r
-000056a0: 6566 6f72 6d61 7474 6564 2066 3322 290a  eformatted f3").
-000056b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000056c0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-000056d0: 2020 2020 2020 2020 2020 2020 2020 756e                un
-000056e0: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
-000056f0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00005700: 2020 2020 2232 2066 696c 6573 2072 6566      "2 files ref
-00005710: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
-00005720: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
-00005730: 2c20 3120 6669 6c65 2066 6169 6c65 6420  , 1 file failed 
-00005740: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
-00005750: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
-00005760: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00005770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005780: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
-00005790: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
-000057a0: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
-000057b0: 2020 7265 706f 7274 2e66 6169 6c65 6428    report.failed(
-000057c0: 5061 7468 2822 6532 2229 2c20 2262 6f6f  Path("e2"), "boo
-000057d0: 6d22 290a 2020 2020 2020 2020 2020 2020  m").            
-000057e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000057f0: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
-00005800: 2034 290a 2020 2020 2020 2020 2020 2020   4).            
-00005810: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00005820: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
-00005830: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
-00005840: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00005850: 2865 7272 5f6c 696e 6573 5b2d 315d 2c20  (err_lines[-1], 
-00005860: 2265 7272 6f72 3a20 6361 6e6e 6f74 2066  "error: cannot f
-00005870: 6f72 6d61 7420 6532 3a20 626f 6f6d 2229  ormat e2: boom")
-00005880: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005890: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-000058a0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-000058b0: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
-000058c0: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
-000058d0: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
-000058e0: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
-000058f0: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
-00005900: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
-00005910: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
-00005920: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
-00005930: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
-00005940: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00005950: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00005960: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
-00005970: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
-00005980: 2020 2020 7265 706f 7274 2e70 6174 685f      report.path_
-00005990: 6967 6e6f 7265 6428 5061 7468 2822 7761  ignored(Path("wa
-000059a0: 7422 292c 2022 6e6f 206d 6174 6368 2229  t"), "no match")
-000059b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000059c0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-000059d0: 6e28 6f75 745f 6c69 6e65 7329 2c20 3529  n(out_lines), 5)
-000059e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000059f0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00005a00: 6e28 6572 725f 6c69 6e65 7329 2c20 3229  n(err_lines), 2)
-00005a10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005a20: 662e 6173 7365 7274 4571 7561 6c28 6f75  f.assertEqual(ou
-00005a30: 745f 6c69 6e65 735b 2d31 5d2c 2022 7761  t_lines[-1], "wa
-00005a40: 7420 6967 6e6f 7265 643a 206e 6f20 6d61  t ignored: no ma
-00005a50: 7463 6822 290a 2020 2020 2020 2020 2020  tch").          
+00002140: 7374 5f70 6570 5f36 3936 5f76 6572 7369  st_pep_696_versi
+00002150: 6f6e 5f64 6574 6563 7469 6f6e 2873 656c  on_detection(sel
+00002160: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00002170: 2020 2020 736f 7572 6365 2c20 5f20 3d20      source, _ = 
+00002180: 7265 6164 5f64 6174 6128 2263 6173 6573  read_data("cases
+00002190: 222c 2022 7479 7065 5f70 6172 616d 5f64  ", "type_param_d
+000021a0: 6566 6175 6c74 7322 290a 2020 2020 2020  efaults").      
+000021b0: 2020 7361 6d70 6c65 7320 3d20 5b0a 2020    samples = [.  
+000021c0: 2020 2020 2020 2020 2020 736f 7572 6365            source
+000021d0: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
+000021e0: 7970 6520 585b 543d 696e 745d 203d 2066  ype X[T=int] = f
+000021f0: 6c6f 6174 222c 0a20 2020 2020 2020 2020  loat",.         
+00002200: 2020 2022 7479 7065 2058 5b54 3a69 6e74     "type X[T:int
+00002210: 3d69 6e74 5d3d 696e 7422 2c0a 2020 2020  =int]=int",.    
+00002220: 2020 2020 2020 2020 2274 7970 6520 585b          "type X[
+00002230: 2a54 733d 696e 745d 3d69 6e74 222c 0a20  *Ts=int]=int",. 
+00002240: 2020 2020 2020 2020 2020 2022 7479 7065             "type
+00002250: 2058 5b2a 5473 3d2a 696e 745d 3d69 6e74   X[*Ts=*int]=int
+00002260: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00002270: 7479 7065 2058 5b2a 2a50 3d69 6e74 5d3d  type X[**P=int]=
+00002280: 696e 7422 2c0a 2020 2020 2020 2020 5d0a  int",.        ].
+00002290: 2020 2020 2020 2020 666f 7220 7361 6d70          for samp
+000022a0: 6c65 2069 6e20 7361 6d70 6c65 733a 0a20  le in samples:. 
+000022b0: 2020 2020 2020 2020 2020 2072 6f6f 7420             root 
+000022c0: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
+000022d0: 7061 7273 6528 7361 6d70 6c65 290a 2020  parse(sample).  
+000022e0: 2020 2020 2020 2020 2020 6665 6174 7572            featur
+000022f0: 6573 203d 2062 6c61 636b 2e67 6574 5f66  es = black.get_f
+00002300: 6561 7475 7265 735f 7573 6564 2872 6f6f  eatures_used(roo
+00002310: 7429 0a20 2020 2020 2020 2020 2020 2073  t).            s
+00002320: 656c 662e 6173 7365 7274 496e 2862 6c61  elf.assertIn(bla
+00002330: 636b 2e46 6561 7475 7265 2e54 5950 455f  ck.Feature.TYPE_
+00002340: 5041 5241 4d5f 4445 4641 554c 5453 2c20  PARAM_DEFAULTS, 
+00002350: 6665 6174 7572 6573 290a 0a20 2020 2064  features)..    d
+00002360: 6566 2074 6573 745f 6578 7072 6573 7369  ef test_expressi
+00002370: 6f6e 5f66 6628 7365 6c66 2920 2d3e 204e  on_ff(self) -> N
+00002380: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
+00002390: 7263 652c 2065 7870 6563 7465 6420 3d20  rce, expected = 
+000023a0: 7265 6164 5f64 6174 6128 2263 6173 6573  read_data("cases
+000023b0: 222c 2022 6578 7072 6573 7369 6f6e 2e70  ", "expression.p
+000023c0: 7922 290a 2020 2020 2020 2020 746d 705f  y").        tmp_
+000023d0: 6669 6c65 203d 2050 6174 6828 626c 6163  file = Path(blac
+000023e0: 6b2e 6475 6d70 5f74 6f5f 6669 6c65 2873  k.dump_to_file(s
+000023f0: 6f75 7263 6529 290a 2020 2020 2020 2020  ource)).        
+00002400: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00002410: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+00002420: 2866 6628 746d 705f 6669 6c65 2c20 7772  (ff(tmp_file, wr
+00002430: 6974 655f 6261 636b 3d62 6c61 636b 2e57  ite_back=black.W
+00002440: 7269 7465 4261 636b 2e59 4553 2929 0a20  riteBack.YES)). 
+00002450: 2020 2020 2020 2020 2020 2061 6374 7561             actua
+00002460: 6c20 3d20 746d 705f 6669 6c65 2e72 6561  l = tmp_file.rea
+00002470: 645f 7465 7874 2865 6e63 6f64 696e 673d  d_text(encoding=
+00002480: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
+00002490: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
+000024a0: 2020 2020 2020 6f73 2e75 6e6c 696e 6b28        os.unlink(
+000024b0: 746d 705f 6669 6c65 290a 2020 2020 2020  tmp_file).      
+000024c0: 2020 7365 6c66 2e61 7373 6572 7446 6f72    self.assertFor
+000024d0: 6d61 7445 7175 616c 2865 7870 6563 7465  matEqual(expecte
+000024e0: 642c 2061 6374 7561 6c29 0a20 2020 2020  d, actual).     
+000024f0: 2020 2077 6974 6820 7061 7463 6828 2262     with patch("b
+00002500: 6c61 636b 2e64 756d 705f 746f 5f66 696c  lack.dump_to_fil
+00002510: 6522 2c20 6475 6d70 5f74 6f5f 7374 6465  e", dump_to_stde
+00002520: 7272 293a 0a20 2020 2020 2020 2020 2020  rr):.           
+00002530: 2062 6c61 636b 2e61 7373 6572 745f 6571   black.assert_eq
+00002540: 7569 7661 6c65 6e74 2873 6f75 7263 652c  uivalent(source,
+00002550: 2061 6374 7561 6c29 0a20 2020 2020 2020   actual).       
+00002560: 2020 2020 2062 6c61 636b 2e61 7373 6572       black.asser
+00002570: 745f 7374 6162 6c65 2873 6f75 7263 652c  t_stable(source,
+00002580: 2061 6374 7561 6c2c 2044 4546 4155 4c54   actual, DEFAULT
+00002590: 5f4d 4f44 4529 0a0a 2020 2020 6465 6620  _MODE)..    def 
+000025a0: 7465 7374 5f65 7870 7265 7373 696f 6e5f  test_expression_
+000025b0: 6469 6666 2873 656c 6629 202d 3e20 4e6f  diff(self) -> No
+000025c0: 6e65 3a0a 2020 2020 2020 2020 736f 7572  ne:.        sour
+000025d0: 6365 2c20 5f20 3d20 7265 6164 5f64 6174  ce, _ = read_dat
+000025e0: 6128 2263 6173 6573 222c 2022 6578 7072  a("cases", "expr
+000025f0: 6573 7369 6f6e 2e70 7922 290a 2020 2020  ession.py").    
+00002600: 2020 2020 6578 7065 6374 6564 2c20 5f20      expected, _ 
+00002610: 3d20 7265 6164 5f64 6174 6128 2263 6173  = read_data("cas
+00002620: 6573 222c 2022 6578 7072 6573 7369 6f6e  es", "expression
+00002630: 2e64 6966 6622 290a 2020 2020 2020 2020  .diff").        
+00002640: 746d 705f 6669 6c65 203d 2050 6174 6828  tmp_file = Path(
+00002650: 626c 6163 6b2e 6475 6d70 5f74 6f5f 6669  black.dump_to_fi
+00002660: 6c65 2873 6f75 7263 6529 290a 2020 2020  le(source)).    
+00002670: 2020 2020 6469 6666 5f68 6561 6465 7220      diff_header 
+00002680: 3d20 7265 2e63 6f6d 7069 6c65 280a 2020  = re.compile(.  
+00002690: 2020 2020 2020 2020 2020 7266 227b 7265            rf"{re
+000026a0: 2e65 7363 6170 6528 7374 7228 746d 705f  .escape(str(tmp_
+000026b0: 6669 6c65 2929 7d5c 745c 645c 645c 645c  file))}\t\d\d\d\
+000026c0: 642d 5c64 5c64 2d5c 645c 6420 220a 2020  d-\d\d-\d\d ".  
+000026d0: 2020 2020 2020 2020 2020 7222 5c64 5c64            r"\d\d
+000026e0: 3a5c 645c 643a 5c64 5c64 5c2e 5c64 5c64  :\d\d:\d\d\.\d\d
+000026f0: 5c64 5c64 5c64 5c64 5c2b 5c64 5c64 3a5c  \d\d\d\d\+\d\d:\
+00002700: 645c 6422 0a20 2020 2020 2020 2029 0a20  d\d".        ). 
+00002710: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00002720: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00002730: 2042 6c61 636b 5275 6e6e 6572 2829 2e69   BlackRunner().i
+00002740: 6e76 6f6b 6528 0a20 2020 2020 2020 2020  nvoke(.         
+00002750: 2020 2020 2020 2062 6c61 636b 2e6d 6169         black.mai
+00002760: 6e2c 205b 222d 2d64 6966 6622 2c20 7374  n, ["--diff", st
+00002770: 7228 746d 705f 6669 6c65 292c 2066 222d  r(tmp_file), f"-
+00002780: 2d63 6f6e 6669 673d 7b45 4d50 5459 5f43  -config={EMPTY_C
+00002790: 4f4e 4649 477d 225d 0a20 2020 2020 2020  ONFIG}"].       
+000027a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000027b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000027c0: 7561 6c28 7265 7375 6c74 2e65 7869 745f  ual(result.exit_
+000027d0: 636f 6465 2c20 3029 0a20 2020 2020 2020  code, 0).       
+000027e0: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
+000027f0: 2020 2020 2020 6f73 2e75 6e6c 696e 6b28        os.unlink(
+00002800: 746d 705f 6669 6c65 290a 2020 2020 2020  tmp_file).      
+00002810: 2020 6163 7475 616c 203d 2072 6573 756c    actual = resul
+00002820: 742e 6f75 7470 7574 0a20 2020 2020 2020  t.output.       
+00002830: 2061 6374 7561 6c20 3d20 6469 6666 5f68   actual = diff_h
+00002840: 6561 6465 722e 7375 6228 4445 5445 524d  eader.sub(DETERM
+00002850: 494e 4953 5449 435f 4845 4144 4552 2c20  INISTIC_HEADER, 
+00002860: 6163 7475 616c 290a 2020 2020 2020 2020  actual).        
+00002870: 6966 2065 7870 6563 7465 6420 213d 2061  if expected != a
+00002880: 6374 7561 6c3a 0a20 2020 2020 2020 2020  ctual:.         
+00002890: 2020 2064 756d 7020 3d20 626c 6163 6b2e     dump = black.
+000028a0: 6475 6d70 5f74 6f5f 6669 6c65 2861 6374  dump_to_file(act
+000028b0: 7561 6c29 0a20 2020 2020 2020 2020 2020  ual).           
+000028c0: 206d 7367 203d 2028 0a20 2020 2020 2020   msg = (.       
+000028d0: 2020 2020 2020 2020 2022 4578 7065 6374           "Expect
+000028e0: 6564 2064 6966 6620 6973 6e27 7420 6571  ed diff isn't eq
+000028f0: 7561 6c20 746f 2074 6865 2061 6374 7561  ual to the actua
+00002900: 6c2e 2049 6620 796f 7520 6d61 6465 2063  l. If you made c
+00002910: 6861 6e67 6573 2074 6f22 0a20 2020 2020  hanges to".     
+00002920: 2020 2020 2020 2020 2020 2022 2065 7870             " exp
+00002930: 7265 7373 696f 6e2e 7079 2061 6e64 2074  ression.py and t
+00002940: 6869 7320 6973 2061 6e20 616e 7469 6369  his is an antici
+00002950: 7061 7465 6420 6469 6666 6572 656e 6365  pated difference
+00002960: 2c20 6f76 6572 7772 6974 6522 0a20 2020  , overwrite".   
+00002970: 2020 2020 2020 2020 2020 2020 2066 2220               f" 
+00002980: 7465 7374 732f 6461 7461 2f63 6173 6573  tests/data/cases
+00002990: 2f65 7870 7265 7373 696f 6e2e 6469 6666  /expression.diff
+000029a0: 2077 6974 6820 7b64 756d 707d 220a 2020   with {dump}".  
+000029b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000029c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000029d0: 6572 7445 7175 616c 2865 7870 6563 7465  ertEqual(expecte
+000029e0: 642c 2061 6374 7561 6c2c 206d 7367 290a  d, actual, msg).
+000029f0: 0a20 2020 2064 6566 2074 6573 745f 6578  .    def test_ex
+00002a00: 7072 6573 7369 6f6e 5f64 6966 665f 7769  pression_diff_wi
+00002a10: 7468 5f63 6f6c 6f72 2873 656c 6629 202d  th_color(self) -
+00002a20: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00002a30: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
+00002a40: 5f64 6174 6128 2263 6173 6573 222c 2022  _data("cases", "
+00002a50: 6578 7072 6573 7369 6f6e 2e70 7922 290a  expression.py").
+00002a60: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+00002a70: 2c20 5f20 3d20 7265 6164 5f64 6174 6128  , _ = read_data(
+00002a80: 2263 6173 6573 222c 2022 6578 7072 6573  "cases", "expres
+00002a90: 7369 6f6e 2e64 6966 6622 290a 2020 2020  sion.diff").    
+00002aa0: 2020 2020 746d 705f 6669 6c65 203d 2050      tmp_file = P
+00002ab0: 6174 6828 626c 6163 6b2e 6475 6d70 5f74  ath(black.dump_t
+00002ac0: 6f5f 6669 6c65 2873 6f75 7263 6529 290a  o_file(source)).
+00002ad0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00002ae0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00002af0: 3d20 426c 6163 6b52 756e 6e65 7228 292e  = BlackRunner().
+00002b00: 696e 766f 6b65 280a 2020 2020 2020 2020  invoke(.        
+00002b10: 2020 2020 2020 2020 626c 6163 6b2e 6d61          black.ma
+00002b20: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+00002b30: 2020 2020 5b22 2d2d 6469 6666 222c 2022      ["--diff", "
+00002b40: 2d2d 636f 6c6f 7222 2c20 7374 7228 746d  --color", str(tm
+00002b50: 705f 6669 6c65 292c 2066 222d 2d63 6f6e  p_file), f"--con
+00002b60: 6669 673d 7b45 4d50 5459 5f43 4f4e 4649  fig={EMPTY_CONFI
+00002b70: 477d 225d 2c0a 2020 2020 2020 2020 2020  G}"],.          
+00002b80: 2020 290a 2020 2020 2020 2020 6669 6e61    ).        fina
+00002b90: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
+00002ba0: 206f 732e 756e 6c69 6e6b 2874 6d70 5f66   os.unlink(tmp_f
+00002bb0: 696c 6529 0a20 2020 2020 2020 2061 6374  ile).        act
+00002bc0: 7561 6c20 3d20 7265 7375 6c74 2e6f 7574  ual = result.out
+00002bd0: 7075 740a 2020 2020 2020 2020 2320 5765  put.        # We
+00002be0: 2063 6865 636b 2074 6865 2063 6f6e 7465   check the conte
+00002bf0: 6e74 7320 6f66 2074 6865 2064 6966 6620  nts of the diff 
+00002c00: 696e 2060 7465 7374 5f65 7870 7265 7373  in `test_express
+00002c10: 696f 6e5f 6469 6666 602e 2041 6c6c 0a20  ion_diff`. All. 
+00002c20: 2020 2020 2020 2023 2077 6520 6e65 6564         # we need
+00002c30: 2074 6f20 6368 6563 6b20 6865 7265 2069   to check here i
+00002c40: 7320 7468 6174 2063 6f6c 6f72 2063 6f64  s that color cod
+00002c50: 6573 2065 7869 7374 2069 6e20 7468 6520  es exist in the 
+00002c60: 7265 7375 6c74 2e0a 2020 2020 2020 2020  result..        
+00002c70: 7365 6c66 2e61 7373 6572 7449 6e28 225c  self.assertIn("\
+00002c80: 3033 335b 316d 222c 2061 6374 7561 6c29  033[1m", actual)
+00002c90: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00002ca0: 7365 7274 496e 2822 5c30 3333 5b33 366d  sertIn("\033[36m
+00002cb0: 222c 2061 6374 7561 6c29 0a20 2020 2020  ", actual).     
+00002cc0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
+00002cd0: 2822 5c30 3333 5b33 326d 222c 2061 6374  ("\033[32m", act
+00002ce0: 7561 6c29 0a20 2020 2020 2020 2073 656c  ual).        sel
+00002cf0: 662e 6173 7365 7274 496e 2822 5c30 3333  f.assertIn("\033
+00002d00: 5b33 316d 222c 2061 6374 7561 6c29 0a20  [31m", actual). 
+00002d10: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00002d20: 7274 496e 2822 5c30 3333 5b30 6d22 2c20  rtIn("\033[0m", 
+00002d30: 6163 7475 616c 290a 0a20 2020 2064 6566  actual)..    def
+00002d40: 2074 6573 745f 6465 7465 6374 5f70 6f73   test_detect_pos
+00002d50: 5f6f 6e6c 795f 6172 6775 6d65 6e74 7328  _only_arguments(
+00002d60: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00002d70: 2020 2020 2020 2073 6f75 7263 652c 205f         source, _
+00002d80: 203d 2072 6561 645f 6461 7461 2822 6361   = read_data("ca
+00002d90: 7365 7322 2c20 2270 6570 5f35 3730 2229  ses", "pep_570")
+00002da0: 0a20 2020 2020 2020 2072 6f6f 7420 3d20  .        root = 
+00002db0: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
+00002dc0: 7273 6528 736f 7572 6365 290a 2020 2020  rse(source).    
+00002dd0: 2020 2020 6665 6174 7572 6573 203d 2062      features = b
+00002de0: 6c61 636b 2e67 6574 5f66 6561 7475 7265  lack.get_feature
+00002df0: 735f 7573 6564 2872 6f6f 7429 0a20 2020  s_used(root).   
+00002e00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00002e10: 496e 2862 6c61 636b 2e46 6561 7475 7265  In(black.Feature
+00002e20: 2e50 4f53 5f4f 4e4c 595f 4152 4755 4d45  .POS_ONLY_ARGUME
+00002e30: 4e54 532c 2066 6561 7475 7265 7329 0a20  NTS, features). 
+00002e40: 2020 2020 2020 2076 6572 7369 6f6e 7320         versions 
+00002e50: 3d20 626c 6163 6b2e 6465 7465 6374 5f74  = black.detect_t
+00002e60: 6172 6765 745f 7665 7273 696f 6e73 2872  arget_versions(r
+00002e70: 6f6f 7429 0a20 2020 2020 2020 2073 656c  oot).        sel
+00002e80: 662e 6173 7365 7274 496e 2862 6c61 636b  f.assertIn(black
+00002e90: 2e54 6172 6765 7456 6572 7369 6f6e 2e50  .TargetVersion.P
+00002ea0: 5933 382c 2076 6572 7369 6f6e 7329 0a0a  Y38, versions)..
+00002eb0: 2020 2020 6465 6620 7465 7374 5f64 6574      def test_det
+00002ec0: 6563 745f 6465 6275 675f 665f 7374 7269  ect_debug_f_stri
+00002ed0: 6e67 7328 7365 6c66 2920 2d3e 204e 6f6e  ngs(self) -> Non
+00002ee0: 653a 0a20 2020 2020 2020 2072 6f6f 7420  e:.        root 
+00002ef0: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
+00002f00: 7061 7273 6528 2222 2266 227b 783d 7d22  parse("""f"{x=}"
+00002f10: 2022 2222 290a 2020 2020 2020 2020 6665   """).        fe
+00002f20: 6174 7572 6573 203d 2062 6c61 636b 2e67  atures = black.g
+00002f30: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
+00002f40: 2872 6f6f 7429 0a20 2020 2020 2020 2073  (root).        s
+00002f50: 656c 662e 6173 7365 7274 496e 2862 6c61  elf.assertIn(bla
+00002f60: 636b 2e46 6561 7475 7265 2e44 4542 5547  ck.Feature.DEBUG
+00002f70: 5f46 5f53 5452 494e 4753 2c20 6665 6174  _F_STRINGS, feat
+00002f80: 7572 6573 290a 2020 2020 2020 2020 7665  ures).        ve
+00002f90: 7273 696f 6e73 203d 2062 6c61 636b 2e64  rsions = black.d
+00002fa0: 6574 6563 745f 7461 7267 6574 5f76 6572  etect_target_ver
+00002fb0: 7369 6f6e 7328 726f 6f74 290a 2020 2020  sions(root).    
+00002fc0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00002fd0: 6e28 626c 6163 6b2e 5461 7267 6574 5665  n(black.TargetVe
+00002fe0: 7273 696f 6e2e 5059 3338 2c20 7665 7273  rsion.PY38, vers
+00002ff0: 696f 6e73 290a 0a20 2020 2020 2020 2072  ions)..        r
+00003000: 6f6f 7420 3d20 626c 6163 6b2e 6c69 6232  oot = black.lib2
+00003010: 746f 335f 7061 7273 6528 0a20 2020 2020  to3_parse(.     
+00003020: 2020 2020 2020 2022 2222 6622 7b78 7d22         """f"{x}"
+00003030: 5c6e 6627 7b22 3d22 7d27 5c6e 6627 7b28  \nf'{"="}'\nf'{(
+00003040: 783a 3d35 297d 275c 6e66 277b 6628 613d  x:=5)}'\nf'{f(a=
+00003050: 2233 3d22 297d 275c 6e66 277b 783a 3d31  "3=")}'\nf'{x:=1
+00003060: 307d 275c 6e22 2222 0a20 2020 2020 2020  0}'\n""".       
+00003070: 2029 0a20 2020 2020 2020 2066 6561 7475   ).        featu
+00003080: 7265 7320 3d20 626c 6163 6b2e 6765 745f  res = black.get_
+00003090: 6665 6174 7572 6573 5f75 7365 6428 726f  features_used(ro
+000030a0: 6f74 290a 2020 2020 2020 2020 7365 6c66  ot).        self
+000030b0: 2e61 7373 6572 744e 6f74 496e 2862 6c61  .assertNotIn(bla
+000030c0: 636b 2e46 6561 7475 7265 2e44 4542 5547  ck.Feature.DEBUG
+000030d0: 5f46 5f53 5452 494e 4753 2c20 6665 6174  _F_STRINGS, feat
+000030e0: 7572 6573 290a 0a20 2020 2020 2020 2072  ures)..        r
+000030f0: 6f6f 7420 3d20 626c 6163 6b2e 6c69 6232  oot = black.lib2
+00003100: 746f 335f 7061 7273 6528 0a20 2020 2020  to3_parse(.     
+00003110: 2020 2020 2020 2022 2222 6622 6865 6172         """f"hear
+00003120: 6420 6120 7275 6d6f 7572 2074 6861 7420  d a rumour that 
+00003130: 7b20 6627 7b31 2b31 3d7d 2720 7d20 2e2e  { f'{1+1=}' } ..
+00003140: 2e20 7365 656d 7320 6c69 6b65 2069 7420  . seems like it 
+00003150: 636f 756c 6420 6265 2074 7275 6522 2022  could be true" "
+00003160: 2222 0a20 2020 2020 2020 2029 0a20 2020  "".        ).   
+00003170: 2020 2020 2066 6561 7475 7265 7320 3d20       features = 
+00003180: 626c 6163 6b2e 6765 745f 6665 6174 7572  black.get_featur
+00003190: 6573 5f75 7365 6428 726f 6f74 290a 2020  es_used(root).  
+000031a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000031b0: 7449 6e28 626c 6163 6b2e 4665 6174 7572  tIn(black.Featur
+000031c0: 652e 4445 4255 475f 465f 5354 5249 4e47  e.DEBUG_F_STRING
+000031d0: 532c 2066 6561 7475 7265 7329 0a0a 2020  S, features)..  
+000031e0: 2020 4070 6174 6368 2822 626c 6163 6b2e    @patch("black.
+000031f0: 6475 6d70 5f74 6f5f 6669 6c65 222c 2064  dump_to_file", d
+00003200: 756d 705f 746f 5f73 7464 6572 7229 0a20  ump_to_stderr). 
+00003210: 2020 2064 6566 2074 6573 745f 7374 7269     def test_stri
+00003220: 6e67 5f71 756f 7465 7328 7365 6c66 2920  ng_quotes(self) 
+00003230: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00003240: 2073 6f75 7263 652c 2065 7870 6563 7465   source, expecte
+00003250: 6420 3d20 7265 6164 5f64 6174 6128 226d  d = read_data("m
+00003260: 6973 6365 6c6c 616e 656f 7573 222c 2022  iscellaneous", "
+00003270: 7374 7269 6e67 5f71 756f 7465 7322 290a  string_quotes").
+00003280: 2020 2020 2020 2020 6d6f 6465 203d 2062          mode = b
+00003290: 6c61 636b 2e4d 6f64 6528 756e 7374 6162  lack.Mode(unstab
+000032a0: 6c65 3d54 7275 6529 0a20 2020 2020 2020  le=True).       
+000032b0: 2061 7373 6572 745f 666f 726d 6174 2873   assert_format(s
+000032c0: 6f75 7263 652c 2065 7870 6563 7465 642c  ource, expected,
+000032d0: 206d 6f64 6529 0a20 2020 2020 2020 206d   mode).        m
+000032e0: 6f64 6520 3d20 7265 706c 6163 6528 6d6f  ode = replace(mo
+000032f0: 6465 2c20 7374 7269 6e67 5f6e 6f72 6d61  de, string_norma
+00003300: 6c69 7a61 7469 6f6e 3d46 616c 7365 290a  lization=False).
+00003310: 2020 2020 2020 2020 6e6f 745f 6e6f 726d          not_norm
+00003320: 616c 697a 6564 203d 2066 7328 736f 7572  alized = fs(sour
+00003330: 6365 2c20 6d6f 6465 3d6d 6f64 6529 0a20  ce, mode=mode). 
+00003340: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00003350: 7274 466f 726d 6174 4571 7561 6c28 736f  rtFormatEqual(so
+00003360: 7572 6365 2e72 6570 6c61 6365 2822 5c5c  urce.replace("\\
+00003370: 5c6e 222c 2022 2229 2c20 6e6f 745f 6e6f  \n", ""), not_no
+00003380: 726d 616c 697a 6564 290a 2020 2020 2020  rmalized).      
+00003390: 2020 626c 6163 6b2e 6173 7365 7274 5f65    black.assert_e
+000033a0: 7175 6976 616c 656e 7428 736f 7572 6365  quivalent(source
+000033b0: 2c20 6e6f 745f 6e6f 726d 616c 697a 6564  , not_normalized
+000033c0: 290a 2020 2020 2020 2020 626c 6163 6b2e  ).        black.
+000033d0: 6173 7365 7274 5f73 7461 626c 6528 736f  assert_stable(so
+000033e0: 7572 6365 2c20 6e6f 745f 6e6f 726d 616c  urce, not_normal
+000033f0: 697a 6564 2c20 6d6f 6465 3d6d 6f64 6529  ized, mode=mode)
+00003400: 0a0a 2020 2020 6465 6620 7465 7374 5f73  ..    def test_s
+00003410: 6b69 705f 736f 7572 6365 5f66 6972 7374  kip_source_first
+00003420: 5f6c 696e 6528 7365 6c66 2920 2d3e 204e  _line(self) -> N
+00003430: 6f6e 653a 0a20 2020 2020 2020 2073 6f75  one:.        sou
+00003440: 7263 652c 205f 203d 2072 6561 645f 6461  rce, _ = read_da
+00003450: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
+00003460: 7322 2c20 2269 6e76 616c 6964 5f68 6561  s", "invalid_hea
+00003470: 6465 7222 290a 2020 2020 2020 2020 746d  der").        tm
+00003480: 705f 6669 6c65 203d 2050 6174 6828 626c  p_file = Path(bl
+00003490: 6163 6b2e 6475 6d70 5f74 6f5f 6669 6c65  ack.dump_to_file
+000034a0: 2873 6f75 7263 6529 290a 2020 2020 2020  (source)).      
+000034b0: 2020 2320 4675 6c6c 2073 6f75 7263 6520    # Full source 
+000034c0: 7368 6f75 6c64 2066 6169 6c20 2869 6e76  should fail (inv
+000034d0: 616c 6964 2073 796e 7461 7820 6174 2068  alid syntax at h
+000034e0: 6561 6465 7229 0a20 2020 2020 2020 2073  eader).        s
+000034f0: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
+00003500: 5b73 7472 2874 6d70 5f66 696c 6529 2c20  [str(tmp_file), 
+00003510: 222d 2d64 6966 6622 2c20 222d 2d63 6865  "--diff", "--che
+00003520: 636b 225d 2c20 6578 6974 5f63 6f64 653d  ck"], exit_code=
+00003530: 3132 3329 0a20 2020 2020 2020 2023 2053  123).        # S
+00003540: 6f2c 2073 6b69 7070 696e 6720 7468 6520  o, skipping the 
+00003550: 6669 7273 7420 6c69 6e65 2073 686f 756c  first line shoul
+00003560: 6420 776f 726b 0a20 2020 2020 2020 2072  d work.        r
+00003570: 6573 756c 7420 3d20 426c 6163 6b52 756e  esult = BlackRun
+00003580: 6e65 7228 292e 696e 766f 6b65 280a 2020  ner().invoke(.  
+00003590: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+000035a0: 6d61 696e 2c20 5b73 7472 2874 6d70 5f66  main, [str(tmp_f
+000035b0: 696c 6529 2c20 222d 7822 2c20 6622 2d2d  ile), "-x", f"--
+000035c0: 636f 6e66 6967 3d7b 454d 5054 595f 434f  config={EMPTY_CO
+000035d0: 4e46 4947 7d22 5d0a 2020 2020 2020 2020  NFIG}"].        
+000035e0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+000035f0: 7373 6572 7445 7175 616c 2872 6573 756c  ssertEqual(resul
+00003600: 742e 6578 6974 5f63 6f64 652c 2030 290a  t.exit_code, 0).
+00003610: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
+00003620: 2074 6d70 5f66 696c 652e 7265 6164 5f74   tmp_file.read_t
+00003630: 6578 7428 656e 636f 6469 6e67 3d22 7574  ext(encoding="ut
+00003640: 662d 3822 290a 2020 2020 2020 2020 7365  f-8").        se
+00003650: 6c66 2e61 7373 6572 7446 6f72 6d61 7445  lf.assertFormatE
+00003660: 7175 616c 2873 6f75 7263 652c 2061 6374  qual(source, act
+00003670: 7561 6c29 0a0a 2020 2020 6465 6620 7465  ual)..    def te
+00003680: 7374 5f73 6b69 705f 736f 7572 6365 5f66  st_skip_source_f
+00003690: 6972 7374 5f6c 696e 655f 7768 656e 5f6d  irst_line_when_m
+000036a0: 6978 696e 675f 6e65 776c 696e 6573 2873  ixing_newlines(s
+000036b0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+000036c0: 2020 2020 2020 636f 6465 5f6d 6978 696e        code_mixin
+000036d0: 675f 6e65 776c 696e 6573 203d 2062 2248  g_newlines = b"H
+000036e0: 6561 6465 7220 7769 6c6c 2062 6520 736b  eader will be sk
+000036f0: 6970 7065 645c 725c 6e69 203d 205b 312c  ipped\r\ni = [1,
+00003700: 322c 335d 5c6e 6a20 3d20 5b31 2c32 2c33  2,3]\nj = [1,2,3
+00003710: 5d5c 6e22 0a20 2020 2020 2020 2065 7870  ]\n".        exp
+00003720: 6563 7465 6420 3d20 6222 4865 6164 6572  ected = b"Header
+00003730: 2077 696c 6c20 6265 2073 6b69 7070 6564   will be skipped
+00003740: 5c72 5c6e 6920 3d20 5b31 2c20 322c 2033  \r\ni = [1, 2, 3
+00003750: 5d5c 6e6a 203d 205b 312c 2032 2c20 335d  ]\nj = [1, 2, 3]
+00003760: 5c6e 220a 2020 2020 2020 2020 7769 7468  \n".        with
+00003770: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
+00003780: 6f72 7928 2920 6173 2077 6f72 6b73 7061  ory() as workspa
+00003790: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+000037a0: 7465 7374 5f66 696c 6520 3d20 5061 7468  test_file = Path
+000037b0: 2877 6f72 6b73 7061 6365 2920 2f20 2273  (workspace) / "s
+000037c0: 6b69 705f 6865 6164 6572 2e70 7922 0a20  kip_header.py". 
+000037d0: 2020 2020 2020 2020 2020 2074 6573 745f             test_
+000037e0: 6669 6c65 2e77 7269 7465 5f62 7974 6573  file.write_bytes
+000037f0: 2863 6f64 655f 6d69 7869 6e67 5f6e 6577  (code_mixing_new
+00003800: 6c69 6e65 7329 0a20 2020 2020 2020 2020  lines).         
+00003810: 2020 206d 6f64 6520 3d20 7265 706c 6163     mode = replac
+00003820: 6528 4445 4641 554c 545f 4d4f 4445 2c20  e(DEFAULT_MODE, 
+00003830: 736b 6970 5f73 6f75 7263 655f 6669 7273  skip_source_firs
+00003840: 745f 6c69 6e65 3d54 7275 6529 0a20 2020  t_line=True).   
+00003850: 2020 2020 2020 2020 2066 6628 7465 7374           ff(test
+00003860: 5f66 696c 652c 206d 6f64 653d 6d6f 6465  _file, mode=mode
+00003870: 2c20 7772 6974 655f 6261 636b 3d62 6c61  , write_back=bla
+00003880: 636b 2e57 7269 7465 4261 636b 2e59 4553  ck.WriteBack.YES
+00003890: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000038a0: 6c66 2e61 7373 6572 7445 7175 616c 2874  lf.assertEqual(t
+000038b0: 6573 745f 6669 6c65 2e72 6561 645f 6279  est_file.read_by
+000038c0: 7465 7328 292c 2065 7870 6563 7465 6429  tes(), expected)
+000038d0: 0a0a 2020 2020 6465 6620 7465 7374 5f73  ..    def test_s
+000038e0: 6b69 705f 6d61 6769 635f 7472 6169 6c69  kip_magic_traili
+000038f0: 6e67 5f63 6f6d 6d61 2873 656c 6629 202d  ng_comma(self) -
+00003900: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00003910: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
+00003920: 5f64 6174 6128 2263 6173 6573 222c 2022  _data("cases", "
+00003930: 6578 7072 6573 7369 6f6e 2229 0a20 2020  expression").   
+00003940: 2020 2020 2065 7870 6563 7465 642c 205f       expected, _
+00003950: 203d 2072 6561 645f 6461 7461 280a 2020   = read_data(.  
+00003960: 2020 2020 2020 2020 2020 226d 6973 6365            "misce
+00003970: 6c6c 616e 656f 7573 222c 2022 6578 7072  llaneous", "expr
+00003980: 6573 7369 6f6e 5f73 6b69 705f 6d61 6769  ession_skip_magi
+00003990: 635f 7472 6169 6c69 6e67 5f63 6f6d 6d61  c_trailing_comma
+000039a0: 2e64 6966 6622 0a20 2020 2020 2020 2029  .diff".        )
+000039b0: 0a20 2020 2020 2020 2074 6d70 5f66 696c  .        tmp_fil
+000039c0: 6520 3d20 5061 7468 2862 6c61 636b 2e64  e = Path(black.d
+000039d0: 756d 705f 746f 5f66 696c 6528 736f 7572  ump_to_file(sour
+000039e0: 6365 2929 0a20 2020 2020 2020 2064 6966  ce)).        dif
+000039f0: 665f 6865 6164 6572 203d 2072 652e 636f  f_header = re.co
+00003a00: 6d70 696c 6528 0a20 2020 2020 2020 2020  mpile(.         
+00003a10: 2020 2072 6622 7b72 652e 6573 6361 7065     rf"{re.escape
+00003a20: 2873 7472 2874 6d70 5f66 696c 6529 297d  (str(tmp_file))}
+00003a30: 5c74 5c64 5c64 5c64 5c64 2d5c 645c 642d  \t\d\d\d\d-\d\d-
+00003a40: 5c64 5c64 2022 0a20 2020 2020 2020 2020  \d\d ".         
+00003a50: 2020 2072 225c 645c 643a 5c64 5c64 3a5c     r"\d\d:\d\d:\
+00003a60: 645c 645c 2e5c 645c 645c 645c 645c 645c  d\d\.\d\d\d\d\d\
+00003a70: 645c 2b5c 645c 643a 5c64 5c64 220a 2020  d\+\d\d:\d\d".  
+00003a80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00003a90: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00003aa0: 2072 6573 756c 7420 3d20 426c 6163 6b52   result = BlackR
+00003ab0: 756e 6e65 7228 292e 696e 766f 6b65 280a  unner().invoke(.
+00003ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ad0: 626c 6163 6b2e 6d61 696e 2c20 5b22 2d43  black.main, ["-C
+00003ae0: 222c 2022 2d2d 6469 6666 222c 2073 7472  ", "--diff", str
+00003af0: 2874 6d70 5f66 696c 6529 2c20 6622 2d2d  (tmp_file), f"--
+00003b00: 636f 6e66 6967 3d7b 454d 5054 595f 434f  config={EMPTY_CO
+00003b10: 4e46 4947 7d22 5d0a 2020 2020 2020 2020  NFIG}"].        
+00003b20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00003b30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00003b40: 616c 2872 6573 756c 742e 6578 6974 5f63  al(result.exit_c
+00003b50: 6f64 652c 2030 290a 2020 2020 2020 2020  ode, 0).        
+00003b60: 6669 6e61 6c6c 793a 0a20 2020 2020 2020  finally:.       
+00003b70: 2020 2020 206f 732e 756e 6c69 6e6b 2874       os.unlink(t
+00003b80: 6d70 5f66 696c 6529 0a20 2020 2020 2020  mp_file).       
+00003b90: 2061 6374 7561 6c20 3d20 7265 7375 6c74   actual = result
+00003ba0: 2e6f 7574 7075 740a 2020 2020 2020 2020  .output.        
+00003bb0: 6163 7475 616c 203d 2064 6966 665f 6865  actual = diff_he
+00003bc0: 6164 6572 2e73 7562 2844 4554 4552 4d49  ader.sub(DETERMI
+00003bd0: 4e49 5354 4943 5f48 4541 4445 522c 2061  NISTIC_HEADER, a
+00003be0: 6374 7561 6c29 0a20 2020 2020 2020 2061  ctual).        a
+00003bf0: 6374 7561 6c20 3d20 6163 7475 616c 2e72  ctual = actual.r
+00003c00: 7374 7269 7028 2920 2b20 225c 6e22 2020  strip() + "\n"  
+00003c10: 2320 7468 6520 6469 6666 206f 7574 7075  # the diff outpu
+00003c20: 7420 6861 7320 6120 7472 6169 6c69 6e67  t has a trailing
+00003c30: 2073 7061 6365 0a20 2020 2020 2020 2069   space.        i
+00003c40: 6620 6578 7065 6374 6564 2021 3d20 6163  f expected != ac
+00003c50: 7475 616c 3a0a 2020 2020 2020 2020 2020  tual:.          
+00003c60: 2020 6475 6d70 203d 2062 6c61 636b 2e64    dump = black.d
+00003c70: 756d 705f 746f 5f66 696c 6528 6163 7475  ump_to_file(actu
+00003c80: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+00003c90: 6d73 6720 3d20 280a 2020 2020 2020 2020  msg = (.        
+00003ca0: 2020 2020 2020 2020 2245 7870 6563 7465          "Expecte
+00003cb0: 6420 6469 6666 2069 736e 2774 2065 7175  d diff isn't equ
+00003cc0: 616c 2074 6f20 7468 6520 6163 7475 616c  al to the actual
+00003cd0: 2e20 4966 2079 6f75 206d 6164 6520 6368  . If you made ch
+00003ce0: 616e 6765 7320 746f 220a 2020 2020 2020  anges to".      
+00003cf0: 2020 2020 2020 2020 2020 2220 6578 7072            " expr
+00003d00: 6573 7369 6f6e 2e70 7920 616e 6420 7468  ession.py and th
+00003d10: 6973 2069 7320 616e 2061 6e74 6963 6970  is is an anticip
+00003d20: 6174 6564 2064 6966 6665 7265 6e63 652c  ated difference,
+00003d30: 206f 7665 7277 7269 7465 220a 2020 2020   overwrite".    
+00003d40: 2020 2020 2020 2020 2020 2020 2220 7465              " te
+00003d50: 7374 732f 6461 7461 2f6d 6973 6365 6c6c  sts/data/miscell
+00003d60: 616e 656f 7573 2f65 7870 7265 7373 696f  aneous/expressio
+00003d70: 6e5f 736b 6970 5f6d 6167 6963 5f74 7261  n_skip_magic_tra
+00003d80: 696c 696e 675f 636f 6d6d 612e 6469 6666  iling_comma.diff
+00003d90: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00003da0: 2020 6622 2077 6974 6820 7b64 756d 707d    f" with {dump}
+00003db0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00003dc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003dd0: 2e61 7373 6572 7445 7175 616c 2865 7870  .assertEqual(exp
+00003de0: 6563 7465 642c 2061 6374 7561 6c2c 206d  ected, actual, m
+00003df0: 7367 290a 0a20 2020 2040 7061 7463 6828  sg)..    @patch(
+00003e00: 2262 6c61 636b 2e64 756d 705f 746f 5f66  "black.dump_to_f
+00003e10: 696c 6522 2c20 6475 6d70 5f74 6f5f 7374  ile", dump_to_st
+00003e20: 6465 7272 290a 2020 2020 6465 6620 7465  derr).    def te
+00003e30: 7374 5f61 7379 6e63 5f61 735f 6964 656e  st_async_as_iden
+00003e40: 7469 6669 6572 2873 656c 6629 202d 3e20  tifier(self) -> 
+00003e50: 4e6f 6e65 3a0a 2020 2020 2020 2020 736f  None:.        so
+00003e60: 7572 6365 5f70 6174 6820 3d20 6765 745f  urce_path = get_
+00003e70: 6361 7365 5f70 6174 6828 226d 6973 6365  case_path("misce
+00003e80: 6c6c 616e 656f 7573 222c 2022 6173 796e  llaneous", "asyn
+00003e90: 635f 6173 5f69 6465 6e74 6966 6965 7222  c_as_identifier"
+00003ea0: 290a 2020 2020 2020 2020 5f2c 2073 6f75  ).        _, sou
+00003eb0: 7263 652c 2065 7870 6563 7465 6420 3d20  rce, expected = 
+00003ec0: 7265 6164 5f64 6174 615f 6672 6f6d 5f66  read_data_from_f
+00003ed0: 696c 6528 736f 7572 6365 5f70 6174 6829  ile(source_path)
+00003ee0: 0a20 2020 2020 2020 2061 6374 7561 6c20  .        actual 
+00003ef0: 3d20 6673 2873 6f75 7263 6529 0a20 2020  = fs(source).   
+00003f00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00003f10: 466f 726d 6174 4571 7561 6c28 6578 7065  FormatEqual(expe
+00003f20: 6374 6564 2c20 6163 7475 616c 290a 2020  cted, actual).  
+00003f30: 2020 2020 2020 6d61 6a6f 722c 206d 696e        major, min
+00003f40: 6f72 203d 2073 7973 2e76 6572 7369 6f6e  or = sys.version
+00003f50: 5f69 6e66 6f5b 3a32 5d0a 2020 2020 2020  _info[:2].      
+00003f60: 2020 6966 206d 616a 6f72 203c 2033 206f    if major < 3 o
+00003f70: 7220 286d 616a 6f72 203c 3d20 3320 616e  r (major <= 3 an
+00003f80: 6420 6d69 6e6f 7220 3c20 3729 3a0a 2020  d minor < 7):.  
+00003f90: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+00003fa0: 6173 7365 7274 5f65 7175 6976 616c 656e  assert_equivalen
+00003fb0: 7428 736f 7572 6365 2c20 6163 7475 616c  t(source, actual
+00003fc0: 290a 2020 2020 2020 2020 626c 6163 6b2e  ).        black.
+00003fd0: 6173 7365 7274 5f73 7461 626c 6528 736f  assert_stable(so
+00003fe0: 7572 6365 2c20 6163 7475 616c 2c20 4445  urce, actual, DE
+00003ff0: 4641 554c 545f 4d4f 4445 290a 2020 2020  FAULT_MODE).    
+00004000: 2020 2020 2320 656e 7375 7265 2062 6c61      # ensure bla
+00004010: 636b 2063 616e 2070 6172 7365 2074 6869  ck can parse thi
+00004020: 7320 7768 656e 2074 6865 2074 6172 6765  s when the targe
+00004030: 7420 6973 2033 2e36 0a20 2020 2020 2020  t is 3.6.       
+00004040: 2073 656c 662e 696e 766f 6b65 426c 6163   self.invokeBlac
+00004050: 6b28 5b73 7472 2873 6f75 7263 655f 7061  k([str(source_pa
+00004060: 7468 292c 2022 2d2d 7461 7267 6574 2d76  th), "--target-v
+00004070: 6572 7369 6f6e 222c 2022 7079 3336 225d  ersion", "py36"]
+00004080: 290a 2020 2020 2020 2020 2320 6275 7420  ).        # but 
+00004090: 6e6f 7420 6f6e 2033 2e37 2c20 6265 6361  not on 3.7, beca
+000040a0: 7573 6520 6173 796e 632f 6177 6169 7420  use async/await 
+000040b0: 6973 206e 6f20 6c6f 6e67 6572 2061 6e20  is no longer an 
+000040c0: 6964 656e 7469 6669 6572 0a20 2020 2020  identifier.     
+000040d0: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+000040e0: 6163 6b28 5b73 7472 2873 6f75 7263 655f  ack([str(source_
+000040f0: 7061 7468 292c 2022 2d2d 7461 7267 6574  path), "--target
+00004100: 2d76 6572 7369 6f6e 222c 2022 7079 3337  -version", "py37
+00004110: 225d 2c20 6578 6974 5f63 6f64 653d 3132  "], exit_code=12
+00004120: 3329 0a0a 2020 2020 4070 6174 6368 2822  3)..    @patch("
+00004130: 626c 6163 6b2e 6475 6d70 5f74 6f5f 6669  black.dump_to_fi
+00004140: 6c65 222c 2064 756d 705f 746f 5f73 7464  le", dump_to_std
+00004150: 6572 7229 0a20 2020 2064 6566 2074 6573  err).    def tes
+00004160: 745f 7079 7468 6f6e 3337 2873 656c 6629  t_python37(self)
+00004170: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00004180: 2020 736f 7572 6365 5f70 6174 6820 3d20    source_path = 
+00004190: 6765 745f 6361 7365 5f70 6174 6828 2263  get_case_path("c
+000041a0: 6173 6573 222c 2022 7079 7468 6f6e 3337  ases", "python37
+000041b0: 2229 0a20 2020 2020 2020 205f 2c20 736f  ").        _, so
+000041c0: 7572 6365 2c20 6578 7065 6374 6564 203d  urce, expected =
+000041d0: 2072 6561 645f 6461 7461 5f66 726f 6d5f   read_data_from_
+000041e0: 6669 6c65 2873 6f75 7263 655f 7061 7468  file(source_path
+000041f0: 290a 2020 2020 2020 2020 6163 7475 616c  ).        actual
+00004200: 203d 2066 7328 736f 7572 6365 290a 2020   = fs(source).  
+00004210: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00004220: 7446 6f72 6d61 7445 7175 616c 2865 7870  tFormatEqual(exp
+00004230: 6563 7465 642c 2061 6374 7561 6c29 0a20  ected, actual). 
+00004240: 2020 2020 2020 206d 616a 6f72 2c20 6d69         major, mi
+00004250: 6e6f 7220 3d20 7379 732e 7665 7273 696f  nor = sys.versio
+00004260: 6e5f 696e 666f 5b3a 325d 0a20 2020 2020  n_info[:2].     
+00004270: 2020 2069 6620 6d61 6a6f 7220 3e20 3320     if major > 3 
+00004280: 6f72 2028 6d61 6a6f 7220 3d3d 2033 2061  or (major == 3 a
+00004290: 6e64 206d 696e 6f72 203e 3d20 3729 3a0a  nd minor >= 7):.
+000042a0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+000042b0: 6b2e 6173 7365 7274 5f65 7175 6976 616c  k.assert_equival
+000042c0: 656e 7428 736f 7572 6365 2c20 6163 7475  ent(source, actu
+000042d0: 616c 290a 2020 2020 2020 2020 626c 6163  al).        blac
+000042e0: 6b2e 6173 7365 7274 5f73 7461 626c 6528  k.assert_stable(
+000042f0: 736f 7572 6365 2c20 6163 7475 616c 2c20  source, actual, 
+00004300: 4445 4641 554c 545f 4d4f 4445 290a 2020  DEFAULT_MODE).  
+00004310: 2020 2020 2020 2320 656e 7375 7265 2062        # ensure b
+00004320: 6c61 636b 2063 616e 2070 6172 7365 2074  lack can parse t
+00004330: 6869 7320 7768 656e 2074 6865 2074 6172  his when the tar
+00004340: 6765 7420 6973 2033 2e37 0a20 2020 2020  get is 3.7.     
+00004350: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+00004360: 6163 6b28 5b73 7472 2873 6f75 7263 655f  ack([str(source_
+00004370: 7061 7468 292c 2022 2d2d 7461 7267 6574  path), "--target
+00004380: 2d76 6572 7369 6f6e 222c 2022 7079 3337  -version", "py37
+00004390: 225d 290a 2020 2020 2020 2020 2320 6275  "]).        # bu
+000043a0: 7420 6e6f 7420 6f6e 2033 2e36 2c20 6265  t not on 3.6, be
+000043b0: 6361 7573 6520 7765 2075 7365 2061 7379  cause we use asy
+000043c0: 6e63 2061 7320 6120 7265 7365 7276 6564  nc as a reserved
+000043d0: 206b 6579 776f 7264 0a20 2020 2020 2020   keyword.       
+000043e0: 2073 656c 662e 696e 766f 6b65 426c 6163   self.invokeBlac
+000043f0: 6b28 5b73 7472 2873 6f75 7263 655f 7061  k([str(source_pa
+00004400: 7468 292c 2022 2d2d 7461 7267 6574 2d76  th), "--target-v
+00004410: 6572 7369 6f6e 222c 2022 7079 3336 225d  ersion", "py36"]
+00004420: 2c20 6578 6974 5f63 6f64 653d 3132 3329  , exit_code=123)
+00004430: 0a0a 2020 2020 6465 6620 7465 7374 5f74  ..    def test_t
+00004440: 6162 5f63 6f6d 6d65 6e74 5f69 6e64 656e  ab_comment_inden
+00004450: 7461 7469 6f6e 2873 656c 6629 202d 3e20  tation(self) -> 
+00004460: 4e6f 6e65 3a0a 2020 2020 2020 2020 636f  None:.        co
+00004470: 6e74 656e 7473 5f74 6162 203d 2022 6966  ntents_tab = "if
+00004480: 2031 3a5c 6e5c 7469 6620 323a 5c6e 5c74   1:\n\tif 2:\n\t
+00004490: 5c74 7061 7373 5c6e 5c74 2320 636f 6d6d  \tpass\n\t# comm
+000044a0: 656e 745c 6e5c 7470 6173 735c 6e22 0a20  ent\n\tpass\n". 
+000044b0: 2020 2020 2020 2063 6f6e 7465 6e74 735f         contents_
+000044c0: 7370 6320 3d20 2269 6620 313a 5c6e 2020  spc = "if 1:\n  
+000044d0: 2020 6966 2032 3a5c 6e20 2020 2020 2020    if 2:\n       
+000044e0: 2070 6173 735c 6e20 2020 2023 2063 6f6d   pass\n    # com
+000044f0: 6d65 6e74 5c6e 2020 2020 7061 7373 5c6e  ment\n    pass\n
+00004500: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
+00004510: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
+00004520: 2863 6f6e 7465 6e74 735f 7370 632c 2066  (contents_spc, f
+00004530: 7328 636f 6e74 656e 7473 5f73 7063 2929  s(contents_spc))
+00004540: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00004550: 7365 7274 466f 726d 6174 4571 7561 6c28  sertFormatEqual(
+00004560: 636f 6e74 656e 7473 5f73 7063 2c20 6673  contents_spc, fs
+00004570: 2863 6f6e 7465 6e74 735f 7461 6229 290a  (contents_tab)).
+00004580: 0a20 2020 2020 2020 2063 6f6e 7465 6e74  .        content
+00004590: 735f 7461 6220 3d20 2269 6620 313a 5c6e  s_tab = "if 1:\n
+000045a0: 5c74 6966 2032 3a5c 6e5c 745c 7470 6173  \tif 2:\n\t\tpas
+000045b0: 735c 6e5c 745c 7423 2063 6f6d 6d65 6e74  s\n\t\t# comment
+000045c0: 5c6e 5c74 7061 7373 5c6e 220a 2020 2020  \n\tpass\n".    
+000045d0: 2020 2020 636f 6e74 656e 7473 5f73 7063      contents_spc
+000045e0: 203d 2022 6966 2031 3a5c 6e20 2020 2069   = "if 1:\n    i
+000045f0: 6620 323a 5c6e 2020 2020 2020 2020 7061  f 2:\n        pa
+00004600: 7373 5c6e 2020 2020 2020 2020 2320 636f  ss\n        # co
+00004610: 6d6d 656e 745c 6e20 2020 2070 6173 735c  mment\n    pass\
+00004620: 6e22 0a20 2020 2020 2020 2073 656c 662e  n".        self.
+00004630: 6173 7365 7274 466f 726d 6174 4571 7561  assertFormatEqua
+00004640: 6c28 636f 6e74 656e 7473 5f73 7063 2c20  l(contents_spc, 
+00004650: 6673 2863 6f6e 7465 6e74 735f 7370 6329  fs(contents_spc)
+00004660: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00004670: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
+00004680: 2863 6f6e 7465 6e74 735f 7370 632c 2066  (contents_spc, f
+00004690: 7328 636f 6e74 656e 7473 5f74 6162 2929  s(contents_tab))
+000046a0: 0a0a 2020 2020 2020 2020 2320 6d69 7865  ..        # mixe
+000046b0: 6420 7461 6273 2061 6e64 2073 7061 6365  d tabs and space
+000046c0: 7320 2876 616c 6964 2050 7974 686f 6e20  s (valid Python 
+000046d0: 3220 636f 6465 290a 2020 2020 2020 2020  2 code).        
+000046e0: 636f 6e74 656e 7473 5f74 6162 203d 2022  contents_tab = "
+000046f0: 6966 2031 3a5c 6e20 2020 2020 2020 2069  if 1:\n        i
+00004700: 6620 323a 5c6e 5c74 5c74 7061 7373 5c6e  f 2:\n\t\tpass\n
+00004710: 5c74 2320 636f 6d6d 656e 745c 6e20 2020  \t# comment\n   
+00004720: 2020 2020 2070 6173 735c 6e22 0a20 2020       pass\n".   
+00004730: 2020 2020 2063 6f6e 7465 6e74 735f 7370       contents_sp
+00004740: 6320 3d20 2269 6620 313a 5c6e 2020 2020  c = "if 1:\n    
+00004750: 6966 2032 3a5c 6e20 2020 2020 2020 2070  if 2:\n        p
+00004760: 6173 735c 6e20 2020 2023 2063 6f6d 6d65  ass\n    # comme
+00004770: 6e74 5c6e 2020 2020 7061 7373 5c6e 220a  nt\n    pass\n".
+00004780: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00004790: 6572 7446 6f72 6d61 7445 7175 616c 2863  ertFormatEqual(c
+000047a0: 6f6e 7465 6e74 735f 7370 632c 2066 7328  ontents_spc, fs(
+000047b0: 636f 6e74 656e 7473 5f73 7063 2929 0a20  contents_spc)). 
+000047c0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000047d0: 7274 466f 726d 6174 4571 7561 6c28 636f  rtFormatEqual(co
+000047e0: 6e74 656e 7473 5f73 7063 2c20 6673 2863  ntents_spc, fs(c
+000047f0: 6f6e 7465 6e74 735f 7461 6229 290a 0a20  ontents_tab)).. 
+00004800: 2020 2020 2020 2063 6f6e 7465 6e74 735f         contents_
+00004810: 7461 6220 3d20 2269 6620 313a 5c6e 2020  tab = "if 1:\n  
+00004820: 2020 2020 2020 6966 2032 3a5c 6e5c 745c        if 2:\n\t\
+00004830: 7470 6173 735c 6e5c 745c 7423 2063 6f6d  tpass\n\t\t# com
+00004840: 6d65 6e74 5c6e 2020 2020 2020 2020 7061  ment\n        pa
+00004850: 7373 5c6e 220a 2020 2020 2020 2020 636f  ss\n".        co
+00004860: 6e74 656e 7473 5f73 7063 203d 2022 6966  ntents_spc = "if
+00004870: 2031 3a5c 6e20 2020 2069 6620 323a 5c6e   1:\n    if 2:\n
+00004880: 2020 2020 2020 2020 7061 7373 5c6e 2020          pass\n  
+00004890: 2020 2020 2020 2320 636f 6d6d 656e 745c        # comment\
+000048a0: 6e20 2020 2070 6173 735c 6e22 0a20 2020  n    pass\n".   
+000048b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000048c0: 466f 726d 6174 4571 7561 6c28 636f 6e74  FormatEqual(cont
+000048d0: 656e 7473 5f73 7063 2c20 6673 2863 6f6e  ents_spc, fs(con
+000048e0: 7465 6e74 735f 7370 6329 290a 2020 2020  tents_spc)).    
+000048f0: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00004900: 6f72 6d61 7445 7175 616c 2863 6f6e 7465  ormatEqual(conte
+00004910: 6e74 735f 7370 632c 2066 7328 636f 6e74  nts_spc, fs(cont
+00004920: 656e 7473 5f74 6162 2929 0a0a 2020 2020  ents_tab))..    
+00004930: 6465 6620 7465 7374 5f66 616c 7365 5f70  def test_false_p
+00004940: 6f73 6974 6976 655f 7379 6d6c 696e 6b5f  ositive_symlink_
+00004950: 6f75 7470 7574 5f69 7373 7565 5f33 3338  output_issue_338
+00004960: 3428 7365 6c66 2920 2d3e 204e 6f6e 653a  4(self) -> None:
+00004970: 0a20 2020 2020 2020 2023 2045 6d75 6c61  .        # Emula
+00004980: 7465 2074 6865 2062 6568 6176 696f 7220  te the behavior 
+00004990: 7768 656e 2075 7369 6e67 2074 6865 2043  when using the C
+000049a0: 4c49 2028 6062 6c61 636b 202e 2f63 6869  LI (`black ./chi
+000049b0: 6c64 2020 2d2d 7665 7262 6f73 6560 292c  ld  --verbose`),
+000049c0: 2077 6869 6368 0a20 2020 2020 2020 2023   which.        #
+000049d0: 2069 6e76 6f6c 7665 7320 7061 7463 6869   involves patchi
+000049e0: 6e67 2073 6f6d 6520 6070 6174 686c 6962  ng some `pathlib
+000049f0: 2e50 6174 6860 206d 6574 686f 6473 2e20  .Path` methods. 
+00004a00: 496e 2070 6172 7469 6375 6c61 722c 2060  In particular, `
+00004a10: 6973 5f64 6972 6020 6973 0a20 2020 2020  is_dir` is.     
+00004a20: 2020 2023 2070 6174 6368 6564 206f 6e6c     # patched onl
+00004a30: 7920 6f6e 2069 7473 2066 6972 7374 2063  y on its first c
+00004a40: 616c 6c3a 2077 6865 6e20 6368 6563 6b69  all: when checki
+00004a50: 6e67 2069 6620 222e 2f63 6869 6c64 2220  ng if "./child" 
+00004a60: 6973 2061 2064 6972 6563 746f 7279 2069  is a directory i
+00004a70: 740a 2020 2020 2020 2020 2320 7368 6f75  t.        # shou
+00004a80: 6c64 2072 6574 7572 6e20 5472 7565 2e20  ld return True. 
+00004a90: 5468 6520 222e 2f63 6869 6c64 2220 666f  The "./child" fo
+00004aa0: 6c64 6572 2065 7869 7374 7320 7265 6c61  lder exists rela
+00004ab0: 7469 7665 2074 6f20 7468 6520 6377 6420  tive to the cwd 
+00004ac0: 7768 656e 0a20 2020 2020 2020 2023 2072  when.        # r
+00004ad0: 756e 6e69 6e67 2066 726f 6d20 434c 492c  unning from CLI,
+00004ae0: 2062 7574 2066 6169 6c73 2077 6865 6e20   but fails when 
+00004af0: 7275 6e6e 696e 6720 7468 6520 7465 7374  running the test
+00004b00: 7320 6265 6361 7573 6520 6377 6420 6973  s because cwd is
+00004b10: 2064 6966 6665 7265 6e74 0a20 2020 2020   different.     
+00004b20: 2020 2070 726f 6a65 6374 5f72 6f6f 7420     project_root 
+00004b30: 3d20 5061 7468 2854 4849 535f 4449 5220  = Path(THIS_DIR 
+00004b40: 2f20 2264 6174 6122 202f 2022 6e65 7374  / "data" / "nest
+00004b50: 6564 5f67 6974 6967 6e6f 7265 5f74 6573  ed_gitignore_tes
+00004b60: 7473 2229 0a20 2020 2020 2020 2077 6f72  ts").        wor
+00004b70: 6b69 6e67 5f64 6972 6563 746f 7279 203d  king_directory =
+00004b80: 2070 726f 6a65 6374 5f72 6f6f 7420 2f20   project_root / 
+00004b90: 2272 6f6f 7422 0a0a 2020 2020 2020 2020  "root"..        
+00004ba0: 7769 7468 2063 6861 6e67 655f 6469 7265  with change_dire
+00004bb0: 6374 6f72 7928 776f 726b 696e 675f 6469  ctory(working_di
+00004bc0: 7265 6374 6f72 7929 3a0a 2020 2020 2020  rectory):.      
+00004bd0: 2020 2020 2020 2320 4e6f 7465 2074 6861        # Note tha
+00004be0: 7420 7468 6520 726f 6f74 2066 6f6c 6465  t the root folde
+00004bf0: 7220 2870 726f 6a65 6374 5f72 6f6f 7429  r (project_root)
+00004c00: 2069 736e 2774 2074 6865 2066 6f6c 6465   isn't the folde
+00004c10: 720a 2020 2020 2020 2020 2020 2020 2320  r.            # 
+00004c20: 6e61 6d65 6420 2272 6f6f 7422 2028 616b  named "root" (ak
+00004c30: 6120 776f 726b 696e 675f 6469 7265 6374  a working_direct
+00004c40: 6f72 7929 0a20 2020 2020 2020 2020 2020  ory).           
+00004c50: 2072 6570 6f72 7420 3d20 4d61 6769 634d   report = MagicM
+00004c60: 6f63 6b28 7665 7262 6f73 653d 5472 7565  ock(verbose=True
+00004c70: 290a 2020 2020 2020 2020 2020 2020 626c  ).            bl
+00004c80: 6163 6b2e 6765 745f 736f 7572 6365 7328  ack.get_sources(
+00004c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004ca0: 2072 6f6f 743d 7072 6f6a 6563 745f 726f   root=project_ro
+00004cb0: 6f74 2c0a 2020 2020 2020 2020 2020 2020  ot,.            
+00004cc0: 2020 2020 7372 633d 2822 2e2f 6368 696c      src=("./chil
+00004cd0: 6422 2c29 2c0a 2020 2020 2020 2020 2020  d",),.          
+00004ce0: 2020 2020 2020 7175 6965 743d 4661 6c73        quiet=Fals
+00004cf0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00004d00: 2020 2076 6572 626f 7365 3d54 7275 652c     verbose=True,
+00004d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d20: 2069 6e63 6c75 6465 3d44 4546 4155 4c54   include=DEFAULT
+00004d30: 5f49 4e43 4c55 4445 2c0a 2020 2020 2020  _INCLUDE,.      
+00004d40: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00004d50: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00004d60: 2020 2020 2020 2020 7265 706f 7274 3d72          report=r
+00004d70: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
+00004d80: 2020 2020 2020 2065 7874 656e 645f 6578         extend_ex
+00004d90: 636c 7564 653d 4e6f 6e65 2c0a 2020 2020  clude=None,.    
+00004da0: 2020 2020 2020 2020 2020 2020 666f 7263              forc
+00004db0: 655f 6578 636c 7564 653d 4e6f 6e65 2c0a  e_exclude=None,.
+00004dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004dd0: 7374 6469 6e5f 6669 6c65 6e61 6d65 3d4e  stdin_filename=N
+00004de0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00004df0: 2029 0a20 2020 2020 2020 2061 7373 6572   ).        asser
+00004e00: 7420 6e6f 7420 616e 7928 0a20 2020 2020  t not any(.     
+00004e10: 2020 2020 2020 206d 6f63 6b5f 6172 6773         mock_args
+00004e20: 5b31 5d2e 7374 6172 7473 7769 7468 2822  [1].startswith("
+00004e30: 6973 2061 2073 796d 626f 6c69 6320 6c69  is a symbolic li
+00004e40: 6e6b 2074 6861 7420 706f 696e 7473 206f  nk that points o
+00004e50: 7574 7369 6465 2229 0a20 2020 2020 2020  utside").       
+00004e60: 2020 2020 2066 6f72 205f 2c20 6d6f 636b       for _, mock
+00004e70: 5f61 7267 732c 205f 2069 6e20 7265 706f  _args, _ in repo
+00004e80: 7274 2e70 6174 685f 6967 6e6f 7265 642e  rt.path_ignored.
+00004e90: 6d6f 636b 5f63 616c 6c73 0a20 2020 2020  mock_calls.     
+00004ea0: 2020 2029 2c20 2241 2073 796d 626f 6c69     ), "A symboli
+00004eb0: 6320 6c69 6e6b 2077 6173 2072 6570 6f72  c link was repor
+00004ec0: 7465 642e 220a 2020 2020 2020 2020 7265  ted.".        re
+00004ed0: 706f 7274 2e70 6174 685f 6967 6e6f 7265  port.path_ignore
+00004ee0: 642e 6173 7365 7274 5f63 616c 6c65 645f  d.assert_called_
+00004ef0: 6f6e 6365 5f77 6974 6828 0a20 2020 2020  once_with(.     
+00004f00: 2020 2020 2020 2050 6174 6828 776f 726b         Path(work
+00004f10: 696e 675f 6469 7265 6374 6f72 792c 2022  ing_directory, "
+00004f20: 6368 696c 6422 2c20 2262 2e70 7922 292c  child", "b.py"),
+00004f30: 0a20 2020 2020 2020 2020 2020 2022 6d61  .            "ma
+00004f40: 7463 6865 7320 6120 2e67 6974 6967 6e6f  tches a .gitigno
+00004f50: 7265 2066 696c 6520 636f 6e74 656e 7422  re file content"
+00004f60: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00004f70: 2064 6566 2074 6573 745f 7265 706f 7274   def test_report
+00004f80: 5f76 6572 626f 7365 2873 656c 6629 202d  _verbose(self) -
+00004f90: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00004fa0: 7265 706f 7274 203d 2052 6570 6f72 7428  report = Report(
+00004fb0: 7665 7262 6f73 653d 5472 7565 290a 2020  verbose=True).  
+00004fc0: 2020 2020 2020 6f75 745f 6c69 6e65 7320        out_lines 
+00004fd0: 3d20 5b5d 0a20 2020 2020 2020 2065 7272  = [].        err
+00004fe0: 5f6c 696e 6573 203d 205b 5d0a 0a20 2020  _lines = []..   
+00004ff0: 2020 2020 2064 6566 206f 7574 286d 7367       def out(msg
+00005000: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
+00005010: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
+00005020: 2020 2020 2020 2020 2020 206f 7574 5f6c             out_l
+00005030: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
+00005040: 0a0a 2020 2020 2020 2020 6465 6620 6572  ..        def er
+00005050: 7228 6d73 673a 2073 7472 2c20 2a2a 6b77  r(msg: str, **kw
+00005060: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
+00005070: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00005080: 6572 725f 6c69 6e65 732e 6170 7065 6e64  err_lines.append
+00005090: 286d 7367 290a 0a20 2020 2020 2020 2077  (msg)..        w
+000050a0: 6974 6820 7061 7463 6828 2262 6c61 636b  ith patch("black
+000050b0: 2e6f 7574 7075 742e 5f6f 7574 222c 206f  .output._out", o
+000050c0: 7574 292c 2070 6174 6368 2822 626c 6163  ut), patch("blac
+000050d0: 6b2e 6f75 7470 7574 2e5f 6572 7222 2c20  k.output._err", 
+000050e0: 6572 7229 3a0a 2020 2020 2020 2020 2020  err):.          
+000050f0: 2020 7265 706f 7274 2e64 6f6e 6528 5061    report.done(Pa
+00005100: 7468 2822 6631 2229 2c20 626c 6163 6b2e  th("f1"), black.
+00005110: 4368 616e 6765 642e 4e4f 290a 2020 2020  Changed.NO).    
+00005120: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005130: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
+00005140: 5f6c 696e 6573 292c 2031 290a 2020 2020  _lines), 1).    
+00005150: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005160: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
+00005170: 5f6c 696e 6573 292c 2030 290a 2020 2020  _lines), 0).    
+00005180: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005190: 6572 7445 7175 616c 286f 7574 5f6c 696e  ertEqual(out_lin
+000051a0: 6573 5b2d 315d 2c20 2266 3120 616c 7265  es[-1], "f1 alre
+000051b0: 6164 7920 7765 6c6c 2066 6f72 6d61 7474  ady well formatt
+000051c0: 6564 2c20 676f 6f64 206a 6f62 2e22 290a  ed, good job.").
+000051d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000051e0: 2e61 7373 6572 7445 7175 616c 2875 6e73  .assertEqual(uns
+000051f0: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00005200: 292c 2022 3120 6669 6c65 206c 6566 7420  ), "1 file left 
+00005210: 756e 6368 616e 6765 642e 2229 0a20 2020  unchanged.").   
+00005220: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00005230: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00005240: 2e72 6574 7572 6e5f 636f 6465 2c20 3029  .return_code, 0)
+00005250: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00005260: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
+00005270: 3222 292c 2062 6c61 636b 2e43 6861 6e67  2"), black.Chang
+00005280: 6564 2e59 4553 290a 2020 2020 2020 2020  ed.YES).        
+00005290: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000052a0: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
+000052b0: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
+000052c0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000052d0: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
+000052e0: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
+000052f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005300: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
+00005310: 315d 2c20 2272 6566 6f72 6d61 7474 6564  1], "reformatted
+00005320: 2066 3222 290a 2020 2020 2020 2020 2020   f2").          
+00005330: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005340: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00005350: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00005360: 7265 706f 7274 2929 2c20 2231 2066 696c  report)), "1 fil
+00005370: 6520 7265 666f 726d 6174 7465 642c 2031  e reformatted, 1
+00005380: 2066 696c 6520 6c65 6674 2075 6e63 6861   file left uncha
+00005390: 6e67 6564 2e22 0a20 2020 2020 2020 2020  nged.".         
+000053a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000053b0: 2072 6570 6f72 742e 646f 6e65 2850 6174   report.done(Pat
+000053c0: 6828 2266 3322 292c 2062 6c61 636b 2e43  h("f3"), black.C
+000053d0: 6861 6e67 6564 2e43 4143 4845 4429 0a20  hanged.CACHED). 
+000053e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000053f0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00005400: 6f75 745f 6c69 6e65 7329 2c20 3329 0a20  out_lines), 3). 
+00005410: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005420: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00005430: 6572 725f 6c69 6e65 7329 2c20 3029 0a20  err_lines), 0). 
+00005440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005450: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00005460: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00005470: 5f6c 696e 6573 5b2d 315d 2c20 2266 3320  _lines[-1], "f3 
+00005480: 7761 736e 2774 206d 6f64 6966 6965 6420  wasn't modified 
+00005490: 6f6e 2064 6973 6b20 7369 6e63 6520 6c61  on disk since la
+000054a0: 7374 2072 756e 2e22 0a20 2020 2020 2020  st run.".       
+000054b0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000054c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000054d0: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+000054e0: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+000054f0: 2872 6570 6f72 7429 292c 2022 3120 6669  (report)), "1 fi
+00005500: 6c65 2072 6566 6f72 6d61 7474 6564 2c20  le reformatted, 
+00005510: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
+00005520: 6861 6e67 6564 2e22 0a20 2020 2020 2020  hanged.".       
+00005530: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00005540: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005550: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
+00005560: 6e5f 636f 6465 2c20 3029 0a20 2020 2020  n_code, 0).     
+00005570: 2020 2020 2020 2072 6570 6f72 742e 6368         report.ch
+00005580: 6563 6b20 3d20 5472 7565 0a20 2020 2020  eck = True.     
+00005590: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000055a0: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
+000055b0: 6574 7572 6e5f 636f 6465 2c20 3129 0a20  eturn_code, 1). 
+000055c0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+000055d0: 742e 6368 6563 6b20 3d20 4661 6c73 650a  t.check = False.
+000055e0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+000055f0: 7274 2e66 6169 6c65 6428 5061 7468 2822  rt.failed(Path("
+00005600: 6531 2229 2c20 2262 6f6f 6d22 290a 2020  e1"), "boom").  
+00005610: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00005620: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00005630: 7574 5f6c 696e 6573 292c 2033 290a 2020  ut_lines), 3).  
+00005640: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00005650: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+00005660: 7272 5f6c 696e 6573 292c 2031 290a 2020  rr_lines), 1).  
+00005670: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00005680: 7373 6572 7445 7175 616c 2865 7272 5f6c  ssertEqual(err_l
+00005690: 696e 6573 5b2d 315d 2c20 2265 7272 6f72  ines[-1], "error
+000056a0: 3a20 6361 6e6e 6f74 2066 6f72 6d61 7420  : cannot format 
+000056b0: 6531 3a20 626f 6f6d 2229 0a20 2020 2020  e1: boom").     
+000056c0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000056d0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+000056e0: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+000056f0: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+00005700: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00005710: 3120 6669 6c65 2072 6566 6f72 6d61 7474  1 file reformatt
+00005720: 6564 2c20 3220 6669 6c65 7320 6c65 6674  ed, 2 files left
+00005730: 2075 6e63 6861 6e67 6564 2c20 3120 6669   unchanged, 1 fi
+00005740: 6c65 2066 6169 6c65 6420 746f 220a 2020  le failed to".  
+00005750: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+00005760: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
+00005770: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00005780: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00005790: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
+000057a0: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
+000057b0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+000057c0: 7274 2e64 6f6e 6528 5061 7468 2822 6633  rt.done(Path("f3
+000057d0: 2229 2c20 626c 6163 6b2e 4368 616e 6765  "), black.Change
+000057e0: 642e 5945 5329 0a20 2020 2020 2020 2020  d.YES).         
+000057f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005800: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
+00005810: 7329 2c20 3429 0a20 2020 2020 2020 2020  s), 4).         
+00005820: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005830: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
+00005840: 7329 2c20 3129 0a20 2020 2020 2020 2020  s), 1).         
+00005850: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00005860: 7561 6c28 6f75 745f 6c69 6e65 735b 2d31  ual(out_lines[-1
+00005870: 5d2c 2022 7265 666f 726d 6174 7465 6420  ], "reformatted 
+00005880: 6633 2229 0a20 2020 2020 2020 2020 2020  f3").           
+00005890: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000058a0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+000058b0: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
+000058c0: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
+000058d0: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
+000058e0: 7320 7265 666f 726d 6174 7465 642c 2032  s reformatted, 2
+000058f0: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
+00005900: 616e 6765 642c 2031 2066 696c 6520 6661  anged, 1 file fa
+00005910: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
+00005920: 2020 2020 2020 2020 2022 2072 6566 6f72           " refor
+00005930: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
+00005940: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00005950: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00005960: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
+00005970: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
+00005980: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
+00005990: 696c 6564 2850 6174 6828 2265 3222 292c  iled(Path("e2"),
+000059a0: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
+000059b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000059c0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+000059d0: 6e65 7329 2c20 3429 0a20 2020 2020 2020  nes), 4).       
+000059e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000059f0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00005a00: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
+00005a10: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00005a20: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
+00005a30: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
+00005a40: 6e6f 7420 666f 726d 6174 2065 323a 2062  not format e2: b
+00005a50: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
 00005a60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
 00005a70: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
 00005a80: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
 00005a90: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
 00005aa0: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
 00005ab0: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
 00005ac0: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
@@ -1456,5976 +1456,6039 @@
 00005af0: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
 00005b00: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
 00005b10: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
 00005b20: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
 00005b30: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
 00005b40: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
 00005b50: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00005b60: 646f 6e65 2850 6174 6828 2266 3422 292c  done(Path("f4"),
-00005b70: 2062 6c61 636b 2e43 6861 6e67 6564 2e4e   black.Changed.N
-00005b80: 4f29 0a20 2020 2020 2020 2020 2020 2073  O).            s
-00005b90: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005ba0: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
-00005bb0: 3629 0a20 2020 2020 2020 2020 2020 2073  6).            s
-00005bc0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005bd0: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
-00005be0: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
-00005bf0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005c00: 6f75 745f 6c69 6e65 735b 2d31 5d2c 2022  out_lines[-1], "
-00005c10: 6634 2061 6c72 6561 6479 2077 656c 6c20  f4 already well 
-00005c20: 666f 726d 6174 7465 642c 2067 6f6f 6420  formatted, good 
-00005c30: 6a6f 622e 2229 0a20 2020 2020 2020 2020  job.").         
-00005c40: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00005c50: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00005c60: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00005c70: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-00005c80: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-00005c90: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
-00005ca0: 2033 2066 696c 6573 206c 6566 7420 756e   3 files left un
-00005cb0: 6368 616e 6765 642c 2032 2066 696c 6573  changed, 2 files
-00005cc0: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
-00005cd0: 2020 2020 2020 2020 2020 2020 2220 7265              " re
-00005ce0: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
-00005cf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00005d00: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005d10: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-00005d20: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
-00005d30: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00005d40: 2e63 6865 636b 203d 2054 7275 650a 2020  .check = True.  
-00005d50: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00005d60: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00005d70: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-00005d80: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-00005d90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00005da0: 2020 2232 2066 696c 6573 2077 6f75 6c64    "2 files would
-00005db0: 2062 6520 7265 666f 726d 6174 7465 642c   be reformatted,
-00005dc0: 2033 2066 696c 6573 2077 6f75 6c64 2062   3 files would b
-00005dd0: 6520 6c65 6674 2075 6e63 6861 6e67 6564  e left unchanged
-00005de0: 2c20 3222 0a20 2020 2020 2020 2020 2020  , 2".           
-00005df0: 2020 2020 2022 2066 696c 6573 2077 6f75       " files wou
-00005e00: 6c64 2066 6169 6c20 746f 2072 6566 6f72  ld fail to refor
-00005e10: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
-00005e20: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00005e30: 2072 6570 6f72 742e 6368 6563 6b20 3d20   report.check = 
-00005e40: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00005e50: 2020 7265 706f 7274 2e64 6966 6620 3d20    report.diff = 
-00005e60: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00005e70: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00005e80: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00005e90: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
-00005ea0: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
-00005eb0: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
-00005ec0: 7320 776f 756c 6420 6265 2072 6566 6f72  s would be refor
-00005ed0: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
-00005ee0: 776f 756c 6420 6265 206c 6566 7420 756e  would be left un
-00005ef0: 6368 616e 6765 642c 2032 220a 2020 2020  changed, 2".    
-00005f00: 2020 2020 2020 2020 2020 2020 2220 6669              " fi
-00005f10: 6c65 7320 776f 756c 6420 6661 696c 2074  les would fail t
-00005f20: 6f20 7265 666f 726d 6174 2e22 2c0a 2020  o reformat.",.  
-00005f30: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00005f40: 2064 6566 2074 6573 745f 7265 706f 7274   def test_report
-00005f50: 5f71 7569 6574 2873 656c 6629 202d 3e20  _quiet(self) -> 
-00005f60: 4e6f 6e65 3a0a 2020 2020 2020 2020 7265  None:.        re
-00005f70: 706f 7274 203d 2052 6570 6f72 7428 7175  port = Report(qu
-00005f80: 6965 743d 5472 7565 290a 2020 2020 2020  iet=True).      
-00005f90: 2020 6f75 745f 6c69 6e65 7320 3d20 5b5d    out_lines = []
-00005fa0: 0a20 2020 2020 2020 2065 7272 5f6c 696e  .        err_lin
-00005fb0: 6573 203d 205b 5d0a 0a20 2020 2020 2020  es = []..       
-00005fc0: 2064 6566 206f 7574 286d 7367 3a20 7374   def out(msg: st
-00005fd0: 722c 202a 2a6b 7761 7267 733a 2041 6e79  r, **kwargs: Any
-00005fe0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00005ff0: 2020 2020 2020 206f 7574 5f6c 696e 6573         out_lines
-00006000: 2e61 7070 656e 6428 6d73 6729 0a0a 2020  .append(msg)..  
-00006010: 2020 2020 2020 6465 6620 6572 7228 6d73        def err(ms
-00006020: 673a 2073 7472 2c20 2a2a 6b77 6172 6773  g: str, **kwargs
-00006030: 3a20 416e 7929 202d 3e20 4e6f 6e65 3a0a  : Any) -> None:.
-00006040: 2020 2020 2020 2020 2020 2020 6572 725f              err_
-00006050: 6c69 6e65 732e 6170 7065 6e64 286d 7367  lines.append(msg
-00006060: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-00006070: 7061 7463 6828 2262 6c61 636b 2e6f 7574  patch("black.out
-00006080: 7075 742e 5f6f 7574 222c 206f 7574 292c  put._out", out),
-00006090: 2070 6174 6368 2822 626c 6163 6b2e 6f75   patch("black.ou
-000060a0: 7470 7574 2e5f 6572 7222 2c20 6572 7229  tput._err", err)
-000060b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000060c0: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
-000060d0: 6631 2229 2c20 626c 6163 6b2e 4368 616e  f1"), black.Chan
-000060e0: 6765 642e 4e4f 290a 2020 2020 2020 2020  ged.NO).        
-000060f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006100: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
-00006110: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-00006120: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006130: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
-00006140: 6573 292c 2030 290a 2020 2020 2020 2020  es), 0).        
-00006150: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006160: 7175 616c 2875 6e73 7479 6c65 2873 7472  qual(unstyle(str
-00006170: 2872 6570 6f72 7429 292c 2022 3120 6669  (report)), "1 fi
-00006180: 6c65 206c 6566 7420 756e 6368 616e 6765  le left unchange
-00006190: 642e 2229 0a20 2020 2020 2020 2020 2020  d.").           
-000061a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000061b0: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
-000061c0: 636f 6465 2c20 3029 0a20 2020 2020 2020  code, 0).       
-000061d0: 2020 2020 2072 6570 6f72 742e 646f 6e65       report.done
-000061e0: 2850 6174 6828 2266 3222 292c 2062 6c61  (Path("f2"), bla
-000061f0: 636b 2e43 6861 6e67 6564 2e59 4553 290a  ck.Changed.YES).
-00006200: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006210: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00006220: 286f 7574 5f6c 696e 6573 292c 2030 290a  (out_lines), 0).
-00006230: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006240: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00006250: 2865 7272 5f6c 696e 6573 292c 2030 290a  (err_lines), 0).
-00006260: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006270: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-00006280: 2020 2020 2020 2020 2020 2020 2020 756e                un
-00006290: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
-000062a0: 2929 2c20 2231 2066 696c 6520 7265 666f  )), "1 file refo
-000062b0: 726d 6174 7465 642c 2031 2066 696c 6520  rmatted, 1 file 
-000062c0: 6c65 6674 2075 6e63 6861 6e67 6564 2e22  left unchanged."
-000062d0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-000062e0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-000062f0: 742e 646f 6e65 2850 6174 6828 2266 3322  t.done(Path("f3"
-00006300: 292c 2062 6c61 636b 2e43 6861 6e67 6564  ), black.Changed
-00006310: 2e43 4143 4845 4429 0a20 2020 2020 2020  .CACHED).       
-00006320: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006330: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00006340: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
-00006350: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006360: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00006370: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
-00006380: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006390: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-000063a0: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-000063b0: 7472 2872 6570 6f72 7429 292c 2022 3120  tr(report)), "1 
-000063c0: 6669 6c65 2072 6566 6f72 6d61 7474 6564  file reformatted
-000063d0: 2c20 3220 6669 6c65 7320 6c65 6674 2075  , 2 files left u
-000063e0: 6e63 6861 6e67 6564 2e22 0a20 2020 2020  nchanged.".     
-000063f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00006400: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006410: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
-00006420: 7572 6e5f 636f 6465 2c20 3029 0a20 2020  urn_code, 0).   
-00006430: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00006440: 6368 6563 6b20 3d20 5472 7565 0a20 2020  check = True.   
-00006450: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006460: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
-00006470: 2e72 6574 7572 6e5f 636f 6465 2c20 3129  .return_code, 1)
-00006480: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00006490: 6f72 742e 6368 6563 6b20 3d20 4661 6c73  ort.check = Fals
-000064a0: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
-000064b0: 706f 7274 2e66 6169 6c65 6428 5061 7468  port.failed(Path
-000064c0: 2822 6531 2229 2c20 2262 6f6f 6d22 290a  ("e1"), "boom").
-000064d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000064e0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-000064f0: 286f 7574 5f6c 696e 6573 292c 2030 290a  (out_lines), 0).
-00006500: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006510: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-00006520: 2865 7272 5f6c 696e 6573 292c 2031 290a  (err_lines), 1).
-00006530: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006540: 2e61 7373 6572 7445 7175 616c 2865 7272  .assertEqual(err
-00006550: 5f6c 696e 6573 5b2d 315d 2c20 2265 7272  _lines[-1], "err
-00006560: 6f72 3a20 6361 6e6e 6f74 2066 6f72 6d61  or: cannot forma
-00006570: 7420 6531 3a20 626f 6f6d 2229 0a20 2020  t e1: boom").   
-00006580: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006590: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-000065a0: 2020 2020 2020 2020 2020 2075 6e73 7479             unsty
-000065b0: 6c65 2873 7472 2872 6570 6f72 7429 292c  le(str(report)),
-000065c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000065d0: 2022 3120 6669 6c65 2072 6566 6f72 6d61   "1 file reforma
-000065e0: 7474 6564 2c20 3220 6669 6c65 7320 6c65  tted, 2 files le
-000065f0: 6674 2075 6e63 6861 6e67 6564 2c20 3120  ft unchanged, 1 
-00006600: 6669 6c65 2066 6169 6c65 6420 746f 220a  file failed to".
-00006610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006620: 2220 7265 666f 726d 6174 2e22 2c0a 2020  " reformat.",.  
-00006630: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00006640: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00006650: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
-00006660: 7265 7475 726e 5f63 6f64 652c 2031 3233  return_code, 123
-00006670: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00006680: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
-00006690: 6633 2229 2c20 626c 6163 6b2e 4368 616e  f3"), black.Chan
-000066a0: 6765 642e 5945 5329 0a20 2020 2020 2020  ged.YES).       
-000066b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000066c0: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-000066d0: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
-000066e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000066f0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00006700: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
-00006710: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006720: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00006730: 2020 2020 2020 2075 6e73 7479 6c65 2873         unstyle(s
-00006740: 7472 2872 6570 6f72 7429 292c 0a20 2020  tr(report)),.   
-00006750: 2020 2020 2020 2020 2020 2020 2022 3220               "2 
-00006760: 6669 6c65 7320 7265 666f 726d 6174 7465  files reformatte
-00006770: 642c 2032 2066 696c 6573 206c 6566 7420  d, 2 files left 
-00006780: 756e 6368 616e 6765 642c 2031 2066 696c  unchanged, 1 fil
-00006790: 6520 6661 696c 6564 2074 6f22 0a20 2020  e failed to".   
-000067a0: 2020 2020 2020 2020 2020 2020 2022 2072               " r
-000067b0: 6566 6f72 6d61 742e 222c 0a20 2020 2020  eformat.",.     
-000067c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000067d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000067e0: 4571 7561 6c28 7265 706f 7274 2e72 6574  Equal(report.ret
-000067f0: 7572 6e5f 636f 6465 2c20 3132 3329 0a20  urn_code, 123). 
-00006800: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00006810: 742e 6661 696c 6564 2850 6174 6828 2265  t.failed(Path("e
-00006820: 3222 292c 2022 626f 6f6d 2229 0a20 2020  2"), "boom").   
-00006830: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006840: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
-00006850: 745f 6c69 6e65 7329 2c20 3029 0a20 2020  t_lines), 0).   
-00006860: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00006870: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
-00006880: 725f 6c69 6e65 7329 2c20 3229 0a20 2020  r_lines), 2).   
-00006890: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000068a0: 7365 7274 4571 7561 6c28 6572 725f 6c69  sertEqual(err_li
-000068b0: 6e65 735b 2d31 5d2c 2022 6572 726f 723a  nes[-1], "error:
-000068c0: 2063 616e 6e6f 7420 666f 726d 6174 2065   cannot format e
-000068d0: 323a 2062 6f6f 6d22 290a 2020 2020 2020  2: boom").      
-000068e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000068f0: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00006900: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
-00006910: 7374 7228 7265 706f 7274 2929 2c0a 2020  str(report)),.  
-00006920: 2020 2020 2020 2020 2020 2020 2020 2232                "2
-00006930: 2066 696c 6573 2072 6566 6f72 6d61 7474   files reformatt
-00006940: 6564 2c20 3220 6669 6c65 7320 6c65 6674  ed, 2 files left
-00006950: 2075 6e63 6861 6e67 6564 2c20 3220 6669   unchanged, 2 fi
-00006960: 6c65 7320 6661 696c 6564 2074 6f22 0a20  les failed to". 
-00006970: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00006980: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
-00006990: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000069a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000069b0: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
-000069c0: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
-000069d0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-000069e0: 6f72 742e 7061 7468 5f69 676e 6f72 6564  ort.path_ignored
-000069f0: 2850 6174 6828 2277 6174 2229 2c20 226e  (Path("wat"), "n
-00006a00: 6f20 6d61 7463 6822 290a 2020 2020 2020  o match").      
-00006a10: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006a20: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
-00006a30: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
-00006a40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006a50: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
-00006a60: 696e 6573 292c 2032 290a 2020 2020 2020  ines), 2).      
-00006a70: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00006a80: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00006a90: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
-00006aa0: 7374 7228 7265 706f 7274 2929 2c0a 2020  str(report)),.  
-00006ab0: 2020 2020 2020 2020 2020 2020 2020 2232                "2
-00006ac0: 2066 696c 6573 2072 6566 6f72 6d61 7474   files reformatt
-00006ad0: 6564 2c20 3220 6669 6c65 7320 6c65 6674  ed, 2 files left
-00006ae0: 2075 6e63 6861 6e67 6564 2c20 3220 6669   unchanged, 2 fi
-00006af0: 6c65 7320 6661 696c 6564 2074 6f22 0a20  les failed to". 
-00006b00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00006b10: 2072 6566 6f72 6d61 742e 222c 0a20 2020   reformat.",.   
-00006b20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00006b30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006b40: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
-00006b50: 6574 7572 6e5f 636f 6465 2c20 3132 3329  eturn_code, 123)
-00006b60: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-00006b70: 6f72 742e 646f 6e65 2850 6174 6828 2266  ort.done(Path("f
-00006b80: 3422 292c 2062 6c61 636b 2e43 6861 6e67  4"), black.Chang
-00006b90: 6564 2e4e 4f29 0a20 2020 2020 2020 2020  ed.NO).         
-00006ba0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006bb0: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
-00006bc0: 7329 2c20 3029 0a20 2020 2020 2020 2020  s), 0).         
-00006bd0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006be0: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
-00006bf0: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
-00006c00: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006c10: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00006c20: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
-00006c30: 2872 6570 6f72 7429 292c 0a20 2020 2020  (report)),.     
-00006c40: 2020 2020 2020 2020 2020 2022 3220 6669             "2 fi
-00006c50: 6c65 7320 7265 666f 726d 6174 7465 642c  les reformatted,
-00006c60: 2033 2066 696c 6573 206c 6566 7420 756e   3 files left un
-00006c70: 6368 616e 6765 642c 2032 2066 696c 6573  changed, 2 files
-00006c80: 2066 6169 6c65 6420 746f 220a 2020 2020   failed to".    
-00006c90: 2020 2020 2020 2020 2020 2020 2220 7265              " re
-00006ca0: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
-00006cb0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006cc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006cd0: 7175 616c 2872 6570 6f72 742e 7265 7475  qual(report.retu
-00006ce0: 726e 5f63 6f64 652c 2031 3233 290a 2020  rn_code, 123).  
-00006cf0: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00006d00: 2e63 6865 636b 203d 2054 7275 650a 2020  .check = True.  
-00006d10: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00006d20: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00006d30: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-00006d40: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-00006d50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006d60: 2020 2232 2066 696c 6573 2077 6f75 6c64    "2 files would
-00006d70: 2062 6520 7265 666f 726d 6174 7465 642c   be reformatted,
-00006d80: 2033 2066 696c 6573 2077 6f75 6c64 2062   3 files would b
-00006d90: 6520 6c65 6674 2075 6e63 6861 6e67 6564  e left unchanged
-00006da0: 2c20 3222 0a20 2020 2020 2020 2020 2020  , 2".           
-00006db0: 2020 2020 2022 2066 696c 6573 2077 6f75       " files wou
-00006dc0: 6c64 2066 6169 6c20 746f 2072 6566 6f72  ld fail to refor
-00006dd0: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
-00006de0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00006df0: 2072 6570 6f72 742e 6368 6563 6b20 3d20   report.check = 
-00006e00: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00006e10: 2020 7265 706f 7274 2e64 6966 6620 3d20    report.diff = 
-00006e20: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00006e30: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006e40: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00006e50: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
-00006e60: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
-00006e70: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
-00006e80: 7320 776f 756c 6420 6265 2072 6566 6f72  s would be refor
-00006e90: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
-00006ea0: 776f 756c 6420 6265 206c 6566 7420 756e  would be left un
-00006eb0: 6368 616e 6765 642c 2032 220a 2020 2020  changed, 2".    
-00006ec0: 2020 2020 2020 2020 2020 2020 2220 6669              " fi
-00006ed0: 6c65 7320 776f 756c 6420 6661 696c 2074  les would fail t
-00006ee0: 6f20 7265 666f 726d 6174 2e22 2c0a 2020  o reformat.",.  
-00006ef0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00006f00: 2064 6566 2074 6573 745f 7265 706f 7274   def test_report
-00006f10: 5f6e 6f72 6d61 6c28 7365 6c66 2920 2d3e  _normal(self) ->
-00006f20: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
-00006f30: 6570 6f72 7420 3d20 626c 6163 6b2e 5265  eport = black.Re
-00006f40: 706f 7274 2829 0a20 2020 2020 2020 206f  port().        o
-00006f50: 7574 5f6c 696e 6573 203d 205b 5d0a 2020  ut_lines = [].  
-00006f60: 2020 2020 2020 6572 725f 6c69 6e65 7320        err_lines 
-00006f70: 3d20 5b5d 0a0a 2020 2020 2020 2020 6465  = []..        de
-00006f80: 6620 6f75 7428 6d73 673a 2073 7472 2c20  f out(msg: str, 
-00006f90: 2a2a 6b77 6172 6773 3a20 416e 7929 202d  **kwargs: Any) -
-00006fa0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00006fb0: 2020 2020 6f75 745f 6c69 6e65 732e 6170      out_lines.ap
-00006fc0: 7065 6e64 286d 7367 290a 0a20 2020 2020  pend(msg)..     
-00006fd0: 2020 2064 6566 2065 7272 286d 7367 3a20     def err(msg: 
-00006fe0: 7374 722c 202a 2a6b 7761 7267 733a 2041  str, **kwargs: A
-00006ff0: 6e79 2920 2d3e 204e 6f6e 653a 0a20 2020  ny) -> None:.   
-00007000: 2020 2020 2020 2020 2065 7272 5f6c 696e           err_lin
-00007010: 6573 2e61 7070 656e 6428 6d73 6729 0a0a  es.append(msg)..
-00007020: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
-00007030: 6368 2822 626c 6163 6b2e 6f75 7470 7574  ch("black.output
-00007040: 2e5f 6f75 7422 2c20 6f75 7429 2c20 7061  ._out", out), pa
-00007050: 7463 6828 2262 6c61 636b 2e6f 7574 7075  tch("black.outpu
-00007060: 742e 5f65 7272 222c 2065 7272 293a 0a20  t._err", err):. 
-00007070: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
-00007080: 742e 646f 6e65 2850 6174 6828 2266 3122  t.done(Path("f1"
-00007090: 292c 2062 6c61 636b 2e43 6861 6e67 6564  ), black.Changed
-000070a0: 2e4e 4f29 0a20 2020 2020 2020 2020 2020  .NO).           
-000070b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000070c0: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
-000070d0: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
-000070e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000070f0: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
-00007100: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
-00007110: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00007120: 6c28 756e 7374 796c 6528 7374 7228 7265  l(unstyle(str(re
-00007130: 706f 7274 2929 2c20 2231 2066 696c 6520  port)), "1 file 
-00007140: 6c65 6674 2075 6e63 6861 6e67 6564 2e22  left unchanged."
-00007150: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00007160: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00007170: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
-00007180: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
-00007190: 2020 7265 706f 7274 2e64 6f6e 6528 5061    report.done(Pa
-000071a0: 7468 2822 6632 2229 2c20 626c 6163 6b2e  th("f2"), black.
-000071b0: 4368 616e 6765 642e 5945 5329 0a20 2020  Changed.YES).   
-000071c0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000071d0: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
-000071e0: 745f 6c69 6e65 7329 2c20 3129 0a20 2020  t_lines), 1).   
-000071f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00007200: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
-00007210: 725f 6c69 6e65 7329 2c20 3029 0a20 2020  r_lines), 0).   
-00007220: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00007230: 7365 7274 4571 7561 6c28 6f75 745f 6c69  sertEqual(out_li
-00007240: 6e65 735b 2d31 5d2c 2022 7265 666f 726d  nes[-1], "reform
-00007250: 6174 7465 6420 6632 2229 0a20 2020 2020  atted f2").     
-00007260: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00007270: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
-00007280: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
-00007290: 2873 7472 2872 6570 6f72 7429 292c 2022  (str(report)), "
-000072a0: 3120 6669 6c65 2072 6566 6f72 6d61 7474  1 file reformatt
-000072b0: 6564 2c20 3120 6669 6c65 206c 6566 7420  ed, 1 file left 
-000072c0: 756e 6368 616e 6765 642e 220a 2020 2020  unchanged.".    
-000072d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000072e0: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
-000072f0: 6528 5061 7468 2822 6633 2229 2c20 626c  e(Path("f3"), bl
-00007300: 6163 6b2e 4368 616e 6765 642e 4341 4348  ack.Changed.CACH
-00007310: 4544 290a 2020 2020 2020 2020 2020 2020  ED).            
-00007320: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007330: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
-00007340: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-00007350: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007360: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
-00007370: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
-00007380: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007390: 286f 7574 5f6c 696e 6573 5b2d 315d 2c20  (out_lines[-1], 
-000073a0: 2272 6566 6f72 6d61 7474 6564 2066 3222  "reformatted f2"
-000073b0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000073c0: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
-000073d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073e0: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
-000073f0: 7274 2929 2c20 2231 2066 696c 6520 7265  rt)), "1 file re
-00007400: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
-00007410: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
-00007420: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
-00007430: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00007440: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00007450: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
-00007460: 652c 2030 290a 2020 2020 2020 2020 2020  e, 0).          
-00007470: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
-00007480: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00007490: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000074a0: 616c 2872 6570 6f72 742e 7265 7475 726e  al(report.return
-000074b0: 5f63 6f64 652c 2031 290a 2020 2020 2020  _code, 1).      
-000074c0: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
-000074d0: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
-000074e0: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
-000074f0: 696c 6564 2850 6174 6828 2265 3122 292c  iled(Path("e1"),
-00007500: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
-00007510: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007520: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
-00007530: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
-00007540: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007550: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
-00007560: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
-00007570: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00007580: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
-00007590: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
-000075a0: 6e6f 7420 666f 726d 6174 2065 313a 2062  not format e1: b
-000075b0: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
-000075c0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000075d0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-000075e0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
-000075f0: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
-00007600: 2020 2020 2020 2020 2020 2231 2066 696c            "1 fil
-00007610: 6520 7265 666f 726d 6174 7465 642c 2032  e reformatted, 2
-00007620: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
-00007630: 616e 6765 642c 2031 2066 696c 6520 6661  anged, 1 file fa
-00007640: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
-00007650: 2020 2020 2020 2020 2022 2072 6566 6f72           " refor
-00007660: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
-00007670: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00007680: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00007690: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
-000076a0: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
-000076b0: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
-000076c0: 6e65 2850 6174 6828 2266 3322 292c 2062  ne(Path("f3"), b
-000076d0: 6c61 636b 2e43 6861 6e67 6564 2e59 4553  lack.Changed.YES
-000076e0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000076f0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00007700: 656e 286f 7574 5f6c 696e 6573 292c 2032  en(out_lines), 2
-00007710: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00007720: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
-00007730: 656e 2865 7272 5f6c 696e 6573 292c 2031  en(err_lines), 1
-00007740: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00007750: 6c66 2e61 7373 6572 7445 7175 616c 286f  lf.assertEqual(o
-00007760: 7574 5f6c 696e 6573 5b2d 315d 2c20 2272  ut_lines[-1], "r
-00007770: 6566 6f72 6d61 7474 6564 2066 3322 290a  eformatted f3").
-00007780: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007790: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
-000077a0: 2020 2020 2020 2020 2020 2020 2020 756e                un
-000077b0: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
-000077c0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-000077d0: 2020 2020 2232 2066 696c 6573 2072 6566      "2 files ref
-000077e0: 6f72 6d61 7474 6564 2c20 3220 6669 6c65  ormatted, 2 file
-000077f0: 7320 6c65 6674 2075 6e63 6861 6e67 6564  s left unchanged
-00007800: 2c20 3120 6669 6c65 2066 6169 6c65 6420  , 1 file failed 
-00007810: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
-00007820: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
-00007830: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00007840: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007850: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
-00007860: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
-00007870: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
-00007880: 2020 7265 706f 7274 2e66 6169 6c65 6428    report.failed(
-00007890: 5061 7468 2822 6532 2229 2c20 2262 6f6f  Path("e2"), "boo
-000078a0: 6d22 290a 2020 2020 2020 2020 2020 2020  m").            
-000078b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000078c0: 286c 656e 286f 7574 5f6c 696e 6573 292c  (len(out_lines),
-000078d0: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
-000078e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000078f0: 286c 656e 2865 7272 5f6c 696e 6573 292c  (len(err_lines),
-00007900: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
-00007910: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007920: 2865 7272 5f6c 696e 6573 5b2d 315d 2c20  (err_lines[-1], 
-00007930: 2265 7272 6f72 3a20 6361 6e6e 6f74 2066  "error: cannot f
-00007940: 6f72 6d61 7420 6532 3a20 626f 6f6d 2229  ormat e2: boom")
-00007950: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007960: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00007970: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00007980: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
-00007990: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
-000079a0: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
-000079b0: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
-000079c0: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
-000079d0: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
-000079e0: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
-000079f0: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
-00007a00: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
-00007a10: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00007a20: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00007a30: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
-00007a40: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
-00007a50: 2020 2020 7265 706f 7274 2e70 6174 685f      report.path_
-00007a60: 6967 6e6f 7265 6428 5061 7468 2822 7761  ignored(Path("wa
-00007a70: 7422 292c 2022 6e6f 206d 6174 6368 2229  t"), "no match")
-00007a80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007a90: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00007aa0: 6e28 6f75 745f 6c69 6e65 7329 2c20 3229  n(out_lines), 2)
-00007ab0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007ac0: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00007ad0: 6e28 6572 725f 6c69 6e65 7329 2c20 3229  n(err_lines), 2)
-00007ae0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007af0: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00007b00: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00007b10: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
-00007b20: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
-00007b30: 2020 2020 2022 3220 6669 6c65 7320 7265       "2 files re
-00007b40: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
-00007b50: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
-00007b60: 642c 2032 2066 696c 6573 2066 6169 6c65  d, 2 files faile
-00007b70: 6420 746f 220a 2020 2020 2020 2020 2020  d to".          
-00007b80: 2020 2020 2020 2220 7265 666f 726d 6174        " reformat
-00007b90: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
-00007ba0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00007bb0: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00007bc0: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
-00007bd0: 652c 2031 3233 290a 2020 2020 2020 2020  e, 123).        
-00007be0: 2020 2020 7265 706f 7274 2e64 6f6e 6528      report.done(
-00007bf0: 5061 7468 2822 6634 2229 2c20 626c 6163  Path("f4"), blac
-00007c00: 6b2e 4368 616e 6765 642e 4e4f 290a 2020  k.Changed.NO).  
-00007c10: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00007c20: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
-00007c30: 7574 5f6c 696e 6573 292c 2032 290a 2020  ut_lines), 2).  
-00007c40: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00007c50: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
-00007c60: 7272 5f6c 696e 6573 292c 2032 290a 2020  rr_lines), 2).  
-00007c70: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00007c80: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
-00007c90: 2020 2020 2020 2020 2020 2020 756e 7374              unst
-00007ca0: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
-00007cb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007cc0: 2020 2232 2066 696c 6573 2072 6566 6f72    "2 files refor
-00007cd0: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
-00007ce0: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
-00007cf0: 3220 6669 6c65 7320 6661 696c 6564 2074  2 files failed t
-00007d00: 6f22 0a20 2020 2020 2020 2020 2020 2020  o".             
-00007d10: 2020 2022 2072 6566 6f72 6d61 742e 222c     " reformat.",
-00007d20: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00007d30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007d40: 6173 7365 7274 4571 7561 6c28 7265 706f  assertEqual(repo
-00007d50: 7274 2e72 6574 7572 6e5f 636f 6465 2c20  rt.return_code, 
-00007d60: 3132 3329 0a20 2020 2020 2020 2020 2020  123).           
-00007d70: 2072 6570 6f72 742e 6368 6563 6b20 3d20   report.check = 
-00007d80: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00007d90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00007da0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00007db0: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
-00007dc0: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
-00007dd0: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
-00007de0: 7320 776f 756c 6420 6265 2072 6566 6f72  s would be refor
-00007df0: 6d61 7474 6564 2c20 3320 6669 6c65 7320  matted, 3 files 
-00007e00: 776f 756c 6420 6265 206c 6566 7420 756e  would be left un
-00007e10: 6368 616e 6765 642c 2032 220a 2020 2020  changed, 2".    
-00007e20: 2020 2020 2020 2020 2020 2020 2220 6669              " fi
-00007e30: 6c65 7320 776f 756c 6420 6661 696c 2074  les would fail t
-00007e40: 6f20 7265 666f 726d 6174 2e22 2c0a 2020  o reformat.",.  
-00007e50: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00007e60: 2020 2020 2020 2020 7265 706f 7274 2e63          report.c
-00007e70: 6865 636b 203d 2046 616c 7365 0a20 2020  heck = False.   
-00007e80: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
-00007e90: 6469 6666 203d 2054 7275 650a 2020 2020  diff = True.    
-00007ea0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00007eb0: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
-00007ec0: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
-00007ed0: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
-00007ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ef0: 2232 2066 696c 6573 2077 6f75 6c64 2062  "2 files would b
-00007f00: 6520 7265 666f 726d 6174 7465 642c 2033  e reformatted, 3
-00007f10: 2066 696c 6573 2077 6f75 6c64 2062 6520   files would be 
-00007f20: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
-00007f30: 3222 0a20 2020 2020 2020 2020 2020 2020  2".             
-00007f40: 2020 2022 2066 696c 6573 2077 6f75 6c64     " files would
-00007f50: 2066 6169 6c20 746f 2072 6566 6f72 6d61   fail to reforma
-00007f60: 742e 222c 0a20 2020 2020 2020 2020 2020  t.",.           
-00007f70: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
-00007f80: 5f6c 6962 3274 6f33 5f70 6172 7365 2873  _lib2to3_parse(s
-00007f90: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00007fa0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-00007fb0: 6173 7365 7274 5261 6973 6573 2862 6c61  assertRaises(bla
-00007fc0: 636b 2e49 6e76 616c 6964 496e 7075 7429  ck.InvalidInput)
-00007fd0: 3a0a 2020 2020 2020 2020 2020 2020 626c  :.            bl
-00007fe0: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
-00007ff0: 6528 2269 6e76 616c 6964 2073 796e 7461  e("invalid synta
-00008000: 7822 290a 0a20 2020 2020 2020 2073 7472  x")..        str
-00008010: 6164 646c 696e 6720 3d20 2278 202b 2079  addling = "x + y
-00008020: 220a 2020 2020 2020 2020 626c 6163 6b2e  ".        black.
-00008030: 6c69 6232 746f 335f 7061 7273 6528 7374  lib2to3_parse(st
-00008040: 7261 6464 6c69 6e67 290a 2020 2020 2020  raddling).      
-00008050: 2020 626c 6163 6b2e 6c69 6232 746f 335f    black.lib2to3_
-00008060: 7061 7273 6528 7374 7261 6464 6c69 6e67  parse(straddling
-00008070: 2c20 7b54 6172 6765 7456 6572 7369 6f6e  , {TargetVersion
-00008080: 2e50 5933 367d 290a 0a20 2020 2020 2020  .PY36})..       
-00008090: 2070 7932 5f6f 6e6c 7920 3d20 2270 7269   py2_only = "pri
-000080a0: 6e74 2078 220a 2020 2020 2020 2020 7769  nt x".        wi
-000080b0: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-000080c0: 6973 6573 2862 6c61 636b 2e49 6e76 616c  ises(black.Inval
-000080d0: 6964 496e 7075 7429 3a0a 2020 2020 2020  idInput):.      
-000080e0: 2020 2020 2020 626c 6163 6b2e 6c69 6232        black.lib2
-000080f0: 746f 335f 7061 7273 6528 7079 325f 6f6e  to3_parse(py2_on
-00008100: 6c79 2c20 7b54 6172 6765 7456 6572 7369  ly, {TargetVersi
-00008110: 6f6e 2e50 5933 367d 290a 0a20 2020 2020  on.PY36})..     
-00008120: 2020 2070 7933 5f6f 6e6c 7920 3d20 2265     py3_only = "e
-00008130: 7865 6328 782c 2065 6e64 3d79 2922 0a20  xec(x, end=y)". 
-00008140: 2020 2020 2020 2062 6c61 636b 2e6c 6962         black.lib
-00008150: 3274 6f33 5f70 6172 7365 2870 7933 5f6f  2to3_parse(py3_o
-00008160: 6e6c 7929 0a20 2020 2020 2020 2062 6c61  nly).        bla
-00008170: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
-00008180: 2870 7933 5f6f 6e6c 792c 207b 5461 7267  (py3_only, {Targ
-00008190: 6574 5665 7273 696f 6e2e 5059 3336 7d29  etVersion.PY36})
-000081a0: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
-000081b0: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
-000081c0: 5f64 6563 6f72 6174 6f72 2873 656c 6629  _decorator(self)
-000081d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000081e0: 2020 2320 5465 7374 2074 6865 2066 6561    # Test the fea
-000081f0: 7475 7265 2064 6574 6563 7469 6f6e 206f  ture detection o
-00008200: 6620 6e65 7720 6465 636f 7261 746f 7220  f new decorator 
-00008210: 7379 6e74 6178 0a20 2020 2020 2020 2023  syntax.        #
-00008220: 2073 696e 6365 2074 6869 7320 6d61 6b65   since this make
-00008230: 7320 736f 6d65 2074 6573 7420 6361 7365  s some test case
-00008240: 7320 6f66 2074 6573 745f 6765 745f 6665  s of test_get_fe
-00008250: 6174 7572 6573 5f75 7365 6428 290a 2020  atures_used().  
-00008260: 2020 2020 2020 2320 6661 696c 7320 6966        # fails if
-00008270: 2069 7420 6661 696c 732c 2074 6869 7320   it fails, this 
-00008280: 6973 2074 6573 7465 6420 6669 7273 7420  is tested first 
-00008290: 736f 2074 6861 7420 6120 7573 6566 756c  so that a useful
-000082a0: 2063 6173 650a 2020 2020 2020 2020 2320   case.        # 
-000082b0: 6973 2069 6465 6e74 6966 6965 640a 2020  is identified.  
-000082c0: 2020 2020 2020 7369 6d70 6c65 732c 2072        simples, r
-000082d0: 656c 6178 6564 203d 2072 6561 645f 6461  elaxed = read_da
-000082e0: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
-000082f0: 7322 2c20 2264 6563 6f72 6174 6f72 7322  s", "decorators"
-00008300: 290a 2020 2020 2020 2020 2320 736b 6970  ).        # skip
-00008310: 2065 7870 6c61 6e61 7469 6f6e 2063 6f6d   explanation com
-00008320: 6d65 6e74 7320 6174 2074 6865 2074 6f70  ments at the top
-00008330: 206f 6620 7468 6520 6669 6c65 0a20 2020   of the file.   
-00008340: 2020 2020 2066 6f72 2073 696d 706c 655f       for simple_
-00008350: 7465 7374 2069 6e20 7369 6d70 6c65 732e  test in simples.
-00008360: 7370 6c69 7428 2223 2322 295b 313a 5d3a  split("##")[1:]:
-00008370: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
-00008380: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
-00008390: 335f 7061 7273 6528 7369 6d70 6c65 5f74  3_parse(simple_t
-000083a0: 6573 7429 0a20 2020 2020 2020 2020 2020  est).           
-000083b0: 2064 6563 6f72 6174 6f72 203d 2073 7472   decorator = str
-000083c0: 286e 6f64 652e 6368 696c 6472 656e 5b30  (node.children[0
-000083d0: 5d2e 6368 696c 6472 656e 5b30 5d29 2e73  ].children[0]).s
-000083e0: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-000083f0: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
-00008400: 7449 6e28 0a20 2020 2020 2020 2020 2020  tIn(.           
-00008410: 2020 2020 2046 6561 7475 7265 2e52 454c       Feature.REL
-00008420: 4158 4544 5f44 4543 4f52 4154 4f52 532c  AXED_DECORATORS,
-00008430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008440: 2062 6c61 636b 2e67 6574 5f66 6561 7475   black.get_featu
-00008450: 7265 735f 7573 6564 286e 6f64 6529 2c0a  res_used(node),.
-00008460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008470: 6d73 673d 280a 2020 2020 2020 2020 2020  msg=(.          
-00008480: 2020 2020 2020 2020 2020 6622 6465 636f            f"deco
-00008490: 7261 746f 7220 277b 6465 636f 7261 746f  rator '{decorato
-000084a0: 727d 2720 666f 6c6c 6f77 7320 7079 7468  r}' follows pyth
-000084b0: 6f6e 3c3d 332e 3820 7379 6e74 6178 220a  on<=3.8 syntax".
-000084c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000084d0: 2020 2020 2262 7574 2069 7320 6465 7465      "but is dete
-000084e0: 6374 6564 2061 7320 332e 392b 220a 2020  cted as 3.9+".  
-000084f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008500: 2020 2320 6622 5468 6520 6675 6c6c 206e    # f"The full n
-00008510: 6f64 6520 6973 5c6e 7b6e 6f64 6521 727d  ode is\n{node!r}
-00008520: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00008530: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
-00008540: 2029 0a20 2020 2020 2020 2023 2073 6b69   ).        # ski
-00008550: 7020 7468 6520 2723 206f 7574 7075 7427  p the '# output'
-00008560: 2063 6f6d 6d65 6e74 2061 7420 7468 6520   comment at the 
-00008570: 746f 7020 6f66 2074 6865 206f 7574 7075  top of the outpu
-00008580: 7420 7061 7274 0a20 2020 2020 2020 2066  t part.        f
-00008590: 6f72 2072 656c 6178 6564 5f74 6573 7420  or relaxed_test 
-000085a0: 696e 2072 656c 6178 6564 2e73 706c 6974  in relaxed.split
-000085b0: 2822 2323 2229 5b31 3a5d 3a0a 2020 2020  ("##")[1:]:.    
-000085c0: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
-000085d0: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
-000085e0: 7365 2872 656c 6178 6564 5f74 6573 7429  se(relaxed_test)
-000085f0: 0a20 2020 2020 2020 2020 2020 2064 6563  .            dec
-00008600: 6f72 6174 6f72 203d 2073 7472 286e 6f64  orator = str(nod
-00008610: 652e 6368 696c 6472 656e 5b30 5d2e 6368  e.children[0].ch
-00008620: 696c 6472 656e 5b30 5d29 2e73 7472 6970  ildren[0]).strip
-00008630: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-00008640: 656c 662e 6173 7365 7274 496e 280a 2020  elf.assertIn(.  
-00008650: 2020 2020 2020 2020 2020 2020 2020 4665                Fe
-00008660: 6174 7572 652e 5245 4c41 5845 445f 4445  ature.RELAXED_DE
-00008670: 434f 5241 544f 5253 2c0a 2020 2020 2020  CORATORS,.      
-00008680: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-00008690: 6765 745f 6665 6174 7572 6573 5f75 7365  get_features_use
-000086a0: 6428 6e6f 6465 292c 0a20 2020 2020 2020  d(node),.       
-000086b0: 2020 2020 2020 2020 206d 7367 3d28 0a20           msg=(. 
-000086c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000086d0: 2020 2066 2264 6563 6f72 6174 6f72 2027     f"decorator '
-000086e0: 7b64 6563 6f72 6174 6f72 7d27 2075 7365  {decorator}' use
-000086f0: 7320 7079 7468 6f6e 332e 392b 2073 796e  s python3.9+ syn
-00008700: 7461 7822 0a20 2020 2020 2020 2020 2020  tax".           
-00008710: 2020 2020 2020 2020 2022 6275 7420 6973           "but is
-00008720: 2064 6574 6563 7465 6420 6173 2070 7974   detected as pyt
-00008730: 686f 6e3c 3d33 2e38 220a 2020 2020 2020  hon<=3.8".      
-00008740: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00008750: 6622 5468 6520 6675 6c6c 206e 6f64 6520  f"The full node 
-00008760: 6973 5c6e 7b6e 6f64 6521 727d 220a 2020  is\n{node!r}".  
-00008770: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-00008780: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00008790: 2020 2020 6465 6620 7465 7374 5f67 6574      def test_get
-000087a0: 5f66 6561 7475 7265 735f 7573 6564 2873  _features_used(s
-000087b0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-000087c0: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
-000087d0: 5f66 6561 7475 7265 735f 7573 6564 2822  _features_used("
-000087e0: 6465 6620 6628 2a2c 2061 7267 293a 202e  def f(*, arg): .
-000087f0: 2e2e 5c6e 222c 2073 6574 2829 290a 2020  ..\n", set()).  
-00008800: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
-00008810: 5f66 6561 7475 7265 735f 7573 6564 280a  _features_used(.
-00008820: 2020 2020 2020 2020 2020 2020 2264 6566              "def
-00008830: 2066 282a 2c20 6172 672c 293a 202e 2e2e   f(*, arg,): ...
-00008840: 5c6e 222c 207b 4665 6174 7572 652e 5452  \n", {Feature.TR
-00008850: 4149 4c49 4e47 5f43 4f4d 4d41 5f49 4e5f  AILING_COMMA_IN_
-00008860: 4445 467d 0a20 2020 2020 2020 2029 0a20  DEF}.        ). 
-00008870: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
-00008880: 6b5f 6665 6174 7572 6573 5f75 7365 6428  k_features_used(
-00008890: 2266 282a 6172 672c 295c 6e22 2c20 7b46  "f(*arg,)\n", {F
-000088a0: 6561 7475 7265 2e54 5241 494c 494e 475f  eature.TRAILING_
-000088b0: 434f 4d4d 415f 494e 5f43 414c 4c7d 290a  COMMA_IN_CALL}).
-000088c0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-000088d0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-000088e0: 2822 6465 6620 6628 2a2c 2061 7267 293a  ("def f(*, arg):
-000088f0: 2066 2773 7472 696e 6727 5c6e 222c 207b   f'string'\n", {
-00008900: 4665 6174 7572 652e 465f 5354 5249 4e47  Feature.F_STRING
-00008910: 537d 290a 2020 2020 2020 2020 7365 6c66  S}).        self
-00008920: 2e63 6865 636b 5f66 6561 7475 7265 735f  .check_features_
-00008930: 7573 6564 2822 3132 335f 3435 365c 6e22  used("123_456\n"
-00008940: 2c20 7b46 6561 7475 7265 2e4e 554d 4552  , {Feature.NUMER
-00008950: 4943 5f55 4e44 4552 5343 4f52 4553 7d29  IC_UNDERSCORES})
-00008960: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-00008970: 6563 6b5f 6665 6174 7572 6573 5f75 7365  eck_features_use
-00008980: 6428 2231 3233 3435 365c 6e22 2c20 7365  d("123456\n", se
-00008990: 7428 2929 0a0a 2020 2020 2020 2020 736f  t())..        so
-000089a0: 7572 6365 2c20 6578 7065 6374 6564 203d  urce, expected =
-000089b0: 2072 6561 645f 6461 7461 2822 6361 7365   read_data("case
-000089c0: 7322 2c20 2266 756e 6374 696f 6e22 290a  s", "function").
-000089d0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-000089e0: 5f66 6561 7475 7265 7320 3d20 7b0a 2020  _features = {.  
-000089f0: 2020 2020 2020 2020 2020 4665 6174 7572            Featur
-00008a00: 652e 5452 4149 4c49 4e47 5f43 4f4d 4d41  e.TRAILING_COMMA
-00008a10: 5f49 4e5f 4341 4c4c 2c0a 2020 2020 2020  _IN_CALL,.      
-00008a20: 2020 2020 2020 4665 6174 7572 652e 5452        Feature.TR
-00008a30: 4149 4c49 4e47 5f43 4f4d 4d41 5f49 4e5f  AILING_COMMA_IN_
-00008a40: 4445 462c 0a20 2020 2020 2020 2020 2020  DEF,.           
-00008a50: 2046 6561 7475 7265 2e46 5f53 5452 494e   Feature.F_STRIN
-00008a60: 4753 2c0a 2020 2020 2020 2020 7d0a 2020  GS,.        }.  
-00008a70: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
-00008a80: 5f66 6561 7475 7265 735f 7573 6564 2873  _features_used(s
-00008a90: 6f75 7263 652c 2065 7870 6563 7465 645f  ource, expected_
-00008aa0: 6665 6174 7572 6573 290a 2020 2020 2020  features).      
-00008ab0: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
-00008ac0: 7475 7265 735f 7573 6564 2865 7870 6563  tures_used(expec
-00008ad0: 7465 642c 2065 7870 6563 7465 645f 6665  ted, expected_fe
-00008ae0: 6174 7572 6573 290a 0a20 2020 2020 2020  atures)..       
-00008af0: 2073 6f75 7263 652c 2065 7870 6563 7465   source, expecte
-00008b00: 6420 3d20 7265 6164 5f64 6174 6128 2263  d = read_data("c
-00008b10: 6173 6573 222c 2022 6578 7072 6573 7369  ases", "expressi
-00008b20: 6f6e 2229 0a20 2020 2020 2020 2073 656c  on").        sel
-00008b30: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
-00008b40: 5f75 7365 6428 736f 7572 6365 2c20 7365  _used(source, se
-00008b50: 7428 2929 0a20 2020 2020 2020 2073 656c  t()).        sel
-00008b60: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
-00008b70: 5f75 7365 6428 6578 7065 6374 6564 2c20  _used(expected, 
-00008b80: 7365 7428 2929 0a0a 2020 2020 2020 2020  set())..        
-00008b90: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
-00008ba0: 7265 735f 7573 6564 2822 6c61 6d62 6461  res_used("lambda
-00008bb0: 2061 2c20 2f2c 2062 3a20 2e2e 2e5c 6e22   a, /, b: ...\n"
-00008bc0: 2c20 7b46 6561 7475 7265 2e50 4f53 5f4f  , {Feature.POS_O
-00008bd0: 4e4c 595f 4152 4755 4d45 4e54 537d 290a  NLY_ARGUMENTS}).
-00008be0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-00008bf0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-00008c00: 2822 6465 6620 666e 2861 2c20 2f2c 2062  ("def fn(a, /, b
-00008c10: 293a 202e 2e2e 222c 207b 4665 6174 7572  ): ...", {Featur
-00008c20: 652e 504f 535f 4f4e 4c59 5f41 5247 554d  e.POS_ONLY_ARGUM
-00008c30: 454e 5453 7d29 0a0a 2020 2020 2020 2020  ENTS})..        
-00008c40: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
-00008c50: 7265 735f 7573 6564 2822 6465 6620 666e  res_used("def fn
-00008c60: 2829 3a20 7969 656c 6420 612c 2062 222c  (): yield a, b",
-00008c70: 2073 6574 2829 290a 2020 2020 2020 2020   set()).        
-00008c80: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
-00008c90: 7265 735f 7573 6564 2822 6465 6620 666e  res_used("def fn
-00008ca0: 2829 3a20 7265 7475 726e 2061 2c20 6222  (): return a, b"
-00008cb0: 2c20 7365 7428 2929 0a20 2020 2020 2020  , set()).       
-00008cc0: 2073 656c 662e 6368 6563 6b5f 6665 6174   self.check_feat
-00008cd0: 7572 6573 5f75 7365 6428 2264 6566 2066  ures_used("def f
-00008ce0: 6e28 293a 2079 6965 6c64 202a 622c 2063  n(): yield *b, c
-00008cf0: 222c 207b 4665 6174 7572 652e 554e 5041  ", {Feature.UNPA
-00008d00: 434b 494e 475f 4f4e 5f46 4c4f 577d 290a  CKING_ON_FLOW}).
-00008d10: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-00008d20: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-00008d30: 280a 2020 2020 2020 2020 2020 2020 2264  (.            "d
-00008d40: 6566 2066 6e28 293a 2072 6574 7572 6e20  ef fn(): return 
-00008d50: 612c 202a 622c 2063 222c 207b 4665 6174  a, *b, c", {Feat
-00008d60: 7572 652e 554e 5041 434b 494e 475f 4f4e  ure.UNPACKING_ON
-00008d70: 5f46 4c4f 577d 0a20 2020 2020 2020 2029  _FLOW}.        )
-00008d80: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-00008d90: 6563 6b5f 6665 6174 7572 6573 5f75 7365  eck_features_use
-00008da0: 6428 2278 203d 2061 2c20 2a62 2c20 6322  d("x = a, *b, c"
-00008db0: 2c20 7365 7428 2929 0a0a 2020 2020 2020  , set())..      
-00008dc0: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
-00008dd0: 7475 7265 735f 7573 6564 2822 783a 2041  tures_used("x: A
-00008de0: 6e79 203d 2072 6567 756c 6172 222c 2073  ny = regular", s
-00008df0: 6574 2829 290a 2020 2020 2020 2020 7365  et()).        se
-00008e00: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
-00008e10: 735f 7573 6564 2822 783a 2041 6e79 203d  s_used("x: Any =
-00008e20: 2028 7265 6775 6c61 722c 2072 6567 756c   (regular, regul
-00008e30: 6172 2922 2c20 7365 7428 2929 0a20 2020  ar)", set()).   
-00008e40: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-00008e50: 6665 6174 7572 6573 5f75 7365 6428 2278  features_used("x
-00008e60: 3a20 416e 7920 3d20 436f 6d70 6c65 7828  : Any = Complex(
-00008e70: 5479 7065 2831 2929 5b73 6f6d 6574 6869  Type(1))[somethi
-00008e80: 6e67 5d22 2c20 7365 7428 2929 0a20 2020  ng]", set()).   
-00008e90: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-00008ea0: 6665 6174 7572 6573 5f75 7365 6428 0a20  features_used(. 
-00008eb0: 2020 2020 2020 2020 2020 2022 783a 2054             "x: T
-00008ec0: 7570 6c65 5b69 6e74 2c20 2e2e 2e5d 203d  uple[int, ...] =
-00008ed0: 2061 2c20 622c 2063 222c 207b 4665 6174   a, b, c", {Feat
-00008ee0: 7572 652e 414e 4e5f 4153 5349 474e 5f45  ure.ANN_ASSIGN_E
-00008ef0: 5854 454e 4445 445f 5248 537d 0a20 2020  XTENDED_RHS}.   
-00008f00: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00008f10: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
-00008f20: 7265 735f 7573 6564 2822 7472 793a 2070  res_used("try: p
-00008f30: 6173 735c 6e65 7863 6570 7420 536f 6d65  ass\nexcept Some
-00008f40: 7468 696e 673a 2070 6173 7322 2c20 7365  thing: pass", se
-00008f50: 7428 2929 0a20 2020 2020 2020 2073 656c  t()).        sel
-00008f60: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
-00008f70: 5f75 7365 6428 2274 7279 3a20 7061 7373  _used("try: pass
-00008f80: 5c6e 6578 6365 7074 2028 2a53 6f6d 6574  \nexcept (*Somet
-00008f90: 6869 6e67 2c29 3a20 7061 7373 222c 2073  hing,): pass", s
-00008fa0: 6574 2829 290a 2020 2020 2020 2020 7365  et()).        se
-00008fb0: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
-00008fc0: 735f 7573 6564 280a 2020 2020 2020 2020  s_used(.        
-00008fd0: 2020 2020 2274 7279 3a20 7061 7373 5c6e      "try: pass\n
-00008fe0: 6578 6365 7074 202a 4772 6f75 703a 2070  except *Group: p
-00008ff0: 6173 7322 2c20 7b46 6561 7475 7265 2e45  ass", {Feature.E
-00009000: 5843 4550 545f 5354 4152 7d0a 2020 2020  XCEPT_STAR}.    
-00009010: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
-00009020: 656c 662e 6368 6563 6b5f 6665 6174 7572  elf.check_featur
-00009030: 6573 5f75 7365 6428 2261 5b2a 625d 222c  es_used("a[*b]",
-00009040: 207b 4665 6174 7572 652e 5641 5249 4144   {Feature.VARIAD
-00009050: 4943 5f47 454e 4552 4943 537d 290a 2020  IC_GENERICS}).  
-00009060: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
-00009070: 5f66 6561 7475 7265 735f 7573 6564 2822  _features_used("
-00009080: 615b 782c 202a 7928 292c 207a 5d20 3d20  a[x, *y(), z] = 
-00009090: 7422 2c20 7b46 6561 7475 7265 2e56 4152  t", {Feature.VAR
-000090a0: 4941 4449 435f 4745 4e45 5249 4353 7d29  IADIC_GENERICS})
-000090b0: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-000090c0: 6563 6b5f 6665 6174 7572 6573 5f75 7365  eck_features_use
-000090d0: 6428 2264 6566 2066 6e28 2a61 7267 733a  d("def fn(*args:
-000090e0: 202a 5429 3a20 7061 7373 222c 207b 4665   *T): pass", {Fe
-000090f0: 6174 7572 652e 5641 5249 4144 4943 5f47  ature.VARIADIC_G
-00009100: 454e 4552 4943 537d 290a 0a20 2020 2020  ENERICS})..     
-00009110: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
-00009120: 6174 7572 6573 5f75 7365 6428 2277 6974  atures_used("wit
-00009130: 6820 613a 2070 6173 7322 2c20 7365 7428  h a: pass", set(
-00009140: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00009150: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
-00009160: 7365 6428 2277 6974 6820 612c 2062 3a20  sed("with a, b: 
-00009170: 7061 7373 222c 2073 6574 2829 290a 2020  pass", set()).  
-00009180: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
-00009190: 5f66 6561 7475 7265 735f 7573 6564 2822  _features_used("
-000091a0: 7769 7468 2061 2061 7320 623a 2070 6173  with a as b: pas
-000091b0: 7322 2c20 7365 7428 2929 0a20 2020 2020  s", set()).     
-000091c0: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
-000091d0: 6174 7572 6573 5f75 7365 6428 2277 6974  atures_used("wit
-000091e0: 6820 6120 6173 2062 2c20 6320 6173 2064  h a as b, c as d
-000091f0: 3a20 7061 7373 222c 2073 6574 2829 290a  : pass", set()).
-00009200: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-00009210: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-00009220: 2822 7769 7468 2028 6129 3a20 7061 7373  ("with (a): pass
-00009230: 222c 2073 6574 2829 290a 2020 2020 2020  ", set()).      
-00009240: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
-00009250: 7475 7265 735f 7573 6564 2822 7769 7468  tures_used("with
-00009260: 2028 612c 2062 293a 2070 6173 7322 2c20   (a, b): pass", 
-00009270: 7365 7428 2929 0a20 2020 2020 2020 2073  set()).        s
-00009280: 656c 662e 6368 6563 6b5f 6665 6174 7572  elf.check_featur
-00009290: 6573 5f75 7365 6428 2277 6974 6820 2861  es_used("with (a
-000092a0: 2c20 6229 2061 7320 2863 2c20 6429 3a20  , b) as (c, d): 
-000092b0: 7061 7373 222c 2073 6574 2829 290a 2020  pass", set()).  
-000092c0: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
-000092d0: 5f66 6561 7475 7265 735f 7573 6564 280a  _features_used(.
-000092e0: 2020 2020 2020 2020 2020 2020 2277 6974              "wit
-000092f0: 6820 2861 2061 7320 6229 3a20 7061 7373  h (a as b): pass
-00009300: 222c 207b 4665 6174 7572 652e 5041 5245  ", {Feature.PARE
-00009310: 4e54 4845 5349 5a45 445f 434f 4e54 4558  NTHESIZED_CONTEX
-00009320: 545f 4d41 4e41 4745 5253 7d0a 2020 2020  T_MANAGERS}.    
-00009330: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
-00009340: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
-00009350: 735f 7573 6564 280a 2020 2020 2020 2020  s_used(.        
-00009360: 2020 2020 2277 6974 6820 2828 6120 6173      "with ((a as
-00009370: 2062 2929 3a20 7061 7373 222c 207b 4665   b)): pass", {Fe
-00009380: 6174 7572 652e 5041 5245 4e54 4845 5349  ature.PARENTHESI
-00009390: 5a45 445f 434f 4e54 4558 545f 4d41 4e41  ZED_CONTEXT_MANA
-000093a0: 4745 5253 7d0a 2020 2020 2020 2020 290a  GERS}.        ).
-000093b0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-000093c0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
-000093d0: 280a 2020 2020 2020 2020 2020 2020 2277  (.            "w
-000093e0: 6974 6820 2861 2c20 6220 6173 2063 293a  ith (a, b as c):
-000093f0: 2070 6173 7322 2c20 7b46 6561 7475 7265   pass", {Feature
-00009400: 2e50 4152 454e 5448 4553 495a 4544 5f43  .PARENTHESIZED_C
-00009410: 4f4e 5445 5854 5f4d 414e 4147 4552 537d  ONTEXT_MANAGERS}
-00009420: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00009430: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
-00009440: 6174 7572 6573 5f75 7365 6428 0a20 2020  atures_used(.   
-00009450: 2020 2020 2020 2020 2022 7769 7468 2028           "with (
-00009460: 612c 2028 6220 6173 2063 2929 3a20 7061  a, (b as c)): pa
-00009470: 7373 222c 207b 4665 6174 7572 652e 5041  ss", {Feature.PA
-00009480: 5245 4e54 4845 5349 5a45 445f 434f 4e54  RENTHESIZED_CONT
-00009490: 4558 545f 4d41 4e41 4745 5253 7d0a 2020  EXT_MANAGERS}.  
-000094a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000094b0: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
-000094c0: 7265 735f 7573 6564 280a 2020 2020 2020  res_used(.      
-000094d0: 2020 2020 2020 2277 6974 6820 2828 612c        "with ((a,
-000094e0: 2028 2862 2061 7320 6329 2929 293a 2070   ((b as c)))): p
-000094f0: 6173 7322 2c20 7b46 6561 7475 7265 2e50  ass", {Feature.P
-00009500: 4152 454e 5448 4553 495a 4544 5f43 4f4e  ARENTHESIZED_CON
-00009510: 5445 5854 5f4d 414e 4147 4552 537d 0a20  TEXT_MANAGERS}. 
-00009520: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00009530: 6620 6368 6563 6b5f 6665 6174 7572 6573  f check_features
-00009540: 5f75 7365 6428 7365 6c66 2c20 736f 7572  _used(self, sour
-00009550: 6365 3a20 7374 722c 2065 7870 6563 7465  ce: str, expecte
-00009560: 643a 2053 6574 5b46 6561 7475 7265 5d29  d: Set[Feature])
-00009570: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00009580: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
-00009590: 6962 3274 6f33 5f70 6172 7365 2873 6f75  ib2to3_parse(sou
-000095a0: 7263 6529 0a20 2020 2020 2020 2061 6374  rce).        act
-000095b0: 7561 6c20 3d20 626c 6163 6b2e 6765 745f  ual = black.get_
-000095c0: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
-000095d0: 6465 290a 2020 2020 2020 2020 6d73 6720  de).        msg 
-000095e0: 3d20 6622 4578 7065 6374 6564 207b 6578  = f"Expected {ex
-000095f0: 7065 6374 6564 7d20 6275 7420 676f 7420  pected} but got 
-00009600: 7b61 6374 7561 6c7d 2066 6f72 207b 736f  {actual} for {so
-00009610: 7572 6365 2172 7d22 0a20 2020 2020 2020  urce!r}".       
-00009620: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00009630: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00009640: 616c 2861 6374 7561 6c2c 2065 7870 6563  al(actual, expec
-00009650: 7465 642c 206d 7367 3d6d 7367 290a 2020  ted, msg=msg).  
-00009660: 2020 2020 2020 6578 6365 7074 2041 7373        except Ass
-00009670: 6572 7469 6f6e 4572 726f 723a 0a20 2020  ertionError:.   
-00009680: 2020 2020 2020 2020 2044 6562 7567 5669           DebugVi
-00009690: 7369 746f 722e 7368 6f77 286e 6f64 6529  sitor.show(node)
-000096a0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000096b0: 7365 0a0a 2020 2020 6465 6620 7465 7374  se..    def test
-000096c0: 5f67 6574 5f66 6561 7475 7265 735f 7573  _get_features_us
-000096d0: 6564 5f66 6f72 5f66 7574 7572 655f 666c  ed_for_future_fl
-000096e0: 6167 7328 7365 6c66 2920 2d3e 204e 6f6e  ags(self) -> Non
-000096f0: 653a 0a20 2020 2020 2020 2066 6f72 2073  e:.        for s
-00009700: 7263 2c20 6665 6174 7572 6573 2069 6e20  rc, features in 
-00009710: 5b0a 2020 2020 2020 2020 2020 2020 2822  [.            ("
-00009720: 6672 6f6d 205f 5f66 7574 7572 655f 5f20  from __future__ 
-00009730: 696d 706f 7274 2061 6e6e 6f74 6174 696f  import annotatio
-00009740: 6e73 222c 207b 4665 6174 7572 652e 4655  ns", {Feature.FU
-00009750: 5455 5245 5f41 4e4e 4f54 4154 494f 4e53  TURE_ANNOTATIONS
-00009760: 7d29 2c0a 2020 2020 2020 2020 2020 2020  }),.            
-00009770: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00009780: 2020 2266 726f 6d20 5f5f 6675 7475 7265    "from __future
-00009790: 5f5f 2069 6d70 6f72 7420 286f 7468 6572  __ import (other
-000097a0: 2c20 616e 6e6f 7461 7469 6f6e 7329 222c  , annotations)",
-000097b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000097c0: 207b 4665 6174 7572 652e 4655 5455 5245   {Feature.FUTURE
-000097d0: 5f41 4e4e 4f54 4154 494f 4e53 7d2c 0a20  _ANNOTATIONS},. 
-000097e0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-000097f0: 2020 2020 2020 2020 2020 2822 6120 3d20            ("a = 
-00009800: 3120 2b20 325c 6e66 726f 6d20 736f 6d65  1 + 2\nfrom some
-00009810: 7468 696e 6720 696d 706f 7274 2061 6e6e  thing import ann
-00009820: 6f74 6174 696f 6e73 222c 2073 6574 2829  otations", set()
-00009830: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-00009840: 2266 726f 6d20 5f5f 6675 7475 7265 5f5f  "from __future__
-00009850: 2069 6d70 6f72 7420 782c 2079 222c 2073   import x, y", s
-00009860: 6574 2829 292c 0a20 2020 2020 2020 205d  et()),.        ]
-00009870: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
-00009880: 7468 2073 656c 662e 7375 6254 6573 7428  th self.subTest(
-00009890: 7372 633d 7372 632c 2066 6561 7475 7265  src=src, feature
-000098a0: 733d 6665 6174 7572 6573 293a 0a20 2020  s=features):.   
-000098b0: 2020 2020 2020 2020 2020 2020 206e 6f64               nod
-000098c0: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
-000098d0: 335f 7061 7273 6528 7372 6329 0a20 2020  3_parse(src).   
-000098e0: 2020 2020 2020 2020 2020 2020 2066 7574               fut
-000098f0: 7572 655f 696d 706f 7274 7320 3d20 626c  ure_imports = bl
-00009900: 6163 6b2e 6765 745f 6675 7475 7265 5f69  ack.get_future_i
-00009910: 6d70 6f72 7473 286e 6f64 6529 0a20 2020  mports(node).   
-00009920: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00009930: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00009940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009950: 2020 2062 6c61 636b 2e67 6574 5f66 6561     black.get_fea
-00009960: 7475 7265 735f 7573 6564 286e 6f64 652c  tures_used(node,
-00009970: 2066 7574 7572 655f 696d 706f 7274 733d   future_imports=
-00009980: 6675 7475 7265 5f69 6d70 6f72 7473 292c  future_imports),
-00009990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000099a0: 2020 2020 2066 6561 7475 7265 732c 0a20       features,. 
-000099b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000099c0: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
-000099d0: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
-000099e0: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
-000099f0: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
-00009a00: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
-00009a10: 7273 6528 225c 6e22 290a 2020 2020 2020  rse("\n").      
-00009a20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00009a30: 616c 2873 6574 2829 2c20 626c 6163 6b2e  al(set(), black.
-00009a40: 6765 745f 6675 7475 7265 5f69 6d70 6f72  get_future_impor
-00009a50: 7473 286e 6f64 6529 290a 2020 2020 2020  ts(node)).      
-00009a60: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
-00009a70: 6962 3274 6f33 5f70 6172 7365 2822 6672  ib2to3_parse("fr
-00009a80: 6f6d 205f 5f66 7574 7572 655f 5f20 696d  om __future__ im
-00009a90: 706f 7274 2062 6c61 636b 5c6e 2229 0a20  port black\n"). 
-00009aa0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00009ab0: 7274 4571 7561 6c28 7b22 626c 6163 6b22  rtEqual({"black"
-00009ac0: 7d2c 2062 6c61 636b 2e67 6574 5f66 7574  }, black.get_fut
-00009ad0: 7572 655f 696d 706f 7274 7328 6e6f 6465  ure_imports(node
-00009ae0: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
-00009af0: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
-00009b00: 7061 7273 6528 2266 726f 6d20 5f5f 6675  parse("from __fu
-00009b10: 7475 7265 5f5f 2069 6d70 6f72 7420 6d75  ture__ import mu
-00009b20: 6c74 6970 6c65 2c20 696d 706f 7274 735c  ltiple, imports\
-00009b30: 6e22 290a 2020 2020 2020 2020 7365 6c66  n").        self
-00009b40: 2e61 7373 6572 7445 7175 616c 287b 226d  .assertEqual({"m
-00009b50: 756c 7469 706c 6522 2c20 2269 6d70 6f72  ultiple", "impor
-00009b60: 7473 227d 2c20 626c 6163 6b2e 6765 745f  ts"}, black.get_
-00009b70: 6675 7475 7265 5f69 6d70 6f72 7473 286e  future_imports(n
-00009b80: 6f64 6529 290a 2020 2020 2020 2020 6e6f  ode)).        no
-00009b90: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
-00009ba0: 6f33 5f70 6172 7365 2822 6672 6f6d 205f  o3_parse("from _
-00009bb0: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
-00009bc0: 2028 7061 7265 6e74 6865 7369 7a65 642c   (parenthesized,
-00009bd0: 2069 6d70 6f72 7473 295c 6e22 290a 2020   imports)\n").  
-00009be0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009bf0: 7445 7175 616c 287b 2270 6172 656e 7468  tEqual({"parenth
-00009c00: 6573 697a 6564 222c 2022 696d 706f 7274  esized", "import
-00009c10: 7322 7d2c 2062 6c61 636b 2e67 6574 5f66  s"}, black.get_f
-00009c20: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
-00009c30: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
-00009c40: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
-00009c50: 335f 7061 7273 6528 0a20 2020 2020 2020  3_parse(.       
-00009c60: 2020 2020 2022 6672 6f6d 205f 5f66 7574       "from __fut
-00009c70: 7572 655f 5f20 696d 706f 7274 206d 756c  ure__ import mul
-00009c80: 7469 706c 655c 6e66 726f 6d20 5f5f 6675  tiple\nfrom __fu
-00009c90: 7475 7265 5f5f 2069 6d70 6f72 7420 696d  ture__ import im
-00009ca0: 706f 7274 735c 6e22 0a20 2020 2020 2020  ports\n".       
-00009cb0: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-00009cc0: 6173 7365 7274 4571 7561 6c28 7b22 6d75  assertEqual({"mu
-00009cd0: 6c74 6970 6c65 222c 2022 696d 706f 7274  ltiple", "import
-00009ce0: 7322 7d2c 2062 6c61 636b 2e67 6574 5f66  s"}, black.get_f
-00009cf0: 7574 7572 655f 696d 706f 7274 7328 6e6f  uture_imports(no
-00009d00: 6465 2929 0a20 2020 2020 2020 206e 6f64  de)).        nod
-00009d10: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
-00009d20: 335f 7061 7273 6528 2223 2063 6f6d 6d65  3_parse("# comme
-00009d30: 6e74 5c6e 6672 6f6d 205f 5f66 7574 7572  nt\nfrom __futur
-00009d40: 655f 5f20 696d 706f 7274 2062 6c61 636b  e__ import black
-00009d50: 5c6e 2229 0a20 2020 2020 2020 2073 656c  \n").        sel
-00009d60: 662e 6173 7365 7274 4571 7561 6c28 7b22  f.assertEqual({"
-00009d70: 626c 6163 6b22 7d2c 2062 6c61 636b 2e67  black"}, black.g
-00009d80: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
-00009d90: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
-00009da0: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-00009db0: 6232 746f 335f 7061 7273 6528 2722 2222  b2to3_parse('"""
-00009dc0: 646f 6373 7472 696e 6722 2222 5c6e 6672  docstring"""\nfr
-00009dd0: 6f6d 205f 5f66 7574 7572 655f 5f20 696d  om __future__ im
-00009de0: 706f 7274 2062 6c61 636b 5c6e 2729 0a20  port black\n'). 
-00009df0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00009e00: 7274 4571 7561 6c28 7b22 626c 6163 6b22  rtEqual({"black"
-00009e10: 7d2c 2062 6c61 636b 2e67 6574 5f66 7574  }, black.get_fut
-00009e20: 7572 655f 696d 706f 7274 7328 6e6f 6465  ure_imports(node
-00009e30: 2929 0a20 2020 2020 2020 206e 6f64 6520  )).        node 
-00009e40: 3d20 626c 6163 6b2e 6c69 6232 746f 335f  = black.lib2to3_
-00009e50: 7061 7273 6528 2273 6f6d 6528 6f74 6865  parse("some(othe
-00009e60: 722c 2063 6f64 6529 5c6e 6672 6f6d 205f  r, code)\nfrom _
-00009e70: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
-00009e80: 2062 6c61 636b 5c6e 2229 0a20 2020 2020   black\n").     
-00009e90: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00009ea0: 7561 6c28 7365 7428 292c 2062 6c61 636b  ual(set(), black
-00009eb0: 2e67 6574 5f66 7574 7572 655f 696d 706f  .get_future_impo
-00009ec0: 7274 7328 6e6f 6465 2929 0a20 2020 2020  rts(node)).     
-00009ed0: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
-00009ee0: 6c69 6232 746f 335f 7061 7273 6528 2266  lib2to3_parse("f
-00009ef0: 726f 6d20 736f 6d65 2e6d 6f64 756c 6520  rom some.module 
-00009f00: 696d 706f 7274 2062 6c61 636b 5c6e 2229  import black\n")
-00009f10: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00009f20: 7365 7274 4571 7561 6c28 7365 7428 292c  sertEqual(set(),
-00009f30: 2062 6c61 636b 2e67 6574 5f66 7574 7572   black.get_futur
-00009f40: 655f 696d 706f 7274 7328 6e6f 6465 2929  e_imports(node))
-00009f50: 0a20 2020 2020 2020 206e 6f64 6520 3d20  .        node = 
-00009f60: 626c 6163 6b2e 6c69 6232 746f 335f 7061  black.lib2to3_pa
-00009f70: 7273 6528 0a20 2020 2020 2020 2020 2020  rse(.           
-00009f80: 2022 6672 6f6d 205f 5f66 7574 7572 655f   "from __future_
-00009f90: 5f20 696d 706f 7274 2075 6e69 636f 6465  _ import unicode
-00009fa0: 5f6c 6974 6572 616c 7320 6173 205f 756e  _literals as _un
-00009fb0: 6963 6f64 655f 6c69 7465 7261 6c73 220a  icode_literals".
-00009fc0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00009fd0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00009fe0: 616c 287b 2275 6e69 636f 6465 5f6c 6974  al({"unicode_lit
-00009ff0: 6572 616c 7322 7d2c 2062 6c61 636b 2e67  erals"}, black.g
-0000a000: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
-0000a010: 7328 6e6f 6465 2929 0a20 2020 2020 2020  s(node)).       
-0000a020: 206e 6f64 6520 3d20 626c 6163 6b2e 6c69   node = black.li
-0000a030: 6232 746f 335f 7061 7273 6528 0a20 2020  b2to3_parse(.   
-0000a040: 2020 2020 2020 2020 2022 6672 6f6d 205f           "from _
-0000a050: 5f66 7574 7572 655f 5f20 696d 706f 7274  _future__ import
-0000a060: 2075 6e69 636f 6465 5f6c 6974 6572 616c   unicode_literal
-0000a070: 7320 6173 205f 6c6f 6c2c 2070 7269 6e74  s as _lol, print
-0000a080: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
-0000a090: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000a0a0: 7175 616c 287b 2275 6e69 636f 6465 5f6c  qual({"unicode_l
-0000a0b0: 6974 6572 616c 7322 2c20 2270 7269 6e74  iterals", "print
-0000a0c0: 227d 2c20 626c 6163 6b2e 6765 745f 6675  "}, black.get_fu
-0000a0d0: 7475 7265 5f69 6d70 6f72 7473 286e 6f64  ture_imports(nod
-0000a0e0: 6529 290a 0a20 2020 2040 7079 7465 7374  e))..    @pytest
-0000a0f0: 2e6d 6172 6b2e 696e 636f 6d70 6174 6962  .mark.incompatib
-0000a100: 6c65 5f77 6974 685f 6d79 7079 630a 2020  le_with_mypyc.  
-0000a110: 2020 6465 6620 7465 7374 5f64 6562 7567    def test_debug
-0000a120: 5f76 6973 6974 6f72 2873 656c 6629 202d  _visitor(self) -
-0000a130: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000a140: 736f 7572 6365 2c20 5f20 3d20 7265 6164  source, _ = read
-0000a150: 5f64 6174 6128 226d 6973 6365 6c6c 616e  _data("miscellan
-0000a160: 656f 7573 222c 2022 6465 6275 675f 7669  eous", "debug_vi
-0000a170: 7369 746f 7222 290a 2020 2020 2020 2020  sitor").        
-0000a180: 6578 7065 6374 6564 2c20 5f20 3d20 7265  expected, _ = re
-0000a190: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
-0000a1a0: 616e 656f 7573 222c 2022 6465 6275 675f  aneous", "debug_
-0000a1b0: 7669 7369 746f 722e 6f75 7422 290a 2020  visitor.out").  
-0000a1c0: 2020 2020 2020 6f75 745f 6c69 6e65 7320        out_lines 
-0000a1d0: 3d20 5b5d 0a20 2020 2020 2020 2065 7272  = [].        err
-0000a1e0: 5f6c 696e 6573 203d 205b 5d0a 0a20 2020  _lines = []..   
-0000a1f0: 2020 2020 2064 6566 206f 7574 286d 7367       def out(msg
-0000a200: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
-0000a210: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
-0000a220: 2020 2020 2020 2020 2020 206f 7574 5f6c             out_l
-0000a230: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
-0000a240: 0a0a 2020 2020 2020 2020 6465 6620 6572  ..        def er
-0000a250: 7228 6d73 673a 2073 7472 2c20 2a2a 6b77  r(msg: str, **kw
-0000a260: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
-0000a270: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000a280: 6572 725f 6c69 6e65 732e 6170 7065 6e64  err_lines.append
-0000a290: 286d 7367 290a 0a20 2020 2020 2020 2077  (msg)..        w
-0000a2a0: 6974 6820 7061 7463 6828 2262 6c61 636b  ith patch("black
-0000a2b0: 2e64 6562 7567 2e6f 7574 222c 206f 7574  .debug.out", out
-0000a2c0: 293a 0a20 2020 2020 2020 2020 2020 2044  ):.            D
-0000a2d0: 6562 7567 5669 7369 746f 722e 7368 6f77  ebugVisitor.show
-0000a2e0: 2873 6f75 7263 6529 0a20 2020 2020 2020  (source).       
-0000a2f0: 2061 6374 7561 6c20 3d20 225c 6e22 2e6a   actual = "\n".j
-0000a300: 6f69 6e28 6f75 745f 6c69 6e65 7329 202b  oin(out_lines) +
-0000a310: 2022 5c6e 220a 2020 2020 2020 2020 6c6f   "\n".        lo
-0000a320: 675f 6e61 6d65 203d 2022 220a 2020 2020  g_name = "".    
-0000a330: 2020 2020 6966 2065 7870 6563 7465 6420      if expected 
-0000a340: 213d 2061 6374 7561 6c3a 0a20 2020 2020  != actual:.     
-0000a350: 2020 2020 2020 206c 6f67 5f6e 616d 6520         log_name 
-0000a360: 3d20 626c 6163 6b2e 6475 6d70 5f74 6f5f  = black.dump_to_
-0000a370: 6669 6c65 282a 6f75 745f 6c69 6e65 7329  file(*out_lines)
-0000a380: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000a390: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-0000a3a0: 2020 2020 2020 2065 7870 6563 7465 642c         expected,
-0000a3b0: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
-0000a3c0: 7561 6c2c 0a20 2020 2020 2020 2020 2020  ual,.           
-0000a3d0: 2066 2241 5354 2070 7269 6e74 206f 7574   f"AST print out
-0000a3e0: 2069 7320 6469 6666 6572 656e 742e 2041   is different. A
-0000a3f0: 6374 7561 6c20 7665 7273 696f 6e20 6475  ctual version du
-0000a400: 6d70 6564 2074 6f20 7b6c 6f67 5f6e 616d  mped to {log_nam
-0000a410: 657d 222c 0a20 2020 2020 2020 2029 0a0a  e}",.        )..
-0000a420: 2020 2020 6465 6620 7465 7374 5f66 6f72      def test_for
-0000a430: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
-0000a440: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
-0000a450: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
-0000a460: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
-0000a470: 2020 2020 2065 6d70 7479 203d 2022 220a       empty = "".
-0000a480: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-0000a490: 662e 6173 7365 7274 5261 6973 6573 2862  f.assertRaises(b
-0000a4a0: 6c61 636b 2e4e 6f74 6869 6e67 4368 616e  lack.NothingChan
-0000a4b0: 6765 6429 3a0a 2020 2020 2020 2020 2020  ged):.          
-0000a4c0: 2020 626c 6163 6b2e 666f 726d 6174 5f66    black.format_f
-0000a4d0: 696c 655f 636f 6e74 656e 7473 2865 6d70  ile_contents(emp
-0000a4e0: 7479 2c20 6d6f 6465 3d6d 6f64 652c 2066  ty, mode=mode, f
-0000a4f0: 6173 743d 4661 6c73 6529 0a20 2020 2020  ast=False).     
-0000a500: 2020 206a 7573 745f 6e6c 203d 2022 5c6e     just_nl = "\n
-0000a510: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
-0000a520: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-0000a530: 2862 6c61 636b 2e4e 6f74 6869 6e67 4368  (black.NothingCh
-0000a540: 616e 6765 6429 3a0a 2020 2020 2020 2020  anged):.        
-0000a550: 2020 2020 626c 6163 6b2e 666f 726d 6174      black.format
-0000a560: 5f66 696c 655f 636f 6e74 656e 7473 286a  _file_contents(j
-0000a570: 7573 745f 6e6c 2c20 6d6f 6465 3d6d 6f64  ust_nl, mode=mod
-0000a580: 652c 2066 6173 743d 4661 6c73 6529 0a20  e, fast=False). 
-0000a590: 2020 2020 2020 2073 616d 6520 3d20 226a         same = "j
-0000a5a0: 203d 205b 312c 2032 2c20 335d 5c6e 220a   = [1, 2, 3]\n".
-0000a5b0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-0000a5c0: 662e 6173 7365 7274 5261 6973 6573 2862  f.assertRaises(b
-0000a5d0: 6c61 636b 2e4e 6f74 6869 6e67 4368 616e  lack.NothingChan
-0000a5e0: 6765 6429 3a0a 2020 2020 2020 2020 2020  ged):.          
-0000a5f0: 2020 626c 6163 6b2e 666f 726d 6174 5f66    black.format_f
-0000a600: 696c 655f 636f 6e74 656e 7473 2873 616d  ile_contents(sam
-0000a610: 652c 206d 6f64 653d 6d6f 6465 2c20 6661  e, mode=mode, fa
-0000a620: 7374 3d46 616c 7365 290a 2020 2020 2020  st=False).      
-0000a630: 2020 6469 6666 6572 656e 7420 3d20 226a    different = "j
-0000a640: 203d 205b 312c 322c 335d 220a 2020 2020   = [1,2,3]".    
-0000a650: 2020 2020 6578 7065 6374 6564 203d 2073      expected = s
-0000a660: 616d 650a 2020 2020 2020 2020 6163 7475  ame.        actu
-0000a670: 616c 203d 2062 6c61 636b 2e66 6f72 6d61  al = black.forma
-0000a680: 745f 6669 6c65 5f63 6f6e 7465 6e74 7328  t_file_contents(
-0000a690: 6469 6666 6572 656e 742c 206d 6f64 653d  different, mode=
-0000a6a0: 6d6f 6465 2c20 6661 7374 3d46 616c 7365  mode, fast=False
-0000a6b0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000a6c0: 7373 6572 7445 7175 616c 2865 7870 6563  ssertEqual(expec
-0000a6d0: 7465 642c 2061 6374 7561 6c29 0a20 2020  ted, actual).   
-0000a6e0: 2020 2020 2069 6e76 616c 6964 203d 2022       invalid = "
-0000a6f0: 7265 7475 726e 2069 6620 796f 7520 6361  return if you ca
-0000a700: 6e22 0a20 2020 2020 2020 2077 6974 6820  n".        with 
-0000a710: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
-0000a720: 7328 626c 6163 6b2e 496e 7661 6c69 6449  s(black.InvalidI
-0000a730: 6e70 7574 2920 6173 2065 3a0a 2020 2020  nput) as e:.    
-0000a740: 2020 2020 2020 2020 626c 6163 6b2e 666f          black.fo
-0000a750: 726d 6174 5f66 696c 655f 636f 6e74 656e  rmat_file_conten
-0000a760: 7473 2869 6e76 616c 6964 2c20 6d6f 6465  ts(invalid, mode
-0000a770: 3d6d 6f64 652c 2066 6173 743d 4661 6c73  =mode, fast=Fals
-0000a780: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-0000a790: 6173 7365 7274 4571 7561 6c28 7374 7228  assertEqual(str(
-0000a7a0: 652e 6578 6365 7074 696f 6e29 2c20 2243  e.exception), "C
-0000a7b0: 616e 6e6f 7420 7061 7273 653a 2031 3a37  annot parse: 1:7
-0000a7c0: 3a20 7265 7475 726e 2069 6620 796f 7520  : return if you 
-0000a7d0: 6361 6e22 290a 0a20 2020 2020 2020 206a  can")..        j
-0000a7e0: 7573 745f 6372 6c66 203d 2022 5c72 5c6e  ust_crlf = "\r\n
-0000a7f0: 220a 2020 2020 2020 2020 7769 7468 2073  ".        with s
-0000a800: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-0000a810: 2862 6c61 636b 2e4e 6f74 6869 6e67 4368  (black.NothingCh
-0000a820: 616e 6765 6429 3a0a 2020 2020 2020 2020  anged):.        
-0000a830: 2020 2020 626c 6163 6b2e 666f 726d 6174      black.format
-0000a840: 5f66 696c 655f 636f 6e74 656e 7473 286a  _file_contents(j
-0000a850: 7573 745f 6372 6c66 2c20 6d6f 6465 3d6d  ust_crlf, mode=m
-0000a860: 6f64 652c 2066 6173 743d 4661 6c73 6529  ode, fast=False)
-0000a870: 0a20 2020 2020 2020 206a 7573 745f 7768  .        just_wh
-0000a880: 6974 6573 7061 6365 5f6e 6c20 3d20 225c  itespace_nl = "\
-0000a890: 6e5c 745c 6e20 5c6e 5c74 205c 6e20 5c74  n\t\n \n\t \n \t
-0000a8a0: 5c6e 5c6e 220a 2020 2020 2020 2020 6163  \n\n".        ac
-0000a8b0: 7475 616c 203d 2062 6c61 636b 2e66 6f72  tual = black.for
-0000a8c0: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
-0000a8d0: 7328 6a75 7374 5f77 6869 7465 7370 6163  s(just_whitespac
-0000a8e0: 655f 6e6c 2c20 6d6f 6465 3d6d 6f64 652c  e_nl, mode=mode,
-0000a8f0: 2066 6173 743d 4661 6c73 6529 0a20 2020   fast=False).   
-0000a900: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000a910: 4571 7561 6c28 225c 6e22 2c20 6163 7475  Equal("\n", actu
-0000a920: 616c 290a 2020 2020 2020 2020 6a75 7374  al).        just
-0000a930: 5f77 6869 7465 7370 6163 655f 6372 6c66  _whitespace_crlf
-0000a940: 203d 2022 5c72 5c6e 5c74 5c72 5c6e 205c   = "\r\n\t\r\n \
-0000a950: 725c 6e5c 7420 5c72 5c6e 205c 745c 725c  r\n\t \r\n \t\r\
-0000a960: 6e5c 725c 6e22 0a20 2020 2020 2020 2061  n\r\n".        a
-0000a970: 6374 7561 6c20 3d20 626c 6163 6b2e 666f  ctual = black.fo
-0000a980: 726d 6174 5f66 696c 655f 636f 6e74 656e  rmat_file_conten
-0000a990: 7473 286a 7573 745f 7768 6974 6573 7061  ts(just_whitespa
-0000a9a0: 6365 5f63 726c 662c 206d 6f64 653d 6d6f  ce_crlf, mode=mo
-0000a9b0: 6465 2c20 6661 7374 3d46 616c 7365 290a  de, fast=False).
-0000a9c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000a9d0: 6572 7445 7175 616c 2822 5c72 5c6e 222c  ertEqual("\r\n",
-0000a9e0: 2061 6374 7561 6c29 0a0a 2020 2020 6465   actual)..    de
-0000a9f0: 6620 7465 7374 5f65 6e64 6d61 726b 6572  f test_endmarker
-0000aa00: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000aa10: 2020 2020 2020 2020 6e20 3d20 626c 6163          n = blac
-0000aa20: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
-0000aa30: 225c 6e22 290a 2020 2020 2020 2020 7365  "\n").        se
-0000aa40: 6c66 2e61 7373 6572 7445 7175 616c 286e  lf.assertEqual(n
-0000aa50: 2e74 7970 652c 2062 6c61 636b 2e73 796d  .type, black.sym
-0000aa60: 732e 6669 6c65 5f69 6e70 7574 290a 2020  s.file_input).  
-0000aa70: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000aa80: 7445 7175 616c 286c 656e 286e 2e63 6869  tEqual(len(n.chi
-0000aa90: 6c64 7265 6e29 2c20 3129 0a20 2020 2020  ldren), 1).     
-0000aaa0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000aab0: 7561 6c28 6e2e 6368 696c 6472 656e 5b30  ual(n.children[0
-0000aac0: 5d2e 7479 7065 2c20 626c 6163 6b2e 746f  ].type, black.to
-0000aad0: 6b65 6e2e 454e 444d 4152 4b45 5229 0a0a  ken.ENDMARKER)..
-0000aae0: 2020 2020 4070 6174 6368 2822 7465 7374      @patch("test
-0000aaf0: 732e 636f 6e66 7465 7374 2e50 5249 4e54  s.conftest.PRINT
-0000ab00: 5f46 554c 4c5f 5452 4545 222c 2054 7275  _FULL_TREE", Tru
-0000ab10: 6529 0a20 2020 2040 7061 7463 6828 2274  e).    @patch("t
-0000ab20: 6573 7473 2e63 6f6e 6674 6573 742e 5052  ests.conftest.PR
-0000ab30: 494e 545f 5452 4545 5f44 4946 4622 2c20  INT_TREE_DIFF", 
-0000ab40: 4661 6c73 6529 0a20 2020 2040 7079 7465  False).    @pyte
-0000ab50: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
-0000ab60: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
-0000ab70: 2020 2020 6465 6620 7465 7374 5f61 7373      def test_ass
-0000ab80: 6572 7446 6f72 6d61 7445 7175 616c 5f70  ertFormatEqual_p
-0000ab90: 7269 6e74 5f66 756c 6c5f 7472 6565 2873  rint_full_tree(s
-0000aba0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000abb0: 2020 2020 2020 6f75 745f 6c69 6e65 7320        out_lines 
-0000abc0: 3d20 5b5d 0a20 2020 2020 2020 2065 7272  = [].        err
-0000abd0: 5f6c 696e 6573 203d 205b 5d0a 0a20 2020  _lines = []..   
-0000abe0: 2020 2020 2064 6566 206f 7574 286d 7367       def out(msg
-0000abf0: 3a20 7374 722c 202a 2a6b 7761 7267 733a  : str, **kwargs:
-0000ac00: 2041 6e79 2920 2d3e 204e 6f6e 653a 0a20   Any) -> None:. 
-0000ac10: 2020 2020 2020 2020 2020 206f 7574 5f6c             out_l
-0000ac20: 696e 6573 2e61 7070 656e 6428 6d73 6729  ines.append(msg)
-0000ac30: 0a0a 2020 2020 2020 2020 6465 6620 6572  ..        def er
-0000ac40: 7228 6d73 673a 2073 7472 2c20 2a2a 6b77  r(msg: str, **kw
-0000ac50: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
-0000ac60: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000ac70: 6572 725f 6c69 6e65 732e 6170 7065 6e64  err_lines.append
-0000ac80: 286d 7367 290a 0a20 2020 2020 2020 2077  (msg)..        w
-0000ac90: 6974 6820 7061 7463 6828 2262 6c61 636b  ith patch("black
-0000aca0: 2e6f 7574 7075 742e 5f6f 7574 222c 206f  .output._out", o
-0000acb0: 7574 292c 2070 6174 6368 2822 626c 6163  ut), patch("blac
-0000acc0: 6b2e 6f75 7470 7574 2e5f 6572 7222 2c20  k.output._err", 
-0000acd0: 6572 7229 3a0a 2020 2020 2020 2020 2020  err):.          
-0000ace0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0000acf0: 7274 5261 6973 6573 2841 7373 6572 7469  rtRaises(Asserti
-0000ad00: 6f6e 4572 726f 7229 3a0a 2020 2020 2020  onError):.      
-0000ad10: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000ad20: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
-0000ad30: 2822 6a20 3d20 5b31 2c20 322c 2033 5d22  ("j = [1, 2, 3]"
-0000ad40: 2c20 226a 203d 205b 312c 2032 2c20 332c  , "j = [1, 2, 3,
-0000ad50: 5d22 290a 0a20 2020 2020 2020 206f 7574  ]")..        out
-0000ad60: 5f73 7472 203d 2022 222e 6a6f 696e 286f  _str = "".join(o
-0000ad70: 7574 5f6c 696e 6573 290a 2020 2020 2020  ut_lines).      
-0000ad80: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-0000ad90: 2245 7870 6563 7465 6420 7472 6565 3a22  "Expected tree:"
-0000ada0: 2c20 6f75 745f 7374 7229 0a20 2020 2020  , out_str).     
-0000adb0: 2020 2073 656c 662e 6173 7365 7274 496e     self.assertIn
-0000adc0: 2822 4163 7475 616c 2074 7265 653a 222c  ("Actual tree:",
-0000add0: 206f 7574 5f73 7472 290a 2020 2020 2020   out_str).      
-0000ade0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000adf0: 616c 2822 222e 6a6f 696e 2865 7272 5f6c  al("".join(err_l
-0000ae00: 696e 6573 292c 2022 2229 0a0a 2020 2020  ines), "")..    
-0000ae10: 4070 6174 6368 2822 7465 7374 732e 636f  @patch("tests.co
-0000ae20: 6e66 7465 7374 2e50 5249 4e54 5f46 554c  nftest.PRINT_FUL
-0000ae30: 4c5f 5452 4545 222c 2046 616c 7365 290a  L_TREE", False).
-0000ae40: 2020 2020 4070 6174 6368 2822 7465 7374      @patch("test
-0000ae50: 732e 636f 6e66 7465 7374 2e50 5249 4e54  s.conftest.PRINT
-0000ae60: 5f54 5245 455f 4449 4646 222c 2054 7275  _TREE_DIFF", Tru
-0000ae70: 6529 0a20 2020 2040 7079 7465 7374 2e6d  e).    @pytest.m
-0000ae80: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
-0000ae90: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
-0000aea0: 6465 6620 7465 7374 5f61 7373 6572 7446  def test_assertF
-0000aeb0: 6f72 6d61 7445 7175 616c 5f70 7269 6e74  ormatEqual_print
-0000aec0: 5f74 7265 655f 6469 6666 2873 656c 6629  _tree_diff(self)
-0000aed0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000aee0: 2020 6f75 745f 6c69 6e65 7320 3d20 5b5d    out_lines = []
-0000aef0: 0a20 2020 2020 2020 2065 7272 5f6c 696e  .        err_lin
-0000af00: 6573 203d 205b 5d0a 0a20 2020 2020 2020  es = []..       
-0000af10: 2064 6566 206f 7574 286d 7367 3a20 7374   def out(msg: st
-0000af20: 722c 202a 2a6b 7761 7267 733a 2041 6e79  r, **kwargs: Any
-0000af30: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000af40: 2020 2020 2020 206f 7574 5f6c 696e 6573         out_lines
-0000af50: 2e61 7070 656e 6428 6d73 6729 0a0a 2020  .append(msg)..  
-0000af60: 2020 2020 2020 6465 6620 6572 7228 6d73        def err(ms
-0000af70: 673a 2073 7472 2c20 2a2a 6b77 6172 6773  g: str, **kwargs
-0000af80: 3a20 416e 7929 202d 3e20 4e6f 6e65 3a0a  : Any) -> None:.
-0000af90: 2020 2020 2020 2020 2020 2020 6572 725f              err_
-0000afa0: 6c69 6e65 732e 6170 7065 6e64 286d 7367  lines.append(msg
-0000afb0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-0000afc0: 7061 7463 6828 2262 6c61 636b 2e6f 7574  patch("black.out
-0000afd0: 7075 742e 5f6f 7574 222c 206f 7574 292c  put._out", out),
-0000afe0: 2070 6174 6368 2822 626c 6163 6b2e 6f75   patch("black.ou
-0000aff0: 7470 7574 2e5f 6572 7222 2c20 6572 7229  tput._err", err)
-0000b000: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
-0000b010: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-0000b020: 6973 6573 2841 7373 6572 7469 6f6e 4572  ises(AssertionEr
-0000b030: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-0000b040: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000b050: 7446 6f72 6d61 7445 7175 616c 2822 6a20  tFormatEqual("j 
-0000b060: 3d20 5b31 2c20 322c 2033 5d5c 6e22 2c20  = [1, 2, 3]\n", 
-0000b070: 226a 203d 205b 312c 2032 2c20 332c 5d5c  "j = [1, 2, 3,]\
-0000b080: 6e22 290a 0a20 2020 2020 2020 206f 7574  n")..        out
-0000b090: 5f73 7472 203d 2022 222e 6a6f 696e 286f  _str = "".join(o
-0000b0a0: 7574 5f6c 696e 6573 290a 2020 2020 2020  ut_lines).      
-0000b0b0: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-0000b0c0: 2254 7265 6520 4469 6666 3a22 2c20 6f75  "Tree Diff:", ou
-0000b0d0: 745f 7374 7229 0a20 2020 2020 2020 2073  t_str).        s
-0000b0e0: 656c 662e 6173 7365 7274 496e 2822 2b20  elf.assertIn("+ 
-0000b0f0: 2020 2020 2020 2020 2043 4f4d 4d41 222c           COMMA",
-0000b100: 206f 7574 5f73 7472 290a 2020 2020 2020   out_str).      
-0000b110: 2020 7365 6c66 2e61 7373 6572 7449 6e28    self.assertIn(
-0000b120: 222b 2027 2c27 222c 206f 7574 5f73 7472  "+ ','", out_str
-0000b130: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000b140: 7373 6572 7445 7175 616c 2822 222e 6a6f  ssertEqual("".jo
-0000b150: 696e 2865 7272 5f6c 696e 6573 292c 2022  in(err_lines), "
-0000b160: 2229 0a0a 2020 2020 4065 7665 6e74 5f6c  ")..    @event_l
-0000b170: 6f6f 7028 290a 2020 2020 4070 6174 6368  oop().    @patch
-0000b180: 2822 636f 6e63 7572 7265 6e74 2e66 7574  ("concurrent.fut
-0000b190: 7572 6573 2e50 726f 6365 7373 506f 6f6c  ures.ProcessPool
-0000b1a0: 4578 6563 7574 6f72 222c 204d 6167 6963  Executor", Magic
-0000b1b0: 4d6f 636b 2873 6964 655f 6566 6665 6374  Mock(side_effect
-0000b1c0: 3d4f 5345 7272 6f72 2929 0a20 2020 2064  =OSError)).    d
-0000b1d0: 6566 2074 6573 745f 776f 726b 735f 696e  ef test_works_in
-0000b1e0: 5f6d 6f6e 6f5f 7072 6f63 6573 735f 6f6e  _mono_process_on
-0000b1f0: 6c79 5f65 6e76 6972 6f6e 6d65 6e74 2873  ly_environment(s
-0000b200: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000b210: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
-0000b220: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
-0000b230: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
-0000b240: 2066 6f72 2066 2069 6e20 5b0a 2020 2020   for f in [.    
-0000b250: 2020 2020 2020 2020 2020 2020 2877 6f72              (wor
-0000b260: 6b73 7061 6365 202f 2022 6f6e 652e 7079  kspace / "one.py
-0000b270: 2229 2e72 6573 6f6c 7665 2829 2c0a 2020  ").resolve(),.  
-0000b280: 2020 2020 2020 2020 2020 2020 2020 2877                (w
-0000b290: 6f72 6b73 7061 6365 202f 2022 7477 6f2e  orkspace / "two.
-0000b2a0: 7079 2229 2e72 6573 6f6c 7665 2829 2c0a  py").resolve(),.
-0000b2b0: 2020 2020 2020 2020 2020 2020 5d3a 0a20              ]:. 
-0000b2c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000b2d0: 2e77 7269 7465 5f74 6578 7428 2770 7269  .write_text('pri
-0000b2e0: 6e74 2822 6865 6c6c 6f22 295c 6e27 2c20  nt("hello")\n', 
-0000b2f0: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
-0000b300: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000b310: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
-0000b320: 7374 7228 776f 726b 7370 6163 6529 5d29  str(workspace)])
-0000b330: 0a0a 2020 2020 4065 7665 6e74 5f6c 6f6f  ..    @event_loo
-0000b340: 7028 290a 2020 2020 6465 6620 7465 7374  p().    def test
-0000b350: 5f63 6865 636b 5f64 6966 665f 7573 655f  _check_diff_use_
-0000b360: 746f 6765 7468 6572 2873 656c 6629 202d  together(self) -
-0000b370: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000b380: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
-0000b390: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0000b3a0: 4669 6c65 7320 7768 6963 6820 7769 6c6c  Files which will
-0000b3b0: 2062 6520 7265 666f 726d 6174 7465 642e   be reformatted.
-0000b3c0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
-0000b3d0: 3120 3d20 6765 745f 6361 7365 5f70 6174  1 = get_case_pat
-0000b3e0: 6828 226d 6973 6365 6c6c 616e 656f 7573  h("miscellaneous
-0000b3f0: 222c 2022 7374 7269 6e67 5f71 756f 7465  ", "string_quote
-0000b400: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
-0000b410: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
-0000b420: 285b 7374 7228 7372 6331 292c 2022 2d2d  ([str(src1), "--
-0000b430: 6469 6666 222c 2022 2d2d 6368 6563 6b22  diff", "--check"
-0000b440: 5d2c 2065 7869 745f 636f 6465 3d31 290a  ], exit_code=1).
-0000b450: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
-0000b460: 6c65 7320 7768 6963 6820 7769 6c6c 206e  les which will n
-0000b470: 6f74 2062 6520 7265 666f 726d 6174 7465  ot be reformatte
-0000b480: 642e 0a20 2020 2020 2020 2020 2020 2073  d..            s
-0000b490: 7263 3220 3d20 6765 745f 6361 7365 5f70  rc2 = get_case_p
-0000b4a0: 6174 6828 2263 6173 6573 222c 2022 636f  ath("cases", "co
-0000b4b0: 6d70 6f73 6974 696f 6e22 290a 2020 2020  mposition").    
-0000b4c0: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000b4d0: 6f6b 6542 6c61 636b 285b 7374 7228 7372  okeBlack([str(sr
-0000b4e0: 6332 292c 2022 2d2d 6469 6666 222c 2022  c2), "--diff", "
-0000b4f0: 2d2d 6368 6563 6b22 5d29 0a20 2020 2020  --check"]).     
-0000b500: 2020 2020 2020 2023 204d 756c 7469 2066         # Multi f
-0000b510: 696c 6520 636f 6d6d 616e 642e 0a20 2020  ile command..   
-0000b520: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
-0000b530: 766f 6b65 426c 6163 6b28 5b73 7472 2873  vokeBlack([str(s
-0000b540: 7263 3129 2c20 7374 7228 7372 6332 292c  rc1), str(src2),
-0000b550: 2022 2d2d 6469 6666 222c 2022 2d2d 6368   "--diff", "--ch
-0000b560: 6563 6b22 5d2c 2065 7869 745f 636f 6465  eck"], exit_code
-0000b570: 3d31 290a 0a20 2020 2064 6566 2074 6573  =1)..    def tes
-0000b580: 745f 6e6f 5f73 7263 5f66 6169 6c73 2873  t_no_src_fails(s
-0000b590: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000b5a0: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
-0000b5b0: 5f64 6972 2829 3a0a 2020 2020 2020 2020  _dir():.        
-0000b5c0: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
-0000b5d0: 6c61 636b 285b 5d2c 2065 7869 745f 636f  lack([], exit_co
-0000b5e0: 6465 3d31 290a 0a20 2020 2064 6566 2074  de=1)..    def t
-0000b5f0: 6573 745f 7372 635f 616e 645f 636f 6465  est_src_and_code
-0000b600: 5f66 6169 6c73 2873 656c 6629 202d 3e20  _fails(self) -> 
-0000b610: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-0000b620: 7468 2063 6163 6865 5f64 6972 2829 3a0a  th cache_dir():.
-0000b630: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b640: 2e69 6e76 6f6b 6542 6c61 636b 285b 222e  .invokeBlack([".
-0000b650: 222c 2022 2d63 222c 2022 3022 5d2c 2065  ", "-c", "0"], e
-0000b660: 7869 745f 636f 6465 3d31 290a 0a20 2020  xit_code=1)..   
-0000b670: 2064 6566 2074 6573 745f 6272 6f6b 656e   def test_broken
-0000b680: 5f73 796d 6c69 6e6b 2873 656c 6629 202d  _symlink(self) -
-0000b690: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000b6a0: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
-0000b6b0: 2061 7320 776f 726b 7370 6163 653a 0a20   as workspace:. 
-0000b6c0: 2020 2020 2020 2020 2020 2073 796d 6c69             symli
-0000b6d0: 6e6b 203d 2077 6f72 6b73 7061 6365 202f  nk = workspace /
-0000b6e0: 2022 6272 6f6b 656e 5f6c 696e 6b2e 7079   "broken_link.py
-0000b6f0: 220a 2020 2020 2020 2020 2020 2020 7472  ".            tr
-0000b700: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000b710: 2020 2073 796d 6c69 6e6b 2e73 796d 6c69     symlink.symli
-0000b720: 6e6b 5f74 6f28 226e 6f6e 6578 6973 7465  nk_to("nonexiste
-0000b730: 6e74 2e70 7922 290a 2020 2020 2020 2020  nt.py").        
-0000b740: 2020 2020 6578 6365 7074 2028 4f53 4572      except (OSEr
-0000b750: 726f 722c 204e 6f74 496d 706c 656d 656e  ror, NotImplemen
-0000b760: 7465 6445 7272 6f72 2920 6173 2065 3a0a  tedError) as e:.
-0000b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b780: 7365 6c66 2e73 6b69 7054 6573 7428 6622  self.skipTest(f"
-0000b790: 4361 6e27 7420 6372 6561 7465 2073 796d  Can't create sym
-0000b7a0: 6c69 6e6b 733a 207b 657d 2229 0a20 2020  links: {e}").   
-0000b7b0: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
-0000b7c0: 766f 6b65 426c 6163 6b28 5b73 7472 2877  vokeBlack([str(w
-0000b7d0: 6f72 6b73 7061 6365 2e72 6573 6f6c 7665  orkspace.resolve
-0000b7e0: 2829 295d 290a 0a20 2020 2064 6566 2074  ())])..    def t
-0000b7f0: 6573 745f 7369 6e67 6c65 5f66 696c 655f  est_single_file_
-0000b800: 666f 7263 655f 7079 6928 7365 6c66 2920  force_pyi(self) 
-0000b810: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000b820: 2070 7969 5f6d 6f64 6520 3d20 7265 706c   pyi_mode = repl
-0000b830: 6163 6528 4445 4641 554c 545f 4d4f 4445  ace(DEFAULT_MODE
-0000b840: 2c20 6973 5f70 7969 3d54 7275 6529 0a20  , is_pyi=True). 
-0000b850: 2020 2020 2020 2063 6f6e 7465 6e74 732c         contents,
-0000b860: 2065 7870 6563 7465 6420 3d20 7265 6164   expected = read
-0000b870: 5f64 6174 6128 226d 6973 6365 6c6c 616e  _data("miscellan
-0000b880: 656f 7573 222c 2022 666f 7263 655f 7079  eous", "force_py
-0000b890: 6922 290a 2020 2020 2020 2020 7769 7468  i").        with
-0000b8a0: 2063 6163 6865 5f64 6972 2829 2061 7320   cache_dir() as 
-0000b8b0: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
-0000b8c0: 2020 2020 2020 2070 6174 6820 3d20 2877         path = (w
-0000b8d0: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
-0000b8e0: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
-0000b8f0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0000b900: 2e77 7269 7465 5f74 6578 7428 636f 6e74  .write_text(cont
-0000b910: 656e 7473 2c20 656e 636f 6469 6e67 3d22  ents, encoding="
-0000b920: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
-0000b930: 2020 2020 7365 6c66 2e69 6e76 6f6b 6542      self.invokeB
-0000b940: 6c61 636b 285b 7374 7228 7061 7468 292c  lack([str(path),
-0000b950: 2022 2d2d 7079 6922 5d29 0a20 2020 2020   "--pyi"]).     
-0000b960: 2020 2020 2020 2061 6374 7561 6c20 3d20         actual = 
-0000b970: 7061 7468 2e72 6561 645f 7465 7874 2865  path.read_text(e
-0000b980: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
-0000b990: 0a20 2020 2020 2020 2020 2020 2023 2076  .            # v
-0000b9a0: 6572 6966 7920 6361 6368 6520 7769 7468  erify cache with
-0000b9b0: 202d 2d70 7969 2069 7320 7365 7061 7261   --pyi is separa
-0000b9c0: 7465 0a20 2020 2020 2020 2020 2020 2070  te.            p
-0000b9d0: 7969 5f63 6163 6865 203d 2062 6c61 636b  yi_cache = black
-0000b9e0: 2e43 6163 6865 2e72 6561 6428 7079 695f  .Cache.read(pyi_
-0000b9f0: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
-0000ba00: 2020 6173 7365 7274 206e 6f74 2070 7969    assert not pyi
-0000ba10: 5f63 6163 6865 2e69 735f 6368 616e 6765  _cache.is_change
-0000ba20: 6428 7061 7468 290a 2020 2020 2020 2020  d(path).        
-0000ba30: 2020 2020 6e6f 726d 616c 5f63 6163 6865      normal_cache
-0000ba40: 203d 2062 6c61 636b 2e43 6163 6865 2e72   = black.Cache.r
-0000ba50: 6561 6428 4445 4641 554c 545f 4d4f 4445  ead(DEFAULT_MODE
-0000ba60: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-0000ba70: 7365 7274 206e 6f72 6d61 6c5f 6361 6368  sert normal_cach
-0000ba80: 652e 6973 5f63 6861 6e67 6564 2870 6174  e.is_changed(pat
-0000ba90: 6829 0a20 2020 2020 2020 2073 656c 662e  h).        self.
-0000baa0: 6173 7365 7274 466f 726d 6174 4571 7561  assertFormatEqua
-0000bab0: 6c28 6578 7065 6374 6564 2c20 6163 7475  l(expected, actu
-0000bac0: 616c 290a 2020 2020 2020 2020 626c 6163  al).        blac
-0000bad0: 6b2e 6173 7365 7274 5f65 7175 6976 616c  k.assert_equival
-0000bae0: 656e 7428 636f 6e74 656e 7473 2c20 6163  ent(contents, ac
-0000baf0: 7475 616c 290a 2020 2020 2020 2020 626c  tual).        bl
-0000bb00: 6163 6b2e 6173 7365 7274 5f73 7461 626c  ack.assert_stabl
-0000bb10: 6528 636f 6e74 656e 7473 2c20 6163 7475  e(contents, actu
-0000bb20: 616c 2c20 7079 695f 6d6f 6465 290a 0a20  al, pyi_mode).. 
-0000bb30: 2020 2040 6576 656e 745f 6c6f 6f70 2829     @event_loop()
-0000bb40: 0a20 2020 2064 6566 2074 6573 745f 6d75  .    def test_mu
-0000bb50: 6c74 695f 6669 6c65 5f66 6f72 6365 5f70  lti_file_force_p
-0000bb60: 7969 2873 656c 6629 202d 3e20 4e6f 6e65  yi(self) -> None
-0000bb70: 3a0a 2020 2020 2020 2020 7265 675f 6d6f  :.        reg_mo
-0000bb80: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
-0000bb90: 450a 2020 2020 2020 2020 7079 695f 6d6f  E.        pyi_mo
-0000bba0: 6465 203d 2072 6570 6c61 6365 2844 4546  de = replace(DEF
-0000bbb0: 4155 4c54 5f4d 4f44 452c 2069 735f 7079  AULT_MODE, is_py
-0000bbc0: 693d 5472 7565 290a 2020 2020 2020 2020  i=True).        
-0000bbd0: 636f 6e74 656e 7473 2c20 6578 7065 6374  contents, expect
-0000bbe0: 6564 203d 2072 6561 645f 6461 7461 2822  ed = read_data("
-0000bbf0: 6d69 7363 656c 6c61 6e65 6f75 7322 2c20  miscellaneous", 
-0000bc00: 2266 6f72 6365 5f70 7969 2229 0a20 2020  "force_pyi").   
-0000bc10: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-0000bc20: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
-0000bc30: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-0000bc40: 7061 7468 7320 3d20 5b0a 2020 2020 2020  paths = [.      
-0000bc50: 2020 2020 2020 2020 2020 2877 6f72 6b73            (works
-0000bc60: 7061 6365 202f 2022 6669 6c65 312e 7079  pace / "file1.py
-0000bc70: 2229 2e72 6573 6f6c 7665 2829 2c0a 2020  ").resolve(),.  
-0000bc80: 2020 2020 2020 2020 2020 2020 2020 2877                (w
-0000bc90: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
-0000bca0: 322e 7079 2229 2e72 6573 6f6c 7665 2829  2.py").resolve()
-0000bcb0: 2c0a 2020 2020 2020 2020 2020 2020 5d0a  ,.            ].
-0000bcc0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000bcd0: 7061 7468 2069 6e20 7061 7468 733a 0a20  path in paths:. 
-0000bce0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000bcf0: 6174 682e 7772 6974 655f 7465 7874 2863  ath.write_text(c
-0000bd00: 6f6e 7465 6e74 732c 2065 6e63 6f64 696e  ontents, encodin
-0000bd10: 673d 2275 7466 2d38 2229 0a20 2020 2020  g="utf-8").     
-0000bd20: 2020 2020 2020 2073 656c 662e 696e 766f         self.invo
-0000bd30: 6b65 426c 6163 6b28 5b73 7472 2870 2920  keBlack([str(p) 
-0000bd40: 666f 7220 7020 696e 2070 6174 6873 5d20  for p in paths] 
-0000bd50: 2b20 5b22 2d2d 7079 6922 5d29 0a20 2020  + ["--pyi"]).   
-0000bd60: 2020 2020 2020 2020 2066 6f72 2070 6174           for pat
-0000bd70: 6820 696e 2070 6174 6873 3a0a 2020 2020  h in paths:.    
-0000bd80: 2020 2020 2020 2020 2020 2020 6163 7475              actu
-0000bd90: 616c 203d 2070 6174 682e 7265 6164 5f74  al = path.read_t
-0000bda0: 6578 7428 656e 636f 6469 6e67 3d22 7574  ext(encoding="ut
-0000bdb0: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
-0000bdc0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000bdd0: 7445 7175 616c 2861 6374 7561 6c2c 2065  tEqual(actual, e
-0000bde0: 7870 6563 7465 6429 0a20 2020 2020 2020  xpected).       
-0000bdf0: 2020 2020 2023 2076 6572 6966 7920 6361       # verify ca
-0000be00: 6368 6520 7769 7468 202d 2d70 7969 2069  che with --pyi i
-0000be10: 7320 7365 7061 7261 7465 0a20 2020 2020  s separate.     
-0000be20: 2020 2020 2020 2070 7969 5f63 6163 6865         pyi_cache
-0000be30: 203d 2062 6c61 636b 2e43 6163 6865 2e72   = black.Cache.r
-0000be40: 6561 6428 7079 695f 6d6f 6465 290a 2020  ead(pyi_mode).  
-0000be50: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
-0000be60: 5f63 6163 6865 203d 2062 6c61 636b 2e43  _cache = black.C
-0000be70: 6163 6865 2e72 6561 6428 7265 675f 6d6f  ache.read(reg_mo
-0000be80: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-0000be90: 666f 7220 7061 7468 2069 6e20 7061 7468  for path in path
-0000bea0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000beb0: 2020 2061 7373 6572 7420 6e6f 7420 7079     assert not py
-0000bec0: 695f 6361 6368 652e 6973 5f63 6861 6e67  i_cache.is_chang
-0000bed0: 6564 2870 6174 6829 0a20 2020 2020 2020  ed(path).       
-0000bee0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-0000bef0: 6e6f 726d 616c 5f63 6163 6865 2e69 735f  normal_cache.is_
-0000bf00: 6368 616e 6765 6428 7061 7468 290a 0a20  changed(path).. 
-0000bf10: 2020 2064 6566 2074 6573 745f 7069 7065     def test_pipe
-0000bf20: 5f66 6f72 6365 5f70 7969 2873 656c 6629  _force_pyi(self)
-0000bf30: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000bf40: 2020 736f 7572 6365 2c20 6578 7065 6374    source, expect
-0000bf50: 6564 203d 2072 6561 645f 6461 7461 2822  ed = read_data("
-0000bf60: 6d69 7363 656c 6c61 6e65 6f75 7322 2c20  miscellaneous", 
-0000bf70: 2266 6f72 6365 5f70 7969 2229 0a20 2020  "force_pyi").   
-0000bf80: 2020 2020 2072 6573 756c 7420 3d20 436c       result = Cl
-0000bf90: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
-0000bfa0: 280a 2020 2020 2020 2020 2020 2020 626c  (.            bl
-0000bfb0: 6163 6b2e 6d61 696e 2c20 5b22 2d22 2c20  ack.main, ["-", 
-0000bfc0: 222d 7122 2c20 222d 2d70 7969 225d 2c20  "-q", "--pyi"], 
-0000bfd0: 696e 7075 743d 4279 7465 7349 4f28 736f  input=BytesIO(so
-0000bfe0: 7572 6365 2e65 6e63 6f64 6528 2275 7466  urce.encode("utf
-0000bff0: 2d38 2229 290a 2020 2020 2020 2020 290a  -8")).        ).
-0000c000: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000c010: 6572 7445 7175 616c 2872 6573 756c 742e  ertEqual(result.
-0000c020: 6578 6974 5f63 6f64 652c 2030 290a 2020  exit_code, 0).  
-0000c030: 2020 2020 2020 6163 7475 616c 203d 2072        actual = r
-0000c040: 6573 756c 742e 6f75 7470 7574 0a20 2020  esult.output.   
-0000c050: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000c060: 466f 726d 6174 4571 7561 6c28 6163 7475  FormatEqual(actu
-0000c070: 616c 2c20 6578 7065 6374 6564 290a 0a20  al, expected).. 
-0000c080: 2020 2064 6566 2074 6573 745f 7369 6e67     def test_sing
-0000c090: 6c65 5f66 696c 655f 666f 7263 655f 7079  le_file_force_py
-0000c0a0: 3336 2873 656c 6629 202d 3e20 4e6f 6e65  36(self) -> None
-0000c0b0: 3a0a 2020 2020 2020 2020 7265 675f 6d6f  :.        reg_mo
-0000c0c0: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
-0000c0d0: 450a 2020 2020 2020 2020 7079 3336 5f6d  E.        py36_m
-0000c0e0: 6f64 6520 3d20 7265 706c 6163 6528 4445  ode = replace(DE
-0000c0f0: 4641 554c 545f 4d4f 4445 2c20 7461 7267  FAULT_MODE, targ
-0000c100: 6574 5f76 6572 7369 6f6e 733d 5059 3336  et_versions=PY36
-0000c110: 5f56 4552 5349 4f4e 5329 0a20 2020 2020  _VERSIONS).     
-0000c120: 2020 2073 6f75 7263 652c 2065 7870 6563     source, expec
-0000c130: 7465 6420 3d20 7265 6164 5f64 6174 6128  ted = read_data(
-0000c140: 226d 6973 6365 6c6c 616e 656f 7573 222c  "miscellaneous",
-0000c150: 2022 666f 7263 655f 7079 3336 2229 0a20   "force_py36"). 
-0000c160: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
-0000c170: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
-0000c180: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
-0000c190: 2020 7061 7468 203d 2028 776f 726b 7370    path = (worksp
-0000c1a0: 6163 6520 2f20 2266 696c 652e 7079 2229  ace / "file.py")
-0000c1b0: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-0000c1c0: 2020 2020 2020 2070 6174 682e 7772 6974         path.writ
-0000c1d0: 655f 7465 7874 2873 6f75 7263 652c 2065  e_text(source, e
-0000c1e0: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
-0000c1f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000c200: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
-0000c210: 7472 2870 6174 6829 2c20 2a50 5933 365f  tr(path), *PY36_
-0000c220: 4152 4753 5d29 0a20 2020 2020 2020 2020  ARGS]).         
-0000c230: 2020 2061 6374 7561 6c20 3d20 7061 7468     actual = path
-0000c240: 2e72 6561 645f 7465 7874 2865 6e63 6f64  .read_text(encod
-0000c250: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
-0000c260: 2020 2020 2020 2020 2023 2076 6572 6966           # verif
-0000c270: 7920 6361 6368 6520 7769 7468 202d 2d74  y cache with --t
-0000c280: 6172 6765 742d 7665 7273 696f 6e20 6973  arget-version is
-0000c290: 2073 6570 6172 6174 650a 2020 2020 2020   separate.      
-0000c2a0: 2020 2020 2020 7079 3336 5f63 6163 6865        py36_cache
-0000c2b0: 203d 2062 6c61 636b 2e43 6163 6865 2e72   = black.Cache.r
-0000c2c0: 6561 6428 7079 3336 5f6d 6f64 6529 0a20  ead(py36_mode). 
-0000c2d0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0000c2e0: 7420 6e6f 7420 7079 3336 5f63 6163 6865  t not py36_cache
-0000c2f0: 2e69 735f 6368 616e 6765 6428 7061 7468  .is_changed(path
-0000c300: 290a 2020 2020 2020 2020 2020 2020 6e6f  ).            no
-0000c310: 726d 616c 5f63 6163 6865 203d 2062 6c61  rmal_cache = bla
-0000c320: 636b 2e43 6163 6865 2e72 6561 6428 7265  ck.Cache.read(re
-0000c330: 675f 6d6f 6465 290a 2020 2020 2020 2020  g_mode).        
-0000c340: 2020 2020 6173 7365 7274 206e 6f72 6d61      assert norma
-0000c350: 6c5f 6361 6368 652e 6973 5f63 6861 6e67  l_cache.is_chang
-0000c360: 6564 2870 6174 6829 0a20 2020 2020 2020  ed(path).       
-0000c370: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000c380: 6c28 6163 7475 616c 2c20 6578 7065 6374  l(actual, expect
-0000c390: 6564 290a 0a20 2020 2040 6576 656e 745f  ed)..    @event_
-0000c3a0: 6c6f 6f70 2829 0a20 2020 2064 6566 2074  loop().    def t
-0000c3b0: 6573 745f 6d75 6c74 695f 6669 6c65 5f66  est_multi_file_f
-0000c3c0: 6f72 6365 5f70 7933 3628 7365 6c66 2920  orce_py36(self) 
-0000c3d0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000c3e0: 2072 6567 5f6d 6f64 6520 3d20 4445 4641   reg_mode = DEFA
-0000c3f0: 554c 545f 4d4f 4445 0a20 2020 2020 2020  ULT_MODE.       
-0000c400: 2070 7933 365f 6d6f 6465 203d 2072 6570   py36_mode = rep
-0000c410: 6c61 6365 2844 4546 4155 4c54 5f4d 4f44  lace(DEFAULT_MOD
-0000c420: 452c 2074 6172 6765 745f 7665 7273 696f  E, target_versio
-0000c430: 6e73 3d50 5933 365f 5645 5253 494f 4e53  ns=PY36_VERSIONS
-0000c440: 290a 2020 2020 2020 2020 736f 7572 6365  ).        source
-0000c450: 2c20 6578 7065 6374 6564 203d 2072 6561  , expected = rea
-0000c460: 645f 6461 7461 2822 6d69 7363 656c 6c61  d_data("miscella
-0000c470: 6e65 6f75 7322 2c20 2266 6f72 6365 5f70  neous", "force_p
-0000c480: 7933 3622 290a 2020 2020 2020 2020 7769  y36").        wi
-0000c490: 7468 2063 6163 6865 5f64 6972 2829 2061  th cache_dir() a
-0000c4a0: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
-0000c4b0: 2020 2020 2020 2020 2070 6174 6873 203d           paths =
-0000c4c0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
-0000c4d0: 2020 2028 776f 726b 7370 6163 6520 2f20     (workspace / 
-0000c4e0: 2266 696c 6531 2e70 7922 292e 7265 736f  "file1.py").reso
-0000c4f0: 6c76 6528 292c 0a20 2020 2020 2020 2020  lve(),.         
-0000c500: 2020 2020 2020 2028 776f 726b 7370 6163         (workspac
-0000c510: 6520 2f20 2266 696c 6532 2e70 7922 292e  e / "file2.py").
-0000c520: 7265 736f 6c76 6528 292c 0a20 2020 2020  resolve(),.     
-0000c530: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-0000c540: 2020 2020 2066 6f72 2070 6174 6820 696e       for path in
-0000c550: 2070 6174 6873 3a0a 2020 2020 2020 2020   paths:.        
-0000c560: 2020 2020 2020 2020 7061 7468 2e77 7269          path.wri
-0000c570: 7465 5f74 6578 7428 736f 7572 6365 2c20  te_text(source, 
-0000c580: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
-0000c590: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000c5a0: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
-0000c5b0: 7374 7228 7029 2066 6f72 2070 2069 6e20  str(p) for p in 
-0000c5c0: 7061 7468 735d 202b 2050 5933 365f 4152  paths] + PY36_AR
-0000c5d0: 4753 290a 2020 2020 2020 2020 2020 2020  GS).            
-0000c5e0: 666f 7220 7061 7468 2069 6e20 7061 7468  for path in path
-0000c5f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000c600: 2020 2061 6374 7561 6c20 3d20 7061 7468     actual = path
-0000c610: 2e72 6561 645f 7465 7874 2865 6e63 6f64  .read_text(encod
-0000c620: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
-0000c630: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000c640: 662e 6173 7365 7274 4571 7561 6c28 6163  f.assertEqual(ac
-0000c650: 7475 616c 2c20 6578 7065 6374 6564 290a  tual, expected).
-0000c660: 2020 2020 2020 2020 2020 2020 2320 7665              # ve
-0000c670: 7269 6679 2063 6163 6865 2077 6974 6820  rify cache with 
-0000c680: 2d2d 7461 7267 6574 2d76 6572 7369 6f6e  --target-version
-0000c690: 2069 7320 7365 7061 7261 7465 0a20 2020   is separate.   
-0000c6a0: 2020 2020 2020 2020 2070 7969 5f63 6163           pyi_cac
-0000c6b0: 6865 203d 2062 6c61 636b 2e43 6163 6865  he = black.Cache
-0000c6c0: 2e72 6561 6428 7079 3336 5f6d 6f64 6529  .read(py36_mode)
-0000c6d0: 0a20 2020 2020 2020 2020 2020 206e 6f72  .            nor
-0000c6e0: 6d61 6c5f 6361 6368 6520 3d20 626c 6163  mal_cache = blac
-0000c6f0: 6b2e 4361 6368 652e 7265 6164 2872 6567  k.Cache.read(reg
-0000c700: 5f6d 6f64 6529 0a20 2020 2020 2020 2020  _mode).         
-0000c710: 2020 2066 6f72 2070 6174 6820 696e 2070     for path in p
-0000c720: 6174 6873 3a0a 2020 2020 2020 2020 2020  aths:.          
-0000c730: 2020 2020 2020 6173 7365 7274 206e 6f74        assert not
-0000c740: 2070 7969 5f63 6163 6865 2e69 735f 6368   pyi_cache.is_ch
-0000c750: 616e 6765 6428 7061 7468 290a 2020 2020  anged(path).    
-0000c760: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-0000c770: 7274 206e 6f72 6d61 6c5f 6361 6368 652e  rt normal_cache.
-0000c780: 6973 5f63 6861 6e67 6564 2870 6174 6829  is_changed(path)
-0000c790: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
-0000c7a0: 6970 655f 666f 7263 655f 7079 3336 2873  ipe_force_py36(s
-0000c7b0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0000c7c0: 2020 2020 2020 736f 7572 6365 2c20 6578        source, ex
-0000c7d0: 7065 6374 6564 203d 2072 6561 645f 6461  pected = read_da
-0000c7e0: 7461 2822 6d69 7363 656c 6c61 6e65 6f75  ta("miscellaneou
-0000c7f0: 7322 2c20 2266 6f72 6365 5f70 7933 3622  s", "force_py36"
-0000c800: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
-0000c810: 203d 2043 6c69 5275 6e6e 6572 2829 2e69   = CliRunner().i
-0000c820: 6e76 6f6b 6528 0a20 2020 2020 2020 2020  nvoke(.         
-0000c830: 2020 2062 6c61 636b 2e6d 6169 6e2c 0a20     black.main,. 
-0000c840: 2020 2020 2020 2020 2020 205b 222d 222c             ["-",
-0000c850: 2022 2d71 222c 2022 2d2d 7461 7267 6574   "-q", "--target
-0000c860: 2d76 6572 7369 6f6e 3d70 7933 3622 5d2c  -version=py36"],
-0000c870: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-0000c880: 7574 3d42 7974 6573 494f 2873 6f75 7263  ut=BytesIO(sourc
-0000c890: 652e 656e 636f 6465 2822 7574 662d 3822  e.encode("utf-8"
-0000c8a0: 2929 2c0a 2020 2020 2020 2020 290a 2020  )),.        ).  
-0000c8b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000c8c0: 7445 7175 616c 2872 6573 756c 742e 6578  tEqual(result.ex
-0000c8d0: 6974 5f63 6f64 652c 2030 290a 2020 2020  it_code, 0).    
-0000c8e0: 2020 2020 6163 7475 616c 203d 2072 6573      actual = res
-0000c8f0: 756c 742e 6f75 7470 7574 0a20 2020 2020  ult.output.     
-0000c900: 2020 2073 656c 662e 6173 7365 7274 466f     self.assertFo
-0000c910: 726d 6174 4571 7561 6c28 6163 7475 616c  rmatEqual(actual
-0000c920: 2c20 6578 7065 6374 6564 290a 0a20 2020  , expected)..   
-0000c930: 2040 7079 7465 7374 2e6d 6172 6b2e 696e   @pytest.mark.in
-0000c940: 636f 6d70 6174 6962 6c65 5f77 6974 685f  compatible_with_
-0000c950: 6d79 7079 630a 2020 2020 6465 6620 7465  mypyc.    def te
-0000c960: 7374 5f72 6566 6f72 6d61 745f 6f6e 655f  st_reformat_one_
-0000c970: 7769 7468 5f73 7464 696e 2873 656c 6629  with_stdin(self)
-0000c980: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000c990: 2020 7769 7468 2070 6174 6368 280a 2020    with patch(.  
-0000c9a0: 2020 2020 2020 2020 2020 2262 6c61 636b            "black
-0000c9b0: 2e66 6f72 6d61 745f 7374 6469 6e5f 746f  .format_stdin_to
-0000c9c0: 5f73 7464 6f75 7422 2c0a 2020 2020 2020  _stdout",.      
-0000c9d0: 2020 2020 2020 7265 7475 726e 5f76 616c        return_val
-0000c9e0: 7565 3d6c 616d 6264 6120 2a61 7267 732c  ue=lambda *args,
-0000c9f0: 202a 2a6b 7761 7267 733a 2062 6c61 636b   **kwargs: black
-0000ca00: 2e43 6861 6e67 6564 2e59 4553 2c0a 2020  .Changed.YES,.  
-0000ca10: 2020 2020 2020 2920 6173 2066 7374 733a        ) as fsts:
-0000ca20: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-0000ca30: 6f72 7420 3d20 4d61 6769 634d 6f63 6b28  ort = MagicMock(
-0000ca40: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
-0000ca50: 7468 203d 2050 6174 6828 222d 2229 0a20  th = Path("-"). 
-0000ca60: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-0000ca70: 2e72 6566 6f72 6d61 745f 6f6e 6528 0a20  .reformat_one(. 
-0000ca80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000ca90: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-0000caa0: 2020 2020 2066 6173 743d 5472 7565 2c0a       fast=True,.
-0000cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cac0: 7772 6974 655f 6261 636b 3d62 6c61 636b  write_back=black
-0000cad0: 2e57 7269 7465 4261 636b 2e59 4553 2c0a  .WriteBack.YES,.
-0000cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000caf0: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
-0000cb00: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
-0000cb10: 2020 2072 6570 6f72 743d 7265 706f 7274     report=report
-0000cb20: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000cb30: 2020 2020 2020 2020 2020 2020 6673 7473              fsts
-0000cb40: 2e61 7373 6572 745f 6361 6c6c 6564 5f6f  .assert_called_o
-0000cb50: 6e63 6528 290a 2020 2020 2020 2020 2020  nce().          
-0000cb60: 2020 7265 706f 7274 2e64 6f6e 652e 6173    report.done.as
-0000cb70: 7365 7274 5f63 616c 6c65 645f 7769 7468  sert_called_with
-0000cb80: 2870 6174 682c 2062 6c61 636b 2e43 6861  (path, black.Cha
-0000cb90: 6e67 6564 2e59 4553 290a 0a20 2020 2040  nged.YES)..    @
-0000cba0: 7079 7465 7374 2e6d 6172 6b2e 696e 636f  pytest.mark.inco
-0000cbb0: 6d70 6174 6962 6c65 5f77 6974 685f 6d79  mpatible_with_my
-0000cbc0: 7079 630a 2020 2020 6465 6620 7465 7374  pyc.    def test
-0000cbd0: 5f72 6566 6f72 6d61 745f 6f6e 655f 7769  _reformat_one_wi
-0000cbe0: 7468 5f73 7464 696e 5f66 696c 656e 616d  th_stdin_filenam
-0000cbf0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
-0000cc00: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
-0000cc10: 7463 6828 0a20 2020 2020 2020 2020 2020  tch(.           
-0000cc20: 2022 626c 6163 6b2e 666f 726d 6174 5f73   "black.format_s
-0000cc30: 7464 696e 5f74 6f5f 7374 646f 7574 222c  tdin_to_stdout",
-0000cc40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000cc50: 7572 6e5f 7661 6c75 653d 6c61 6d62 6461  urn_value=lambda
-0000cc60: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-0000cc70: 3a20 626c 6163 6b2e 4368 616e 6765 642e  : black.Changed.
-0000cc80: 5945 532c 0a20 2020 2020 2020 2029 2061  YES,.        ) a
-0000cc90: 7320 6673 7473 3a0a 2020 2020 2020 2020  s fsts:.        
-0000cca0: 2020 2020 7265 706f 7274 203d 204d 6167      report = Mag
-0000ccb0: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
-0000ccc0: 2020 2020 2070 203d 2022 666f 6f2e 7079       p = "foo.py
-0000ccd0: 220a 2020 2020 2020 2020 2020 2020 7061  ".            pa
-0000cce0: 7468 203d 2050 6174 6828 6622 5f5f 424c  th = Path(f"__BL
-0000ccf0: 4143 4b5f 5354 4449 4e5f 4649 4c45 4e41  ACK_STDIN_FILENA
-0000cd00: 4d45 5f5f 7b70 7d22 290a 2020 2020 2020  ME__{p}").      
-0000cd10: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-0000cd20: 2050 6174 6828 7029 0a20 2020 2020 2020   Path(p).       
-0000cd30: 2020 2020 2062 6c61 636b 2e72 6566 6f72       black.refor
-0000cd40: 6d61 745f 6f6e 6528 0a20 2020 2020 2020  mat_one(.       
-0000cd50: 2020 2020 2020 2020 2070 6174 682c 0a20           path,. 
-0000cd60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000cd70: 6173 743d 5472 7565 2c0a 2020 2020 2020  ast=True,.      
-0000cd80: 2020 2020 2020 2020 2020 7772 6974 655f            write_
-0000cd90: 6261 636b 3d62 6c61 636b 2e57 7269 7465  back=black.Write
-0000cda0: 4261 636b 2e59 4553 2c0a 2020 2020 2020  Back.YES,.      
-0000cdb0: 2020 2020 2020 2020 2020 6d6f 6465 3d44            mode=D
-0000cdc0: 4546 4155 4c54 5f4d 4f44 452c 0a20 2020  EFAULT_MODE,.   
-0000cdd0: 2020 2020 2020 2020 2020 2020 2072 6570               rep
-0000cde0: 6f72 743d 7265 706f 7274 2c0a 2020 2020  ort=report,.    
-0000cdf0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000ce00: 2020 2020 2020 6673 7473 2e61 7373 6572        fsts.asser
-0000ce10: 745f 6361 6c6c 6564 5f6f 6e63 655f 7769  t_called_once_wi
-0000ce20: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
-0000ce30: 2020 2020 6661 7374 3d54 7275 652c 2077      fast=True, w
-0000ce40: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
-0000ce50: 5772 6974 6542 6163 6b2e 5945 532c 206d  WriteBack.YES, m
-0000ce60: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
-0000ce70: 2c20 6c69 6e65 733d 2829 0a20 2020 2020  , lines=().     
-0000ce80: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000ce90: 2020 2020 2023 205f 5f42 4c41 434b 5f53       # __BLACK_S
-0000cea0: 5444 494e 5f46 494c 454e 414d 455f 5f20  TDIN_FILENAME__ 
-0000ceb0: 7368 6f75 6c64 2068 6176 6520 6265 656e  should have been
-0000cec0: 2073 7472 6970 7065 640a 2020 2020 2020   stripped.      
-0000ced0: 2020 2020 2020 7265 706f 7274 2e64 6f6e        report.don
-0000cee0: 652e 6173 7365 7274 5f63 616c 6c65 645f  e.assert_called_
-0000cef0: 7769 7468 2865 7870 6563 7465 642c 2062  with(expected, b
-0000cf00: 6c61 636b 2e43 6861 6e67 6564 2e59 4553  lack.Changed.YES
-0000cf10: 290a 0a20 2020 2040 7079 7465 7374 2e6d  )..    @pytest.m
-0000cf20: 6172 6b2e 696e 636f 6d70 6174 6962 6c65  ark.incompatible
-0000cf30: 5f77 6974 685f 6d79 7079 630a 2020 2020  _with_mypyc.    
-0000cf40: 6465 6620 7465 7374 5f72 6566 6f72 6d61  def test_reforma
-0000cf50: 745f 6f6e 655f 7769 7468 5f73 7464 696e  t_one_with_stdin
-0000cf60: 5f66 696c 656e 616d 655f 7079 6928 7365  _filename_pyi(se
-0000cf70: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000cf80: 2020 2020 2077 6974 6820 7061 7463 6828       with patch(
-0000cf90: 0a20 2020 2020 2020 2020 2020 2022 626c  .            "bl
-0000cfa0: 6163 6b2e 666f 726d 6174 5f73 7464 696e  ack.format_stdin
-0000cfb0: 5f74 6f5f 7374 646f 7574 222c 0a20 2020  _to_stdout",.   
-0000cfc0: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
-0000cfd0: 7661 6c75 653d 6c61 6d62 6461 202a 6172  value=lambda *ar
-0000cfe0: 6773 2c20 2a2a 6b77 6172 6773 3a20 626c  gs, **kwargs: bl
-0000cff0: 6163 6b2e 4368 616e 6765 642e 5945 532c  ack.Changed.YES,
-0000d000: 0a20 2020 2020 2020 2029 2061 7320 6673  .        ) as fs
-0000d010: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0000d020: 7265 706f 7274 203d 204d 6167 6963 4d6f  report = MagicMo
-0000d030: 636b 2829 0a20 2020 2020 2020 2020 2020  ck().           
-0000d040: 2070 203d 2022 666f 6f2e 7079 6922 0a20   p = "foo.pyi". 
-0000d050: 2020 2020 2020 2020 2020 2070 6174 6820             path 
-0000d060: 3d20 5061 7468 2866 225f 5f42 4c41 434b  = Path(f"__BLACK
-0000d070: 5f53 5444 494e 5f46 494c 454e 414d 455f  _STDIN_FILENAME_
-0000d080: 5f7b 707d 2229 0a20 2020 2020 2020 2020  _{p}").         
-0000d090: 2020 2065 7870 6563 7465 6420 3d20 5061     expected = Pa
-0000d0a0: 7468 2870 290a 2020 2020 2020 2020 2020  th(p).          
-0000d0b0: 2020 626c 6163 6b2e 7265 666f 726d 6174    black.reformat
-0000d0c0: 5f6f 6e65 280a 2020 2020 2020 2020 2020  _one(.          
-0000d0d0: 2020 2020 2020 7061 7468 2c0a 2020 2020        path,.    
-0000d0e0: 2020 2020 2020 2020 2020 2020 6661 7374              fast
-0000d0f0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-0000d100: 2020 2020 2020 2077 7269 7465 5f62 6163         write_bac
-0000d110: 6b3d 626c 6163 6b2e 5772 6974 6542 6163  k=black.WriteBac
-0000d120: 6b2e 5945 532c 0a20 2020 2020 2020 2020  k.YES,.         
-0000d130: 2020 2020 2020 206d 6f64 653d 4445 4641         mode=DEFA
-0000d140: 554c 545f 4d4f 4445 2c0a 2020 2020 2020  ULT_MODE,.      
-0000d150: 2020 2020 2020 2020 2020 7265 706f 7274            report
-0000d160: 3d72 6570 6f72 742c 0a20 2020 2020 2020  =report,.       
-0000d170: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000d180: 2020 2066 7374 732e 6173 7365 7274 5f63     fsts.assert_c
-0000d190: 616c 6c65 645f 6f6e 6365 5f77 6974 6828  alled_once_with(
-0000d1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d1b0: 2066 6173 743d 5472 7565 2c0a 2020 2020   fast=True,.    
-0000d1c0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
-0000d1d0: 655f 6261 636b 3d62 6c61 636b 2e57 7269  e_back=black.Wri
-0000d1e0: 7465 4261 636b 2e59 4553 2c0a 2020 2020  teBack.YES,.    
-0000d1f0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0000d200: 3d72 6570 6c61 6365 2844 4546 4155 4c54  =replace(DEFAULT
-0000d210: 5f4d 4f44 452c 2069 735f 7079 693d 5472  _MODE, is_pyi=Tr
-0000d220: 7565 292c 0a20 2020 2020 2020 2020 2020  ue),.           
-0000d230: 2020 2020 206c 696e 6573 3d28 292c 0a20       lines=(),. 
-0000d240: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000d250: 2020 2020 2020 2020 2023 205f 5f42 4c41           # __BLA
-0000d260: 434b 5f53 5444 494e 5f46 494c 454e 414d  CK_STDIN_FILENAM
-0000d270: 455f 5f20 7368 6f75 6c64 2068 6176 6520  E__ should have 
-0000d280: 6265 656e 2073 7472 6970 7065 640a 2020  been stripped.  
-0000d290: 2020 2020 2020 2020 2020 7265 706f 7274            report
-0000d2a0: 2e64 6f6e 652e 6173 7365 7274 5f63 616c  .done.assert_cal
-0000d2b0: 6c65 645f 7769 7468 2865 7870 6563 7465  led_with(expecte
-0000d2c0: 642c 2062 6c61 636b 2e43 6861 6e67 6564  d, black.Changed
-0000d2d0: 2e59 4553 290a 0a20 2020 2040 7079 7465  .YES)..    @pyte
-0000d2e0: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
-0000d2f0: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
-0000d300: 2020 2020 6465 6620 7465 7374 5f72 6566      def test_ref
-0000d310: 6f72 6d61 745f 6f6e 655f 7769 7468 5f73  ormat_one_with_s
-0000d320: 7464 696e 5f66 696c 656e 616d 655f 6970  tdin_filename_ip
-0000d330: 796e 6228 7365 6c66 2920 2d3e 204e 6f6e  ynb(self) -> Non
-0000d340: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
-0000d350: 7061 7463 6828 0a20 2020 2020 2020 2020  patch(.         
-0000d360: 2020 2022 626c 6163 6b2e 666f 726d 6174     "black.format
-0000d370: 5f73 7464 696e 5f74 6f5f 7374 646f 7574  _stdin_to_stdout
-0000d380: 222c 0a20 2020 2020 2020 2020 2020 2072  ",.            r
-0000d390: 6574 7572 6e5f 7661 6c75 653d 6c61 6d62  eturn_value=lamb
-0000d3a0: 6461 202a 6172 6773 2c20 2a2a 6b77 6172  da *args, **kwar
-0000d3b0: 6773 3a20 626c 6163 6b2e 4368 616e 6765  gs: black.Change
-0000d3c0: 642e 5945 532c 0a20 2020 2020 2020 2029  d.YES,.        )
-0000d3d0: 2061 7320 6673 7473 3a0a 2020 2020 2020   as fsts:.      
-0000d3e0: 2020 2020 2020 7265 706f 7274 203d 204d        report = M
-0000d3f0: 6167 6963 4d6f 636b 2829 0a20 2020 2020  agicMock().     
-0000d400: 2020 2020 2020 2070 203d 2022 666f 6f2e         p = "foo.
-0000d410: 6970 796e 6222 0a20 2020 2020 2020 2020  ipynb".         
-0000d420: 2020 2070 6174 6820 3d20 5061 7468 2866     path = Path(f
-0000d430: 225f 5f42 4c41 434b 5f53 5444 494e 5f46  "__BLACK_STDIN_F
-0000d440: 494c 454e 414d 455f 5f7b 707d 2229 0a20  ILENAME__{p}"). 
-0000d450: 2020 2020 2020 2020 2020 2065 7870 6563             expec
-0000d460: 7465 6420 3d20 5061 7468 2870 290a 2020  ted = Path(p).  
-0000d470: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-0000d480: 7265 666f 726d 6174 5f6f 6e65 280a 2020  reformat_one(.  
-0000d490: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0000d4a0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-0000d4b0: 2020 2020 6661 7374 3d54 7275 652c 0a20      fast=True,. 
-0000d4c0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000d4d0: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
-0000d4e0: 5772 6974 6542 6163 6b2e 5945 532c 0a20  WriteBack.YES,. 
-0000d4f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000d500: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
-0000d510: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000d520: 2020 7265 706f 7274 3d72 6570 6f72 742c    report=report,
-0000d530: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000d540: 2020 2020 2020 2020 2020 2066 7374 732e             fsts.
-0000d550: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
-0000d560: 6365 5f77 6974 6828 0a20 2020 2020 2020  ce_with(.       
-0000d570: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
-0000d580: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0000d590: 2020 2020 7772 6974 655f 6261 636b 3d62      write_back=b
-0000d5a0: 6c61 636b 2e57 7269 7465 4261 636b 2e59  lack.WriteBack.Y
-0000d5b0: 4553 2c0a 2020 2020 2020 2020 2020 2020  ES,.            
-0000d5c0: 2020 2020 6d6f 6465 3d72 6570 6c61 6365      mode=replace
-0000d5d0: 2844 4546 4155 4c54 5f4d 4f44 452c 2069  (DEFAULT_MODE, i
-0000d5e0: 735f 6970 796e 623d 5472 7565 292c 0a20  s_ipynb=True),. 
-0000d5f0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000d600: 696e 6573 3d28 292c 0a20 2020 2020 2020  ines=(),.       
-0000d610: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000d620: 2020 2023 205f 5f42 4c41 434b 5f53 5444     # __BLACK_STD
-0000d630: 494e 5f46 494c 454e 414d 455f 5f20 7368  IN_FILENAME__ sh
-0000d640: 6f75 6c64 2068 6176 6520 6265 656e 2073  ould have been s
-0000d650: 7472 6970 7065 640a 2020 2020 2020 2020  tripped.        
-0000d660: 2020 2020 7265 706f 7274 2e64 6f6e 652e      report.done.
-0000d670: 6173 7365 7274 5f63 616c 6c65 645f 7769  assert_called_wi
-0000d680: 7468 2865 7870 6563 7465 642c 2062 6c61  th(expected, bla
-0000d690: 636b 2e43 6861 6e67 6564 2e59 4553 290a  ck.Changed.YES).
-0000d6a0: 0a20 2020 2040 7079 7465 7374 2e6d 6172  .    @pytest.mar
-0000d6b0: 6b2e 696e 636f 6d70 6174 6962 6c65 5f77  k.incompatible_w
-0000d6c0: 6974 685f 6d79 7079 630a 2020 2020 6465  ith_mypyc.    de
-0000d6d0: 6620 7465 7374 5f72 6566 6f72 6d61 745f  f test_reformat_
-0000d6e0: 6f6e 655f 7769 7468 5f73 7464 696e 5f61  one_with_stdin_a
-0000d6f0: 6e64 5f65 7869 7374 696e 675f 7061 7468  nd_existing_path
-0000d700: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000d710: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
-0000d720: 6368 280a 2020 2020 2020 2020 2020 2020  ch(.            
-0000d730: 2262 6c61 636b 2e66 6f72 6d61 745f 7374  "black.format_st
-0000d740: 6469 6e5f 746f 5f73 7464 6f75 7422 2c0a  din_to_stdout",.
-0000d750: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d760: 726e 5f76 616c 7565 3d6c 616d 6264 6120  rn_value=lambda 
-0000d770: 2a61 7267 732c 202a 2a6b 7761 7267 733a  *args, **kwargs:
-0000d780: 2062 6c61 636b 2e43 6861 6e67 6564 2e59   black.Changed.Y
-0000d790: 4553 2c0a 2020 2020 2020 2020 2920 6173  ES,.        ) as
-0000d7a0: 2066 7374 733a 0a20 2020 2020 2020 2020   fsts:.         
-0000d7b0: 2020 2072 6570 6f72 7420 3d20 4d61 6769     report = Magi
-0000d7c0: 634d 6f63 6b28 290a 2020 2020 2020 2020  cMock().        
-0000d7d0: 2020 2020 2320 4576 656e 2077 6974 6820      # Even with 
-0000d7e0: 616e 2065 7869 7374 696e 6720 6669 6c65  an existing file
-0000d7f0: 2c20 7369 6e63 6520 7765 2061 7265 2066  , since we are f
-0000d800: 6f72 6369 6e67 2073 7464 696e 2c20 626c  orcing stdin, bl
-0000d810: 6163 6b0a 2020 2020 2020 2020 2020 2020  ack.            
-0000d820: 2320 7368 6f75 6c64 206f 7574 7075 7420  # should output 
-0000d830: 746f 2073 7464 6f75 7420 616e 6420 6e6f  to stdout and no
-0000d840: 7420 6d6f 6469 6679 2074 6865 2066 696c  t modify the fil
-0000d850: 6520 696e 706c 6163 650a 2020 2020 2020  e inplace.      
-0000d860: 2020 2020 2020 7020 3d20 5448 4953 5f44        p = THIS_D
-0000d870: 4952 202f 2022 6461 7461 2220 2f20 2263  IR / "data" / "c
-0000d880: 6173 6573 2220 2f20 2263 6f6c 6c65 6374  ases" / "collect
-0000d890: 696f 6e73 2e70 7922 0a20 2020 2020 2020  ions.py".       
-0000d8a0: 2020 2020 2023 204d 616b 6520 7375 7265       # Make sure
-0000d8b0: 2069 735f 6669 6c65 2061 6374 7561 6c6c   is_file actuall
-0000d8c0: 7920 7265 7475 726e 7320 5472 7565 0a20  y returns True. 
-0000d8d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000d8e0: 6173 7365 7274 5472 7565 2870 2e69 735f  assertTrue(p.is_
-0000d8f0: 6669 6c65 2829 290a 2020 2020 2020 2020  file()).        
-0000d900: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
-0000d910: 6622 5f5f 424c 4143 4b5f 5354 4449 4e5f  f"__BLACK_STDIN_
-0000d920: 4649 4c45 4e41 4d45 5f5f 7b70 7d22 290a  FILENAME__{p}").
-0000d930: 2020 2020 2020 2020 2020 2020 6578 7065              expe
-0000d940: 6374 6564 203d 2050 6174 6828 7029 0a20  cted = Path(p). 
-0000d950: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-0000d960: 2e72 6566 6f72 6d61 745f 6f6e 6528 0a20  .reformat_one(. 
-0000d970: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000d980: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-0000d990: 2020 2020 2066 6173 743d 5472 7565 2c0a       fast=True,.
-0000d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9b0: 7772 6974 655f 6261 636b 3d62 6c61 636b  write_back=black
-0000d9c0: 2e57 7269 7465 4261 636b 2e59 4553 2c0a  .WriteBack.YES,.
-0000d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9e0: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
-0000d9f0: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
-0000da00: 2020 2072 6570 6f72 743d 7265 706f 7274     report=report
-0000da10: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000da20: 2020 2020 2020 2020 2020 2020 6673 7473              fsts
-0000da30: 2e61 7373 6572 745f 6361 6c6c 6564 5f6f  .assert_called_o
-0000da40: 6e63 6528 290a 2020 2020 2020 2020 2020  nce().          
-0000da50: 2020 2320 5f5f 424c 4143 4b5f 5354 4449    # __BLACK_STDI
-0000da60: 4e5f 4649 4c45 4e41 4d45 5f5f 2073 686f  N_FILENAME__ sho
-0000da70: 756c 6420 6861 7665 2062 6565 6e20 7374  uld have been st
-0000da80: 7269 7070 6564 0a20 2020 2020 2020 2020  ripped.         
-0000da90: 2020 2072 6570 6f72 742e 646f 6e65 2e61     report.done.a
-0000daa0: 7373 6572 745f 6361 6c6c 6564 5f77 6974  ssert_called_wit
-0000dab0: 6828 6578 7065 6374 6564 2c20 626c 6163  h(expected, blac
-0000dac0: 6b2e 4368 616e 6765 642e 5945 5329 0a0a  k.Changed.YES)..
-0000dad0: 2020 2020 6465 6620 7465 7374 5f72 6566      def test_ref
-0000dae0: 6f72 6d61 745f 6f6e 655f 7769 7468 5f73  ormat_one_with_s
-0000daf0: 7464 696e 5f65 6d70 7479 2873 656c 6629  tdin_empty(self)
-0000db00: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000db10: 2020 6361 7365 7320 3d20 5b0a 2020 2020    cases = [.    
-0000db20: 2020 2020 2020 2020 2822 222c 2022 2229          ("", "")
-0000db30: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
-0000db40: 5c6e 222c 2022 5c6e 2229 2c0a 2020 2020  \n", "\n"),.    
-0000db50: 2020 2020 2020 2020 2822 5c72 5c6e 222c          ("\r\n",
-0000db60: 2022 5c72 5c6e 2229 2c0a 2020 2020 2020   "\r\n"),.      
-0000db70: 2020 2020 2020 2822 205c 7422 2c20 2222        (" \t", ""
-0000db80: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-0000db90: 2220 5c74 5c6e 5c74 2022 2c20 225c 6e22  " \t\n\t ", "\n"
-0000dba0: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-0000dbb0: 2220 5c74 5c72 5c6e 5c74 2022 2c20 225c  " \t\r\n\t ", "\
-0000dbc0: 725c 6e22 292c 0a20 2020 2020 2020 205d  r\n"),.        ]
-0000dbd0: 0a0a 2020 2020 2020 2020 6465 6620 5f6e  ..        def _n
-0000dbe0: 6577 5f77 7261 7070 6572 280a 2020 2020  ew_wrapper(.    
-0000dbf0: 2020 2020 2020 2020 6f75 7470 7574 3a20          output: 
-0000dc00: 696f 2e53 7472 696e 6749 4f2c 2069 6f5f  io.StringIO, io_
-0000dc10: 5465 7874 494f 5772 6170 7065 723a 2054  TextIOWrapper: T
-0000dc20: 7970 655b 696f 2e54 6578 7449 4f57 7261  ype[io.TextIOWra
-0000dc30: 7070 6572 5d0a 2020 2020 2020 2020 2920  pper].        ) 
-0000dc40: 2d3e 2043 616c 6c61 626c 655b 5b41 6e79  -> Callable[[Any
-0000dc50: 2c20 416e 795d 2c20 696f 2e54 6578 7449  , Any], io.TextI
-0000dc60: 4f57 7261 7070 6572 5d3a 0a20 2020 2020  OWrapper]:.     
-0000dc70: 2020 2020 2020 2064 6566 2067 6574 5f6f         def get_o
-0000dc80: 7574 7075 7428 2a61 7267 733a 2041 6e79  utput(*args: Any
-0000dc90: 2c20 2a2a 6b77 6172 6773 3a20 416e 7929  , **kwargs: Any)
-0000dca0: 202d 3e20 696f 2e54 6578 7449 4f57 7261   -> io.TextIOWra
-0000dcb0: 7070 6572 3a0a 2020 2020 2020 2020 2020  pper:.          
-0000dcc0: 2020 2020 2020 6966 2061 7267 7320 3d3d        if args ==
-0000dcd0: 2028 7379 732e 7374 646f 7574 2e62 7566   (sys.stdout.buf
-0000dce0: 6665 722c 293a 0a20 2020 2020 2020 2020  fer,):.         
-0000dcf0: 2020 2020 2020 2020 2020 2023 2049 7427             # It'
-0000dd00: 7320 6066 6f72 6d61 745f 7374 6469 6e5f  s `format_stdin_
-0000dd10: 746f 5f73 7464 6f75 7428 2960 2063 616c  to_stdout()` cal
-0000dd20: 6c69 6e67 2060 696f 2e54 6578 7449 4f57  ling `io.TextIOW
-0000dd30: 7261 7070 6572 2829 602c 0a20 2020 2020  rapper()`,.     
-0000dd40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000dd50: 2072 6574 7572 6e20 6f75 7220 6d6f 636b   return our mock
-0000dd60: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
-0000dd70: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000dd80: 7572 6e20 6f75 7470 7574 0a20 2020 2020  urn output.     
-0000dd90: 2020 2020 2020 2020 2020 2023 2049 7427             # It'
-0000dda0: 7320 736f 6d65 7468 696e 6720 656c 7365  s something else
-0000ddb0: 2028 692e 652e 2060 6465 636f 6465 5f62   (i.e. `decode_b
-0000ddc0: 7974 6573 2829 6029 2063 616c 6c69 6e67  ytes()`) calling
-0000ddd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dde0: 2023 2060 696f 2e54 6578 7449 4f57 7261   # `io.TextIOWra
-0000ddf0: 7070 6572 2829 602c 2070 6173 7320 7468  pper()`, pass th
-0000de00: 726f 7567 6820 746f 2074 6865 206f 7269  rough to the ori
-0000de10: 6769 6e61 6c20 696d 706c 656d 656e 7461  ginal implementa
-0000de20: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
-0000de30: 2020 2020 2020 2320 5365 6520 6469 7363        # See disc
-0000de40: 7573 7369 6f6e 2069 6e20 6874 7470 733a  ussion in https:
-0000de50: 2f2f 6769 7468 7562 2e63 6f6d 2f70 7366  //github.com/psf
-0000de60: 2f62 6c61 636b 2f70 756c 6c2f 3234 3839  /black/pull/2489
-0000de70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000de80: 2072 6574 7572 6e20 696f 5f54 6578 7449   return io_TextI
-0000de90: 4f57 7261 7070 6572 282a 6172 6773 2c20  OWrapper(*args, 
-0000dea0: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
-0000deb0: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
-0000dec0: 745f 6f75 7470 7574 0a0a 2020 2020 2020  t_output..      
-0000ded0: 2020 666f 7220 636f 6e74 656e 742c 2065    for content, e
-0000dee0: 7870 6563 7465 6420 696e 2063 6173 6573  xpected in cases
-0000def0: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
-0000df00: 7470 7574 203d 2069 6f2e 5374 7269 6e67  tput = io.String
-0000df10: 494f 2829 0a20 2020 2020 2020 2020 2020  IO().           
-0000df20: 2069 6f5f 5465 7874 494f 5772 6170 7065   io_TextIOWrappe
-0000df30: 7220 3d20 696f 2e54 6578 7449 4f57 7261  r = io.TextIOWra
-0000df40: 7070 6572 0a0a 2020 2020 2020 2020 2020  pper..          
-0000df50: 2020 7769 7468 2070 6174 6368 2822 696f    with patch("io
-0000df60: 2e54 6578 7449 4f57 7261 7070 6572 222c  .TextIOWrapper",
-0000df70: 205f 6e65 775f 7772 6170 7065 7228 6f75   _new_wrapper(ou
-0000df80: 7470 7574 2c20 696f 5f54 6578 7449 4f57  tput, io_TextIOW
-0000df90: 7261 7070 6572 2929 3a0a 2020 2020 2020  rapper)):.      
-0000dfa0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfc0: 2020 2062 6c61 636b 2e66 6f72 6d61 745f     black.format_
-0000dfd0: 7374 6469 6e5f 746f 5f73 7464 6f75 7428  stdin_to_stdout(
-0000dfe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dff0: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
-0000e000: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0000e010: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0000e020: 656e 743d 636f 6e74 656e 742c 0a20 2020  ent=content,.   
-0000e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e040: 2020 2020 2077 7269 7465 5f62 6163 6b3d       write_back=
-0000e050: 626c 6163 6b2e 5772 6974 6542 6163 6b2e  black.WriteBack.
-0000e060: 5945 532c 0a20 2020 2020 2020 2020 2020  YES,.           
-0000e070: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0000e080: 653d 4445 4641 554c 545f 4d4f 4445 2c0a  e=DEFAULT_MODE,.
-0000e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0a0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000e0b0: 2020 2020 2020 6578 6365 7074 2069 6f2e        except io.
-0000e0c0: 556e 7375 7070 6f72 7465 644f 7065 7261  UnsupportedOpera
-0000e0d0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-0000e0e0: 2020 2020 2020 2020 2020 7061 7373 2020            pass  
-0000e0f0: 2320 5374 7269 6e67 494f 2064 6f65 7320  # StringIO does 
-0000e100: 6e6f 7420 7375 7070 6f72 7420 6465 7461  not support deta
-0000e110: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
-0000e120: 2020 2061 7373 6572 7420 6f75 7470 7574     assert output
-0000e130: 2e67 6574 7661 6c75 6528 2920 3d3d 2065  .getvalue() == e
-0000e140: 7870 6563 7465 640a 0a20 2020 2064 6566  xpected..    def
-0000e150: 2074 6573 745f 636c 695f 756e 7374 6162   test_cli_unstab
-0000e160: 6c65 2873 656c 6629 202d 3e20 4e6f 6e65  le(self) -> None
-0000e170: 3a0a 2020 2020 2020 2020 7365 6c66 2e69  :.        self.i
-0000e180: 6e76 6f6b 6542 6c61 636b 285b 222d 2d75  nvokeBlack(["--u
-0000e190: 6e73 7461 626c 6522 2c20 222d 6322 2c20  nstable", "-c", 
-0000e1a0: 2230 225d 2c20 6578 6974 5f63 6f64 653d  "0"], exit_code=
-0000e1b0: 3029 0a20 2020 2020 2020 2073 656c 662e  0).        self.
-0000e1c0: 696e 766f 6b65 426c 6163 6b28 5b22 2d2d  invokeBlack(["--
-0000e1d0: 7072 6576 6965 7722 2c20 222d 6322 2c20  preview", "-c", 
-0000e1e0: 2230 225d 2c20 6578 6974 5f63 6f64 653d  "0"], exit_code=
-0000e1f0: 3029 0a20 2020 2020 2020 2023 204d 7573  0).        # Mus
-0000e200: 7420 616c 736f 2070 6173 7320 2d2d 7072  t also pass --pr
-0000e210: 6576 6965 770a 2020 2020 2020 2020 7365  eview.        se
-0000e220: 6c66 2e69 6e76 6f6b 6542 6c61 636b 280a  lf.invokeBlack(.
-0000e230: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
-0000e240: 656e 6162 6c65 2d75 6e73 7461 626c 652d  enable-unstable-
-0000e250: 6665 6174 7572 6522 2c20 2273 7472 696e  feature", "strin
-0000e260: 675f 7072 6f63 6573 7369 6e67 222c 2022  g_processing", "
-0000e270: 2d63 222c 2022 3022 5d2c 2065 7869 745f  -c", "0"], exit_
-0000e280: 636f 6465 3d31 0a20 2020 2020 2020 2029  code=1.        )
-0000e290: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
-0000e2a0: 766f 6b65 426c 6163 6b28 0a20 2020 2020  vokeBlack(.     
-0000e2b0: 2020 2020 2020 205b 222d 2d70 7265 7669         ["--previ
-0000e2c0: 6577 222c 2022 2d2d 656e 6162 6c65 2d75  ew", "--enable-u
-0000e2d0: 6e73 7461 626c 652d 6665 6174 7572 6522  nstable-feature"
-0000e2e0: 2c20 2273 7472 696e 675f 7072 6f63 6573  , "string_proces
-0000e2f0: 7369 6e67 222c 2022 2d63 222c 2022 3022  sing", "-c", "0"
-0000e300: 5d2c 0a20 2020 2020 2020 2020 2020 2065  ],.            e
-0000e310: 7869 745f 636f 6465 3d30 2c0a 2020 2020  xit_code=0,.    
-0000e320: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
-0000e330: 6c66 2e69 6e76 6f6b 6542 6c61 636b 280a  lf.invokeBlack(.
-0000e340: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
-0000e350: 756e 7374 6162 6c65 222c 2022 2d2d 656e  unstable", "--en
-0000e360: 6162 6c65 2d75 6e73 7461 626c 652d 6665  able-unstable-fe
-0000e370: 6174 7572 6522 2c20 2273 7472 696e 675f  ature", "string_
-0000e380: 7072 6f63 6573 7369 6e67 222c 2022 2d63  processing", "-c
-0000e390: 222c 2022 3022 5d2c 0a20 2020 2020 2020  ", "0"],.       
-0000e3a0: 2020 2020 2065 7869 745f 636f 6465 3d30       exit_code=0
-0000e3b0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000e3c0: 2064 6566 2074 6573 745f 696e 7661 6c69   def test_invali
-0000e3d0: 645f 636c 695f 7265 6765 7828 7365 6c66  d_cli_regex(self
-0000e3e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000e3f0: 2020 2066 6f72 206f 7074 696f 6e20 696e     for option in
-0000e400: 205b 222d 2d69 6e63 6c75 6465 222c 2022   ["--include", "
-0000e410: 2d2d 6578 636c 7564 6522 2c20 222d 2d65  --exclude", "--e
-0000e420: 7874 656e 642d 6578 636c 7564 6522 2c20  xtend-exclude", 
-0000e430: 222d 2d66 6f72 6365 2d65 7863 6c75 6465  "--force-exclude
-0000e440: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-0000e450: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
-0000e460: 285b 222d 222c 206f 7074 696f 6e2c 2022  (["-", option, "
-0000e470: 2a2a 2829 2821 212a 2922 5d2c 2065 7869  **()(!!*)"], exi
-0000e480: 745f 636f 6465 3d32 290a 0a20 2020 2064  t_code=2)..    d
-0000e490: 6566 2074 6573 745f 7265 7175 6972 6564  ef test_required
-0000e4a0: 5f76 6572 7369 6f6e 5f6d 6174 6368 6573  _version_matches
-0000e4b0: 5f76 6572 7369 6f6e 2873 656c 6629 202d  _version(self) -
-0000e4c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000e4d0: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
-0000e4e0: 280a 2020 2020 2020 2020 2020 2020 5b22  (.            ["
-0000e4f0: 2d2d 7265 7175 6972 6564 2d76 6572 7369  --required-versi
-0000e500: 6f6e 222c 2062 6c61 636b 2e5f 5f76 6572  on", black.__ver
-0000e510: 7369 6f6e 5f5f 2c20 222d 6322 2c20 2230  sion__, "-c", "0
-0000e520: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-0000e530: 6578 6974 5f63 6f64 653d 302c 0a20 2020  exit_code=0,.   
-0000e540: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
-0000e550: 636f 6e66 6967 3d54 7275 652c 0a20 2020  config=True,.   
-0000e560: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-0000e570: 7465 7374 5f72 6571 7569 7265 645f 7665  test_required_ve
-0000e580: 7273 696f 6e5f 6d61 7463 6865 735f 7061  rsion_matches_pa
-0000e590: 7274 6961 6c5f 7665 7273 696f 6e28 7365  rtial_version(se
-0000e5a0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000e5b0: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
-0000e5c0: 426c 6163 6b28 0a20 2020 2020 2020 2020  Black(.         
-0000e5d0: 2020 205b 222d 2d72 6571 7569 7265 642d     ["--required-
-0000e5e0: 7665 7273 696f 6e22 2c20 626c 6163 6b2e  version", black.
-0000e5f0: 5f5f 7665 7273 696f 6e5f 5f2e 7370 6c69  __version__.spli
-0000e600: 7428 222e 2229 5b30 5d2c 2022 2d63 222c  t(".")[0], "-c",
-0000e610: 2022 3022 5d2c 0a20 2020 2020 2020 2020   "0"],.         
-0000e620: 2020 2065 7869 745f 636f 6465 3d30 2c0a     exit_code=0,.
-0000e630: 2020 2020 2020 2020 2020 2020 6967 6e6f              igno
-0000e640: 7265 5f63 6f6e 6669 673d 5472 7565 2c0a  re_config=True,.
-0000e650: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-0000e660: 6566 2074 6573 745f 7265 7175 6972 6564  ef test_required
-0000e670: 5f76 6572 7369 6f6e 5f64 6f65 735f 6e6f  _version_does_no
-0000e680: 745f 6d61 7463 685f 6f6e 5f6d 696e 6f72  t_match_on_minor
-0000e690: 5f76 6572 7369 6f6e 2873 656c 6629 202d  _version(self) -
-0000e6a0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000e6b0: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
-0000e6c0: 280a 2020 2020 2020 2020 2020 2020 5b22  (.            ["
-0000e6d0: 2d2d 7265 7175 6972 6564 2d76 6572 7369  --required-versi
-0000e6e0: 6f6e 222c 2062 6c61 636b 2e5f 5f76 6572  on", black.__ver
-0000e6f0: 7369 6f6e 5f5f 2e73 706c 6974 2822 2e22  sion__.split("."
-0000e700: 295b 305d 202b 2022 2e39 3939 222c 2022  )[0] + ".999", "
-0000e710: 2d63 222c 2022 3022 5d2c 0a20 2020 2020  -c", "0"],.     
-0000e720: 2020 2020 2020 2065 7869 745f 636f 6465         exit_code
-0000e730: 3d31 2c0a 2020 2020 2020 2020 2020 2020  =1,.            
-0000e740: 6967 6e6f 7265 5f63 6f6e 6669 673d 5472  ignore_config=Tr
-0000e750: 7565 2c0a 2020 2020 2020 2020 290a 0a20  ue,.        ).. 
-0000e760: 2020 2064 6566 2074 6573 745f 7265 7175     def test_requ
-0000e770: 6972 6564 5f76 6572 7369 6f6e 5f64 6f65  ired_version_doe
-0000e780: 735f 6e6f 745f 6d61 7463 685f 7665 7273  s_not_match_vers
-0000e790: 696f 6e28 7365 6c66 2920 2d3e 204e 6f6e  ion(self) -> Non
-0000e7a0: 653a 0a20 2020 2020 2020 2072 6573 756c  e:.        resul
-0000e7b0: 7420 3d20 426c 6163 6b52 756e 6e65 7228  t = BlackRunner(
-0000e7c0: 292e 696e 766f 6b65 280a 2020 2020 2020  ).invoke(.      
-0000e7d0: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
-0000e7e0: 2c0a 2020 2020 2020 2020 2020 2020 5b22  ,.            ["
-0000e7f0: 2d2d 7265 7175 6972 6564 2d76 6572 7369  --required-versi
-0000e800: 6f6e 222c 2022 3230 2e39 3962 222c 2022  on", "20.99b", "
-0000e810: 2d63 222c 2022 3022 5d2c 0a20 2020 2020  -c", "0"],.     
-0000e820: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
-0000e830: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
-0000e840: 7375 6c74 2e65 7869 745f 636f 6465 2c20  sult.exit_code, 
-0000e850: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
-0000e860: 6173 7365 7274 496e 2822 7265 7175 6972  assertIn("requir
-0000e870: 6564 2076 6572 7369 6f6e 222c 2072 6573  ed version", res
-0000e880: 756c 742e 7374 6465 7272 290a 0a20 2020  ult.stderr)..   
-0000e890: 2064 6566 2074 6573 745f 7072 6573 6572   def test_preser
-0000e8a0: 7665 735f 6c69 6e65 5f65 6e64 696e 6773  ves_line_endings
-0000e8b0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0000e8c0: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
-0000e8d0: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
-0000e8e0: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
-0000e8f0: 2020 2020 2020 2020 2020 2020 7465 7374              test
-0000e900: 5f66 696c 6520 3d20 5061 7468 2877 6f72  _file = Path(wor
-0000e910: 6b73 7061 6365 2920 2f20 2274 6573 742e  kspace) / "test.
-0000e920: 7079 220a 2020 2020 2020 2020 2020 2020  py".            
-0000e930: 666f 7220 6e6c 2069 6e20 5b22 5c6e 222c  for nl in ["\n",
-0000e940: 2022 5c72 5c6e 225d 3a0a 2020 2020 2020   "\r\n"]:.      
-0000e950: 2020 2020 2020 2020 2020 636f 6e74 656e            conten
-0000e960: 7473 203d 206e 6c2e 6a6f 696e 285b 2264  ts = nl.join(["d
-0000e970: 6566 2066 2820 2029 3a22 2c20 2220 2020  ef f(  ):", "   
-0000e980: 2070 6173 7322 5d29 0a20 2020 2020 2020   pass"]).       
-0000e990: 2020 2020 2020 2020 2074 6573 745f 6669           test_fi
-0000e9a0: 6c65 2e77 7269 7465 5f62 7974 6573 2863  le.write_bytes(c
-0000e9b0: 6f6e 7465 6e74 732e 656e 636f 6465 2829  ontents.encode()
-0000e9c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000e9d0: 2020 6666 2874 6573 745f 6669 6c65 2c20    ff(test_file, 
-0000e9e0: 7772 6974 655f 6261 636b 3d62 6c61 636b  write_back=black
-0000e9f0: 2e57 7269 7465 4261 636b 2e59 4553 290a  .WriteBack.YES).
-0000ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea10: 7570 6461 7465 645f 636f 6e74 656e 7473  updated_contents
-0000ea20: 3a20 6279 7465 7320 3d20 7465 7374 5f66  : bytes = test_f
-0000ea30: 696c 652e 7265 6164 5f62 7974 6573 2829  ile.read_bytes()
-0000ea40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ea50: 2073 656c 662e 6173 7365 7274 496e 286e   self.assertIn(n
-0000ea60: 6c2e 656e 636f 6465 2829 2c20 7570 6461  l.encode(), upda
-0000ea70: 7465 645f 636f 6e74 656e 7473 290a 2020  ted_contents).  
-0000ea80: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000ea90: 206e 6c20 3d3d 2022 5c6e 223a 0a20 2020   nl == "\n":.   
-0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eab0: 2073 656c 662e 6173 7365 7274 4e6f 7449   self.assertNotI
-0000eac0: 6e28 6222 5c72 5c6e 222c 2075 7064 6174  n(b"\r\n", updat
-0000ead0: 6564 5f63 6f6e 7465 6e74 7329 0a0a 2020  ed_contents)..  
-0000eae0: 2020 6465 6620 7465 7374 5f70 7265 7365    def test_prese
-0000eaf0: 7276 6573 5f6c 696e 655f 656e 6469 6e67  rves_line_ending
-0000eb00: 735f 7669 615f 7374 6469 6e28 7365 6c66  s_via_stdin(self
-0000eb10: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000eb20: 2020 2066 6f72 206e 6c20 696e 205b 225c     for nl in ["\
-0000eb30: 6e22 2c20 225c 725c 6e22 5d3a 0a20 2020  n", "\r\n"]:.   
-0000eb40: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
-0000eb50: 7320 3d20 6e6c 2e6a 6f69 6e28 5b22 6465  s = nl.join(["de
-0000eb60: 6620 6628 2020 293a 222c 2022 2020 2020  f f(  ):", "    
-0000eb70: 7061 7373 225d 290a 2020 2020 2020 2020  pass"]).        
-0000eb80: 2020 2020 7275 6e6e 6572 203d 2042 6c61      runner = Bla
-0000eb90: 636b 5275 6e6e 6572 2829 0a20 2020 2020  ckRunner().     
-0000eba0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0000ebb0: 7275 6e6e 6572 2e69 6e76 6f6b 6528 0a20  runner.invoke(. 
-0000ebc0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000ebd0: 6c61 636b 2e6d 6169 6e2c 205b 222d 222c  lack.main, ["-",
-0000ebe0: 2022 2d2d 6661 7374 225d 2c20 696e 7075   "--fast"], inpu
-0000ebf0: 743d 4279 7465 7349 4f28 636f 6e74 656e  t=BytesIO(conten
-0000ec00: 7473 2e65 6e63 6f64 6528 2275 7466 2d38  ts.encode("utf-8
-0000ec10: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
-0000ec20: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000ec30: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-0000ec40: 6573 756c 742e 6578 6974 5f63 6f64 652c  esult.exit_code,
-0000ec50: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
-0000ec60: 6f75 7470 7574 203d 2072 6573 756c 742e  output = result.
-0000ec70: 7374 646f 7574 5f62 7974 6573 0a20 2020  stdout_bytes.   
-0000ec80: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0000ec90: 7365 7274 496e 286e 6c2e 656e 636f 6465  sertIn(nl.encode
-0000eca0: 2822 7574 662d 3822 292c 206f 7574 7075  ("utf-8"), outpu
-0000ecb0: 7429 0a20 2020 2020 2020 2020 2020 2069  t).            i
-0000ecc0: 6620 6e6c 203d 3d20 225c 6e22 3a0a 2020  f nl == "\n":.  
-0000ecd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000ece0: 6c66 2e61 7373 6572 744e 6f74 496e 2862  lf.assertNotIn(b
-0000ecf0: 225c 725c 6e22 2c20 6f75 7470 7574 290a  "\r\n", output).
-0000ed00: 0a20 2020 2064 6566 2074 6573 745f 6e6f  .    def test_no
-0000ed10: 726d 616c 697a 655f 6c69 6e65 5f65 6e64  rmalize_line_end
-0000ed20: 696e 6773 2873 656c 6629 202d 3e20 4e6f  ings(self) -> No
-0000ed30: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
-0000ed40: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
-0000ed50: 6f72 7928 2920 6173 2077 6f72 6b73 7061  ory() as workspa
-0000ed60: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-0000ed70: 7465 7374 5f66 696c 6520 3d20 5061 7468  test_file = Path
-0000ed80: 2877 6f72 6b73 7061 6365 2920 2f20 2274  (workspace) / "t
-0000ed90: 6573 742e 7079 220a 2020 2020 2020 2020  est.py".        
-0000eda0: 2020 2020 666f 7220 6461 7461 2c20 6578      for data, ex
-0000edb0: 7065 6374 6564 2069 6e20 280a 2020 2020  pected in (.    
-0000edc0: 2020 2020 2020 2020 2020 2020 2862 2263              (b"c
-0000edd0: 5c72 5c6e 635c 6e20 222c 2062 2263 5c72  \r\nc\n ", b"c\r
-0000ede0: 5c6e 635c 725c 6e22 292c 0a20 2020 2020  \nc\r\n"),.     
-0000edf0: 2020 2020 2020 2020 2020 2028 6222 6c5c             (b"l\
-0000ee00: 6e6c 5c72 5c6e 2022 2c20 6222 6c5c 6e6c  nl\r\n ", b"l\nl
-0000ee10: 5c6e 2229 2c0a 2020 2020 2020 2020 2020  \n"),.          
-0000ee20: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0000ee30: 2020 2020 2074 6573 745f 6669 6c65 2e77       test_file.w
-0000ee40: 7269 7465 5f62 7974 6573 2864 6174 6129  rite_bytes(data)
-0000ee50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ee60: 2066 6628 7465 7374 5f66 696c 652c 2077   ff(test_file, w
-0000ee70: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
-0000ee80: 5772 6974 6542 6163 6b2e 5945 5329 0a20  WriteBack.YES). 
-0000ee90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000eea0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0000eeb0: 7465 7374 5f66 696c 652e 7265 6164 5f62  test_file.read_b
-0000eec0: 7974 6573 2829 2c20 6578 7065 6374 6564  ytes(), expected
-0000eed0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0000eee0: 726f 6f74 5f6c 6f67 6765 725f 6e6f 745f  root_logger_not_
-0000eef0: 7573 6564 5f64 6972 6563 746c 7928 7365  used_directly(se
-0000ef00: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000ef10: 2020 2020 2064 6566 2066 6169 6c28 2a61       def fail(*a
-0000ef20: 7267 733a 2041 6e79 2c20 2a2a 6b77 6172  rgs: Any, **kwar
-0000ef30: 6773 3a20 416e 7929 202d 3e20 4e6f 6e65  gs: Any) -> None
-0000ef40: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000ef50: 6c66 2e66 6169 6c28 2252 6563 6f72 6420  lf.fail("Record 
-0000ef60: 6372 6561 7465 6420 7769 7468 2072 6f6f  created with roo
-0000ef70: 7420 6c6f 6767 6572 2229 0a0a 2020 2020  t logger")..    
-0000ef80: 2020 2020 7769 7468 2070 6174 6368 2e6d      with patch.m
-0000ef90: 756c 7469 706c 6528 0a20 2020 2020 2020  ultiple(.       
-0000efa0: 2020 2020 206c 6f67 6769 6e67 2e72 6f6f       logging.roo
-0000efb0: 742c 0a20 2020 2020 2020 2020 2020 2064  t,.            d
-0000efc0: 6562 7567 3d66 6169 6c2c 0a20 2020 2020  ebug=fail,.     
-0000efd0: 2020 2020 2020 2069 6e66 6f3d 6661 696c         info=fail
-0000efe0: 2c0a 2020 2020 2020 2020 2020 2020 7761  ,.            wa
-0000eff0: 726e 696e 673d 6661 696c 2c0a 2020 2020  rning=fail,.    
-0000f000: 2020 2020 2020 2020 6572 726f 723d 6661          error=fa
-0000f010: 696c 2c0a 2020 2020 2020 2020 2020 2020  il,.            
-0000f020: 6372 6974 6963 616c 3d66 6169 6c2c 0a20  critical=fail,. 
-0000f030: 2020 2020 2020 2020 2020 206c 6f67 3d66             log=f
-0000f040: 6169 6c2c 0a20 2020 2020 2020 2029 3a0a  ail,.        ):.
-0000f050: 2020 2020 2020 2020 2020 2020 6666 2854              ff(T
-0000f060: 4849 535f 4449 5220 2f20 2275 7469 6c2e  HIS_DIR / "util.
-0000f070: 7079 2229 0a0a 2020 2020 6465 6620 7465  py")..    def te
-0000f080: 7374 5f69 6e76 616c 6964 5f63 6f6e 6669  st_invalid_confi
-0000f090: 675f 7265 7475 726e 5f63 6f64 6528 7365  g_return_code(se
-0000f0a0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000f0b0: 2020 2020 2074 6d70 5f66 696c 6520 3d20       tmp_file = 
-0000f0c0: 5061 7468 2862 6c61 636b 2e64 756d 705f  Path(black.dump_
-0000f0d0: 746f 5f66 696c 6528 2929 0a20 2020 2020  to_file()).     
-0000f0e0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000f0f0: 2020 2020 746d 705f 636f 6e66 6967 203d      tmp_config =
-0000f100: 2050 6174 6828 626c 6163 6b2e 6475 6d70   Path(black.dump
-0000f110: 5f74 6f5f 6669 6c65 2829 290a 2020 2020  _to_file()).    
-0000f120: 2020 2020 2020 2020 746d 705f 636f 6e66          tmp_conf
-0000f130: 6967 2e75 6e6c 696e 6b28 290a 2020 2020  ig.unlink().    
-0000f140: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
-0000f150: 222d 2d63 6f6e 6669 6722 2c20 7374 7228  "--config", str(
-0000f160: 746d 705f 636f 6e66 6967 292c 2073 7472  tmp_config), str
-0000f170: 2874 6d70 5f66 696c 6529 5d0a 2020 2020  (tmp_file)].    
-0000f180: 2020 2020 2020 2020 7365 6c66 2e69 6e76          self.inv
-0000f190: 6f6b 6542 6c61 636b 2861 7267 732c 2065  okeBlack(args, e
-0000f1a0: 7869 745f 636f 6465 3d32 2c20 6967 6e6f  xit_code=2, igno
-0000f1b0: 7265 5f63 6f6e 6669 673d 4661 6c73 6529  re_config=False)
-0000f1c0: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
-0000f1d0: 3a0a 2020 2020 2020 2020 2020 2020 746d  :.            tm
-0000f1e0: 705f 6669 6c65 2e75 6e6c 696e 6b28 290a  p_file.unlink().
-0000f1f0: 0a20 2020 2064 6566 2074 6573 745f 7061  .    def test_pa
-0000f200: 7273 655f 7079 7072 6f6a 6563 745f 746f  rse_pyproject_to
-0000f210: 6d6c 2873 656c 6629 202d 3e20 4e6f 6e65  ml(self) -> None
-0000f220: 3a0a 2020 2020 2020 2020 7465 7374 5f74  :.        test_t
-0000f230: 6f6d 6c5f 6669 6c65 203d 2054 4849 535f  oml_file = THIS_
-0000f240: 4449 5220 2f20 2274 6573 742e 746f 6d6c  DIR / "test.toml
-0000f250: 220a 2020 2020 2020 2020 636f 6e66 6967  ".        config
-0000f260: 203d 2062 6c61 636b 2e70 6172 7365 5f70   = black.parse_p
-0000f270: 7970 726f 6a65 6374 5f74 6f6d 6c28 7374  yproject_toml(st
-0000f280: 7228 7465 7374 5f74 6f6d 6c5f 6669 6c65  r(test_toml_file
-0000f290: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-0000f2a0: 6173 7365 7274 4571 7561 6c28 636f 6e66  assertEqual(conf
-0000f2b0: 6967 5b22 7665 7262 6f73 6522 5d2c 2031  ig["verbose"], 1
-0000f2c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000f2d0: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-0000f2e0: 675b 2263 6865 636b 225d 2c20 226e 6f22  g["check"], "no"
-0000f2f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0000f300: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-0000f310: 675b 2264 6966 6622 5d2c 2022 7922 290a  g["diff"], "y").
-0000f320: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000f330: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-0000f340: 2263 6f6c 6f72 225d 2c20 5472 7565 290a  "color"], True).
-0000f350: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000f360: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-0000f370: 226c 696e 655f 6c65 6e67 7468 225d 2c20  "line_length"], 
-0000f380: 3739 290a 2020 2020 2020 2020 7365 6c66  79).        self
-0000f390: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-0000f3a0: 6669 675b 2274 6172 6765 745f 7665 7273  fig["target_vers
-0000f3b0: 696f 6e22 5d2c 205b 2270 7933 3622 2c20  ion"], ["py36", 
-0000f3c0: 2270 7933 3722 2c20 2270 7933 3822 5d29  "py37", "py38"])
-0000f3d0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0000f3e0: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
-0000f3f0: 5b22 7079 7468 6f6e 5f63 656c 6c5f 6d61  ["python_cell_ma
-0000f400: 6769 6373 225d 2c20 5b22 6375 7374 6f6d  gics"], ["custom
-0000f410: 3122 2c20 2263 7573 746f 6d32 225d 290a  1", "custom2"]).
-0000f420: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000f430: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-0000f440: 2265 7863 6c75 6465 225d 2c20 7222 5c2e  "exclude"], r"\.
-0000f450: 7079 693f 2422 290a 2020 2020 2020 2020  pyi?$").        
-0000f460: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000f470: 2863 6f6e 6669 675b 2269 6e63 6c75 6465  (config["include
-0000f480: 225d 2c20 7222 5c2e 7079 3f24 2229 0a0a  "], r"\.py?$")..
-0000f490: 2020 2020 6465 6620 7465 7374 5f73 7065      def test_spe
-0000f4a0: 6c6c 6368 6563 6b5f 7079 7072 6f6a 6563  llcheck_pyprojec
-0000f4b0: 745f 746f 6d6c 2873 656c 6629 202d 3e20  t_toml(self) -> 
-0000f4c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7465  None:.        te
-0000f4d0: 7374 5f74 6f6d 6c5f 6669 6c65 203d 2054  st_toml_file = T
-0000f4e0: 4849 535f 4449 5220 2f20 2264 6174 6122  HIS_DIR / "data"
-0000f4f0: 202f 2022 696e 636f 7272 6563 745f 7370   / "incorrect_sp
-0000f500: 656c 6c69 6e67 2e74 6f6d 6c22 0a20 2020  elling.toml".   
-0000f510: 2020 2020 2072 6573 756c 7420 3d20 426c       result = Bl
-0000f520: 6163 6b52 756e 6e65 7228 292e 696e 766f  ackRunner().invo
-0000f530: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
-0000f540: 626c 6163 6b2e 6d61 696e 2c0a 2020 2020  black.main,.    
-0000f550: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
-0000f560: 2020 2020 2020 2020 2020 222d 2d63 6f64            "--cod
-0000f570: 653d 7072 696e 7428 2768 656c 6c6f 2077  e=print('hello w
-0000f580: 6f72 6c64 2729 222c 0a20 2020 2020 2020  orld')",.       
-0000f590: 2020 2020 2020 2020 2022 2d2d 7665 7262           "--verb
-0000f5a0: 6f73 6522 2c0a 2020 2020 2020 2020 2020  ose",.          
-0000f5b0: 2020 2020 2020 6622 2d2d 636f 6e66 6967        f"--config
-0000f5c0: 3d7b 7374 7228 7465 7374 5f74 6f6d 6c5f  ={str(test_toml_
-0000f5d0: 6669 6c65 297d 222c 0a20 2020 2020 2020  file)}",.       
-0000f5e0: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
-0000f5f0: 290a 0a20 2020 2020 2020 2061 7373 6572  )..        asser
-0000f600: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
-0000f610: 7222 496e 7661 6c69 6420 636f 6e66 6967  r"Invalid config
-0000f620: 206b 6579 7320 6465 7465 6374 6564 3a20   keys detected: 
-0000f630: 2769 6e65 5f6c 656e 6774 6827 2c20 2774  'ine_length', 't
-0000f640: 6172 6765 745f 6572 7369 6f6e 2720 2869  arget_ersion' (i
-0000f650: 6e22 0a20 2020 2020 2020 2020 2020 2072  n".            r
-0000f660: 6622 207b 7465 7374 5f74 6f6d 6c5f 6669  f" {test_toml_fi
-0000f670: 6c65 7d29 2220 696e 2072 6573 756c 742e  le})" in result.
-0000f680: 7374 6465 7272 0a20 2020 2020 2020 2029  stderr.        )
-0000f690: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
-0000f6a0: 6172 7365 5f70 7970 726f 6a65 6374 5f74  arse_pyproject_t
-0000f6b0: 6f6d 6c5f 7072 6f6a 6563 745f 6d65 7461  oml_project_meta
-0000f6c0: 6461 7461 2873 656c 6629 202d 3e20 4e6f  data(self) -> No
-0000f6d0: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
-0000f6e0: 7465 7374 5f74 6f6d 6c2c 2065 7870 6563  test_toml, expec
-0000f6f0: 7465 6420 696e 205b 0a20 2020 2020 2020  ted in [.       
-0000f700: 2020 2020 2028 226f 6e6c 795f 626c 6163       ("only_blac
-0000f710: 6b5f 7079 7072 6f6a 6563 742e 746f 6d6c  k_pyproject.toml
-0000f720: 222c 205b 2270 7933 3130 225d 292c 0a20  ", ["py310"]),. 
-0000f730: 2020 2020 2020 2020 2020 2028 226f 6e6c             ("onl
-0000f740: 795f 6d65 7461 6461 7461 5f70 7970 726f  y_metadata_pypro
-0000f750: 6a65 6374 2e74 6f6d 6c22 2c20 5b22 7079  ject.toml", ["py
-0000f760: 3337 222c 2022 7079 3338 222c 2022 7079  37", "py38", "py
-0000f770: 3339 222c 2022 7079 3331 3022 5d29 2c0a  39", "py310"]),.
-0000f780: 2020 2020 2020 2020 2020 2020 2822 6e65              ("ne
-0000f790: 6974 6865 725f 7079 7072 6f6a 6563 742e  ither_pyproject.
-0000f7a0: 746f 6d6c 222c 204e 6f6e 6529 2c0a 2020  toml", None),.  
-0000f7b0: 2020 2020 2020 2020 2020 2822 626f 7468            ("both
-0000f7c0: 5f70 7970 726f 6a65 6374 2e74 6f6d 6c22  _pyproject.toml"
-0000f7d0: 2c20 5b22 7079 3331 3022 5d29 2c0a 2020  , ["py310"]),.  
-0000f7e0: 2020 2020 2020 5d3a 0a20 2020 2020 2020        ]:.       
-0000f7f0: 2020 2020 2074 6573 745f 746f 6d6c 5f66       test_toml_f
-0000f800: 696c 6520 3d20 5448 4953 5f44 4952 202f  ile = THIS_DIR /
-0000f810: 2022 6461 7461 2220 2f20 2270 726f 6a65   "data" / "proje
-0000f820: 6374 5f6d 6574 6164 6174 6122 202f 2074  ct_metadata" / t
-0000f830: 6573 745f 746f 6d6c 0a20 2020 2020 2020  est_toml.       
-0000f840: 2020 2020 2063 6f6e 6669 6720 3d20 626c       config = bl
-0000f850: 6163 6b2e 7061 7273 655f 7079 7072 6f6a  ack.parse_pyproj
-0000f860: 6563 745f 746f 6d6c 2873 7472 2874 6573  ect_toml(str(tes
-0000f870: 745f 746f 6d6c 5f66 696c 6529 290a 2020  t_toml_file)).  
-0000f880: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000f890: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-0000f8a0: 672e 6765 7428 2274 6172 6765 745f 7665  g.get("target_ve
-0000f8b0: 7273 696f 6e22 292c 2065 7870 6563 7465  rsion"), expecte
-0000f8c0: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
-0000f8d0: 5f69 6e66 6572 5f74 6172 6765 745f 7665  _infer_target_ve
-0000f8e0: 7273 696f 6e28 7365 6c66 2920 2d3e 204e  rsion(self) -> N
-0000f8f0: 6f6e 653a 0a20 2020 2020 2020 2066 6f72  one:.        for
-0000f900: 2076 6572 7369 6f6e 2c20 6578 7065 6374   version, expect
-0000f910: 6564 2069 6e20 5b0a 2020 2020 2020 2020  ed in [.        
-0000f920: 2020 2020 2822 332e 3622 2c20 5b54 6172      ("3.6", [Tar
-0000f930: 6765 7456 6572 7369 6f6e 2e50 5933 365d  getVersion.PY36]
-0000f940: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-0000f950: 2233 2e31 312e 3072 6331 222c 205b 5461  "3.11.0rc1", [Ta
-0000f960: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
-0000f970: 315d 292c 0a20 2020 2020 2020 2020 2020  1]),.           
-0000f980: 2028 223e 3d33 2e31 3022 2c20 5b54 6172   (">=3.10", [Tar
-0000f990: 6765 7456 6572 7369 6f6e 2e50 5933 3130  getVersion.PY310
-0000f9a0: 2c20 5461 7267 6574 5665 7273 696f 6e2e  , TargetVersion.
-0000f9b0: 5059 3331 312c 2054 6172 6765 7456 6572  PY311, TargetVer
-0000f9c0: 7369 6f6e 2e50 5933 3132 5d29 2c0a 2020  sion.PY312]),.  
-0000f9d0: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-0000f9e0: 2020 2020 2020 2020 2020 2020 223e 3d33              ">=3
-0000f9f0: 2e31 302e 3622 2c0a 2020 2020 2020 2020  .10.6",.        
-0000fa00: 2020 2020 2020 2020 5b54 6172 6765 7456          [TargetV
-0000fa10: 6572 7369 6f6e 2e50 5933 3130 2c20 5461  ersion.PY310, Ta
-0000fa20: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
-0000fa30: 312c 2054 6172 6765 7456 6572 7369 6f6e  1, TargetVersion
-0000fa40: 2e50 5933 3132 5d2c 0a20 2020 2020 2020  .PY312],.       
-0000fa50: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-0000fa60: 2020 2020 2822 3c33 2e36 222c 205b 5461      ("<3.6", [Ta
-0000fa70: 7267 6574 5665 7273 696f 6e2e 5059 3333  rgetVersion.PY33
-0000fa80: 2c20 5461 7267 6574 5665 7273 696f 6e2e  , TargetVersion.
-0000fa90: 5059 3334 2c20 5461 7267 6574 5665 7273  PY34, TargetVers
-0000faa0: 696f 6e2e 5059 3335 5d29 2c0a 2020 2020  ion.PY35]),.    
-0000fab0: 2020 2020 2020 2020 2822 3e33 2e37 2c3c          (">3.7,<
-0000fac0: 332e 3130 222c 205b 5461 7267 6574 5665  3.10", [TargetVe
-0000fad0: 7273 696f 6e2e 5059 3338 2c20 5461 7267  rsion.PY38, Targ
-0000fae0: 6574 5665 7273 696f 6e2e 5059 3339 5d29  etVersion.PY39])
-0000faf0: 2c0a 2020 2020 2020 2020 2020 2020 280a  ,.            (.
-0000fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb10: 223e 332e 372c 213d 332e 382c 213d 332e  ">3.7,!=3.8,!=3.
-0000fb20: 3922 2c0a 2020 2020 2020 2020 2020 2020  9",.            
-0000fb30: 2020 2020 5b54 6172 6765 7456 6572 7369      [TargetVersi
-0000fb40: 6f6e 2e50 5933 3130 2c20 5461 7267 6574  on.PY310, Target
-0000fb50: 5665 7273 696f 6e2e 5059 3331 312c 2054  Version.PY311, T
-0000fb60: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
-0000fb70: 3132 5d2c 0a20 2020 2020 2020 2020 2020  12],.           
-0000fb80: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-0000fb90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000fba0: 2020 223e 2033 2e39 2e34 2c20 213d 2033    "> 3.9.4, != 3
-0000fbb0: 2e31 302e 3322 2c0a 2020 2020 2020 2020  .10.3",.        
-0000fbc0: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
-0000fbd0: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
-0000fbe0: 7267 6574 5665 7273 696f 6e2e 5059 3339  rgetVersion.PY39
-0000fbf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000fc00: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
-0000fc10: 696f 6e2e 5059 3331 302c 0a20 2020 2020  ion.PY310,.     
-0000fc20: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0000fc30: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
-0000fc40: 3131 2c0a 2020 2020 2020 2020 2020 2020  11,.            
-0000fc50: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-0000fc60: 7273 696f 6e2e 5059 3331 322c 0a20 2020  rsion.PY312,.   
-0000fc70: 2020 2020 2020 2020 2020 2020 205d 2c0a               ],.
-0000fc80: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-0000fc90: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
-0000fca0: 2020 2020 2020 2020 2020 2020 2022 213d               "!=
-0000fcb0: 332e 332c 213d 332e 3422 2c0a 2020 2020  3.3,!=3.4",.    
-0000fcc0: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
-0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fce0: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
-0000fcf0: 5059 3335 2c0a 2020 2020 2020 2020 2020  PY35,.          
-0000fd00: 2020 2020 2020 2020 2020 5461 7267 6574            Target
-0000fd10: 5665 7273 696f 6e2e 5059 3336 2c0a 2020  Version.PY36,.  
-0000fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd30: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
-0000fd40: 5059 3337 2c0a 2020 2020 2020 2020 2020  PY37,.          
-0000fd50: 2020 2020 2020 2020 2020 5461 7267 6574            Target
-0000fd60: 5665 7273 696f 6e2e 5059 3338 2c0a 2020  Version.PY38,.  
-0000fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd80: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
-0000fd90: 5059 3339 2c0a 2020 2020 2020 2020 2020  PY39,.          
-0000fda0: 2020 2020 2020 2020 2020 5461 7267 6574            Target
-0000fdb0: 5665 7273 696f 6e2e 5059 3331 302c 0a20  Version.PY310,. 
-0000fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdd0: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
-0000fde0: 2e50 5933 3131 2c0a 2020 2020 2020 2020  .PY311,.        
-0000fdf0: 2020 2020 2020 2020 2020 2020 5461 7267              Targ
-0000fe00: 6574 5665 7273 696f 6e2e 5059 3331 322c  etVersion.PY312,
-0000fe10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fe20: 205d 2c0a 2020 2020 2020 2020 2020 2020   ],.            
-0000fe30: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
-0000fe40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fe50: 2022 3d3d 332e 2a22 2c0a 2020 2020 2020   "==3.*",.      
-0000fe60: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
-0000fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe80: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-0000fe90: 3333 2c0a 2020 2020 2020 2020 2020 2020  33,.            
-0000fea0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-0000feb0: 7273 696f 6e2e 5059 3334 2c0a 2020 2020  rsion.PY34,.    
-0000fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fed0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-0000fee0: 3335 2c0a 2020 2020 2020 2020 2020 2020  35,.            
-0000fef0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-0000ff00: 7273 696f 6e2e 5059 3336 2c0a 2020 2020  rsion.PY36,.    
-0000ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff20: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-0000ff30: 3337 2c0a 2020 2020 2020 2020 2020 2020  37,.            
-0000ff40: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-0000ff50: 7273 696f 6e2e 5059 3338 2c0a 2020 2020  rsion.PY38,.    
+00005b60: 7061 7468 5f69 676e 6f72 6564 2850 6174  path_ignored(Pat
+00005b70: 6828 2277 6174 2229 2c20 226e 6f20 6d61  h("wat"), "no ma
+00005b80: 7463 6822 290a 2020 2020 2020 2020 2020  tch").          
+00005b90: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005ba0: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
+00005bb0: 292c 2035 290a 2020 2020 2020 2020 2020  ), 5).          
+00005bc0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005bd0: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
+00005be0: 292c 2032 290a 2020 2020 2020 2020 2020  ), 2).          
+00005bf0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005c00: 616c 286f 7574 5f6c 696e 6573 5b2d 315d  al(out_lines[-1]
+00005c10: 2c20 2277 6174 2069 676e 6f72 6564 3a20  , "wat ignored: 
+00005c20: 6e6f 206d 6174 6368 2229 0a20 2020 2020  no match").     
+00005c30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00005c40: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00005c50: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+00005c60: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+00005c70: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00005c80: 3220 6669 6c65 7320 7265 666f 726d 6174  2 files reformat
+00005c90: 7465 642c 2032 2066 696c 6573 206c 6566  ted, 2 files lef
+00005ca0: 7420 756e 6368 616e 6765 642c 2032 2066  t unchanged, 2 f
+00005cb0: 696c 6573 2066 6169 6c65 6420 746f 220a  iles failed to".
+00005cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005cd0: 2220 7265 666f 726d 6174 2e22 2c0a 2020  " reformat.",.  
+00005ce0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00005cf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005d00: 6572 7445 7175 616c 2872 6570 6f72 742e  ertEqual(report.
+00005d10: 7265 7475 726e 5f63 6f64 652c 2031 3233  return_code, 123
+00005d20: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00005d30: 706f 7274 2e64 6f6e 6528 5061 7468 2822  port.done(Path("
+00005d40: 6634 2229 2c20 626c 6163 6b2e 4368 616e  f4"), black.Chan
+00005d50: 6765 642e 4e4f 290a 2020 2020 2020 2020  ged.NO).        
+00005d60: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005d70: 7175 616c 286c 656e 286f 7574 5f6c 696e  qual(len(out_lin
+00005d80: 6573 292c 2036 290a 2020 2020 2020 2020  es), 6).        
+00005d90: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005da0: 7175 616c 286c 656e 2865 7272 5f6c 696e  qual(len(err_lin
+00005db0: 6573 292c 2032 290a 2020 2020 2020 2020  es), 2).        
+00005dc0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00005dd0: 7175 616c 286f 7574 5f6c 696e 6573 5b2d  qual(out_lines[-
+00005de0: 315d 2c20 2266 3420 616c 7265 6164 7920  1], "f4 already 
+00005df0: 7765 6c6c 2066 6f72 6d61 7474 6564 2c20  well formatted, 
+00005e00: 676f 6f64 206a 6f62 2e22 290a 2020 2020  good job.").    
+00005e10: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00005e20: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00005e30: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
+00005e40: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
+00005e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e60: 2232 2066 696c 6573 2072 6566 6f72 6d61  "2 files reforma
+00005e70: 7474 6564 2c20 3320 6669 6c65 7320 6c65  tted, 3 files le
+00005e80: 6674 2075 6e63 6861 6e67 6564 2c20 3220  ft unchanged, 2 
+00005e90: 6669 6c65 7320 6661 696c 6564 2074 6f22  files failed to"
+00005ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005eb0: 2022 2072 6566 6f72 6d61 742e 222c 0a20   " reformat.",. 
+00005ec0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00005ed0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00005ee0: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00005ef0: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
+00005f00: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
+00005f10: 6570 6f72 742e 6368 6563 6b20 3d20 5472  eport.check = Tr
+00005f20: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
+00005f30: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00005f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005f50: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
+00005f60: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
+00005f70: 2020 2020 2020 2022 3220 6669 6c65 7320         "2 files 
+00005f80: 776f 756c 6420 6265 2072 6566 6f72 6d61  would be reforma
+00005f90: 7474 6564 2c20 3320 6669 6c65 7320 776f  tted, 3 files wo
+00005fa0: 756c 6420 6265 206c 6566 7420 756e 6368  uld be left unch
+00005fb0: 616e 6765 642c 2032 220a 2020 2020 2020  anged, 2".      
+00005fc0: 2020 2020 2020 2020 2020 2220 6669 6c65            " file
+00005fd0: 7320 776f 756c 6420 6661 696c 2074 6f20  s would fail to 
+00005fe0: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
+00005ff0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00006000: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
+00006010: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
+00006020: 2020 2020 2020 2072 6570 6f72 742e 6469         report.di
+00006030: 6666 203d 2054 7275 650a 2020 2020 2020  ff = True.      
+00006040: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006050: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00006060: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
+00006070: 7374 7228 7265 706f 7274 2929 2c0a 2020  str(report)),.  
+00006080: 2020 2020 2020 2020 2020 2020 2020 2232                "2
+00006090: 2066 696c 6573 2077 6f75 6c64 2062 6520   files would be 
+000060a0: 7265 666f 726d 6174 7465 642c 2033 2066  reformatted, 3 f
+000060b0: 696c 6573 2077 6f75 6c64 2062 6520 6c65  iles would be le
+000060c0: 6674 2075 6e63 6861 6e67 6564 2c20 3222  ft unchanged, 2"
+000060d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000060e0: 2022 2066 696c 6573 2077 6f75 6c64 2066   " files would f
+000060f0: 6169 6c20 746f 2072 6566 6f72 6d61 742e  ail to reformat.
+00006100: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
+00006110: 0a0a 2020 2020 6465 6620 7465 7374 5f72  ..    def test_r
+00006120: 6570 6f72 745f 7175 6965 7428 7365 6c66  eport_quiet(self
+00006130: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00006140: 2020 2072 6570 6f72 7420 3d20 5265 706f     report = Repo
+00006150: 7274 2871 7569 6574 3d54 7275 6529 0a20  rt(quiet=True). 
+00006160: 2020 2020 2020 206f 7574 5f6c 696e 6573         out_lines
+00006170: 203d 205b 5d0a 2020 2020 2020 2020 6572   = [].        er
+00006180: 725f 6c69 6e65 7320 3d20 5b5d 0a0a 2020  r_lines = []..  
+00006190: 2020 2020 2020 6465 6620 6f75 7428 6d73        def out(ms
+000061a0: 673a 2073 7472 2c20 2a2a 6b77 6172 6773  g: str, **kwargs
+000061b0: 3a20 416e 7929 202d 3e20 4e6f 6e65 3a0a  : Any) -> None:.
+000061c0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+000061d0: 6c69 6e65 732e 6170 7065 6e64 286d 7367  lines.append(msg
+000061e0: 290a 0a20 2020 2020 2020 2064 6566 2065  )..        def e
+000061f0: 7272 286d 7367 3a20 7374 722c 202a 2a6b  rr(msg: str, **k
+00006200: 7761 7267 733a 2041 6e79 2920 2d3e 204e  wargs: Any) -> N
+00006210: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00006220: 2065 7272 5f6c 696e 6573 2e61 7070 656e   err_lines.appen
+00006230: 6428 6d73 6729 0a0a 2020 2020 2020 2020  d(msg)..        
+00006240: 7769 7468 2070 6174 6368 2822 626c 6163  with patch("blac
+00006250: 6b2e 6f75 7470 7574 2e5f 6f75 7422 2c20  k.output._out", 
+00006260: 6f75 7429 2c20 7061 7463 6828 2262 6c61  out), patch("bla
+00006270: 636b 2e6f 7574 7075 742e 5f65 7272 222c  ck.output._err",
+00006280: 2065 7272 293a 0a20 2020 2020 2020 2020   err):.         
+00006290: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
+000062a0: 6174 6828 2266 3122 292c 2062 6c61 636b  ath("f1"), black
+000062b0: 2e43 6861 6e67 6564 2e4e 4f29 0a20 2020  .Changed.NO).   
+000062c0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000062d0: 7365 7274 4571 7561 6c28 6c65 6e28 6f75  sertEqual(len(ou
+000062e0: 745f 6c69 6e65 7329 2c20 3029 0a20 2020  t_lines), 0).   
+000062f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006300: 7365 7274 4571 7561 6c28 6c65 6e28 6572  sertEqual(len(er
+00006310: 725f 6c69 6e65 7329 2c20 3029 0a20 2020  r_lines), 0).   
+00006320: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006330: 7365 7274 4571 7561 6c28 756e 7374 796c  sertEqual(unstyl
+00006340: 6528 7374 7228 7265 706f 7274 2929 2c20  e(str(report)), 
+00006350: 2231 2066 696c 6520 6c65 6674 2075 6e63  "1 file left unc
+00006360: 6861 6e67 6564 2e22 290a 2020 2020 2020  hanged.").      
+00006370: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006380: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
+00006390: 7475 726e 5f63 6f64 652c 2030 290a 2020  turn_code, 0).  
+000063a0: 2020 2020 2020 2020 2020 7265 706f 7274            report
+000063b0: 2e64 6f6e 6528 5061 7468 2822 6632 2229  .done(Path("f2")
+000063c0: 2c20 626c 6163 6b2e 4368 616e 6765 642e  , black.Changed.
+000063d0: 5945 5329 0a20 2020 2020 2020 2020 2020  YES).           
+000063e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000063f0: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
+00006400: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
+00006410: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00006420: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
+00006430: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
+00006440: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00006450: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00006460: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
+00006470: 6570 6f72 7429 292c 2022 3120 6669 6c65  eport)), "1 file
+00006480: 2072 6566 6f72 6d61 7474 6564 2c20 3120   reformatted, 1 
+00006490: 6669 6c65 206c 6566 7420 756e 6368 616e  file left unchan
+000064a0: 6765 642e 220a 2020 2020 2020 2020 2020  ged.".          
+000064b0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+000064c0: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
+000064d0: 2822 6633 2229 2c20 626c 6163 6b2e 4368  ("f3"), black.Ch
+000064e0: 616e 6765 642e 4341 4348 4544 290a 2020  anged.CACHED).  
+000064f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006500: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00006510: 7574 5f6c 696e 6573 292c 2030 290a 2020  ut_lines), 0).  
+00006520: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006530: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+00006540: 7272 5f6c 696e 6573 292c 2030 290a 2020  rr_lines), 0).  
+00006550: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006560: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00006570: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00006580: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00006590: 2c20 2231 2066 696c 6520 7265 666f 726d  , "1 file reform
+000065a0: 6174 7465 642c 2032 2066 696c 6573 206c  atted, 2 files l
+000065b0: 6566 7420 756e 6368 616e 6765 642e 220a  eft unchanged.".
+000065c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000065d0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000065e0: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+000065f0: 742e 7265 7475 726e 5f63 6f64 652c 2030  t.return_code, 0
+00006600: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00006610: 706f 7274 2e63 6865 636b 203d 2054 7275  port.check = Tru
+00006620: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+00006630: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
+00006640: 6570 6f72 742e 7265 7475 726e 5f63 6f64  eport.return_cod
+00006650: 652c 2031 290a 2020 2020 2020 2020 2020  e, 1).          
+00006660: 2020 7265 706f 7274 2e63 6865 636b 203d    report.check =
+00006670: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+00006680: 2020 2072 6570 6f72 742e 6661 696c 6564     report.failed
+00006690: 2850 6174 6828 2265 3122 292c 2022 626f  (Path("e1"), "bo
+000066a0: 6f6d 2229 0a20 2020 2020 2020 2020 2020  om").           
+000066b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000066c0: 6c28 6c65 6e28 6f75 745f 6c69 6e65 7329  l(len(out_lines)
+000066d0: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
+000066e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000066f0: 6c28 6c65 6e28 6572 725f 6c69 6e65 7329  l(len(err_lines)
+00006700: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
+00006710: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00006720: 6c28 6572 725f 6c69 6e65 735b 2d31 5d2c  l(err_lines[-1],
+00006730: 2022 6572 726f 723a 2063 616e 6e6f 7420   "error: cannot 
+00006740: 666f 726d 6174 2065 313a 2062 6f6f 6d22  format e1: boom"
+00006750: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006760: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+00006770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006780: 756e 7374 796c 6528 7374 7228 7265 706f  unstyle(str(repo
+00006790: 7274 2929 2c0a 2020 2020 2020 2020 2020  rt)),.          
+000067a0: 2020 2020 2020 2231 2066 696c 6520 7265        "1 file re
+000067b0: 666f 726d 6174 7465 642c 2032 2066 696c  formatted, 2 fil
+000067c0: 6573 206c 6566 7420 756e 6368 616e 6765  es left unchange
+000067d0: 642c 2031 2066 696c 6520 6661 696c 6564  d, 1 file failed
+000067e0: 2074 6f22 0a20 2020 2020 2020 2020 2020   to".           
+000067f0: 2020 2020 2022 2072 6566 6f72 6d61 742e       " reformat.
+00006800: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
+00006810: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00006820: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+00006830: 706f 7274 2e72 6574 7572 6e5f 636f 6465  port.return_code
+00006840: 2c20 3132 3329 0a20 2020 2020 2020 2020  , 123).         
+00006850: 2020 2072 6570 6f72 742e 646f 6e65 2850     report.done(P
+00006860: 6174 6828 2266 3322 292c 2062 6c61 636b  ath("f3"), black
+00006870: 2e43 6861 6e67 6564 2e59 4553 290a 2020  .Changed.YES).  
+00006880: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00006890: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+000068a0: 7574 5f6c 696e 6573 292c 2030 290a 2020  ut_lines), 0).  
+000068b0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000068c0: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+000068d0: 7272 5f6c 696e 6573 292c 2031 290a 2020  rr_lines), 1).  
+000068e0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000068f0: 7373 6572 7445 7175 616c 280a 2020 2020  ssertEqual(.    
+00006900: 2020 2020 2020 2020 2020 2020 756e 7374              unst
+00006910: 796c 6528 7374 7228 7265 706f 7274 2929  yle(str(report))
+00006920: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006930: 2020 2232 2066 696c 6573 2072 6566 6f72    "2 files refor
+00006940: 6d61 7474 6564 2c20 3220 6669 6c65 7320  matted, 2 files 
+00006950: 6c65 6674 2075 6e63 6861 6e67 6564 2c20  left unchanged, 
+00006960: 3120 6669 6c65 2066 6169 6c65 6420 746f  1 file failed to
+00006970: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00006980: 2020 2220 7265 666f 726d 6174 2e22 2c0a    " reformat.",.
+00006990: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000069a0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000069b0: 7373 6572 7445 7175 616c 2872 6570 6f72  ssertEqual(repor
+000069c0: 742e 7265 7475 726e 5f63 6f64 652c 2031  t.return_code, 1
+000069d0: 3233 290a 2020 2020 2020 2020 2020 2020  23).            
+000069e0: 7265 706f 7274 2e66 6169 6c65 6428 5061  report.failed(Pa
+000069f0: 7468 2822 6532 2229 2c20 2262 6f6f 6d22  th("e2"), "boom"
+00006a00: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006a10: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00006a20: 656e 286f 7574 5f6c 696e 6573 292c 2030  en(out_lines), 0
+00006a30: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006a40: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+00006a50: 656e 2865 7272 5f6c 696e 6573 292c 2032  en(err_lines), 2
+00006a60: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00006a70: 6c66 2e61 7373 6572 7445 7175 616c 2865  lf.assertEqual(e
+00006a80: 7272 5f6c 696e 6573 5b2d 315d 2c20 2265  rr_lines[-1], "e
+00006a90: 7272 6f72 3a20 6361 6e6e 6f74 2066 6f72  rror: cannot for
+00006aa0: 6d61 7420 6532 3a20 626f 6f6d 2229 0a20  mat e2: boom"). 
+00006ab0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006ac0: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00006ad0: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+00006ae0: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00006af0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00006b00: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
+00006b10: 726d 6174 7465 642c 2032 2066 696c 6573  rmatted, 2 files
+00006b20: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
+00006b30: 2032 2066 696c 6573 2066 6169 6c65 6420   2 files failed 
+00006b40: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
+00006b50: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
+00006b60: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00006b70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006b80: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
+00006b90: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
+00006ba0: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
+00006bb0: 2020 7265 706f 7274 2e70 6174 685f 6967    report.path_ig
+00006bc0: 6e6f 7265 6428 5061 7468 2822 7761 7422  nored(Path("wat"
+00006bd0: 292c 2022 6e6f 206d 6174 6368 2229 0a20  ), "no match"). 
+00006be0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006bf0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00006c00: 6f75 745f 6c69 6e65 7329 2c20 3029 0a20  out_lines), 0). 
+00006c10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006c20: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+00006c30: 6572 725f 6c69 6e65 7329 2c20 3229 0a20  err_lines), 2). 
+00006c40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006c50: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00006c60: 2020 2020 2020 2020 2020 2020 2075 6e73               uns
+00006c70: 7479 6c65 2873 7472 2872 6570 6f72 7429  tyle(str(report)
+00006c80: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00006c90: 2020 2022 3220 6669 6c65 7320 7265 666f     "2 files refo
+00006ca0: 726d 6174 7465 642c 2032 2066 696c 6573  rmatted, 2 files
+00006cb0: 206c 6566 7420 756e 6368 616e 6765 642c   left unchanged,
+00006cc0: 2032 2066 696c 6573 2066 6169 6c65 6420   2 files failed 
+00006cd0: 746f 220a 2020 2020 2020 2020 2020 2020  to".            
+00006ce0: 2020 2020 2220 7265 666f 726d 6174 2e22      " reformat."
+00006cf0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00006d00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006d10: 2e61 7373 6572 7445 7175 616c 2872 6570  .assertEqual(rep
+00006d20: 6f72 742e 7265 7475 726e 5f63 6f64 652c  ort.return_code,
+00006d30: 2031 3233 290a 2020 2020 2020 2020 2020   123).          
+00006d40: 2020 7265 706f 7274 2e64 6f6e 6528 5061    report.done(Pa
+00006d50: 7468 2822 6634 2229 2c20 626c 6163 6b2e  th("f4"), black.
+00006d60: 4368 616e 6765 642e 4e4f 290a 2020 2020  Changed.NO).    
+00006d70: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00006d80: 6572 7445 7175 616c 286c 656e 286f 7574  ertEqual(len(out
+00006d90: 5f6c 696e 6573 292c 2030 290a 2020 2020  _lines), 0).    
+00006da0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00006db0: 6572 7445 7175 616c 286c 656e 2865 7272  ertEqual(len(err
+00006dc0: 5f6c 696e 6573 292c 2032 290a 2020 2020  _lines), 2).    
+00006dd0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00006de0: 6572 7445 7175 616c 280a 2020 2020 2020  ertEqual(.      
+00006df0: 2020 2020 2020 2020 2020 756e 7374 796c            unstyl
+00006e00: 6528 7374 7228 7265 706f 7274 2929 2c0a  e(str(report)),.
+00006e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e20: 2232 2066 696c 6573 2072 6566 6f72 6d61  "2 files reforma
+00006e30: 7474 6564 2c20 3320 6669 6c65 7320 6c65  tted, 3 files le
+00006e40: 6674 2075 6e63 6861 6e67 6564 2c20 3220  ft unchanged, 2 
+00006e50: 6669 6c65 7320 6661 696c 6564 2074 6f22  files failed to"
+00006e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006e70: 2022 2072 6566 6f72 6d61 742e 222c 0a20   " reformat.",. 
+00006e80: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00006e90: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00006ea0: 7365 7274 4571 7561 6c28 7265 706f 7274  sertEqual(report
+00006eb0: 2e72 6574 7572 6e5f 636f 6465 2c20 3132  .return_code, 12
+00006ec0: 3329 0a20 2020 2020 2020 2020 2020 2072  3).            r
+00006ed0: 6570 6f72 742e 6368 6563 6b20 3d20 5472  eport.check = Tr
+00006ee0: 7565 0a20 2020 2020 2020 2020 2020 2073  ue.            s
+00006ef0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00006f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006f10: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
+00006f20: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
+00006f30: 2020 2020 2020 2022 3220 6669 6c65 7320         "2 files 
+00006f40: 776f 756c 6420 6265 2072 6566 6f72 6d61  would be reforma
+00006f50: 7474 6564 2c20 3320 6669 6c65 7320 776f  tted, 3 files wo
+00006f60: 756c 6420 6265 206c 6566 7420 756e 6368  uld be left unch
+00006f70: 616e 6765 642c 2032 220a 2020 2020 2020  anged, 2".      
+00006f80: 2020 2020 2020 2020 2020 2220 6669 6c65            " file
+00006f90: 7320 776f 756c 6420 6661 696c 2074 6f20  s would fail to 
+00006fa0: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
+00006fb0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00006fc0: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
+00006fd0: 636b 203d 2046 616c 7365 0a20 2020 2020  ck = False.     
+00006fe0: 2020 2020 2020 2072 6570 6f72 742e 6469         report.di
+00006ff0: 6666 203d 2054 7275 650a 2020 2020 2020  ff = True.      
+00007000: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007010: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00007020: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
+00007030: 7374 7228 7265 706f 7274 2929 2c0a 2020  str(report)),.  
+00007040: 2020 2020 2020 2020 2020 2020 2020 2232                "2
+00007050: 2066 696c 6573 2077 6f75 6c64 2062 6520   files would be 
+00007060: 7265 666f 726d 6174 7465 642c 2033 2066  reformatted, 3 f
+00007070: 696c 6573 2077 6f75 6c64 2062 6520 6c65  iles would be le
+00007080: 6674 2075 6e63 6861 6e67 6564 2c20 3222  ft unchanged, 2"
+00007090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000070a0: 2022 2066 696c 6573 2077 6f75 6c64 2066   " files would f
+000070b0: 6169 6c20 746f 2072 6566 6f72 6d61 742e  ail to reformat.
+000070c0: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
+000070d0: 0a0a 2020 2020 6465 6620 7465 7374 5f72  ..    def test_r
+000070e0: 6570 6f72 745f 6e6f 726d 616c 2873 656c  eport_normal(sel
+000070f0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00007100: 2020 2020 7265 706f 7274 203d 2062 6c61      report = bla
+00007110: 636b 2e52 6570 6f72 7428 290a 2020 2020  ck.Report().    
+00007120: 2020 2020 6f75 745f 6c69 6e65 7320 3d20      out_lines = 
+00007130: 5b5d 0a20 2020 2020 2020 2065 7272 5f6c  [].        err_l
+00007140: 696e 6573 203d 205b 5d0a 0a20 2020 2020  ines = []..     
+00007150: 2020 2064 6566 206f 7574 286d 7367 3a20     def out(msg: 
+00007160: 7374 722c 202a 2a6b 7761 7267 733a 2041  str, **kwargs: A
+00007170: 6e79 2920 2d3e 204e 6f6e 653a 0a20 2020  ny) -> None:.   
+00007180: 2020 2020 2020 2020 206f 7574 5f6c 696e           out_lin
+00007190: 6573 2e61 7070 656e 6428 6d73 6729 0a0a  es.append(msg)..
+000071a0: 2020 2020 2020 2020 6465 6620 6572 7228          def err(
+000071b0: 6d73 673a 2073 7472 2c20 2a2a 6b77 6172  msg: str, **kwar
+000071c0: 6773 3a20 416e 7929 202d 3e20 4e6f 6e65  gs: Any) -> None
+000071d0: 3a0a 2020 2020 2020 2020 2020 2020 6572  :.            er
+000071e0: 725f 6c69 6e65 732e 6170 7065 6e64 286d  r_lines.append(m
+000071f0: 7367 290a 0a20 2020 2020 2020 2077 6974  sg)..        wit
+00007200: 6820 7061 7463 6828 2262 6c61 636b 2e6f  h patch("black.o
+00007210: 7574 7075 742e 5f6f 7574 222c 206f 7574  utput._out", out
+00007220: 292c 2070 6174 6368 2822 626c 6163 6b2e  ), patch("black.
+00007230: 6f75 7470 7574 2e5f 6572 7222 2c20 6572  output._err", er
+00007240: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00007250: 7265 706f 7274 2e64 6f6e 6528 5061 7468  report.done(Path
+00007260: 2822 6631 2229 2c20 626c 6163 6b2e 4368  ("f1"), black.Ch
+00007270: 616e 6765 642e 4e4f 290a 2020 2020 2020  anged.NO).      
+00007280: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007290: 7445 7175 616c 286c 656e 286f 7574 5f6c  tEqual(len(out_l
+000072a0: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
+000072b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000072c0: 7445 7175 616c 286c 656e 2865 7272 5f6c  tEqual(len(err_l
+000072d0: 696e 6573 292c 2030 290a 2020 2020 2020  ines), 0).      
+000072e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000072f0: 7445 7175 616c 2875 6e73 7479 6c65 2873  tEqual(unstyle(s
+00007300: 7472 2872 6570 6f72 7429 292c 2022 3120  tr(report)), "1 
+00007310: 6669 6c65 206c 6566 7420 756e 6368 616e  file left unchan
+00007320: 6765 642e 2229 0a20 2020 2020 2020 2020  ged.").         
+00007330: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007340: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
+00007350: 6e5f 636f 6465 2c20 3029 0a20 2020 2020  n_code, 0).     
+00007360: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
+00007370: 6e65 2850 6174 6828 2266 3222 292c 2062  ne(Path("f2"), b
+00007380: 6c61 636b 2e43 6861 6e67 6564 2e59 4553  lack.Changed.YES
+00007390: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000073a0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+000073b0: 656e 286f 7574 5f6c 696e 6573 292c 2031  en(out_lines), 1
+000073c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000073d0: 6c66 2e61 7373 6572 7445 7175 616c 286c  lf.assertEqual(l
+000073e0: 656e 2865 7272 5f6c 696e 6573 292c 2030  en(err_lines), 0
+000073f0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00007400: 6c66 2e61 7373 6572 7445 7175 616c 286f  lf.assertEqual(o
+00007410: 7574 5f6c 696e 6573 5b2d 315d 2c20 2272  ut_lines[-1], "r
+00007420: 6566 6f72 6d61 7474 6564 2066 3222 290a  eformatted f2").
+00007430: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007440: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+00007450: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00007460: 7374 796c 6528 7374 7228 7265 706f 7274  style(str(report
+00007470: 2929 2c20 2231 2066 696c 6520 7265 666f  )), "1 file refo
+00007480: 726d 6174 7465 642c 2031 2066 696c 6520  rmatted, 1 file 
+00007490: 6c65 6674 2075 6e63 6861 6e67 6564 2e22  left unchanged."
+000074a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000074b0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+000074c0: 742e 646f 6e65 2850 6174 6828 2266 3322  t.done(Path("f3"
+000074d0: 292c 2062 6c61 636b 2e43 6861 6e67 6564  ), black.Changed
+000074e0: 2e43 4143 4845 4429 0a20 2020 2020 2020  .CACHED).       
+000074f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007500: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+00007510: 6e65 7329 2c20 3129 0a20 2020 2020 2020  nes), 1).       
+00007520: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007530: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00007540: 6e65 7329 2c20 3029 0a20 2020 2020 2020  nes), 0).       
+00007550: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007560: 4571 7561 6c28 6f75 745f 6c69 6e65 735b  Equal(out_lines[
+00007570: 2d31 5d2c 2022 7265 666f 726d 6174 7465  -1], "reformatte
+00007580: 6420 6632 2229 0a20 2020 2020 2020 2020  d f2").         
+00007590: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000075a0: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+000075b0: 2020 2020 2075 6e73 7479 6c65 2873 7472       unstyle(str
+000075c0: 2872 6570 6f72 7429 292c 2022 3120 6669  (report)), "1 fi
+000075d0: 6c65 2072 6566 6f72 6d61 7474 6564 2c20  le reformatted, 
+000075e0: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
+000075f0: 6861 6e67 6564 2e22 0a20 2020 2020 2020  hanged.".       
+00007600: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00007610: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007620: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
+00007630: 6e5f 636f 6465 2c20 3029 0a20 2020 2020  n_code, 0).     
+00007640: 2020 2020 2020 2072 6570 6f72 742e 6368         report.ch
+00007650: 6563 6b20 3d20 5472 7565 0a20 2020 2020  eck = True.     
+00007660: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00007670: 7274 4571 7561 6c28 7265 706f 7274 2e72  rtEqual(report.r
+00007680: 6574 7572 6e5f 636f 6465 2c20 3129 0a20  eturn_code, 1). 
+00007690: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+000076a0: 742e 6368 6563 6b20 3d20 4661 6c73 650a  t.check = False.
+000076b0: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+000076c0: 7274 2e66 6169 6c65 6428 5061 7468 2822  rt.failed(Path("
+000076d0: 6531 2229 2c20 2262 6f6f 6d22 290a 2020  e1"), "boom").  
+000076e0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000076f0: 7373 6572 7445 7175 616c 286c 656e 286f  ssertEqual(len(o
+00007700: 7574 5f6c 696e 6573 292c 2031 290a 2020  ut_lines), 1).  
+00007710: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007720: 7373 6572 7445 7175 616c 286c 656e 2865  ssertEqual(len(e
+00007730: 7272 5f6c 696e 6573 292c 2031 290a 2020  rr_lines), 1).  
+00007740: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00007750: 7373 6572 7445 7175 616c 2865 7272 5f6c  ssertEqual(err_l
+00007760: 696e 6573 5b2d 315d 2c20 2265 7272 6f72  ines[-1], "error
+00007770: 3a20 6361 6e6e 6f74 2066 6f72 6d61 7420  : cannot format 
+00007780: 6531 3a20 626f 6f6d 2229 0a20 2020 2020  e1: boom").     
+00007790: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000077a0: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+000077b0: 2020 2020 2020 2020 2075 6e73 7479 6c65           unstyle
+000077c0: 2873 7472 2872 6570 6f72 7429 292c 0a20  (str(report)),. 
+000077d0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000077e0: 3120 6669 6c65 2072 6566 6f72 6d61 7474  1 file reformatt
+000077f0: 6564 2c20 3220 6669 6c65 7320 6c65 6674  ed, 2 files left
+00007800: 2075 6e63 6861 6e67 6564 2c20 3120 6669   unchanged, 1 fi
+00007810: 6c65 2066 6169 6c65 6420 746f 220a 2020  le failed to".  
+00007820: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+00007830: 7265 666f 726d 6174 2e22 2c0a 2020 2020  reformat.",.    
+00007840: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00007850: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007860: 7445 7175 616c 2872 6570 6f72 742e 7265  tEqual(report.re
+00007870: 7475 726e 5f63 6f64 652c 2031 3233 290a  turn_code, 123).
+00007880: 2020 2020 2020 2020 2020 2020 7265 706f              repo
+00007890: 7274 2e64 6f6e 6528 5061 7468 2822 6633  rt.done(Path("f3
+000078a0: 2229 2c20 626c 6163 6b2e 4368 616e 6765  "), black.Change
+000078b0: 642e 5945 5329 0a20 2020 2020 2020 2020  d.YES).         
+000078c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000078d0: 7561 6c28 6c65 6e28 6f75 745f 6c69 6e65  ual(len(out_line
+000078e0: 7329 2c20 3229 0a20 2020 2020 2020 2020  s), 2).         
+000078f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007900: 7561 6c28 6c65 6e28 6572 725f 6c69 6e65  ual(len(err_line
+00007910: 7329 2c20 3129 0a20 2020 2020 2020 2020  s), 1).         
+00007920: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007930: 7561 6c28 6f75 745f 6c69 6e65 735b 2d31  ual(out_lines[-1
+00007940: 5d2c 2022 7265 666f 726d 6174 7465 6420  ], "reformatted 
+00007950: 6633 2229 0a20 2020 2020 2020 2020 2020  f3").           
+00007960: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007970: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00007980: 2020 2075 6e73 7479 6c65 2873 7472 2872     unstyle(str(r
+00007990: 6570 6f72 7429 292c 0a20 2020 2020 2020  eport)),.       
+000079a0: 2020 2020 2020 2020 2022 3220 6669 6c65           "2 file
+000079b0: 7320 7265 666f 726d 6174 7465 642c 2032  s reformatted, 2
+000079c0: 2066 696c 6573 206c 6566 7420 756e 6368   files left unch
+000079d0: 616e 6765 642c 2031 2066 696c 6520 6661  anged, 1 file fa
+000079e0: 696c 6564 2074 6f22 0a20 2020 2020 2020  iled to".       
+000079f0: 2020 2020 2020 2020 2022 2072 6566 6f72           " refor
+00007a00: 6d61 742e 222c 0a20 2020 2020 2020 2020  mat.",.         
+00007a10: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00007a20: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00007a30: 6c28 7265 706f 7274 2e72 6574 7572 6e5f  l(report.return_
+00007a40: 636f 6465 2c20 3132 3329 0a20 2020 2020  code, 123).     
+00007a50: 2020 2020 2020 2072 6570 6f72 742e 6661         report.fa
+00007a60: 696c 6564 2850 6174 6828 2265 3222 292c  iled(Path("e2"),
+00007a70: 2022 626f 6f6d 2229 0a20 2020 2020 2020   "boom").       
+00007a80: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007a90: 4571 7561 6c28 6c65 6e28 6f75 745f 6c69  Equal(len(out_li
+00007aa0: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
+00007ab0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007ac0: 4571 7561 6c28 6c65 6e28 6572 725f 6c69  Equal(len(err_li
+00007ad0: 6e65 7329 2c20 3229 0a20 2020 2020 2020  nes), 2).       
+00007ae0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00007af0: 4571 7561 6c28 6572 725f 6c69 6e65 735b  Equal(err_lines[
+00007b00: 2d31 5d2c 2022 6572 726f 723a 2063 616e  -1], "error: can
+00007b10: 6e6f 7420 666f 726d 6174 2065 323a 2062  not format e2: b
+00007b20: 6f6f 6d22 290a 2020 2020 2020 2020 2020  oom").          
+00007b30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007b40: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00007b50: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00007b60: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00007b70: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
+00007b80: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
+00007b90: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
+00007ba0: 6861 6e67 6564 2c20 3220 6669 6c65 7320  hanged, 2 files 
+00007bb0: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
+00007bc0: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
+00007bd0: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
+00007be0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00007bf0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007c00: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
+00007c10: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
+00007c20: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
+00007c30: 7061 7468 5f69 676e 6f72 6564 2850 6174  path_ignored(Pat
+00007c40: 6828 2277 6174 2229 2c20 226e 6f20 6d61  h("wat"), "no ma
+00007c50: 7463 6822 290a 2020 2020 2020 2020 2020  tch").          
+00007c60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007c70: 616c 286c 656e 286f 7574 5f6c 696e 6573  al(len(out_lines
+00007c80: 292c 2032 290a 2020 2020 2020 2020 2020  ), 2).          
+00007c90: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007ca0: 616c 286c 656e 2865 7272 5f6c 696e 6573  al(len(err_lines
+00007cb0: 292c 2032 290a 2020 2020 2020 2020 2020  ), 2).          
+00007cc0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007cd0: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00007ce0: 2020 2020 756e 7374 796c 6528 7374 7228      unstyle(str(
+00007cf0: 7265 706f 7274 2929 2c0a 2020 2020 2020  report)),.      
+00007d00: 2020 2020 2020 2020 2020 2232 2066 696c            "2 fil
+00007d10: 6573 2072 6566 6f72 6d61 7474 6564 2c20  es reformatted, 
+00007d20: 3220 6669 6c65 7320 6c65 6674 2075 6e63  2 files left unc
+00007d30: 6861 6e67 6564 2c20 3220 6669 6c65 7320  hanged, 2 files 
+00007d40: 6661 696c 6564 2074 6f22 0a20 2020 2020  failed to".     
+00007d50: 2020 2020 2020 2020 2020 2022 2072 6566             " ref
+00007d60: 6f72 6d61 742e 222c 0a20 2020 2020 2020  ormat.",.       
+00007d70: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00007d80: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00007d90: 7561 6c28 7265 706f 7274 2e72 6574 7572  ual(report.retur
+00007da0: 6e5f 636f 6465 2c20 3132 3329 0a20 2020  n_code, 123).   
+00007db0: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
+00007dc0: 646f 6e65 2850 6174 6828 2266 3422 292c  done(Path("f4"),
+00007dd0: 2062 6c61 636b 2e43 6861 6e67 6564 2e4e   black.Changed.N
+00007de0: 4f29 0a20 2020 2020 2020 2020 2020 2073  O).            s
+00007df0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007e00: 6c65 6e28 6f75 745f 6c69 6e65 7329 2c20  len(out_lines), 
+00007e10: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
+00007e20: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007e30: 6c65 6e28 6572 725f 6c69 6e65 7329 2c20  len(err_lines), 
+00007e40: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
+00007e50: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007e70: 2075 6e73 7479 6c65 2873 7472 2872 6570   unstyle(str(rep
+00007e80: 6f72 7429 292c 0a20 2020 2020 2020 2020  ort)),.         
+00007e90: 2020 2020 2020 2022 3220 6669 6c65 7320         "2 files 
+00007ea0: 7265 666f 726d 6174 7465 642c 2033 2066  reformatted, 3 f
+00007eb0: 696c 6573 206c 6566 7420 756e 6368 616e  iles left unchan
+00007ec0: 6765 642c 2032 2066 696c 6573 2066 6169  ged, 2 files fai
+00007ed0: 6c65 6420 746f 220a 2020 2020 2020 2020  led to".        
+00007ee0: 2020 2020 2020 2020 2220 7265 666f 726d          " reform
+00007ef0: 6174 2e22 2c0a 2020 2020 2020 2020 2020  at.",.          
+00007f00: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00007f10: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00007f20: 2872 6570 6f72 742e 7265 7475 726e 5f63  (report.return_c
+00007f30: 6f64 652c 2031 3233 290a 2020 2020 2020  ode, 123).      
+00007f40: 2020 2020 2020 7265 706f 7274 2e63 6865        report.che
+00007f50: 636b 203d 2054 7275 650a 2020 2020 2020  ck = True.      
+00007f60: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00007f70: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00007f80: 2020 2020 2020 2020 756e 7374 796c 6528          unstyle(
+00007f90: 7374 7228 7265 706f 7274 2929 2c0a 2020  str(report)),.  
+00007fa0: 2020 2020 2020 2020 2020 2020 2020 2232                "2
+00007fb0: 2066 696c 6573 2077 6f75 6c64 2062 6520   files would be 
+00007fc0: 7265 666f 726d 6174 7465 642c 2033 2066  reformatted, 3 f
+00007fd0: 696c 6573 2077 6f75 6c64 2062 6520 6c65  iles would be le
+00007fe0: 6674 2075 6e63 6861 6e67 6564 2c20 3222  ft unchanged, 2"
+00007ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008000: 2022 2066 696c 6573 2077 6f75 6c64 2066   " files would f
+00008010: 6169 6c20 746f 2072 6566 6f72 6d61 742e  ail to reformat.
+00008020: 222c 0a20 2020 2020 2020 2020 2020 2029  ",.            )
+00008030: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
+00008040: 6f72 742e 6368 6563 6b20 3d20 4661 6c73  ort.check = Fals
+00008050: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+00008060: 706f 7274 2e64 6966 6620 3d20 5472 7565  port.diff = True
+00008070: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008080: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00008090: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000080a0: 6e73 7479 6c65 2873 7472 2872 6570 6f72  nstyle(str(repor
+000080b0: 7429 292c 0a20 2020 2020 2020 2020 2020  t)),.           
+000080c0: 2020 2020 2022 3220 6669 6c65 7320 776f       "2 files wo
+000080d0: 756c 6420 6265 2072 6566 6f72 6d61 7474  uld be reformatt
+000080e0: 6564 2c20 3320 6669 6c65 7320 776f 756c  ed, 3 files woul
+000080f0: 6420 6265 206c 6566 7420 756e 6368 616e  d be left unchan
+00008100: 6765 642c 2032 220a 2020 2020 2020 2020  ged, 2".        
+00008110: 2020 2020 2020 2020 2220 6669 6c65 7320          " files 
+00008120: 776f 756c 6420 6661 696c 2074 6f20 7265  would fail to re
+00008130: 666f 726d 6174 2e22 2c0a 2020 2020 2020  format.",.      
+00008140: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00008150: 2074 6573 745f 6c69 6232 746f 335f 7061   test_lib2to3_pa
+00008160: 7273 6528 7365 6c66 2920 2d3e 204e 6f6e  rse(self) -> Non
+00008170: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
+00008180: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
+00008190: 7328 626c 6163 6b2e 496e 7661 6c69 6449  s(black.InvalidI
+000081a0: 6e70 7574 293a 0a20 2020 2020 2020 2020  nput):.         
+000081b0: 2020 2062 6c61 636b 2e6c 6962 3274 6f33     black.lib2to3
+000081c0: 5f70 6172 7365 2822 696e 7661 6c69 6420  _parse("invalid 
+000081d0: 7379 6e74 6178 2229 0a0a 2020 2020 2020  syntax")..      
+000081e0: 2020 7374 7261 6464 6c69 6e67 203d 2022    straddling = "
+000081f0: 7820 2b20 7922 0a20 2020 2020 2020 2062  x + y".        b
+00008200: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
+00008210: 7365 2873 7472 6164 646c 696e 6729 0a20  se(straddling). 
+00008220: 2020 2020 2020 2062 6c61 636b 2e6c 6962         black.lib
+00008230: 3274 6f33 5f70 6172 7365 2873 7472 6164  2to3_parse(strad
+00008240: 646c 696e 672c 207b 5461 7267 6574 5665  dling, {TargetVe
+00008250: 7273 696f 6e2e 5059 3336 7d29 0a0a 2020  rsion.PY36})..  
+00008260: 2020 2020 2020 7079 325f 6f6e 6c79 203d        py2_only =
+00008270: 2022 7072 696e 7420 7822 0a20 2020 2020   "print x".     
+00008280: 2020 2077 6974 6820 7365 6c66 2e61 7373     with self.ass
+00008290: 6572 7452 6169 7365 7328 626c 6163 6b2e  ertRaises(black.
+000082a0: 496e 7661 6c69 6449 6e70 7574 293a 0a20  InvalidInput):. 
+000082b0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+000082c0: 2e6c 6962 3274 6f33 5f70 6172 7365 2870  .lib2to3_parse(p
+000082d0: 7932 5f6f 6e6c 792c 207b 5461 7267 6574  y2_only, {Target
+000082e0: 5665 7273 696f 6e2e 5059 3336 7d29 0a0a  Version.PY36})..
+000082f0: 2020 2020 2020 2020 7079 335f 6f6e 6c79          py3_only
+00008300: 203d 2022 6578 6563 2878 2c20 656e 643d   = "exec(x, end=
+00008310: 7929 220a 2020 2020 2020 2020 626c 6163  y)".        blac
+00008320: 6b2e 6c69 6232 746f 335f 7061 7273 6528  k.lib2to3_parse(
+00008330: 7079 335f 6f6e 6c79 290a 2020 2020 2020  py3_only).      
+00008340: 2020 626c 6163 6b2e 6c69 6232 746f 335f    black.lib2to3_
+00008350: 7061 7273 6528 7079 335f 6f6e 6c79 2c20  parse(py3_only, 
+00008360: 7b54 6172 6765 7456 6572 7369 6f6e 2e50  {TargetVersion.P
+00008370: 5933 367d 290a 0a20 2020 2064 6566 2074  Y36})..    def t
+00008380: 6573 745f 6765 745f 6665 6174 7572 6573  est_get_features
+00008390: 5f75 7365 645f 6465 636f 7261 746f 7228  _used_decorator(
+000083a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+000083b0: 2020 2020 2020 2023 2054 6573 7420 7468         # Test th
+000083c0: 6520 6665 6174 7572 6520 6465 7465 6374  e feature detect
+000083d0: 696f 6e20 6f66 206e 6577 2064 6563 6f72  ion of new decor
+000083e0: 6174 6f72 2073 796e 7461 780a 2020 2020  ator syntax.    
+000083f0: 2020 2020 2320 7369 6e63 6520 7468 6973      # since this
+00008400: 206d 616b 6573 2073 6f6d 6520 7465 7374   makes some test
+00008410: 2063 6173 6573 206f 6620 7465 7374 5f67   cases of test_g
+00008420: 6574 5f66 6561 7475 7265 735f 7573 6564  et_features_used
+00008430: 2829 0a20 2020 2020 2020 2023 2066 6169  ().        # fai
+00008440: 6c73 2069 6620 6974 2066 6169 6c73 2c20  ls if it fails, 
+00008450: 7468 6973 2069 7320 7465 7374 6564 2066  this is tested f
+00008460: 6972 7374 2073 6f20 7468 6174 2061 2075  irst so that a u
+00008470: 7365 6675 6c20 6361 7365 0a20 2020 2020  seful case.     
+00008480: 2020 2023 2069 7320 6964 656e 7469 6669     # is identifi
+00008490: 6564 0a20 2020 2020 2020 2073 696d 706c  ed.        simpl
+000084a0: 6573 2c20 7265 6c61 7865 6420 3d20 7265  es, relaxed = re
+000084b0: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
+000084c0: 616e 656f 7573 222c 2022 6465 636f 7261  aneous", "decora
+000084d0: 746f 7273 2229 0a20 2020 2020 2020 2023  tors").        #
+000084e0: 2073 6b69 7020 6578 706c 616e 6174 696f   skip explanatio
+000084f0: 6e20 636f 6d6d 656e 7473 2061 7420 7468  n comments at th
+00008500: 6520 746f 7020 6f66 2074 6865 2066 696c  e top of the fil
+00008510: 650a 2020 2020 2020 2020 666f 7220 7369  e.        for si
+00008520: 6d70 6c65 5f74 6573 7420 696e 2073 696d  mple_test in sim
+00008530: 706c 6573 2e73 706c 6974 2822 2323 2229  ples.split("##")
+00008540: 5b31 3a5d 3a0a 2020 2020 2020 2020 2020  [1:]:.          
+00008550: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
+00008560: 6962 3274 6f33 5f70 6172 7365 2873 696d  ib2to3_parse(sim
+00008570: 706c 655f 7465 7374 290a 2020 2020 2020  ple_test).      
+00008580: 2020 2020 2020 6465 636f 7261 746f 7220        decorator 
+00008590: 3d20 7374 7228 6e6f 6465 2e63 6869 6c64  = str(node.child
+000085a0: 7265 6e5b 305d 2e63 6869 6c64 7265 6e5b  ren[0].children[
+000085b0: 305d 292e 7374 7269 7028 290a 2020 2020  0]).strip().    
+000085c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000085d0: 6572 744e 6f74 496e 280a 2020 2020 2020  ertNotIn(.      
+000085e0: 2020 2020 2020 2020 2020 4665 6174 7572            Featur
+000085f0: 652e 5245 4c41 5845 445f 4445 434f 5241  e.RELAXED_DECORA
+00008600: 544f 5253 2c0a 2020 2020 2020 2020 2020  TORS,.          
+00008610: 2020 2020 2020 626c 6163 6b2e 6765 745f        black.get_
+00008620: 6665 6174 7572 6573 5f75 7365 6428 6e6f  features_used(no
+00008630: 6465 292c 0a20 2020 2020 2020 2020 2020  de),.           
+00008640: 2020 2020 206d 7367 3d28 0a20 2020 2020       msg=(.     
+00008650: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00008660: 2264 6563 6f72 6174 6f72 2027 7b64 6563  "decorator '{dec
+00008670: 6f72 6174 6f72 7d27 2066 6f6c 6c6f 7773  orator}' follows
+00008680: 2070 7974 686f 6e3c 3d33 2e38 2073 796e   python<=3.8 syn
+00008690: 7461 7822 0a20 2020 2020 2020 2020 2020  tax".           
+000086a0: 2020 2020 2020 2020 2022 6275 7420 6973           "but is
+000086b0: 2064 6574 6563 7465 6420 6173 2033 2e39   detected as 3.9
+000086c0: 2b22 0a20 2020 2020 2020 2020 2020 2020  +".             
+000086d0: 2020 2020 2020 2023 2066 2254 6865 2066         # f"The f
+000086e0: 756c 6c20 6e6f 6465 2069 735c 6e7b 6e6f  ull node is\n{no
+000086f0: 6465 2172 7d22 0a20 2020 2020 2020 2020  de!r}".         
+00008700: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+00008710: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00008720: 2320 736b 6970 2074 6865 2027 2320 6f75  # skip the '# ou
+00008730: 7470 7574 2720 636f 6d6d 656e 7420 6174  tput' comment at
+00008740: 2074 6865 2074 6f70 206f 6620 7468 6520   the top of the 
+00008750: 6f75 7470 7574 2070 6172 740a 2020 2020  output part.    
+00008760: 2020 2020 666f 7220 7265 6c61 7865 645f      for relaxed_
+00008770: 7465 7374 2069 6e20 7265 6c61 7865 642e  test in relaxed.
+00008780: 7370 6c69 7428 2223 2322 295b 313a 5d3a  split("##")[1:]:
+00008790: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
+000087a0: 6520 3d20 626c 6163 6b2e 6c69 6232 746f  e = black.lib2to
+000087b0: 335f 7061 7273 6528 7265 6c61 7865 645f  3_parse(relaxed_
+000087c0: 7465 7374 290a 2020 2020 2020 2020 2020  test).          
+000087d0: 2020 6465 636f 7261 746f 7220 3d20 7374    decorator = st
+000087e0: 7228 6e6f 6465 2e63 6869 6c64 7265 6e5b  r(node.children[
+000087f0: 305d 2e63 6869 6c64 7265 6e5b 305d 292e  0].children[0]).
+00008800: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+00008810: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+00008820: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00008830: 2020 2046 6561 7475 7265 2e52 454c 4158     Feature.RELAX
+00008840: 4544 5f44 4543 4f52 4154 4f52 532c 0a20  ED_DECORATORS,. 
+00008850: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00008860: 6c61 636b 2e67 6574 5f66 6561 7475 7265  lack.get_feature
+00008870: 735f 7573 6564 286e 6f64 6529 2c0a 2020  s_used(node),.  
+00008880: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+00008890: 673d 280a 2020 2020 2020 2020 2020 2020  g=(.            
+000088a0: 2020 2020 2020 2020 6622 6465 636f 7261          f"decora
+000088b0: 746f 7220 277b 6465 636f 7261 746f 727d  tor '{decorator}
+000088c0: 2720 7573 6573 2070 7974 686f 6e33 2e39  ' uses python3.9
+000088d0: 2b20 7379 6e74 6178 220a 2020 2020 2020  + syntax".      
+000088e0: 2020 2020 2020 2020 2020 2020 2020 2262                "b
+000088f0: 7574 2069 7320 6465 7465 6374 6564 2061  ut is detected a
+00008900: 7320 7079 7468 6f6e 3c3d 332e 3822 0a20  s python<=3.8". 
+00008910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008920: 2020 2023 2066 2254 6865 2066 756c 6c20     # f"The full 
+00008930: 6e6f 6465 2069 735c 6e7b 6e6f 6465 2172  node is\n{node!r
+00008940: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00008950: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+00008960: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
+00008970: 745f 6765 745f 6665 6174 7572 6573 5f75  t_get_features_u
+00008980: 7365 6428 7365 6c66 2920 2d3e 204e 6f6e  sed(self) -> Non
+00008990: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
+000089a0: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
+000089b0: 7365 6428 2264 6566 2066 282a 2c20 6172  sed("def f(*, ar
+000089c0: 6729 3a20 2e2e 2e5c 6e22 2c20 7365 7428  g): ...\n", set(
+000089d0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+000089e0: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
+000089f0: 7365 6428 0a20 2020 2020 2020 2020 2020  sed(.           
+00008a00: 2022 6465 6620 6628 2a2c 2061 7267 2c29   "def f(*, arg,)
+00008a10: 3a20 2e2e 2e5c 6e22 2c20 7b46 6561 7475  : ...\n", {Featu
+00008a20: 7265 2e54 5241 494c 494e 475f 434f 4d4d  re.TRAILING_COMM
+00008a30: 415f 494e 5f44 4546 7d0a 2020 2020 2020  A_IN_DEF}.      
+00008a40: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
+00008a50: 2e63 6865 636b 5f66 6561 7475 7265 735f  .check_features_
+00008a60: 7573 6564 2822 6628 2a61 7267 2c29 5c6e  used("f(*arg,)\n
+00008a70: 222c 207b 4665 6174 7572 652e 5452 4149  ", {Feature.TRAI
+00008a80: 4c49 4e47 5f43 4f4d 4d41 5f49 4e5f 4341  LING_COMMA_IN_CA
+00008a90: 4c4c 7d29 0a20 2020 2020 2020 2073 656c  LL}).        sel
+00008aa0: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
+00008ab0: 5f75 7365 6428 2264 6566 2066 282a 2c20  _used("def f(*, 
+00008ac0: 6172 6729 3a20 6627 7374 7269 6e67 275c  arg): f'string'\
+00008ad0: 6e22 2c20 7b46 6561 7475 7265 2e46 5f53  n", {Feature.F_S
+00008ae0: 5452 494e 4753 7d29 0a20 2020 2020 2020  TRINGS}).       
+00008af0: 2073 656c 662e 6368 6563 6b5f 6665 6174   self.check_feat
+00008b00: 7572 6573 5f75 7365 6428 2231 3233 5f34  ures_used("123_4
+00008b10: 3536 5c6e 222c 207b 4665 6174 7572 652e  56\n", {Feature.
+00008b20: 4e55 4d45 5249 435f 554e 4445 5253 434f  NUMERIC_UNDERSCO
+00008b30: 5245 537d 290a 2020 2020 2020 2020 7365  RES}).        se
+00008b40: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
+00008b50: 735f 7573 6564 2822 3132 3334 3536 5c6e  s_used("123456\n
+00008b60: 222c 2073 6574 2829 290a 0a20 2020 2020  ", set())..     
+00008b70: 2020 2073 6f75 7263 652c 2065 7870 6563     source, expec
+00008b80: 7465 6420 3d20 7265 6164 5f64 6174 6128  ted = read_data(
+00008b90: 2263 6173 6573 222c 2022 6675 6e63 7469  "cases", "functi
+00008ba0: 6f6e 2229 0a20 2020 2020 2020 2065 7870  on").        exp
+00008bb0: 6563 7465 645f 6665 6174 7572 6573 203d  ected_features =
+00008bc0: 207b 0a20 2020 2020 2020 2020 2020 2046   {.            F
+00008bd0: 6561 7475 7265 2e54 5241 494c 494e 475f  eature.TRAILING_
+00008be0: 434f 4d4d 415f 494e 5f43 414c 4c2c 0a20  COMMA_IN_CALL,. 
+00008bf0: 2020 2020 2020 2020 2020 2046 6561 7475             Featu
+00008c00: 7265 2e54 5241 494c 494e 475f 434f 4d4d  re.TRAILING_COMM
+00008c10: 415f 494e 5f44 4546 2c0a 2020 2020 2020  A_IN_DEF,.      
+00008c20: 2020 2020 2020 4665 6174 7572 652e 465f        Feature.F_
+00008c30: 5354 5249 4e47 532c 0a20 2020 2020 2020  STRINGS,.       
+00008c40: 207d 0a20 2020 2020 2020 2073 656c 662e   }.        self.
+00008c50: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
+00008c60: 7365 6428 736f 7572 6365 2c20 6578 7065  sed(source, expe
+00008c70: 6374 6564 5f66 6561 7475 7265 7329 0a20  cted_features). 
+00008c80: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+00008c90: 6b5f 6665 6174 7572 6573 5f75 7365 6428  k_features_used(
+00008ca0: 6578 7065 6374 6564 2c20 6578 7065 6374  expected, expect
+00008cb0: 6564 5f66 6561 7475 7265 7329 0a0a 2020  ed_features)..  
+00008cc0: 2020 2020 2020 736f 7572 6365 2c20 6578        source, ex
+00008cd0: 7065 6374 6564 203d 2072 6561 645f 6461  pected = read_da
+00008ce0: 7461 2822 6361 7365 7322 2c20 2265 7870  ta("cases", "exp
+00008cf0: 7265 7373 696f 6e22 290a 2020 2020 2020  ression").      
+00008d00: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
+00008d10: 7475 7265 735f 7573 6564 2873 6f75 7263  tures_used(sourc
+00008d20: 652c 2073 6574 2829 290a 2020 2020 2020  e, set()).      
+00008d30: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
+00008d40: 7475 7265 735f 7573 6564 2865 7870 6563  tures_used(expec
+00008d50: 7465 642c 2073 6574 2829 290a 0a20 2020  ted, set())..   
+00008d60: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+00008d70: 6665 6174 7572 6573 5f75 7365 6428 226c  features_used("l
+00008d80: 616d 6264 6120 612c 202f 2c20 623a 202e  ambda a, /, b: .
+00008d90: 2e2e 5c6e 222c 207b 4665 6174 7572 652e  ..\n", {Feature.
+00008da0: 504f 535f 4f4e 4c59 5f41 5247 554d 454e  POS_ONLY_ARGUMEN
+00008db0: 5453 7d29 0a20 2020 2020 2020 2073 656c  TS}).        sel
+00008dc0: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
+00008dd0: 5f75 7365 6428 2264 6566 2066 6e28 612c  _used("def fn(a,
+00008de0: 202f 2c20 6229 3a20 2e2e 2e22 2c20 7b46   /, b): ...", {F
+00008df0: 6561 7475 7265 2e50 4f53 5f4f 4e4c 595f  eature.POS_ONLY_
+00008e00: 4152 4755 4d45 4e54 537d 290a 0a20 2020  ARGUMENTS})..   
+00008e10: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+00008e20: 6665 6174 7572 6573 5f75 7365 6428 2264  features_used("d
+00008e30: 6566 2066 6e28 293a 2079 6965 6c64 2061  ef fn(): yield a
+00008e40: 2c20 6222 2c20 7365 7428 2929 0a20 2020  , b", set()).   
+00008e50: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+00008e60: 6665 6174 7572 6573 5f75 7365 6428 2264  features_used("d
+00008e70: 6566 2066 6e28 293a 2072 6574 7572 6e20  ef fn(): return 
+00008e80: 612c 2062 222c 2073 6574 2829 290a 2020  a, b", set()).  
+00008e90: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+00008ea0: 5f66 6561 7475 7265 735f 7573 6564 2822  _features_used("
+00008eb0: 6465 6620 666e 2829 3a20 7969 656c 6420  def fn(): yield 
+00008ec0: 2a62 2c20 6322 2c20 7b46 6561 7475 7265  *b, c", {Feature
+00008ed0: 2e55 4e50 4143 4b49 4e47 5f4f 4e5f 464c  .UNPACKING_ON_FL
+00008ee0: 4f57 7d29 0a20 2020 2020 2020 2073 656c  OW}).        sel
+00008ef0: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
+00008f00: 5f75 7365 6428 0a20 2020 2020 2020 2020  _used(.         
+00008f10: 2020 2022 6465 6620 666e 2829 3a20 7265     "def fn(): re
+00008f20: 7475 726e 2061 2c20 2a62 2c20 6322 2c20  turn a, *b, c", 
+00008f30: 7b46 6561 7475 7265 2e55 4e50 4143 4b49  {Feature.UNPACKI
+00008f40: 4e47 5f4f 4e5f 464c 4f57 7d0a 2020 2020  NG_ON_FLOW}.    
+00008f50: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+00008f60: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
+00008f70: 735f 7573 6564 2822 7820 3d20 612c 202a  s_used("x = a, *
+00008f80: 622c 2063 222c 2073 6574 2829 290a 0a20  b, c", set()).. 
+00008f90: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+00008fa0: 6b5f 6665 6174 7572 6573 5f75 7365 6428  k_features_used(
+00008fb0: 2278 3a20 416e 7920 3d20 7265 6775 6c61  "x: Any = regula
+00008fc0: 7222 2c20 7365 7428 2929 0a20 2020 2020  r", set()).     
+00008fd0: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
+00008fe0: 6174 7572 6573 5f75 7365 6428 2278 3a20  atures_used("x: 
+00008ff0: 416e 7920 3d20 2872 6567 756c 6172 2c20  Any = (regular, 
+00009000: 7265 6775 6c61 7229 222c 2073 6574 2829  regular)", set()
+00009010: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
+00009020: 6865 636b 5f66 6561 7475 7265 735f 7573  heck_features_us
+00009030: 6564 2822 783a 2041 6e79 203d 2043 6f6d  ed("x: Any = Com
+00009040: 706c 6578 2854 7970 6528 3129 295b 736f  plex(Type(1))[so
+00009050: 6d65 7468 696e 675d 222c 2073 6574 2829  mething]", set()
+00009060: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
+00009070: 6865 636b 5f66 6561 7475 7265 735f 7573  heck_features_us
+00009080: 6564 280a 2020 2020 2020 2020 2020 2020  ed(.            
+00009090: 2278 3a20 5475 706c 655b 696e 742c 202e  "x: Tuple[int, .
+000090a0: 2e2e 5d20 3d20 612c 2062 2c20 6322 2c20  ..] = a, b, c", 
+000090b0: 7b46 6561 7475 7265 2e41 4e4e 5f41 5353  {Feature.ANN_ASS
+000090c0: 4947 4e5f 4558 5445 4e44 4544 5f52 4853  IGN_EXTENDED_RHS
+000090d0: 7d0a 2020 2020 2020 2020 290a 0a20 2020  }.        )..   
+000090e0: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+000090f0: 6665 6174 7572 6573 5f75 7365 6428 2274  features_used("t
+00009100: 7279 3a20 7061 7373 5c6e 6578 6365 7074  ry: pass\nexcept
+00009110: 2053 6f6d 6574 6869 6e67 3a20 7061 7373   Something: pass
+00009120: 222c 2073 6574 2829 290a 2020 2020 2020  ", set()).      
+00009130: 2020 7365 6c66 2e63 6865 636b 5f66 6561    self.check_fea
+00009140: 7475 7265 735f 7573 6564 2822 7472 793a  tures_used("try:
+00009150: 2070 6173 735c 6e65 7863 6570 7420 282a   pass\nexcept (*
+00009160: 536f 6d65 7468 696e 672c 293a 2070 6173  Something,): pas
+00009170: 7322 2c20 7365 7428 2929 0a20 2020 2020  s", set()).     
+00009180: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
+00009190: 6174 7572 6573 5f75 7365 6428 0a20 2020  atures_used(.   
+000091a0: 2020 2020 2020 2020 2022 7472 793a 2070           "try: p
+000091b0: 6173 735c 6e65 7863 6570 7420 2a47 726f  ass\nexcept *Gro
+000091c0: 7570 3a20 7061 7373 222c 207b 4665 6174  up: pass", {Feat
+000091d0: 7572 652e 4558 4345 5054 5f53 5441 527d  ure.EXCEPT_STAR}
+000091e0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000091f0: 2020 2020 7365 6c66 2e63 6865 636b 5f66      self.check_f
+00009200: 6561 7475 7265 735f 7573 6564 2822 615b  eatures_used("a[
+00009210: 2a62 5d22 2c20 7b46 6561 7475 7265 2e56  *b]", {Feature.V
+00009220: 4152 4941 4449 435f 4745 4e45 5249 4353  ARIADIC_GENERICS
+00009230: 7d29 0a20 2020 2020 2020 2073 656c 662e  }).        self.
+00009240: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
+00009250: 7365 6428 2261 5b78 2c20 2a79 2829 2c20  sed("a[x, *y(), 
+00009260: 7a5d 203d 2074 222c 207b 4665 6174 7572  z] = t", {Featur
+00009270: 652e 5641 5249 4144 4943 5f47 454e 4552  e.VARIADIC_GENER
+00009280: 4943 537d 290a 2020 2020 2020 2020 7365  ICS}).        se
+00009290: 6c66 2e63 6865 636b 5f66 6561 7475 7265  lf.check_feature
+000092a0: 735f 7573 6564 2822 6465 6620 666e 282a  s_used("def fn(*
+000092b0: 6172 6773 3a20 2a54 293a 2070 6173 7322  args: *T): pass"
+000092c0: 2c20 7b46 6561 7475 7265 2e56 4152 4941  , {Feature.VARIA
+000092d0: 4449 435f 4745 4e45 5249 4353 7d29 0a0a  DIC_GENERICS})..
+000092e0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+000092f0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
+00009300: 2822 7769 7468 2061 3a20 7061 7373 222c  ("with a: pass",
+00009310: 2073 6574 2829 290a 2020 2020 2020 2020   set()).        
+00009320: 7365 6c66 2e63 6865 636b 5f66 6561 7475  self.check_featu
+00009330: 7265 735f 7573 6564 2822 7769 7468 2061  res_used("with a
+00009340: 2c20 623a 2070 6173 7322 2c20 7365 7428  , b: pass", set(
+00009350: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+00009360: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
+00009370: 7365 6428 2277 6974 6820 6120 6173 2062  sed("with a as b
+00009380: 3a20 7061 7373 222c 2073 6574 2829 290a  : pass", set()).
+00009390: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+000093a0: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
+000093b0: 2822 7769 7468 2061 2061 7320 622c 2063  ("with a as b, c
+000093c0: 2061 7320 643a 2070 6173 7322 2c20 7365   as d: pass", se
+000093d0: 7428 2929 0a20 2020 2020 2020 2073 656c  t()).        sel
+000093e0: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
+000093f0: 5f75 7365 6428 2277 6974 6820 2861 293a  _used("with (a):
+00009400: 2070 6173 7322 2c20 7365 7428 2929 0a20   pass", set()). 
+00009410: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+00009420: 6b5f 6665 6174 7572 6573 5f75 7365 6428  k_features_used(
+00009430: 2277 6974 6820 2861 2c20 6229 3a20 7061  "with (a, b): pa
+00009440: 7373 222c 2073 6574 2829 290a 2020 2020  ss", set()).    
+00009450: 2020 2020 7365 6c66 2e63 6865 636b 5f66      self.check_f
+00009460: 6561 7475 7265 735f 7573 6564 2822 7769  eatures_used("wi
+00009470: 7468 2028 612c 2062 2920 6173 2028 632c  th (a, b) as (c,
+00009480: 2064 293a 2070 6173 7322 2c20 7365 7428   d): pass", set(
+00009490: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+000094a0: 6368 6563 6b5f 6665 6174 7572 6573 5f75  check_features_u
+000094b0: 7365 6428 0a20 2020 2020 2020 2020 2020  sed(.           
+000094c0: 2022 7769 7468 2028 6120 6173 2062 293a   "with (a as b):
+000094d0: 2070 6173 7322 2c20 7b46 6561 7475 7265   pass", {Feature
+000094e0: 2e50 4152 454e 5448 4553 495a 4544 5f43  .PARENTHESIZED_C
+000094f0: 4f4e 5445 5854 5f4d 414e 4147 4552 537d  ONTEXT_MANAGERS}
+00009500: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00009510: 2020 2073 656c 662e 6368 6563 6b5f 6665     self.check_fe
+00009520: 6174 7572 6573 5f75 7365 6428 0a20 2020  atures_used(.   
+00009530: 2020 2020 2020 2020 2022 7769 7468 2028           "with (
+00009540: 2861 2061 7320 6229 293a 2070 6173 7322  (a as b)): pass"
+00009550: 2c20 7b46 6561 7475 7265 2e50 4152 454e  , {Feature.PAREN
+00009560: 5448 4553 495a 4544 5f43 4f4e 5445 5854  THESIZED_CONTEXT
+00009570: 5f4d 414e 4147 4552 537d 0a20 2020 2020  _MANAGERS}.     
+00009580: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+00009590: 662e 6368 6563 6b5f 6665 6174 7572 6573  f.check_features
+000095a0: 5f75 7365 6428 0a20 2020 2020 2020 2020  _used(.         
+000095b0: 2020 2022 7769 7468 2028 612c 2062 2061     "with (a, b a
+000095c0: 7320 6329 3a20 7061 7373 222c 207b 4665  s c): pass", {Fe
+000095d0: 6174 7572 652e 5041 5245 4e54 4845 5349  ature.PARENTHESI
+000095e0: 5a45 445f 434f 4e54 4558 545f 4d41 4e41  ZED_CONTEXT_MANA
+000095f0: 4745 5253 7d0a 2020 2020 2020 2020 290a  GERS}.        ).
+00009600: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+00009610: 636b 5f66 6561 7475 7265 735f 7573 6564  ck_features_used
+00009620: 280a 2020 2020 2020 2020 2020 2020 2277  (.            "w
+00009630: 6974 6820 2861 2c20 2862 2061 7320 6329  ith (a, (b as c)
+00009640: 293a 2070 6173 7322 2c20 7b46 6561 7475  ): pass", {Featu
+00009650: 7265 2e50 4152 454e 5448 4553 495a 4544  re.PARENTHESIZED
+00009660: 5f43 4f4e 5445 5854 5f4d 414e 4147 4552  _CONTEXT_MANAGER
+00009670: 537d 0a20 2020 2020 2020 2029 0a20 2020  S}.        ).   
+00009680: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+00009690: 6665 6174 7572 6573 5f75 7365 6428 0a20  features_used(. 
+000096a0: 2020 2020 2020 2020 2020 2022 7769 7468             "with
+000096b0: 2028 2861 2c20 2828 6220 6173 2063 2929   ((a, ((b as c))
+000096c0: 2929 3a20 7061 7373 222c 207b 4665 6174  )): pass", {Feat
+000096d0: 7572 652e 5041 5245 4e54 4845 5349 5a45  ure.PARENTHESIZE
+000096e0: 445f 434f 4e54 4558 545f 4d41 4e41 4745  D_CONTEXT_MANAGE
+000096f0: 5253 7d0a 2020 2020 2020 2020 290a 0a20  RS}.        ).. 
+00009700: 2020 2064 6566 2063 6865 636b 5f66 6561     def check_fea
+00009710: 7475 7265 735f 7573 6564 2873 656c 662c  tures_used(self,
+00009720: 2073 6f75 7263 653a 2073 7472 2c20 6578   source: str, ex
+00009730: 7065 6374 6564 3a20 5365 745b 4665 6174  pected: Set[Feat
+00009740: 7572 655d 2920 2d3e 204e 6f6e 653a 0a20  ure]) -> None:. 
+00009750: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
+00009760: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+00009770: 6528 736f 7572 6365 290a 2020 2020 2020  e(source).      
+00009780: 2020 6163 7475 616c 203d 2062 6c61 636b    actual = black
+00009790: 2e67 6574 5f66 6561 7475 7265 735f 7573  .get_features_us
+000097a0: 6564 286e 6f64 6529 0a20 2020 2020 2020  ed(node).       
+000097b0: 206d 7367 203d 2066 2245 7870 6563 7465   msg = f"Expecte
+000097c0: 6420 7b65 7870 6563 7465 647d 2062 7574  d {expected} but
+000097d0: 2067 6f74 207b 6163 7475 616c 7d20 666f   got {actual} fo
+000097e0: 7220 7b73 6f75 7263 6521 727d 220a 2020  r {source!r}".  
+000097f0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00009800: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009810: 7274 4571 7561 6c28 6163 7475 616c 2c20  rtEqual(actual, 
+00009820: 6578 7065 6374 6564 2c20 6d73 673d 6d73  expected, msg=ms
+00009830: 6729 0a20 2020 2020 2020 2065 7863 6570  g).        excep
+00009840: 7420 4173 7365 7274 696f 6e45 7272 6f72  t AssertionError
+00009850: 3a0a 2020 2020 2020 2020 2020 2020 4465  :.            De
+00009860: 6275 6756 6973 6974 6f72 2e73 686f 7728  bugVisitor.show(
+00009870: 6e6f 6465 290a 2020 2020 2020 2020 2020  node).          
+00009880: 2020 7261 6973 650a 0a20 2020 2064 6566    raise..    def
+00009890: 2074 6573 745f 6765 745f 6665 6174 7572   test_get_featur
+000098a0: 6573 5f75 7365 645f 666f 725f 6675 7475  es_used_for_futu
+000098b0: 7265 5f66 6c61 6773 2873 656c 6629 202d  re_flags(self) -
+000098c0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000098d0: 666f 7220 7372 632c 2066 6561 7475 7265  for src, feature
+000098e0: 7320 696e 205b 0a20 2020 2020 2020 2020  s in [.         
+000098f0: 2020 2028 2266 726f 6d20 5f5f 6675 7475     ("from __futu
+00009900: 7265 5f5f 2069 6d70 6f72 7420 616e 6e6f  re__ import anno
+00009910: 7461 7469 6f6e 7322 2c20 7b46 6561 7475  tations", {Featu
+00009920: 7265 2e46 5554 5552 455f 414e 4e4f 5441  re.FUTURE_ANNOTA
+00009930: 5449 4f4e 537d 292c 0a20 2020 2020 2020  TIONS}),.       
+00009940: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+00009950: 2020 2020 2020 2022 6672 6f6d 205f 5f66         "from __f
+00009960: 7574 7572 655f 5f20 696d 706f 7274 2028  uture__ import (
+00009970: 6f74 6865 722c 2061 6e6e 6f74 6174 696f  other, annotatio
+00009980: 6e73 2922 2c0a 2020 2020 2020 2020 2020  ns)",.          
+00009990: 2020 2020 2020 7b46 6561 7475 7265 2e46        {Feature.F
+000099a0: 5554 5552 455f 414e 4e4f 5441 5449 4f4e  UTURE_ANNOTATION
+000099b0: 537d 2c0a 2020 2020 2020 2020 2020 2020  S},.            
+000099c0: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+000099d0: 2261 203d 2031 202b 2032 5c6e 6672 6f6d  "a = 1 + 2\nfrom
+000099e0: 2073 6f6d 6574 6869 6e67 2069 6d70 6f72   something impor
+000099f0: 7420 616e 6e6f 7461 7469 6f6e 7322 2c20  t annotations", 
+00009a00: 7365 7428 2929 2c0a 2020 2020 2020 2020  set()),.        
+00009a10: 2020 2020 2822 6672 6f6d 205f 5f66 7574      ("from __fut
+00009a20: 7572 655f 5f20 696d 706f 7274 2078 2c20  ure__ import x, 
+00009a30: 7922 2c20 7365 7428 2929 2c0a 2020 2020  y", set()),.    
+00009a40: 2020 2020 5d3a 0a20 2020 2020 2020 2020      ]:.         
+00009a50: 2020 2077 6974 6820 7365 6c66 2e73 7562     with self.sub
+00009a60: 5465 7374 2873 7263 3d73 7263 2c20 6665  Test(src=src, fe
+00009a70: 6174 7572 6573 3d66 6561 7475 7265 7329  atures=features)
+00009a80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009a90: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
+00009aa0: 6962 3274 6f33 5f70 6172 7365 2873 7263  ib2to3_parse(src
+00009ab0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00009ac0: 2020 6675 7475 7265 5f69 6d70 6f72 7473    future_imports
+00009ad0: 203d 2062 6c61 636b 2e67 6574 5f66 7574   = black.get_fut
+00009ae0: 7572 655f 696d 706f 7274 7328 6e6f 6465  ure_imports(node
+00009af0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00009b00: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00009b10: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
+00009b20: 2020 2020 2020 2020 626c 6163 6b2e 6765          black.ge
+00009b30: 745f 6665 6174 7572 6573 5f75 7365 6428  t_features_used(
+00009b40: 6e6f 6465 2c20 6675 7475 7265 5f69 6d70  node, future_imp
+00009b50: 6f72 7473 3d66 7574 7572 655f 696d 706f  orts=future_impo
+00009b60: 7274 7329 2c0a 2020 2020 2020 2020 2020  rts),.          
+00009b70: 2020 2020 2020 2020 2020 6665 6174 7572            featur
+00009b80: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+00009b90: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+00009ba0: 6573 745f 6765 745f 6675 7475 7265 5f69  est_get_future_i
+00009bb0: 6d70 6f72 7473 2873 656c 6629 202d 3e20  mports(self) -> 
+00009bc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6e6f  None:.        no
+00009bd0: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
+00009be0: 6f33 5f70 6172 7365 2822 5c6e 2229 0a20  o3_parse("\n"). 
+00009bf0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00009c00: 7274 4571 7561 6c28 7365 7428 292c 2062  rtEqual(set(), b
+00009c10: 6c61 636b 2e67 6574 5f66 7574 7572 655f  lack.get_future_
+00009c20: 696d 706f 7274 7328 6e6f 6465 2929 0a20  imports(node)). 
+00009c30: 2020 2020 2020 206e 6f64 6520 3d20 626c         node = bl
+00009c40: 6163 6b2e 6c69 6232 746f 335f 7061 7273  ack.lib2to3_pars
+00009c50: 6528 2266 726f 6d20 5f5f 6675 7475 7265  e("from __future
+00009c60: 5f5f 2069 6d70 6f72 7420 626c 6163 6b5c  __ import black\
+00009c70: 6e22 290a 2020 2020 2020 2020 7365 6c66  n").        self
+00009c80: 2e61 7373 6572 7445 7175 616c 287b 2262  .assertEqual({"b
+00009c90: 6c61 636b 227d 2c20 626c 6163 6b2e 6765  lack"}, black.ge
+00009ca0: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
+00009cb0: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
+00009cc0: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
+00009cd0: 3274 6f33 5f70 6172 7365 2822 6672 6f6d  2to3_parse("from
+00009ce0: 205f 5f66 7574 7572 655f 5f20 696d 706f   __future__ impo
+00009cf0: 7274 206d 756c 7469 706c 652c 2069 6d70  rt multiple, imp
+00009d00: 6f72 7473 5c6e 2229 0a20 2020 2020 2020  orts\n").       
+00009d10: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009d20: 6c28 7b22 6d75 6c74 6970 6c65 222c 2022  l({"multiple", "
+00009d30: 696d 706f 7274 7322 7d2c 2062 6c61 636b  imports"}, black
+00009d40: 2e67 6574 5f66 7574 7572 655f 696d 706f  .get_future_impo
+00009d50: 7274 7328 6e6f 6465 2929 0a20 2020 2020  rts(node)).     
+00009d60: 2020 206e 6f64 6520 3d20 626c 6163 6b2e     node = black.
+00009d70: 6c69 6232 746f 335f 7061 7273 6528 2266  lib2to3_parse("f
+00009d80: 726f 6d20 5f5f 6675 7475 7265 5f5f 2069  rom __future__ i
+00009d90: 6d70 6f72 7420 2870 6172 656e 7468 6573  mport (parenthes
+00009da0: 697a 6564 2c20 696d 706f 7274 7329 5c6e  ized, imports)\n
+00009db0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00009dc0: 6173 7365 7274 4571 7561 6c28 7b22 7061  assertEqual({"pa
+00009dd0: 7265 6e74 6865 7369 7a65 6422 2c20 2269  renthesized", "i
+00009de0: 6d70 6f72 7473 227d 2c20 626c 6163 6b2e  mports"}, black.
+00009df0: 6765 745f 6675 7475 7265 5f69 6d70 6f72  get_future_impor
+00009e00: 7473 286e 6f64 6529 290a 2020 2020 2020  ts(node)).      
+00009e10: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
+00009e20: 6962 3274 6f33 5f70 6172 7365 280a 2020  ib2to3_parse(.  
+00009e30: 2020 2020 2020 2020 2020 2266 726f 6d20            "from 
+00009e40: 5f5f 6675 7475 7265 5f5f 2069 6d70 6f72  __future__ impor
+00009e50: 7420 6d75 6c74 6970 6c65 5c6e 6672 6f6d  t multiple\nfrom
+00009e60: 205f 5f66 7574 7572 655f 5f20 696d 706f   __future__ impo
+00009e70: 7274 2069 6d70 6f72 7473 5c6e 220a 2020  rt imports\n".  
+00009e80: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00009e90: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00009ea0: 287b 226d 756c 7469 706c 6522 2c20 2269  ({"multiple", "i
+00009eb0: 6d70 6f72 7473 227d 2c20 626c 6163 6b2e  mports"}, black.
+00009ec0: 6765 745f 6675 7475 7265 5f69 6d70 6f72  get_future_impor
+00009ed0: 7473 286e 6f64 6529 290a 2020 2020 2020  ts(node)).      
+00009ee0: 2020 6e6f 6465 203d 2062 6c61 636b 2e6c    node = black.l
+00009ef0: 6962 3274 6f33 5f70 6172 7365 2822 2320  ib2to3_parse("# 
+00009f00: 636f 6d6d 656e 745c 6e66 726f 6d20 5f5f  comment\nfrom __
+00009f10: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
+00009f20: 626c 6163 6b5c 6e22 290a 2020 2020 2020  black\n").      
+00009f30: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00009f40: 616c 287b 2262 6c61 636b 227d 2c20 626c  al({"black"}, bl
+00009f50: 6163 6b2e 6765 745f 6675 7475 7265 5f69  ack.get_future_i
+00009f60: 6d70 6f72 7473 286e 6f64 6529 290a 2020  mports(node)).  
+00009f70: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
+00009f80: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+00009f90: 2827 2222 2264 6f63 7374 7269 6e67 2222  ('"""docstring""
+00009fa0: 225c 6e66 726f 6d20 5f5f 6675 7475 7265  "\nfrom __future
+00009fb0: 5f5f 2069 6d70 6f72 7420 626c 6163 6b5c  __ import black\
+00009fc0: 6e27 290a 2020 2020 2020 2020 7365 6c66  n').        self
+00009fd0: 2e61 7373 6572 7445 7175 616c 287b 2262  .assertEqual({"b
+00009fe0: 6c61 636b 227d 2c20 626c 6163 6b2e 6765  lack"}, black.ge
+00009ff0: 745f 6675 7475 7265 5f69 6d70 6f72 7473  t_future_imports
+0000a000: 286e 6f64 6529 290a 2020 2020 2020 2020  (node)).        
+0000a010: 6e6f 6465 203d 2062 6c61 636b 2e6c 6962  node = black.lib
+0000a020: 3274 6f33 5f70 6172 7365 2822 736f 6d65  2to3_parse("some
+0000a030: 286f 7468 6572 2c20 636f 6465 295c 6e66  (other, code)\nf
+0000a040: 726f 6d20 5f5f 6675 7475 7265 5f5f 2069  rom __future__ i
+0000a050: 6d70 6f72 7420 626c 6163 6b5c 6e22 290a  mport black\n").
+0000a060: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000a070: 6572 7445 7175 616c 2873 6574 2829 2c20  ertEqual(set(), 
+0000a080: 626c 6163 6b2e 6765 745f 6675 7475 7265  black.get_future
+0000a090: 5f69 6d70 6f72 7473 286e 6f64 6529 290a  _imports(node)).
+0000a0a0: 2020 2020 2020 2020 6e6f 6465 203d 2062          node = b
+0000a0b0: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
+0000a0c0: 7365 2822 6672 6f6d 2073 6f6d 652e 6d6f  se("from some.mo
+0000a0d0: 6475 6c65 2069 6d70 6f72 7420 626c 6163  dule import blac
+0000a0e0: 6b5c 6e22 290a 2020 2020 2020 2020 7365  k\n").        se
+0000a0f0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+0000a100: 6574 2829 2c20 626c 6163 6b2e 6765 745f  et(), black.get_
+0000a110: 6675 7475 7265 5f69 6d70 6f72 7473 286e  future_imports(n
+0000a120: 6f64 6529 290a 2020 2020 2020 2020 6e6f  ode)).        no
+0000a130: 6465 203d 2062 6c61 636b 2e6c 6962 3274  de = black.lib2t
+0000a140: 6f33 5f70 6172 7365 280a 2020 2020 2020  o3_parse(.      
+0000a150: 2020 2020 2020 2266 726f 6d20 5f5f 6675        "from __fu
+0000a160: 7475 7265 5f5f 2069 6d70 6f72 7420 756e  ture__ import un
+0000a170: 6963 6f64 655f 6c69 7465 7261 6c73 2061  icode_literals a
+0000a180: 7320 5f75 6e69 636f 6465 5f6c 6974 6572  s _unicode_liter
+0000a190: 616c 7322 0a20 2020 2020 2020 2029 0a20  als".        ). 
+0000a1a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000a1b0: 7274 4571 7561 6c28 7b22 756e 6963 6f64  rtEqual({"unicod
+0000a1c0: 655f 6c69 7465 7261 6c73 227d 2c20 626c  e_literals"}, bl
+0000a1d0: 6163 6b2e 6765 745f 6675 7475 7265 5f69  ack.get_future_i
+0000a1e0: 6d70 6f72 7473 286e 6f64 6529 290a 2020  mports(node)).  
+0000a1f0: 2020 2020 2020 6e6f 6465 203d 2062 6c61        node = bla
+0000a200: 636b 2e6c 6962 3274 6f33 5f70 6172 7365  ck.lib2to3_parse
+0000a210: 280a 2020 2020 2020 2020 2020 2020 2266  (.            "f
+0000a220: 726f 6d20 5f5f 6675 7475 7265 5f5f 2069  rom __future__ i
+0000a230: 6d70 6f72 7420 756e 6963 6f64 655f 6c69  mport unicode_li
+0000a240: 7465 7261 6c73 2061 7320 5f6c 6f6c 2c20  terals as _lol, 
+0000a250: 7072 696e 7422 0a20 2020 2020 2020 2029  print".        )
+0000a260: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0000a270: 7365 7274 4571 7561 6c28 7b22 756e 6963  sertEqual({"unic
+0000a280: 6f64 655f 6c69 7465 7261 6c73 222c 2022  ode_literals", "
+0000a290: 7072 696e 7422 7d2c 2062 6c61 636b 2e67  print"}, black.g
+0000a2a0: 6574 5f66 7574 7572 655f 696d 706f 7274  et_future_import
+0000a2b0: 7328 6e6f 6465 2929 0a0a 2020 2020 4070  s(node))..    @p
+0000a2c0: 7974 6573 742e 6d61 726b 2e69 6e63 6f6d  ytest.mark.incom
+0000a2d0: 7061 7469 626c 655f 7769 7468 5f6d 7970  patible_with_myp
+0000a2e0: 7963 0a20 2020 2064 6566 2074 6573 745f  yc.    def test_
+0000a2f0: 6465 6275 675f 7669 7369 746f 7228 7365  debug_visitor(se
+0000a300: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000a310: 2020 2020 2073 6f75 7263 652c 205f 203d       source, _ =
+0000a320: 2072 6561 645f 6461 7461 2822 6d69 7363   read_data("misc
+0000a330: 656c 6c61 6e65 6f75 7322 2c20 2264 6562  ellaneous", "deb
+0000a340: 7567 5f76 6973 6974 6f72 2229 0a20 2020  ug_visitor").   
+0000a350: 2020 2020 2065 7870 6563 7465 642c 205f       expected, _
+0000a360: 203d 2072 6561 645f 6461 7461 2822 6d69   = read_data("mi
+0000a370: 7363 656c 6c61 6e65 6f75 7322 2c20 2264  scellaneous", "d
+0000a380: 6562 7567 5f76 6973 6974 6f72 2e6f 7574  ebug_visitor.out
+0000a390: 2229 0a20 2020 2020 2020 206f 7574 5f6c  ").        out_l
+0000a3a0: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
+0000a3b0: 2020 6572 725f 6c69 6e65 7320 3d20 5b5d    err_lines = []
+0000a3c0: 0a0a 2020 2020 2020 2020 6465 6620 6f75  ..        def ou
+0000a3d0: 7428 6d73 673a 2073 7472 2c20 2a2a 6b77  t(msg: str, **kw
+0000a3e0: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
+0000a3f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000a400: 6f75 745f 6c69 6e65 732e 6170 7065 6e64  out_lines.append
+0000a410: 286d 7367 290a 0a20 2020 2020 2020 2064  (msg)..        d
+0000a420: 6566 2065 7272 286d 7367 3a20 7374 722c  ef err(msg: str,
+0000a430: 202a 2a6b 7761 7267 733a 2041 6e79 2920   **kwargs: Any) 
+0000a440: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000a450: 2020 2020 2065 7272 5f6c 696e 6573 2e61       err_lines.a
+0000a460: 7070 656e 6428 6d73 6729 0a0a 2020 2020  ppend(msg)..    
+0000a470: 2020 2020 7769 7468 2070 6174 6368 2822      with patch("
+0000a480: 626c 6163 6b2e 6465 6275 672e 6f75 7422  black.debug.out"
+0000a490: 2c20 6f75 7429 3a0a 2020 2020 2020 2020  , out):.        
+0000a4a0: 2020 2020 4465 6275 6756 6973 6974 6f72      DebugVisitor
+0000a4b0: 2e73 686f 7728 736f 7572 6365 290a 2020  .show(source).  
+0000a4c0: 2020 2020 2020 6163 7475 616c 203d 2022        actual = "
+0000a4d0: 5c6e 222e 6a6f 696e 286f 7574 5f6c 696e  \n".join(out_lin
+0000a4e0: 6573 2920 2b20 225c 6e22 0a20 2020 2020  es) + "\n".     
+0000a4f0: 2020 206c 6f67 5f6e 616d 6520 3d20 2222     log_name = ""
+0000a500: 0a20 2020 2020 2020 2069 6620 6578 7065  .        if expe
+0000a510: 6374 6564 2021 3d20 6163 7475 616c 3a0a  cted != actual:.
+0000a520: 2020 2020 2020 2020 2020 2020 6c6f 675f              log_
+0000a530: 6e61 6d65 203d 2062 6c61 636b 2e64 756d  name = black.dum
+0000a540: 705f 746f 5f66 696c 6528 2a6f 7574 5f6c  p_to_file(*out_l
+0000a550: 696e 6573 290a 2020 2020 2020 2020 7365  ines).        se
+0000a560: 6c66 2e61 7373 6572 7445 7175 616c 280a  lf.assertEqual(.
+0000a570: 2020 2020 2020 2020 2020 2020 6578 7065              expe
+0000a580: 6374 6564 2c0a 2020 2020 2020 2020 2020  cted,.          
+0000a590: 2020 6163 7475 616c 2c0a 2020 2020 2020    actual,.      
+0000a5a0: 2020 2020 2020 6622 4153 5420 7072 696e        f"AST prin
+0000a5b0: 7420 6f75 7420 6973 2064 6966 6665 7265  t out is differe
+0000a5c0: 6e74 2e20 4163 7475 616c 2076 6572 7369  nt. Actual versi
+0000a5d0: 6f6e 2064 756d 7065 6420 746f 207b 6c6f  on dumped to {lo
+0000a5e0: 675f 6e61 6d65 7d22 2c0a 2020 2020 2020  g_name}",.      
+0000a5f0: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
+0000a600: 745f 666f 726d 6174 5f66 696c 655f 636f  t_format_file_co
+0000a610: 6e74 656e 7473 2873 656c 6629 202d 3e20  ntents(self) -> 
+0000a620: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d6f  None:.        mo
+0000a630: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
+0000a640: 450a 2020 2020 2020 2020 656d 7074 7920  E.        empty 
+0000a650: 3d20 2222 0a20 2020 2020 2020 2077 6974  = "".        wit
+0000a660: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
+0000a670: 7365 7328 626c 6163 6b2e 4e6f 7468 696e  ses(black.Nothin
+0000a680: 6743 6861 6e67 6564 293a 0a20 2020 2020  gChanged):.     
+0000a690: 2020 2020 2020 2062 6c61 636b 2e66 6f72         black.for
+0000a6a0: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
+0000a6b0: 7328 656d 7074 792c 206d 6f64 653d 6d6f  s(empty, mode=mo
+0000a6c0: 6465 2c20 6661 7374 3d46 616c 7365 290a  de, fast=False).
+0000a6d0: 2020 2020 2020 2020 6a75 7374 5f6e 6c20          just_nl 
+0000a6e0: 3d20 225c 6e22 0a20 2020 2020 2020 2077  = "\n".        w
+0000a6f0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+0000a700: 6169 7365 7328 626c 6163 6b2e 4e6f 7468  aises(black.Noth
+0000a710: 696e 6743 6861 6e67 6564 293a 0a20 2020  ingChanged):.   
+0000a720: 2020 2020 2020 2020 2062 6c61 636b 2e66           black.f
+0000a730: 6f72 6d61 745f 6669 6c65 5f63 6f6e 7465  ormat_file_conte
+0000a740: 6e74 7328 6a75 7374 5f6e 6c2c 206d 6f64  nts(just_nl, mod
+0000a750: 653d 6d6f 6465 2c20 6661 7374 3d46 616c  e=mode, fast=Fal
+0000a760: 7365 290a 2020 2020 2020 2020 7361 6d65  se).        same
+0000a770: 203d 2022 6a20 3d20 5b31 2c20 322c 2033   = "j = [1, 2, 3
+0000a780: 5d5c 6e22 0a20 2020 2020 2020 2077 6974  ]\n".        wit
+0000a790: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
+0000a7a0: 7365 7328 626c 6163 6b2e 4e6f 7468 696e  ses(black.Nothin
+0000a7b0: 6743 6861 6e67 6564 293a 0a20 2020 2020  gChanged):.     
+0000a7c0: 2020 2020 2020 2062 6c61 636b 2e66 6f72         black.for
+0000a7d0: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
+0000a7e0: 7328 7361 6d65 2c20 6d6f 6465 3d6d 6f64  s(same, mode=mod
+0000a7f0: 652c 2066 6173 743d 4661 6c73 6529 0a20  e, fast=False). 
+0000a800: 2020 2020 2020 2064 6966 6665 7265 6e74         different
+0000a810: 203d 2022 6a20 3d20 5b31 2c32 2c33 5d22   = "j = [1,2,3]"
+0000a820: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
+0000a830: 6420 3d20 7361 6d65 0a20 2020 2020 2020  d = same.       
+0000a840: 2061 6374 7561 6c20 3d20 626c 6163 6b2e   actual = black.
+0000a850: 666f 726d 6174 5f66 696c 655f 636f 6e74  format_file_cont
+0000a860: 656e 7473 2864 6966 6665 7265 6e74 2c20  ents(different, 
+0000a870: 6d6f 6465 3d6d 6f64 652c 2066 6173 743d  mode=mode, fast=
+0000a880: 4661 6c73 6529 0a20 2020 2020 2020 2073  False).        s
+0000a890: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000a8a0: 6578 7065 6374 6564 2c20 6163 7475 616c  expected, actual
+0000a8b0: 290a 2020 2020 2020 2020 696e 7661 6c69  ).        invali
+0000a8c0: 6420 3d20 2272 6574 7572 6e20 6966 2079  d = "return if y
+0000a8d0: 6f75 2063 616e 220a 2020 2020 2020 2020  ou can".        
+0000a8e0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+0000a8f0: 5261 6973 6573 2862 6c61 636b 2e49 6e76  Raises(black.Inv
+0000a900: 616c 6964 496e 7075 7429 2061 7320 653a  alidInput) as e:
+0000a910: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
+0000a920: 636b 2e66 6f72 6d61 745f 6669 6c65 5f63  ck.format_file_c
+0000a930: 6f6e 7465 6e74 7328 696e 7661 6c69 642c  ontents(invalid,
+0000a940: 206d 6f64 653d 6d6f 6465 2c20 6661 7374   mode=mode, fast
+0000a950: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0000a960: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000a970: 2873 7472 2865 2e65 7863 6570 7469 6f6e  (str(e.exception
+0000a980: 292c 2022 4361 6e6e 6f74 2070 6172 7365  ), "Cannot parse
+0000a990: 3a20 313a 373a 2072 6574 7572 6e20 6966  : 1:7: return if
+0000a9a0: 2079 6f75 2063 616e 2229 0a0a 2020 2020   you can")..    
+0000a9b0: 2020 2020 6a75 7374 5f63 726c 6620 3d20      just_crlf = 
+0000a9c0: 225c 725c 6e22 0a20 2020 2020 2020 2077  "\r\n".        w
+0000a9d0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+0000a9e0: 6169 7365 7328 626c 6163 6b2e 4e6f 7468  aises(black.Noth
+0000a9f0: 696e 6743 6861 6e67 6564 293a 0a20 2020  ingChanged):.   
+0000aa00: 2020 2020 2020 2020 2062 6c61 636b 2e66           black.f
+0000aa10: 6f72 6d61 745f 6669 6c65 5f63 6f6e 7465  ormat_file_conte
+0000aa20: 6e74 7328 6a75 7374 5f63 726c 662c 206d  nts(just_crlf, m
+0000aa30: 6f64 653d 6d6f 6465 2c20 6661 7374 3d46  ode=mode, fast=F
+0000aa40: 616c 7365 290a 2020 2020 2020 2020 6a75  alse).        ju
+0000aa50: 7374 5f77 6869 7465 7370 6163 655f 6e6c  st_whitespace_nl
+0000aa60: 203d 2022 5c6e 5c74 5c6e 205c 6e5c 7420   = "\n\t\n \n\t 
+0000aa70: 5c6e 205c 745c 6e5c 6e22 0a20 2020 2020  \n \t\n\n".     
+0000aa80: 2020 2061 6374 7561 6c20 3d20 626c 6163     actual = blac
+0000aa90: 6b2e 666f 726d 6174 5f66 696c 655f 636f  k.format_file_co
+0000aaa0: 6e74 656e 7473 286a 7573 745f 7768 6974  ntents(just_whit
+0000aab0: 6573 7061 6365 5f6e 6c2c 206d 6f64 653d  espace_nl, mode=
+0000aac0: 6d6f 6465 2c20 6661 7374 3d46 616c 7365  mode, fast=False
+0000aad0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000aae0: 7373 6572 7445 7175 616c 2822 5c6e 222c  ssertEqual("\n",
+0000aaf0: 2061 6374 7561 6c29 0a20 2020 2020 2020   actual).       
+0000ab00: 206a 7573 745f 7768 6974 6573 7061 6365   just_whitespace
+0000ab10: 5f63 726c 6620 3d20 225c 725c 6e5c 745c  _crlf = "\r\n\t\
+0000ab20: 725c 6e20 5c72 5c6e 5c74 205c 725c 6e20  r\n \r\n\t \r\n 
+0000ab30: 5c74 5c72 5c6e 5c72 5c6e 220a 2020 2020  \t\r\n\r\n".    
+0000ab40: 2020 2020 6163 7475 616c 203d 2062 6c61      actual = bla
+0000ab50: 636b 2e66 6f72 6d61 745f 6669 6c65 5f63  ck.format_file_c
+0000ab60: 6f6e 7465 6e74 7328 6a75 7374 5f77 6869  ontents(just_whi
+0000ab70: 7465 7370 6163 655f 6372 6c66 2c20 6d6f  tespace_crlf, mo
+0000ab80: 6465 3d6d 6f64 652c 2066 6173 743d 4661  de=mode, fast=Fa
+0000ab90: 6c73 6529 0a20 2020 2020 2020 2073 656c  lse).        sel
+0000aba0: 662e 6173 7365 7274 4571 7561 6c28 225c  f.assertEqual("\
+0000abb0: 725c 6e22 2c20 6163 7475 616c 290a 0a20  r\n", actual).. 
+0000abc0: 2020 2064 6566 2074 6573 745f 656e 646d     def test_endm
+0000abd0: 6172 6b65 7228 7365 6c66 2920 2d3e 204e  arker(self) -> N
+0000abe0: 6f6e 653a 0a20 2020 2020 2020 206e 203d  one:.        n =
+0000abf0: 2062 6c61 636b 2e6c 6962 3274 6f33 5f70   black.lib2to3_p
+0000ac00: 6172 7365 2822 5c6e 2229 0a20 2020 2020  arse("\n").     
+0000ac10: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000ac20: 7561 6c28 6e2e 7479 7065 2c20 626c 6163  ual(n.type, blac
+0000ac30: 6b2e 7379 6d73 2e66 696c 655f 696e 7075  k.syms.file_inpu
+0000ac40: 7429 0a20 2020 2020 2020 2073 656c 662e  t).        self.
+0000ac50: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+0000ac60: 6e2e 6368 696c 6472 656e 292c 2031 290a  n.children), 1).
+0000ac70: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000ac80: 6572 7445 7175 616c 286e 2e63 6869 6c64  ertEqual(n.child
+0000ac90: 7265 6e5b 305d 2e74 7970 652c 2062 6c61  ren[0].type, bla
+0000aca0: 636b 2e74 6f6b 656e 2e45 4e44 4d41 524b  ck.token.ENDMARK
+0000acb0: 4552 290a 0a20 2020 2040 7061 7463 6828  ER)..    @patch(
+0000acc0: 2274 6573 7473 2e63 6f6e 6674 6573 742e  "tests.conftest.
+0000acd0: 5052 494e 545f 4655 4c4c 5f54 5245 4522  PRINT_FULL_TREE"
+0000ace0: 2c20 5472 7565 290a 2020 2020 4070 6174  , True).    @pat
+0000acf0: 6368 2822 7465 7374 732e 636f 6e66 7465  ch("tests.confte
+0000ad00: 7374 2e50 5249 4e54 5f54 5245 455f 4449  st.PRINT_TREE_DI
+0000ad10: 4646 222c 2046 616c 7365 290a 2020 2020  FF", False).    
+0000ad20: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
+0000ad30: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
+0000ad40: 7970 7963 0a20 2020 2064 6566 2074 6573  ypyc.    def tes
+0000ad50: 745f 6173 7365 7274 466f 726d 6174 4571  t_assertFormatEq
+0000ad60: 7561 6c5f 7072 696e 745f 6675 6c6c 5f74  ual_print_full_t
+0000ad70: 7265 6528 7365 6c66 2920 2d3e 204e 6f6e  ree(self) -> Non
+0000ad80: 653a 0a20 2020 2020 2020 206f 7574 5f6c  e:.        out_l
+0000ad90: 696e 6573 203d 205b 5d0a 2020 2020 2020  ines = [].      
+0000ada0: 2020 6572 725f 6c69 6e65 7320 3d20 5b5d    err_lines = []
+0000adb0: 0a0a 2020 2020 2020 2020 6465 6620 6f75  ..        def ou
+0000adc0: 7428 6d73 673a 2073 7472 2c20 2a2a 6b77  t(msg: str, **kw
+0000add0: 6172 6773 3a20 416e 7929 202d 3e20 4e6f  args: Any) -> No
+0000ade0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000adf0: 6f75 745f 6c69 6e65 732e 6170 7065 6e64  out_lines.append
+0000ae00: 286d 7367 290a 0a20 2020 2020 2020 2064  (msg)..        d
+0000ae10: 6566 2065 7272 286d 7367 3a20 7374 722c  ef err(msg: str,
+0000ae20: 202a 2a6b 7761 7267 733a 2041 6e79 2920   **kwargs: Any) 
+0000ae30: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000ae40: 2020 2020 2065 7272 5f6c 696e 6573 2e61       err_lines.a
+0000ae50: 7070 656e 6428 6d73 6729 0a0a 2020 2020  ppend(msg)..    
+0000ae60: 2020 2020 7769 7468 2070 6174 6368 2822      with patch("
+0000ae70: 626c 6163 6b2e 6f75 7470 7574 2e5f 6f75  black.output._ou
+0000ae80: 7422 2c20 6f75 7429 2c20 7061 7463 6828  t", out), patch(
+0000ae90: 2262 6c61 636b 2e6f 7574 7075 742e 5f65  "black.output._e
+0000aea0: 7272 222c 2065 7272 293a 0a20 2020 2020  rr", err):.     
+0000aeb0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+0000aec0: 2e61 7373 6572 7452 6169 7365 7328 4173  .assertRaises(As
+0000aed0: 7365 7274 696f 6e45 7272 6f72 293a 0a20  sertionError):. 
+0000aee0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000aef0: 656c 662e 6173 7365 7274 466f 726d 6174  elf.assertFormat
+0000af00: 4571 7561 6c28 226a 203d 205b 312c 2032  Equal("j = [1, 2
+0000af10: 2c20 335d 222c 2022 6a20 3d20 5b31 2c20  , 3]", "j = [1, 
+0000af20: 322c 2033 2c5d 2229 0a0a 2020 2020 2020  2, 3,]")..      
+0000af30: 2020 6f75 745f 7374 7220 3d20 2222 2e6a    out_str = "".j
+0000af40: 6f69 6e28 6f75 745f 6c69 6e65 7329 0a20  oin(out_lines). 
+0000af50: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000af60: 7274 496e 2822 4578 7065 6374 6564 2074  rtIn("Expected t
+0000af70: 7265 653a 222c 206f 7574 5f73 7472 290a  ree:", out_str).
+0000af80: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000af90: 6572 7449 6e28 2241 6374 7561 6c20 7472  ertIn("Actual tr
+0000afa0: 6565 3a22 2c20 6f75 745f 7374 7229 0a20  ee:", out_str). 
+0000afb0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000afc0: 7274 4571 7561 6c28 2222 2e6a 6f69 6e28  rtEqual("".join(
+0000afd0: 6572 725f 6c69 6e65 7329 2c20 2222 290a  err_lines), "").
+0000afe0: 0a20 2020 2040 7061 7463 6828 2274 6573  .    @patch("tes
+0000aff0: 7473 2e63 6f6e 6674 6573 742e 5052 494e  ts.conftest.PRIN
+0000b000: 545f 4655 4c4c 5f54 5245 4522 2c20 4661  T_FULL_TREE", Fa
+0000b010: 6c73 6529 0a20 2020 2040 7061 7463 6828  lse).    @patch(
+0000b020: 2274 6573 7473 2e63 6f6e 6674 6573 742e  "tests.conftest.
+0000b030: 5052 494e 545f 5452 4545 5f44 4946 4622  PRINT_TREE_DIFF"
+0000b040: 2c20 5472 7565 290a 2020 2020 4070 7974  , True).    @pyt
+0000b050: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
+0000b060: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
+0000b070: 0a20 2020 2064 6566 2074 6573 745f 6173  .    def test_as
+0000b080: 7365 7274 466f 726d 6174 4571 7561 6c5f  sertFormatEqual_
+0000b090: 7072 696e 745f 7472 6565 5f64 6966 6628  print_tree_diff(
+0000b0a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000b0b0: 2020 2020 2020 206f 7574 5f6c 696e 6573         out_lines
+0000b0c0: 203d 205b 5d0a 2020 2020 2020 2020 6572   = [].        er
+0000b0d0: 725f 6c69 6e65 7320 3d20 5b5d 0a0a 2020  r_lines = []..  
+0000b0e0: 2020 2020 2020 6465 6620 6f75 7428 6d73        def out(ms
+0000b0f0: 673a 2073 7472 2c20 2a2a 6b77 6172 6773  g: str, **kwargs
+0000b100: 3a20 416e 7929 202d 3e20 4e6f 6e65 3a0a  : Any) -> None:.
+0000b110: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+0000b120: 6c69 6e65 732e 6170 7065 6e64 286d 7367  lines.append(msg
+0000b130: 290a 0a20 2020 2020 2020 2064 6566 2065  )..        def e
+0000b140: 7272 286d 7367 3a20 7374 722c 202a 2a6b  rr(msg: str, **k
+0000b150: 7761 7267 733a 2041 6e79 2920 2d3e 204e  wargs: Any) -> N
+0000b160: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000b170: 2065 7272 5f6c 696e 6573 2e61 7070 656e   err_lines.appen
+0000b180: 6428 6d73 6729 0a0a 2020 2020 2020 2020  d(msg)..        
+0000b190: 7769 7468 2070 6174 6368 2822 626c 6163  with patch("blac
+0000b1a0: 6b2e 6f75 7470 7574 2e5f 6f75 7422 2c20  k.output._out", 
+0000b1b0: 6f75 7429 2c20 7061 7463 6828 2262 6c61  out), patch("bla
+0000b1c0: 636b 2e6f 7574 7075 742e 5f65 7272 222c  ck.output._err",
+0000b1d0: 2065 7272 293a 0a20 2020 2020 2020 2020   err):.         
+0000b1e0: 2020 2077 6974 6820 7365 6c66 2e61 7373     with self.ass
+0000b1f0: 6572 7452 6169 7365 7328 4173 7365 7274  ertRaises(Assert
+0000b200: 696f 6e45 7272 6f72 293a 0a20 2020 2020  ionError):.     
+0000b210: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b220: 6173 7365 7274 466f 726d 6174 4571 7561  assertFormatEqua
+0000b230: 6c28 226a 203d 205b 312c 2032 2c20 335d  l("j = [1, 2, 3]
+0000b240: 5c6e 222c 2022 6a20 3d20 5b31 2c20 322c  \n", "j = [1, 2,
+0000b250: 2033 2c5d 5c6e 2229 0a0a 2020 2020 2020   3,]\n")..      
+0000b260: 2020 6f75 745f 7374 7220 3d20 2222 2e6a    out_str = "".j
+0000b270: 6f69 6e28 6f75 745f 6c69 6e65 7329 0a20  oin(out_lines). 
+0000b280: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000b290: 7274 496e 2822 5472 6565 2044 6966 663a  rtIn("Tree Diff:
+0000b2a0: 222c 206f 7574 5f73 7472 290a 2020 2020  ", out_str).    
+0000b2b0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
+0000b2c0: 6e28 222b 2020 2020 2020 2020 2020 434f  n("+          CO
+0000b2d0: 4d4d 4122 2c20 6f75 745f 7374 7229 0a20  MMA", out_str). 
+0000b2e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000b2f0: 7274 496e 2822 2b20 272c 2722 2c20 6f75  rtIn("+ ','", ou
+0000b300: 745f 7374 7229 0a20 2020 2020 2020 2073  t_str).        s
+0000b310: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000b320: 2222 2e6a 6f69 6e28 6572 725f 6c69 6e65  "".join(err_line
+0000b330: 7329 2c20 2222 290a 0a20 2020 2040 6576  s), "")..    @ev
+0000b340: 656e 745f 6c6f 6f70 2829 0a20 2020 2040  ent_loop().    @
+0000b350: 7061 7463 6828 2263 6f6e 6375 7272 656e  patch("concurren
+0000b360: 742e 6675 7475 7265 732e 5072 6f63 6573  t.futures.Proces
+0000b370: 7350 6f6f 6c45 7865 6375 746f 7222 2c20  sPoolExecutor", 
+0000b380: 4d61 6769 634d 6f63 6b28 7369 6465 5f65  MagicMock(side_e
+0000b390: 6666 6563 743d 4f53 4572 726f 7229 290a  ffect=OSError)).
+0000b3a0: 2020 2020 6465 6620 7465 7374 5f77 6f72      def test_wor
+0000b3b0: 6b73 5f69 6e5f 6d6f 6e6f 5f70 726f 6365  ks_in_mono_proce
+0000b3c0: 7373 5f6f 6e6c 795f 656e 7669 726f 6e6d  ss_only_environm
+0000b3d0: 656e 7428 7365 6c66 2920 2d3e 204e 6f6e  ent(self) -> Non
+0000b3e0: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
+0000b3f0: 6361 6368 655f 6469 7228 2920 6173 2077  cache_dir() as w
+0000b400: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
+0000b410: 2020 2020 2020 666f 7220 6620 696e 205b        for f in [
+0000b420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b430: 2028 776f 726b 7370 6163 6520 2f20 226f   (workspace / "o
+0000b440: 6e65 2e70 7922 292e 7265 736f 6c76 6528  ne.py").resolve(
+0000b450: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000b460: 2020 2028 776f 726b 7370 6163 6520 2f20     (workspace / 
+0000b470: 2274 776f 2e70 7922 292e 7265 736f 6c76  "two.py").resolv
+0000b480: 6528 292c 0a20 2020 2020 2020 2020 2020  e(),.           
+0000b490: 205d 3a0a 2020 2020 2020 2020 2020 2020   ]:.            
+0000b4a0: 2020 2020 662e 7772 6974 655f 7465 7874      f.write_text
+0000b4b0: 2827 7072 696e 7428 2268 656c 6c6f 2229  ('print("hello")
+0000b4c0: 5c6e 272c 2065 6e63 6f64 696e 673d 2275  \n', encoding="u
+0000b4d0: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
+0000b4e0: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+0000b4f0: 6163 6b28 5b73 7472 2877 6f72 6b73 7061  ack([str(workspa
+0000b500: 6365 295d 290a 0a20 2020 2040 6576 656e  ce)])..    @even
+0000b510: 745f 6c6f 6f70 2829 0a20 2020 2064 6566  t_loop().    def
+0000b520: 2074 6573 745f 6368 6563 6b5f 6469 6666   test_check_diff
+0000b530: 5f75 7365 5f74 6f67 6574 6865 7228 7365  _use_together(se
+0000b540: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000b550: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+0000b560: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
+0000b570: 2020 2023 2046 696c 6573 2077 6869 6368     # Files which
+0000b580: 2077 696c 6c20 6265 2072 6566 6f72 6d61   will be reforma
+0000b590: 7474 6564 2e0a 2020 2020 2020 2020 2020  tted..          
+0000b5a0: 2020 7372 6331 203d 2067 6574 5f63 6173    src1 = get_cas
+0000b5b0: 655f 7061 7468 2822 6d69 7363 656c 6c61  e_path("miscella
+0000b5c0: 6e65 6f75 7322 2c20 2273 7472 696e 675f  neous", "string_
+0000b5d0: 7175 6f74 6573 2229 0a20 2020 2020 2020  quotes").       
+0000b5e0: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
+0000b5f0: 426c 6163 6b28 5b73 7472 2873 7263 3129  Black([str(src1)
+0000b600: 2c20 222d 2d64 6966 6622 2c20 222d 2d63  , "--diff", "--c
+0000b610: 6865 636b 225d 2c20 6578 6974 5f63 6f64  heck"], exit_cod
+0000b620: 653d 3129 0a20 2020 2020 2020 2020 2020  e=1).           
+0000b630: 2023 2046 696c 6573 2077 6869 6368 2077   # Files which w
+0000b640: 696c 6c20 6e6f 7420 6265 2072 6566 6f72  ill not be refor
+0000b650: 6d61 7474 6564 2e0a 2020 2020 2020 2020  matted..        
+0000b660: 2020 2020 7372 6332 203d 2067 6574 5f63      src2 = get_c
+0000b670: 6173 655f 7061 7468 2822 6361 7365 7322  ase_path("cases"
+0000b680: 2c20 2263 6f6d 706f 7369 7469 6f6e 2229  , "composition")
+0000b690: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000b6a0: 662e 696e 766f 6b65 426c 6163 6b28 5b73  f.invokeBlack([s
+0000b6b0: 7472 2873 7263 3229 2c20 222d 2d64 6966  tr(src2), "--dif
+0000b6c0: 6622 2c20 222d 2d63 6865 636b 225d 290a  f", "--check"]).
+0000b6d0: 2020 2020 2020 2020 2020 2020 2320 4d75              # Mu
+0000b6e0: 6c74 6920 6669 6c65 2063 6f6d 6d61 6e64  lti file command
+0000b6f0: 2e0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0000b700: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
+0000b710: 7374 7228 7372 6331 292c 2073 7472 2873  str(src1), str(s
+0000b720: 7263 3229 2c20 222d 2d64 6966 6622 2c20  rc2), "--diff", 
+0000b730: 222d 2d63 6865 636b 225d 2c20 6578 6974  "--check"], exit
+0000b740: 5f63 6f64 653d 3129 0a0a 2020 2020 6465  _code=1)..    de
+0000b750: 6620 7465 7374 5f6e 6f5f 7372 635f 6661  f test_no_src_fa
+0000b760: 696c 7328 7365 6c66 2920 2d3e 204e 6f6e  ils(self) -> Non
+0000b770: 653a 0a20 2020 2020 2020 2077 6974 6820  e:.        with 
+0000b780: 6361 6368 655f 6469 7228 293a 0a20 2020  cache_dir():.   
+0000b790: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
+0000b7a0: 766f 6b65 426c 6163 6b28 5b5d 2c20 6578  vokeBlack([], ex
+0000b7b0: 6974 5f63 6f64 653d 3129 0a0a 2020 2020  it_code=1)..    
+0000b7c0: 6465 6620 7465 7374 5f73 7263 5f61 6e64  def test_src_and
+0000b7d0: 5f63 6f64 655f 6661 696c 7328 7365 6c66  _code_fails(self
+0000b7e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000b7f0: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
+0000b800: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+0000b810: 2073 656c 662e 696e 766f 6b65 426c 6163   self.invokeBlac
+0000b820: 6b28 5b22 2e22 2c20 222d 6322 2c20 2230  k([".", "-c", "0
+0000b830: 225d 2c20 6578 6974 5f63 6f64 653d 3129  "], exit_code=1)
+0000b840: 0a0a 2020 2020 6465 6620 7465 7374 5f62  ..    def test_b
+0000b850: 726f 6b65 6e5f 7379 6d6c 696e 6b28 7365  roken_symlink(se
+0000b860: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000b870: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
+0000b880: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
+0000b890: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0000b8a0: 7379 6d6c 696e 6b20 3d20 776f 726b 7370  symlink = worksp
+0000b8b0: 6163 6520 2f20 2262 726f 6b65 6e5f 6c69  ace / "broken_li
+0000b8c0: 6e6b 2e70 7922 0a20 2020 2020 2020 2020  nk.py".         
+0000b8d0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000b8e0: 2020 2020 2020 2020 7379 6d6c 696e 6b2e          symlink.
+0000b8f0: 7379 6d6c 696e 6b5f 746f 2822 6e6f 6e65  symlink_to("none
+0000b900: 7869 7374 656e 742e 7079 2229 0a20 2020  xistent.py").   
+0000b910: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0000b920: 284f 5345 7272 6f72 2c20 4e6f 7449 6d70  (OSError, NotImp
+0000b930: 6c65 6d65 6e74 6564 4572 726f 7229 2061  lementedError) a
+0000b940: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000b950: 2020 2020 2073 656c 662e 736b 6970 5465       self.skipTe
+0000b960: 7374 2866 2243 616e 2774 2063 7265 6174  st(f"Can't creat
+0000b970: 6520 7379 6d6c 696e 6b73 3a20 7b65 7d22  e symlinks: {e}"
+0000b980: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000b990: 6c66 2e69 6e76 6f6b 6542 6c61 636b 285b  lf.invokeBlack([
+0000b9a0: 7374 7228 776f 726b 7370 6163 652e 7265  str(workspace.re
+0000b9b0: 736f 6c76 6528 2929 5d29 0a0a 2020 2020  solve())])..    
+0000b9c0: 6465 6620 7465 7374 5f73 696e 676c 655f  def test_single_
+0000b9d0: 6669 6c65 5f66 6f72 6365 5f70 7969 2873  file_force_pyi(s
+0000b9e0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000b9f0: 2020 2020 2020 7079 695f 6d6f 6465 203d        pyi_mode =
+0000ba00: 2072 6570 6c61 6365 2844 4546 4155 4c54   replace(DEFAULT
+0000ba10: 5f4d 4f44 452c 2069 735f 7079 693d 5472  _MODE, is_pyi=Tr
+0000ba20: 7565 290a 2020 2020 2020 2020 636f 6e74  ue).        cont
+0000ba30: 656e 7473 2c20 6578 7065 6374 6564 203d  ents, expected =
+0000ba40: 2072 6561 645f 6461 7461 2822 6d69 7363   read_data("misc
+0000ba50: 656c 6c61 6e65 6f75 7322 2c20 2266 6f72  ellaneous", "for
+0000ba60: 6365 5f70 7969 2229 0a20 2020 2020 2020  ce_pyi").       
+0000ba70: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
+0000ba80: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+0000ba90: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0000baa0: 203d 2028 776f 726b 7370 6163 6520 2f20   = (workspace / 
+0000bab0: 2266 696c 652e 7079 2229 2e72 6573 6f6c  "file.py").resol
+0000bac0: 7665 2829 0a20 2020 2020 2020 2020 2020  ve().           
+0000bad0: 2070 6174 682e 7772 6974 655f 7465 7874   path.write_text
+0000bae0: 2863 6f6e 7465 6e74 732c 2065 6e63 6f64  (contents, encod
+0000baf0: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
+0000bb00: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
+0000bb10: 766f 6b65 426c 6163 6b28 5b73 7472 2870  vokeBlack([str(p
+0000bb20: 6174 6829 2c20 222d 2d70 7969 225d 290a  ath), "--pyi"]).
+0000bb30: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+0000bb40: 616c 203d 2070 6174 682e 7265 6164 5f74  al = path.read_t
+0000bb50: 6578 7428 656e 636f 6469 6e67 3d22 7574  ext(encoding="ut
+0000bb60: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
+0000bb70: 2020 2320 7665 7269 6679 2063 6163 6865    # verify cache
+0000bb80: 2077 6974 6820 2d2d 7079 6920 6973 2073   with --pyi is s
+0000bb90: 6570 6172 6174 650a 2020 2020 2020 2020  eparate.        
+0000bba0: 2020 2020 7079 695f 6361 6368 6520 3d20      pyi_cache = 
+0000bbb0: 626c 6163 6b2e 4361 6368 652e 7265 6164  black.Cache.read
+0000bbc0: 2870 7969 5f6d 6f64 6529 0a20 2020 2020  (pyi_mode).     
+0000bbd0: 2020 2020 2020 2061 7373 6572 7420 6e6f         assert no
+0000bbe0: 7420 7079 695f 6361 6368 652e 6973 5f63  t pyi_cache.is_c
+0000bbf0: 6861 6e67 6564 2870 6174 6829 0a20 2020  hanged(path).   
+0000bc00: 2020 2020 2020 2020 206e 6f72 6d61 6c5f           normal_
+0000bc10: 6361 6368 6520 3d20 626c 6163 6b2e 4361  cache = black.Ca
+0000bc20: 6368 652e 7265 6164 2844 4546 4155 4c54  che.read(DEFAULT
+0000bc30: 5f4d 4f44 4529 0a20 2020 2020 2020 2020  _MODE).         
+0000bc40: 2020 2061 7373 6572 7420 6e6f 726d 616c     assert normal
+0000bc50: 5f63 6163 6865 2e69 735f 6368 616e 6765  _cache.is_change
+0000bc60: 6428 7061 7468 290a 2020 2020 2020 2020  d(path).        
+0000bc70: 7365 6c66 2e61 7373 6572 7446 6f72 6d61  self.assertForma
+0000bc80: 7445 7175 616c 2865 7870 6563 7465 642c  tEqual(expected,
+0000bc90: 2061 6374 7561 6c29 0a20 2020 2020 2020   actual).       
+0000bca0: 2062 6c61 636b 2e61 7373 6572 745f 6571   black.assert_eq
+0000bcb0: 7569 7661 6c65 6e74 2863 6f6e 7465 6e74  uivalent(content
+0000bcc0: 732c 2061 6374 7561 6c29 0a20 2020 2020  s, actual).     
+0000bcd0: 2020 2062 6c61 636b 2e61 7373 6572 745f     black.assert_
+0000bce0: 7374 6162 6c65 2863 6f6e 7465 6e74 732c  stable(contents,
+0000bcf0: 2061 6374 7561 6c2c 2070 7969 5f6d 6f64   actual, pyi_mod
+0000bd00: 6529 0a0a 2020 2020 4065 7665 6e74 5f6c  e)..    @event_l
+0000bd10: 6f6f 7028 290a 2020 2020 6465 6620 7465  oop().    def te
+0000bd20: 7374 5f6d 756c 7469 5f66 696c 655f 666f  st_multi_file_fo
+0000bd30: 7263 655f 7079 6928 7365 6c66 2920 2d3e  rce_pyi(self) ->
+0000bd40: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
+0000bd50: 6567 5f6d 6f64 6520 3d20 4445 4641 554c  eg_mode = DEFAUL
+0000bd60: 545f 4d4f 4445 0a20 2020 2020 2020 2070  T_MODE.        p
+0000bd70: 7969 5f6d 6f64 6520 3d20 7265 706c 6163  yi_mode = replac
+0000bd80: 6528 4445 4641 554c 545f 4d4f 4445 2c20  e(DEFAULT_MODE, 
+0000bd90: 6973 5f70 7969 3d54 7275 6529 0a20 2020  is_pyi=True).   
+0000bda0: 2020 2020 2063 6f6e 7465 6e74 732c 2065       contents, e
+0000bdb0: 7870 6563 7465 6420 3d20 7265 6164 5f64  xpected = read_d
+0000bdc0: 6174 6128 226d 6973 6365 6c6c 616e 656f  ata("miscellaneo
+0000bdd0: 7573 222c 2022 666f 7263 655f 7079 6922  us", "force_pyi"
+0000bde0: 290a 2020 2020 2020 2020 7769 7468 2063  ).        with c
+0000bdf0: 6163 6865 5f64 6972 2829 2061 7320 776f  ache_dir() as wo
+0000be00: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
+0000be10: 2020 2020 2070 6174 6873 203d 205b 0a20       paths = [. 
+0000be20: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0000be30: 776f 726b 7370 6163 6520 2f20 2266 696c  workspace / "fil
+0000be40: 6531 2e70 7922 292e 7265 736f 6c76 6528  e1.py").resolve(
+0000be50: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000be60: 2020 2028 776f 726b 7370 6163 6520 2f20     (workspace / 
+0000be70: 2266 696c 6532 2e70 7922 292e 7265 736f  "file2.py").reso
+0000be80: 6c76 6528 292c 0a20 2020 2020 2020 2020  lve(),.         
+0000be90: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+0000bea0: 2066 6f72 2070 6174 6820 696e 2070 6174   for path in pat
+0000beb0: 6873 3a0a 2020 2020 2020 2020 2020 2020  hs:.            
+0000bec0: 2020 2020 7061 7468 2e77 7269 7465 5f74      path.write_t
+0000bed0: 6578 7428 636f 6e74 656e 7473 2c20 656e  ext(contents, en
+0000bee0: 636f 6469 6e67 3d22 7574 662d 3822 290a  coding="utf-8").
+0000bef0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bf00: 2e69 6e76 6f6b 6542 6c61 636b 285b 7374  .invokeBlack([st
+0000bf10: 7228 7029 2066 6f72 2070 2069 6e20 7061  r(p) for p in pa
+0000bf20: 7468 735d 202b 205b 222d 2d70 7969 225d  ths] + ["--pyi"]
+0000bf30: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+0000bf40: 7220 7061 7468 2069 6e20 7061 7468 733a  r path in paths:
+0000bf50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bf60: 2061 6374 7561 6c20 3d20 7061 7468 2e72   actual = path.r
+0000bf70: 6561 645f 7465 7874 2865 6e63 6f64 696e  ead_text(encodin
+0000bf80: 673d 2275 7466 2d38 2229 0a20 2020 2020  g="utf-8").     
+0000bf90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000bfa0: 6173 7365 7274 4571 7561 6c28 6163 7475  assertEqual(actu
+0000bfb0: 616c 2c20 6578 7065 6374 6564 290a 2020  al, expected).  
+0000bfc0: 2020 2020 2020 2020 2020 2320 7665 7269            # veri
+0000bfd0: 6679 2063 6163 6865 2077 6974 6820 2d2d  fy cache with --
+0000bfe0: 7079 6920 6973 2073 6570 6172 6174 650a  pyi is separate.
+0000bff0: 2020 2020 2020 2020 2020 2020 7079 695f              pyi_
+0000c000: 6361 6368 6520 3d20 626c 6163 6b2e 4361  cache = black.Ca
+0000c010: 6368 652e 7265 6164 2870 7969 5f6d 6f64  che.read(pyi_mod
+0000c020: 6529 0a20 2020 2020 2020 2020 2020 206e  e).            n
+0000c030: 6f72 6d61 6c5f 6361 6368 6520 3d20 626c  ormal_cache = bl
+0000c040: 6163 6b2e 4361 6368 652e 7265 6164 2872  ack.Cache.read(r
+0000c050: 6567 5f6d 6f64 6529 0a20 2020 2020 2020  eg_mode).       
+0000c060: 2020 2020 2066 6f72 2070 6174 6820 696e       for path in
+0000c070: 2070 6174 6873 3a0a 2020 2020 2020 2020   paths:.        
+0000c080: 2020 2020 2020 2020 6173 7365 7274 206e          assert n
+0000c090: 6f74 2070 7969 5f63 6163 6865 2e69 735f  ot pyi_cache.is_
+0000c0a0: 6368 616e 6765 6428 7061 7468 290a 2020  changed(path).  
+0000c0b0: 2020 2020 2020 2020 2020 2020 2020 6173                as
+0000c0c0: 7365 7274 206e 6f72 6d61 6c5f 6361 6368  sert normal_cach
+0000c0d0: 652e 6973 5f63 6861 6e67 6564 2870 6174  e.is_changed(pat
+0000c0e0: 6829 0a0a 2020 2020 6465 6620 7465 7374  h)..    def test
+0000c0f0: 5f70 6970 655f 666f 7263 655f 7079 6928  _pipe_force_pyi(
+0000c100: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000c110: 2020 2020 2020 2073 6f75 7263 652c 2065         source, e
+0000c120: 7870 6563 7465 6420 3d20 7265 6164 5f64  xpected = read_d
+0000c130: 6174 6128 226d 6973 6365 6c6c 616e 656f  ata("miscellaneo
+0000c140: 7573 222c 2022 666f 7263 655f 7079 6922  us", "force_pyi"
+0000c150: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
+0000c160: 203d 2043 6c69 5275 6e6e 6572 2829 2e69   = CliRunner().i
+0000c170: 6e76 6f6b 6528 0a20 2020 2020 2020 2020  nvoke(.         
+0000c180: 2020 2062 6c61 636b 2e6d 6169 6e2c 205b     black.main, [
+0000c190: 222d 222c 2022 2d71 222c 2022 2d2d 7079  "-", "-q", "--py
+0000c1a0: 6922 5d2c 2069 6e70 7574 3d42 7974 6573  i"], input=Bytes
+0000c1b0: 494f 2873 6f75 7263 652e 656e 636f 6465  IO(source.encode
+0000c1c0: 2822 7574 662d 3822 2929 0a20 2020 2020  ("utf-8")).     
+0000c1d0: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+0000c1e0: 662e 6173 7365 7274 4571 7561 6c28 7265  f.assertEqual(re
+0000c1f0: 7375 6c74 2e65 7869 745f 636f 6465 2c20  sult.exit_code, 
+0000c200: 3029 0a20 2020 2020 2020 2061 6374 7561  0).        actua
+0000c210: 6c20 3d20 7265 7375 6c74 2e6f 7574 7075  l = result.outpu
+0000c220: 740a 2020 2020 2020 2020 7365 6c66 2e61  t.        self.a
+0000c230: 7373 6572 7446 6f72 6d61 7445 7175 616c  ssertFormatEqual
+0000c240: 2861 6374 7561 6c2c 2065 7870 6563 7465  (actual, expecte
+0000c250: 6429 0a0a 2020 2020 6465 6620 7465 7374  d)..    def test
+0000c260: 5f73 696e 676c 655f 6669 6c65 5f66 6f72  _single_file_for
+0000c270: 6365 5f70 7933 3628 7365 6c66 2920 2d3e  ce_py36(self) ->
+0000c280: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
+0000c290: 6567 5f6d 6f64 6520 3d20 4445 4641 554c  eg_mode = DEFAUL
+0000c2a0: 545f 4d4f 4445 0a20 2020 2020 2020 2070  T_MODE.        p
+0000c2b0: 7933 365f 6d6f 6465 203d 2072 6570 6c61  y36_mode = repla
+0000c2c0: 6365 2844 4546 4155 4c54 5f4d 4f44 452c  ce(DEFAULT_MODE,
+0000c2d0: 2074 6172 6765 745f 7665 7273 696f 6e73   target_versions
+0000c2e0: 3d50 5933 365f 5645 5253 494f 4e53 290a  =PY36_VERSIONS).
+0000c2f0: 2020 2020 2020 2020 736f 7572 6365 2c20          source, 
+0000c300: 6578 7065 6374 6564 203d 2072 6561 645f  expected = read_
+0000c310: 6461 7461 2822 6d69 7363 656c 6c61 6e65  data("miscellane
+0000c320: 6f75 7322 2c20 2266 6f72 6365 5f70 7933  ous", "force_py3
+0000c330: 3622 290a 2020 2020 2020 2020 7769 7468  6").        with
+0000c340: 2063 6163 6865 5f64 6972 2829 2061 7320   cache_dir() as 
+0000c350: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
+0000c360: 2020 2020 2020 2070 6174 6820 3d20 2877         path = (w
+0000c370: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
+0000c380: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
+0000c390: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0000c3a0: 2e77 7269 7465 5f74 6578 7428 736f 7572  .write_text(sour
+0000c3b0: 6365 2c20 656e 636f 6469 6e67 3d22 7574  ce, encoding="ut
+0000c3c0: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
+0000c3d0: 2020 7365 6c66 2e69 6e76 6f6b 6542 6c61    self.invokeBla
+0000c3e0: 636b 285b 7374 7228 7061 7468 292c 202a  ck([str(path), *
+0000c3f0: 5059 3336 5f41 5247 535d 290a 2020 2020  PY36_ARGS]).    
+0000c400: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
+0000c410: 2070 6174 682e 7265 6164 5f74 6578 7428   path.read_text(
+0000c420: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
+0000c430: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0000c440: 7665 7269 6679 2063 6163 6865 2077 6974  verify cache wit
+0000c450: 6820 2d2d 7461 7267 6574 2d76 6572 7369  h --target-versi
+0000c460: 6f6e 2069 7320 7365 7061 7261 7465 0a20  on is separate. 
+0000c470: 2020 2020 2020 2020 2020 2070 7933 365f             py36_
+0000c480: 6361 6368 6520 3d20 626c 6163 6b2e 4361  cache = black.Ca
+0000c490: 6368 652e 7265 6164 2870 7933 365f 6d6f  che.read(py36_mo
+0000c4a0: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
+0000c4b0: 6173 7365 7274 206e 6f74 2070 7933 365f  assert not py36_
+0000c4c0: 6361 6368 652e 6973 5f63 6861 6e67 6564  cache.is_changed
+0000c4d0: 2870 6174 6829 0a20 2020 2020 2020 2020  (path).         
+0000c4e0: 2020 206e 6f72 6d61 6c5f 6361 6368 6520     normal_cache 
+0000c4f0: 3d20 626c 6163 6b2e 4361 6368 652e 7265  = black.Cache.re
+0000c500: 6164 2872 6567 5f6d 6f64 6529 0a20 2020  ad(reg_mode).   
+0000c510: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+0000c520: 6e6f 726d 616c 5f63 6163 6865 2e69 735f  normal_cache.is_
+0000c530: 6368 616e 6765 6428 7061 7468 290a 2020  changed(path).  
+0000c540: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000c550: 7445 7175 616c 2861 6374 7561 6c2c 2065  tEqual(actual, e
+0000c560: 7870 6563 7465 6429 0a0a 2020 2020 4065  xpected)..    @e
+0000c570: 7665 6e74 5f6c 6f6f 7028 290a 2020 2020  vent_loop().    
+0000c580: 6465 6620 7465 7374 5f6d 756c 7469 5f66  def test_multi_f
+0000c590: 696c 655f 666f 7263 655f 7079 3336 2873  ile_force_py36(s
+0000c5a0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000c5b0: 2020 2020 2020 7265 675f 6d6f 6465 203d        reg_mode =
+0000c5c0: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
+0000c5d0: 2020 2020 2020 7079 3336 5f6d 6f64 6520        py36_mode 
+0000c5e0: 3d20 7265 706c 6163 6528 4445 4641 554c  = replace(DEFAUL
+0000c5f0: 545f 4d4f 4445 2c20 7461 7267 6574 5f76  T_MODE, target_v
+0000c600: 6572 7369 6f6e 733d 5059 3336 5f56 4552  ersions=PY36_VER
+0000c610: 5349 4f4e 5329 0a20 2020 2020 2020 2073  SIONS).        s
+0000c620: 6f75 7263 652c 2065 7870 6563 7465 6420  ource, expected 
+0000c630: 3d20 7265 6164 5f64 6174 6128 226d 6973  = read_data("mis
+0000c640: 6365 6c6c 616e 656f 7573 222c 2022 666f  cellaneous", "fo
+0000c650: 7263 655f 7079 3336 2229 0a20 2020 2020  rce_py36").     
+0000c660: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
+0000c670: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
+0000c680: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+0000c690: 7468 7320 3d20 5b0a 2020 2020 2020 2020  ths = [.        
+0000c6a0: 2020 2020 2020 2020 2877 6f72 6b73 7061          (workspa
+0000c6b0: 6365 202f 2022 6669 6c65 312e 7079 2229  ce / "file1.py")
+0000c6c0: 2e72 6573 6f6c 7665 2829 2c0a 2020 2020  .resolve(),.    
+0000c6d0: 2020 2020 2020 2020 2020 2020 2877 6f72              (wor
+0000c6e0: 6b73 7061 6365 202f 2022 6669 6c65 322e  kspace / "file2.
+0000c6f0: 7079 2229 2e72 6573 6f6c 7665 2829 2c0a  py").resolve(),.
+0000c700: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
+0000c710: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
+0000c720: 7468 2069 6e20 7061 7468 733a 0a20 2020  th in paths:.   
+0000c730: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+0000c740: 682e 7772 6974 655f 7465 7874 2873 6f75  h.write_text(sou
+0000c750: 7263 652c 2065 6e63 6f64 696e 673d 2275  rce, encoding="u
+0000c760: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
+0000c770: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+0000c780: 6163 6b28 5b73 7472 2870 2920 666f 7220  ack([str(p) for 
+0000c790: 7020 696e 2070 6174 6873 5d20 2b20 5059  p in paths] + PY
+0000c7a0: 3336 5f41 5247 5329 0a20 2020 2020 2020  36_ARGS).       
+0000c7b0: 2020 2020 2066 6f72 2070 6174 6820 696e       for path in
+0000c7c0: 2070 6174 6873 3a0a 2020 2020 2020 2020   paths:.        
+0000c7d0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
+0000c7e0: 2070 6174 682e 7265 6164 5f74 6578 7428   path.read_text(
+0000c7f0: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
+0000c800: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c810: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000c820: 616c 2861 6374 7561 6c2c 2065 7870 6563  al(actual, expec
+0000c830: 7465 6429 0a20 2020 2020 2020 2020 2020  ted).           
+0000c840: 2023 2076 6572 6966 7920 6361 6368 6520   # verify cache 
+0000c850: 7769 7468 202d 2d74 6172 6765 742d 7665  with --target-ve
+0000c860: 7273 696f 6e20 6973 2073 6570 6172 6174  rsion is separat
+0000c870: 650a 2020 2020 2020 2020 2020 2020 7079  e.            py
+0000c880: 695f 6361 6368 6520 3d20 626c 6163 6b2e  i_cache = black.
+0000c890: 4361 6368 652e 7265 6164 2870 7933 365f  Cache.read(py36_
+0000c8a0: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
+0000c8b0: 2020 6e6f 726d 616c 5f63 6163 6865 203d    normal_cache =
+0000c8c0: 2062 6c61 636b 2e43 6163 6865 2e72 6561   black.Cache.rea
+0000c8d0: 6428 7265 675f 6d6f 6465 290a 2020 2020  d(reg_mode).    
+0000c8e0: 2020 2020 2020 2020 666f 7220 7061 7468          for path
+0000c8f0: 2069 6e20 7061 7468 733a 0a20 2020 2020   in paths:.     
+0000c900: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0000c910: 7420 6e6f 7420 7079 695f 6361 6368 652e  t not pyi_cache.
+0000c920: 6973 5f63 6861 6e67 6564 2870 6174 6829  is_changed(path)
+0000c930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c940: 2061 7373 6572 7420 6e6f 726d 616c 5f63   assert normal_c
+0000c950: 6163 6865 2e69 735f 6368 616e 6765 6428  ache.is_changed(
+0000c960: 7061 7468 290a 0a20 2020 2064 6566 2074  path)..    def t
+0000c970: 6573 745f 7069 7065 5f66 6f72 6365 5f70  est_pipe_force_p
+0000c980: 7933 3628 7365 6c66 2920 2d3e 204e 6f6e  y36(self) -> Non
+0000c990: 653a 0a20 2020 2020 2020 2073 6f75 7263  e:.        sourc
+0000c9a0: 652c 2065 7870 6563 7465 6420 3d20 7265  e, expected = re
+0000c9b0: 6164 5f64 6174 6128 226d 6973 6365 6c6c  ad_data("miscell
+0000c9c0: 616e 656f 7573 222c 2022 666f 7263 655f  aneous", "force_
+0000c9d0: 7079 3336 2229 0a20 2020 2020 2020 2072  py36").        r
+0000c9e0: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
+0000c9f0: 7228 292e 696e 766f 6b65 280a 2020 2020  r().invoke(.    
+0000ca00: 2020 2020 2020 2020 626c 6163 6b2e 6d61          black.ma
+0000ca10: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+0000ca20: 5b22 2d22 2c20 222d 7122 2c20 222d 2d74  ["-", "-q", "--t
+0000ca30: 6172 6765 742d 7665 7273 696f 6e3d 7079  arget-version=py
+0000ca40: 3336 225d 2c0a 2020 2020 2020 2020 2020  36"],.          
+0000ca50: 2020 696e 7075 743d 4279 7465 7349 4f28    input=BytesIO(
+0000ca60: 736f 7572 6365 2e65 6e63 6f64 6528 2275  source.encode("u
+0000ca70: 7466 2d38 2229 292c 0a20 2020 2020 2020  tf-8")),.       
+0000ca80: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
+0000ca90: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
+0000caa0: 6c74 2e65 7869 745f 636f 6465 2c20 3029  lt.exit_code, 0)
+0000cab0: 0a20 2020 2020 2020 2061 6374 7561 6c20  .        actual 
+0000cac0: 3d20 7265 7375 6c74 2e6f 7574 7075 740a  = result.output.
+0000cad0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000cae0: 6572 7446 6f72 6d61 7445 7175 616c 2861  ertFormatEqual(a
+0000caf0: 6374 7561 6c2c 2065 7870 6563 7465 6429  ctual, expected)
+0000cb00: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
+0000cb10: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
+0000cb20: 7769 7468 5f6d 7970 7963 0a20 2020 2064  with_mypyc.    d
+0000cb30: 6566 2074 6573 745f 7265 666f 726d 6174  ef test_reformat
+0000cb40: 5f6f 6e65 5f77 6974 685f 7374 6469 6e28  _one_with_stdin(
+0000cb50: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000cb60: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
+0000cb70: 6828 0a20 2020 2020 2020 2020 2020 2022  h(.            "
+0000cb80: 626c 6163 6b2e 666f 726d 6174 5f73 7464  black.format_std
+0000cb90: 696e 5f74 6f5f 7374 646f 7574 222c 0a20  in_to_stdout",. 
+0000cba0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000cbb0: 6e5f 7661 6c75 653d 6c61 6d62 6461 202a  n_value=lambda *
+0000cbc0: 6172 6773 2c20 2a2a 6b77 6172 6773 3a20  args, **kwargs: 
+0000cbd0: 626c 6163 6b2e 4368 616e 6765 642e 5945  black.Changed.YE
+0000cbe0: 532c 0a20 2020 2020 2020 2029 2061 7320  S,.        ) as 
+0000cbf0: 6673 7473 3a0a 2020 2020 2020 2020 2020  fsts:.          
+0000cc00: 2020 7265 706f 7274 203d 204d 6167 6963    report = Magic
+0000cc10: 4d6f 636b 2829 0a20 2020 2020 2020 2020  Mock().         
+0000cc20: 2020 2070 6174 6820 3d20 5061 7468 2822     path = Path("
+0000cc30: 2d22 290a 2020 2020 2020 2020 2020 2020  -").            
+0000cc40: 626c 6163 6b2e 7265 666f 726d 6174 5f6f  black.reformat_o
+0000cc50: 6e65 280a 2020 2020 2020 2020 2020 2020  ne(.            
+0000cc60: 2020 2020 7061 7468 2c0a 2020 2020 2020      path,.      
+0000cc70: 2020 2020 2020 2020 2020 6661 7374 3d54            fast=T
+0000cc80: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+0000cc90: 2020 2020 2077 7269 7465 5f62 6163 6b3d       write_back=
+0000cca0: 626c 6163 6b2e 5772 6974 6542 6163 6b2e  black.WriteBack.
+0000ccb0: 5945 532c 0a20 2020 2020 2020 2020 2020  YES,.           
+0000ccc0: 2020 2020 206d 6f64 653d 4445 4641 554c       mode=DEFAUL
+0000ccd0: 545f 4d4f 4445 2c0a 2020 2020 2020 2020  T_MODE,.        
+0000cce0: 2020 2020 2020 2020 7265 706f 7274 3d72          report=r
+0000ccf0: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
+0000cd00: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000cd10: 2066 7374 732e 6173 7365 7274 5f63 616c   fsts.assert_cal
+0000cd20: 6c65 645f 6f6e 6365 2829 0a20 2020 2020  led_once().     
+0000cd30: 2020 2020 2020 2072 6570 6f72 742e 646f         report.do
+0000cd40: 6e65 2e61 7373 6572 745f 6361 6c6c 6564  ne.assert_called
+0000cd50: 5f77 6974 6828 7061 7468 2c20 626c 6163  _with(path, blac
+0000cd60: 6b2e 4368 616e 6765 642e 5945 5329 0a0a  k.Changed.YES)..
+0000cd70: 2020 2020 4070 7974 6573 742e 6d61 726b      @pytest.mark
+0000cd80: 2e69 6e63 6f6d 7061 7469 626c 655f 7769  .incompatible_wi
+0000cd90: 7468 5f6d 7970 7963 0a20 2020 2064 6566  th_mypyc.    def
+0000cda0: 2074 6573 745f 7265 666f 726d 6174 5f6f   test_reformat_o
+0000cdb0: 6e65 5f77 6974 685f 7374 6469 6e5f 6669  ne_with_stdin_fi
+0000cdc0: 6c65 6e61 6d65 2873 656c 6629 202d 3e20  lename(self) -> 
+0000cdd0: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
+0000cde0: 7468 2070 6174 6368 280a 2020 2020 2020  th patch(.      
+0000cdf0: 2020 2020 2020 2262 6c61 636b 2e66 6f72        "black.for
+0000ce00: 6d61 745f 7374 6469 6e5f 746f 5f73 7464  mat_stdin_to_std
+0000ce10: 6f75 7422 2c0a 2020 2020 2020 2020 2020  out",.          
+0000ce20: 2020 7265 7475 726e 5f76 616c 7565 3d6c    return_value=l
+0000ce30: 616d 6264 6120 2a61 7267 732c 202a 2a6b  ambda *args, **k
+0000ce40: 7761 7267 733a 2062 6c61 636b 2e43 6861  wargs: black.Cha
+0000ce50: 6e67 6564 2e59 4553 2c0a 2020 2020 2020  nged.YES,.      
+0000ce60: 2020 2920 6173 2066 7374 733a 0a20 2020    ) as fsts:.   
+0000ce70: 2020 2020 2020 2020 2072 6570 6f72 7420           report 
+0000ce80: 3d20 4d61 6769 634d 6f63 6b28 290a 2020  = MagicMock().  
+0000ce90: 2020 2020 2020 2020 2020 7020 3d20 2266            p = "f
+0000cea0: 6f6f 2e70 7922 0a20 2020 2020 2020 2020  oo.py".         
+0000ceb0: 2020 2070 6174 6820 3d20 5061 7468 2866     path = Path(f
+0000cec0: 225f 5f42 4c41 434b 5f53 5444 494e 5f46  "__BLACK_STDIN_F
+0000ced0: 494c 454e 414d 455f 5f7b 707d 2229 0a20  ILENAME__{p}"). 
+0000cee0: 2020 2020 2020 2020 2020 2065 7870 6563             expec
+0000cef0: 7465 6420 3d20 5061 7468 2870 290a 2020  ted = Path(p).  
+0000cf00: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
+0000cf10: 7265 666f 726d 6174 5f6f 6e65 280a 2020  reformat_one(.  
+0000cf20: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000cf30: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+0000cf40: 2020 2020 6661 7374 3d54 7275 652c 0a20      fast=True,. 
+0000cf50: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000cf60: 7269 7465 5f62 6163 6b3d 626c 6163 6b2e  rite_back=black.
+0000cf70: 5772 6974 6542 6163 6b2e 5945 532c 0a20  WriteBack.YES,. 
+0000cf80: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000cf90: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
+0000cfa0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cfb0: 2020 7265 706f 7274 3d72 6570 6f72 742c    report=report,
+0000cfc0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000cfd0: 2020 2020 2020 2020 2020 2066 7374 732e             fsts.
+0000cfe0: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
+0000cff0: 6365 5f77 6974 6828 0a20 2020 2020 2020  ce_with(.       
+0000d000: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
+0000d010: 7565 2c20 7772 6974 655f 6261 636b 3d62  ue, write_back=b
+0000d020: 6c61 636b 2e57 7269 7465 4261 636b 2e59  lack.WriteBack.Y
+0000d030: 4553 2c20 6d6f 6465 3d44 4546 4155 4c54  ES, mode=DEFAULT
+0000d040: 5f4d 4f44 452c 206c 696e 6573 3d28 290a  _MODE, lines=().
+0000d050: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000d060: 2020 2020 2020 2020 2020 2320 5f5f 424c            # __BL
+0000d070: 4143 4b5f 5354 4449 4e5f 4649 4c45 4e41  ACK_STDIN_FILENA
+0000d080: 4d45 5f5f 2073 686f 756c 6420 6861 7665  ME__ should have
+0000d090: 2062 6565 6e20 7374 7269 7070 6564 0a20   been stripped. 
+0000d0a0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+0000d0b0: 742e 646f 6e65 2e61 7373 6572 745f 6361  t.done.assert_ca
+0000d0c0: 6c6c 6564 5f77 6974 6828 6578 7065 6374  lled_with(expect
+0000d0d0: 6564 2c20 626c 6163 6b2e 4368 616e 6765  ed, black.Change
+0000d0e0: 642e 5945 5329 0a0a 2020 2020 4070 7974  d.YES)..    @pyt
+0000d0f0: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
+0000d100: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
+0000d110: 0a20 2020 2064 6566 2074 6573 745f 7265  .    def test_re
+0000d120: 666f 726d 6174 5f6f 6e65 5f77 6974 685f  format_one_with_
+0000d130: 7374 6469 6e5f 6669 6c65 6e61 6d65 5f70  stdin_filename_p
+0000d140: 7969 2873 656c 6629 202d 3e20 4e6f 6e65  yi(self) -> None
+0000d150: 3a0a 2020 2020 2020 2020 7769 7468 2070  :.        with p
+0000d160: 6174 6368 280a 2020 2020 2020 2020 2020  atch(.          
+0000d170: 2020 2262 6c61 636b 2e66 6f72 6d61 745f    "black.format_
+0000d180: 7374 6469 6e5f 746f 5f73 7464 6f75 7422  stdin_to_stdout"
+0000d190: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
+0000d1a0: 7475 726e 5f76 616c 7565 3d6c 616d 6264  turn_value=lambd
+0000d1b0: 6120 2a61 7267 732c 202a 2a6b 7761 7267  a *args, **kwarg
+0000d1c0: 733a 2062 6c61 636b 2e43 6861 6e67 6564  s: black.Changed
+0000d1d0: 2e59 4553 2c0a 2020 2020 2020 2020 2920  .YES,.        ) 
+0000d1e0: 6173 2066 7374 733a 0a20 2020 2020 2020  as fsts:.       
+0000d1f0: 2020 2020 2072 6570 6f72 7420 3d20 4d61       report = Ma
+0000d200: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
+0000d210: 2020 2020 2020 7020 3d20 2266 6f6f 2e70        p = "foo.p
+0000d220: 7969 220a 2020 2020 2020 2020 2020 2020  yi".            
+0000d230: 7061 7468 203d 2050 6174 6828 6622 5f5f  path = Path(f"__
+0000d240: 424c 4143 4b5f 5354 4449 4e5f 4649 4c45  BLACK_STDIN_FILE
+0000d250: 4e41 4d45 5f5f 7b70 7d22 290a 2020 2020  NAME__{p}").    
+0000d260: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+0000d270: 203d 2050 6174 6828 7029 0a20 2020 2020   = Path(p).     
+0000d280: 2020 2020 2020 2062 6c61 636b 2e72 6566         black.ref
+0000d290: 6f72 6d61 745f 6f6e 6528 0a20 2020 2020  ormat_one(.     
+0000d2a0: 2020 2020 2020 2020 2020 2070 6174 682c             path,
+0000d2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d2c0: 2066 6173 743d 5472 7565 2c0a 2020 2020   fast=True,.    
+0000d2d0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+0000d2e0: 655f 6261 636b 3d62 6c61 636b 2e57 7269  e_back=black.Wri
+0000d2f0: 7465 4261 636b 2e59 4553 2c0a 2020 2020  teBack.YES,.    
+0000d300: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0000d310: 3d44 4546 4155 4c54 5f4d 4f44 452c 0a20  =DEFAULT_MODE,. 
+0000d320: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000d330: 6570 6f72 743d 7265 706f 7274 2c0a 2020  eport=report,.  
+0000d340: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d350: 2020 2020 2020 2020 6673 7473 2e61 7373          fsts.ass
+0000d360: 6572 745f 6361 6c6c 6564 5f6f 6e63 655f  ert_called_once_
+0000d370: 7769 7468 280a 2020 2020 2020 2020 2020  with(.          
+0000d380: 2020 2020 2020 6661 7374 3d54 7275 652c        fast=True,
+0000d390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d3a0: 2077 7269 7465 5f62 6163 6b3d 626c 6163   write_back=blac
+0000d3b0: 6b2e 5772 6974 6542 6163 6b2e 5945 532c  k.WriteBack.YES,
+0000d3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d3d0: 206d 6f64 653d 7265 706c 6163 6528 4445   mode=replace(DE
+0000d3e0: 4641 554c 545f 4d4f 4445 2c20 6973 5f70  FAULT_MODE, is_p
+0000d3f0: 7969 3d54 7275 6529 2c0a 2020 2020 2020  yi=True),.      
+0000d400: 2020 2020 2020 2020 2020 6c69 6e65 733d            lines=
+0000d410: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+0000d420: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0000d430: 5f5f 424c 4143 4b5f 5354 4449 4e5f 4649  __BLACK_STDIN_FI
+0000d440: 4c45 4e41 4d45 5f5f 2073 686f 756c 6420  LENAME__ should 
+0000d450: 6861 7665 2062 6565 6e20 7374 7269 7070  have been stripp
+0000d460: 6564 0a20 2020 2020 2020 2020 2020 2072  ed.            r
+0000d470: 6570 6f72 742e 646f 6e65 2e61 7373 6572  eport.done.asser
+0000d480: 745f 6361 6c6c 6564 5f77 6974 6828 6578  t_called_with(ex
+0000d490: 7065 6374 6564 2c20 626c 6163 6b2e 4368  pected, black.Ch
+0000d4a0: 616e 6765 642e 5945 5329 0a0a 2020 2020  anged.YES)..    
+0000d4b0: 4070 7974 6573 742e 6d61 726b 2e69 6e63  @pytest.mark.inc
+0000d4c0: 6f6d 7061 7469 626c 655f 7769 7468 5f6d  ompatible_with_m
+0000d4d0: 7970 7963 0a20 2020 2064 6566 2074 6573  ypyc.    def tes
+0000d4e0: 745f 7265 666f 726d 6174 5f6f 6e65 5f77  t_reformat_one_w
+0000d4f0: 6974 685f 7374 6469 6e5f 6669 6c65 6e61  ith_stdin_filena
+0000d500: 6d65 5f69 7079 6e62 2873 656c 6629 202d  me_ipynb(self) -
+0000d510: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000d520: 7769 7468 2070 6174 6368 280a 2020 2020  with patch(.    
+0000d530: 2020 2020 2020 2020 2262 6c61 636b 2e66          "black.f
+0000d540: 6f72 6d61 745f 7374 6469 6e5f 746f 5f73  ormat_stdin_to_s
+0000d550: 7464 6f75 7422 2c0a 2020 2020 2020 2020  tdout",.        
+0000d560: 2020 2020 7265 7475 726e 5f76 616c 7565      return_value
+0000d570: 3d6c 616d 6264 6120 2a61 7267 732c 202a  =lambda *args, *
+0000d580: 2a6b 7761 7267 733a 2062 6c61 636b 2e43  *kwargs: black.C
+0000d590: 6861 6e67 6564 2e59 4553 2c0a 2020 2020  hanged.YES,.    
+0000d5a0: 2020 2020 2920 6173 2066 7374 733a 0a20      ) as fsts:. 
+0000d5b0: 2020 2020 2020 2020 2020 2072 6570 6f72             repor
+0000d5c0: 7420 3d20 4d61 6769 634d 6f63 6b28 290a  t = MagicMock().
+0000d5d0: 2020 2020 2020 2020 2020 2020 7020 3d20              p = 
+0000d5e0: 2266 6f6f 2e69 7079 6e62 220a 2020 2020  "foo.ipynb".    
+0000d5f0: 2020 2020 2020 2020 7061 7468 203d 2050          path = P
+0000d600: 6174 6828 6622 5f5f 424c 4143 4b5f 5354  ath(f"__BLACK_ST
+0000d610: 4449 4e5f 4649 4c45 4e41 4d45 5f5f 7b70  DIN_FILENAME__{p
+0000d620: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000d630: 6578 7065 6374 6564 203d 2050 6174 6828  expected = Path(
+0000d640: 7029 0a20 2020 2020 2020 2020 2020 2062  p).            b
+0000d650: 6c61 636b 2e72 6566 6f72 6d61 745f 6f6e  lack.reformat_on
+0000d660: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0000d670: 2020 2070 6174 682c 0a20 2020 2020 2020     path,.       
+0000d680: 2020 2020 2020 2020 2066 6173 743d 5472           fast=Tr
+0000d690: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0000d6a0: 2020 2020 7772 6974 655f 6261 636b 3d62      write_back=b
+0000d6b0: 6c61 636b 2e57 7269 7465 4261 636b 2e59  lack.WriteBack.Y
+0000d6c0: 4553 2c0a 2020 2020 2020 2020 2020 2020  ES,.            
+0000d6d0: 2020 2020 6d6f 6465 3d44 4546 4155 4c54      mode=DEFAULT
+0000d6e0: 5f4d 4f44 452c 0a20 2020 2020 2020 2020  _MODE,.         
+0000d6f0: 2020 2020 2020 2072 6570 6f72 743d 7265         report=re
+0000d700: 706f 7274 2c0a 2020 2020 2020 2020 2020  port,.          
+0000d710: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000d720: 6673 7473 2e61 7373 6572 745f 6361 6c6c  fsts.assert_call
+0000d730: 6564 5f6f 6e63 655f 7769 7468 280a 2020  ed_once_with(.  
+0000d740: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+0000d750: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
+0000d760: 2020 2020 2020 2020 2077 7269 7465 5f62           write_b
+0000d770: 6163 6b3d 626c 6163 6b2e 5772 6974 6542  ack=black.WriteB
+0000d780: 6163 6b2e 5945 532c 0a20 2020 2020 2020  ack.YES,.       
+0000d790: 2020 2020 2020 2020 206d 6f64 653d 7265           mode=re
+0000d7a0: 706c 6163 6528 4445 4641 554c 545f 4d4f  place(DEFAULT_MO
+0000d7b0: 4445 2c20 6973 5f69 7079 6e62 3d54 7275  DE, is_ipynb=Tru
+0000d7c0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+0000d7d0: 2020 2020 6c69 6e65 733d 2829 2c0a 2020      lines=(),.  
+0000d7e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d7f0: 2020 2020 2020 2020 2320 5f5f 424c 4143          # __BLAC
+0000d800: 4b5f 5354 4449 4e5f 4649 4c45 4e41 4d45  K_STDIN_FILENAME
+0000d810: 5f5f 2073 686f 756c 6420 6861 7665 2062  __ should have b
+0000d820: 6565 6e20 7374 7269 7070 6564 0a20 2020  een stripped.   
+0000d830: 2020 2020 2020 2020 2072 6570 6f72 742e           report.
+0000d840: 646f 6e65 2e61 7373 6572 745f 6361 6c6c  done.assert_call
+0000d850: 6564 5f77 6974 6828 6578 7065 6374 6564  ed_with(expected
+0000d860: 2c20 626c 6163 6b2e 4368 616e 6765 642e  , black.Changed.
+0000d870: 5945 5329 0a0a 2020 2020 4070 7974 6573  YES)..    @pytes
+0000d880: 742e 6d61 726b 2e69 6e63 6f6d 7061 7469  t.mark.incompati
+0000d890: 626c 655f 7769 7468 5f6d 7970 7963 0a20  ble_with_mypyc. 
+0000d8a0: 2020 2064 6566 2074 6573 745f 7265 666f     def test_refo
+0000d8b0: 726d 6174 5f6f 6e65 5f77 6974 685f 7374  rmat_one_with_st
+0000d8c0: 6469 6e5f 616e 645f 6578 6973 7469 6e67  din_and_existing
+0000d8d0: 5f70 6174 6828 7365 6c66 2920 2d3e 204e  _path(self) -> N
+0000d8e0: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
+0000d8f0: 6820 7061 7463 6828 0a20 2020 2020 2020  h patch(.       
+0000d900: 2020 2020 2022 626c 6163 6b2e 666f 726d       "black.form
+0000d910: 6174 5f73 7464 696e 5f74 6f5f 7374 646f  at_stdin_to_stdo
+0000d920: 7574 222c 0a20 2020 2020 2020 2020 2020  ut",.           
+0000d930: 2072 6574 7572 6e5f 7661 6c75 653d 6c61   return_value=la
+0000d940: 6d62 6461 202a 6172 6773 2c20 2a2a 6b77  mbda *args, **kw
+0000d950: 6172 6773 3a20 626c 6163 6b2e 4368 616e  args: black.Chan
+0000d960: 6765 642e 5945 532c 0a20 2020 2020 2020  ged.YES,.       
+0000d970: 2029 2061 7320 6673 7473 3a0a 2020 2020   ) as fsts:.    
+0000d980: 2020 2020 2020 2020 7265 706f 7274 203d          report =
+0000d990: 204d 6167 6963 4d6f 636b 2829 0a20 2020   MagicMock().   
+0000d9a0: 2020 2020 2020 2020 2023 2045 7665 6e20           # Even 
+0000d9b0: 7769 7468 2061 6e20 6578 6973 7469 6e67  with an existing
+0000d9c0: 2066 696c 652c 2073 696e 6365 2077 6520   file, since we 
+0000d9d0: 6172 6520 666f 7263 696e 6720 7374 6469  are forcing stdi
+0000d9e0: 6e2c 2062 6c61 636b 0a20 2020 2020 2020  n, black.       
+0000d9f0: 2020 2020 2023 2073 686f 756c 6420 6f75       # should ou
+0000da00: 7470 7574 2074 6f20 7374 646f 7574 2061  tput to stdout a
+0000da10: 6e64 206e 6f74 206d 6f64 6966 7920 7468  nd not modify th
+0000da20: 6520 6669 6c65 2069 6e70 6c61 6365 0a20  e file inplace. 
+0000da30: 2020 2020 2020 2020 2020 2070 203d 2054             p = T
+0000da40: 4849 535f 4449 5220 2f20 2264 6174 6122  HIS_DIR / "data"
+0000da50: 202f 2022 6361 7365 7322 202f 2022 636f   / "cases" / "co
+0000da60: 6c6c 6563 7469 6f6e 732e 7079 220a 2020  llections.py".  
+0000da70: 2020 2020 2020 2020 2020 2320 4d61 6b65            # Make
+0000da80: 2073 7572 6520 6973 5f66 696c 6520 6163   sure is_file ac
+0000da90: 7475 616c 6c79 2072 6574 7572 6e73 2054  tually returns T
+0000daa0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0000dab0: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+0000dac0: 702e 6973 5f66 696c 6528 2929 0a20 2020  p.is_file()).   
+0000dad0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
+0000dae0: 5061 7468 2866 225f 5f42 4c41 434b 5f53  Path(f"__BLACK_S
+0000daf0: 5444 494e 5f46 494c 454e 414d 455f 5f7b  TDIN_FILENAME__{
+0000db00: 707d 2229 0a20 2020 2020 2020 2020 2020  p}").           
+0000db10: 2065 7870 6563 7465 6420 3d20 5061 7468   expected = Path
+0000db20: 2870 290a 2020 2020 2020 2020 2020 2020  (p).            
+0000db30: 626c 6163 6b2e 7265 666f 726d 6174 5f6f  black.reformat_o
+0000db40: 6e65 280a 2020 2020 2020 2020 2020 2020  ne(.            
+0000db50: 2020 2020 7061 7468 2c0a 2020 2020 2020      path,.      
+0000db60: 2020 2020 2020 2020 2020 6661 7374 3d54            fast=T
+0000db70: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+0000db80: 2020 2020 2077 7269 7465 5f62 6163 6b3d       write_back=
+0000db90: 626c 6163 6b2e 5772 6974 6542 6163 6b2e  black.WriteBack.
+0000dba0: 5945 532c 0a20 2020 2020 2020 2020 2020  YES,.           
+0000dbb0: 2020 2020 206d 6f64 653d 4445 4641 554c       mode=DEFAUL
+0000dbc0: 545f 4d4f 4445 2c0a 2020 2020 2020 2020  T_MODE,.        
+0000dbd0: 2020 2020 2020 2020 7265 706f 7274 3d72          report=r
+0000dbe0: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
+0000dbf0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000dc00: 2066 7374 732e 6173 7365 7274 5f63 616c   fsts.assert_cal
+0000dc10: 6c65 645f 6f6e 6365 2829 0a20 2020 2020  led_once().     
+0000dc20: 2020 2020 2020 2023 205f 5f42 4c41 434b         # __BLACK
+0000dc30: 5f53 5444 494e 5f46 494c 454e 414d 455f  _STDIN_FILENAME_
+0000dc40: 5f20 7368 6f75 6c64 2068 6176 6520 6265  _ should have be
+0000dc50: 656e 2073 7472 6970 7065 640a 2020 2020  en stripped.    
+0000dc60: 2020 2020 2020 2020 7265 706f 7274 2e64          report.d
+0000dc70: 6f6e 652e 6173 7365 7274 5f63 616c 6c65  one.assert_calle
+0000dc80: 645f 7769 7468 2865 7870 6563 7465 642c  d_with(expected,
+0000dc90: 2062 6c61 636b 2e43 6861 6e67 6564 2e59   black.Changed.Y
+0000dca0: 4553 290a 0a20 2020 2064 6566 2074 6573  ES)..    def tes
+0000dcb0: 745f 7265 666f 726d 6174 5f6f 6e65 5f77  t_reformat_one_w
+0000dcc0: 6974 685f 7374 6469 6e5f 656d 7074 7928  ith_stdin_empty(
+0000dcd0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+0000dce0: 2020 2020 2020 2063 6173 6573 203d 205b         cases = [
+0000dcf0: 0a20 2020 2020 2020 2020 2020 2028 2222  .            (""
+0000dd00: 2c20 2222 292c 0a20 2020 2020 2020 2020  , ""),.         
+0000dd10: 2020 2028 225c 6e22 2c20 225c 6e22 292c     ("\n", "\n"),
+0000dd20: 0a20 2020 2020 2020 2020 2020 2028 225c  .            ("\
+0000dd30: 725c 6e22 2c20 225c 725c 6e22 292c 0a20  r\n", "\r\n"),. 
+0000dd40: 2020 2020 2020 2020 2020 2028 2220 5c74             (" \t
+0000dd50: 222c 2022 2229 2c0a 2020 2020 2020 2020  ", ""),.        
+0000dd60: 2020 2020 2822 205c 745c 6e5c 7420 222c      (" \t\n\t ",
+0000dd70: 2022 5c6e 2229 2c0a 2020 2020 2020 2020   "\n"),.        
+0000dd80: 2020 2020 2822 205c 745c 725c 6e5c 7420      (" \t\r\n\t 
+0000dd90: 222c 2022 5c72 5c6e 2229 2c0a 2020 2020  ", "\r\n"),.    
+0000dda0: 2020 2020 5d0a 0a20 2020 2020 2020 2064      ]..        d
+0000ddb0: 6566 205f 6e65 775f 7772 6170 7065 7228  ef _new_wrapper(
+0000ddc0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0000ddd0: 7075 743a 2069 6f2e 5374 7269 6e67 494f  put: io.StringIO
+0000dde0: 2c20 696f 5f54 6578 7449 4f57 7261 7070  , io_TextIOWrapp
+0000ddf0: 6572 3a20 5479 7065 5b69 6f2e 5465 7874  er: Type[io.Text
+0000de00: 494f 5772 6170 7065 725d 0a20 2020 2020  IOWrapper].     
+0000de10: 2020 2029 202d 3e20 4361 6c6c 6162 6c65     ) -> Callable
+0000de20: 5b5b 416e 792c 2041 6e79 5d2c 2069 6f2e  [[Any, Any], io.
+0000de30: 5465 7874 494f 5772 6170 7065 725d 3a0a  TextIOWrapper]:.
+0000de40: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+0000de50: 6765 745f 6f75 7470 7574 282a 6172 6773  get_output(*args
+0000de60: 3a20 416e 792c 202a 2a6b 7761 7267 733a  : Any, **kwargs:
+0000de70: 2041 6e79 2920 2d3e 2069 6f2e 5465 7874   Any) -> io.Text
+0000de80: 494f 5772 6170 7065 723a 0a20 2020 2020  IOWrapper:.     
+0000de90: 2020 2020 2020 2020 2020 2069 6620 6172             if ar
+0000dea0: 6773 203d 3d20 2873 7973 2e73 7464 6f75  gs == (sys.stdou
+0000deb0: 742e 6275 6666 6572 2c29 3a0a 2020 2020  t.buffer,):.    
+0000dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ded0: 2320 4974 2773 2060 666f 726d 6174 5f73  # It's `format_s
+0000dee0: 7464 696e 5f74 6f5f 7374 646f 7574 2829  tdin_to_stdout()
+0000def0: 6020 6361 6c6c 696e 6720 6069 6f2e 5465  ` calling `io.Te
+0000df00: 7874 494f 5772 6170 7065 7228 2960 2c0a  xtIOWrapper()`,.
+0000df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df20: 2020 2020 2320 7265 7475 726e 206f 7572      # return our
+0000df30: 206d 6f63 6b20 6f62 6a65 6374 2e0a 2020   mock object..  
+0000df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df50: 2020 7265 7475 726e 206f 7574 7075 740a    return output.
+0000df60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df70: 2320 4974 2773 2073 6f6d 6574 6869 6e67  # It's something
+0000df80: 2065 6c73 6520 2869 2e65 2e20 6064 6563   else (i.e. `dec
+0000df90: 6f64 655f 6279 7465 7328 2960 2920 6361  ode_bytes()`) ca
+0000dfa0: 6c6c 696e 670a 2020 2020 2020 2020 2020  lling.          
+0000dfb0: 2020 2020 2020 2320 6069 6f2e 5465 7874        # `io.Text
+0000dfc0: 494f 5772 6170 7065 7228 2960 2c20 7061  IOWrapper()`, pa
+0000dfd0: 7373 2074 6872 6f75 6768 2074 6f20 7468  ss through to th
+0000dfe0: 6520 6f72 6967 696e 616c 2069 6d70 6c65  e original imple
+0000dff0: 6d65 6e74 6174 696f 6e2e 0a20 2020 2020  mentation..     
+0000e000: 2020 2020 2020 2020 2020 2023 2053 6565             # See
+0000e010: 2064 6973 6375 7373 696f 6e20 696e 2068   discussion in h
+0000e020: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+0000e030: 6d2f 7073 662f 626c 6163 6b2f 7075 6c6c  m/psf/black/pull
+0000e040: 2f32 3438 390a 2020 2020 2020 2020 2020  /2489.          
+0000e050: 2020 2020 2020 7265 7475 726e 2069 6f5f        return io_
+0000e060: 5465 7874 494f 5772 6170 7065 7228 2a61  TextIOWrapper(*a
+0000e070: 7267 732c 202a 2a6b 7761 7267 7329 0a0a  rgs, **kwargs)..
+0000e080: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000e090: 726e 2067 6574 5f6f 7574 7075 740a 0a20  rn get_output.. 
+0000e0a0: 2020 2020 2020 2066 6f72 2063 6f6e 7465         for conte
+0000e0b0: 6e74 2c20 6578 7065 6374 6564 2069 6e20  nt, expected in 
+0000e0c0: 6361 7365 733a 0a20 2020 2020 2020 2020  cases:.         
+0000e0d0: 2020 206f 7574 7075 7420 3d20 696f 2e53     output = io.S
+0000e0e0: 7472 696e 6749 4f28 290a 2020 2020 2020  tringIO().      
+0000e0f0: 2020 2020 2020 696f 5f54 6578 7449 4f57        io_TextIOW
+0000e100: 7261 7070 6572 203d 2069 6f2e 5465 7874  rapper = io.Text
+0000e110: 494f 5772 6170 7065 720a 0a20 2020 2020  IOWrapper..     
+0000e120: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
+0000e130: 6828 2269 6f2e 5465 7874 494f 5772 6170  h("io.TextIOWrap
+0000e140: 7065 7222 2c20 5f6e 6577 5f77 7261 7070  per", _new_wrapp
+0000e150: 6572 286f 7574 7075 742c 2069 6f5f 5465  er(output, io_Te
+0000e160: 7874 494f 5772 6170 7065 7229 293a 0a20  xtIOWrapper)):. 
+0000e170: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000e180: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000e190: 2020 2020 2020 2020 626c 6163 6b2e 666f          black.fo
+0000e1a0: 726d 6174 5f73 7464 696e 5f74 6f5f 7374  rmat_stdin_to_st
+0000e1b0: 646f 7574 280a 2020 2020 2020 2020 2020  dout(.          
+0000e1c0: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+0000e1d0: 7374 3d54 7275 652c 0a20 2020 2020 2020  st=True,.       
+0000e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1f0: 2063 6f6e 7465 6e74 3d63 6f6e 7465 6e74   content=content
+0000e200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e210: 2020 2020 2020 2020 2020 7772 6974 655f            write_
+0000e220: 6261 636b 3d62 6c61 636b 2e57 7269 7465  back=black.Write
+0000e230: 4261 636b 2e59 4553 2c0a 2020 2020 2020  Back.YES,.      
+0000e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e250: 2020 6d6f 6465 3d44 4546 4155 4c54 5f4d    mode=DEFAULT_M
+0000e260: 4f44 452c 0a20 2020 2020 2020 2020 2020  ODE,.           
+0000e270: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000e280: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000e290: 7420 696f 2e55 6e73 7570 706f 7274 6564  t io.Unsupported
+0000e2a0: 4f70 6572 6174 696f 6e3a 0a20 2020 2020  Operation:.     
+0000e2b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000e2c0: 6173 7320 2023 2053 7472 696e 6749 4f20  ass  # StringIO 
+0000e2d0: 646f 6573 206e 6f74 2073 7570 706f 7274  does not support
+0000e2e0: 2064 6574 6163 680a 2020 2020 2020 2020   detach.        
+0000e2f0: 2020 2020 2020 2020 6173 7365 7274 206f          assert o
+0000e300: 7574 7075 742e 6765 7476 616c 7565 2829  utput.getvalue()
+0000e310: 203d 3d20 6578 7065 6374 6564 0a0a 2020   == expected..  
+0000e320: 2020 6465 6620 7465 7374 5f63 6c69 5f75    def test_cli_u
+0000e330: 6e73 7461 626c 6528 7365 6c66 2920 2d3e  nstable(self) ->
+0000e340: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+0000e350: 656c 662e 696e 766f 6b65 426c 6163 6b28  elf.invokeBlack(
+0000e360: 5b22 2d2d 756e 7374 6162 6c65 222c 2022  ["--unstable", "
+0000e370: 2d63 222c 2022 3022 5d2c 2065 7869 745f  -c", "0"], exit_
+0000e380: 636f 6465 3d30 290a 2020 2020 2020 2020  code=0).        
+0000e390: 7365 6c66 2e69 6e76 6f6b 6542 6c61 636b  self.invokeBlack
+0000e3a0: 285b 222d 2d70 7265 7669 6577 222c 2022  (["--preview", "
+0000e3b0: 2d63 222c 2022 3022 5d2c 2065 7869 745f  -c", "0"], exit_
+0000e3c0: 636f 6465 3d30 290a 2020 2020 2020 2020  code=0).        
+0000e3d0: 2320 4d75 7374 2061 6c73 6f20 7061 7373  # Must also pass
+0000e3e0: 202d 2d70 7265 7669 6577 0a20 2020 2020   --preview.     
+0000e3f0: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+0000e400: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
+0000e410: 205b 222d 2d65 6e61 626c 652d 756e 7374   ["--enable-unst
+0000e420: 6162 6c65 2d66 6561 7475 7265 222c 2022  able-feature", "
+0000e430: 7374 7269 6e67 5f70 726f 6365 7373 696e  string_processin
+0000e440: 6722 2c20 222d 6322 2c20 2230 225d 2c20  g", "-c", "0"], 
+0000e450: 6578 6974 5f63 6f64 653d 310a 2020 2020  exit_code=1.    
+0000e460: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+0000e470: 6c66 2e69 6e76 6f6b 6542 6c61 636b 280a  lf.invokeBlack(.
+0000e480: 2020 2020 2020 2020 2020 2020 5b22 2d2d              ["--
+0000e490: 7072 6576 6965 7722 2c20 222d 2d65 6e61  preview", "--ena
+0000e4a0: 626c 652d 756e 7374 6162 6c65 2d66 6561  ble-unstable-fea
+0000e4b0: 7475 7265 222c 2022 7374 7269 6e67 5f70  ture", "string_p
+0000e4c0: 726f 6365 7373 696e 6722 2c20 222d 6322  rocessing", "-c"
+0000e4d0: 2c20 2230 225d 2c0a 2020 2020 2020 2020  , "0"],.        
+0000e4e0: 2020 2020 6578 6974 5f63 6f64 653d 302c      exit_code=0,
+0000e4f0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0000e500: 2020 2073 656c 662e 696e 766f 6b65 426c     self.invokeBl
+0000e510: 6163 6b28 0a20 2020 2020 2020 2020 2020  ack(.           
+0000e520: 205b 222d 2d75 6e73 7461 626c 6522 2c20   ["--unstable", 
+0000e530: 222d 2d65 6e61 626c 652d 756e 7374 6162  "--enable-unstab
+0000e540: 6c65 2d66 6561 7475 7265 222c 2022 7374  le-feature", "st
+0000e550: 7269 6e67 5f70 726f 6365 7373 696e 6722  ring_processing"
+0000e560: 2c20 222d 6322 2c20 2230 225d 2c0a 2020  , "-c", "0"],.  
+0000e570: 2020 2020 2020 2020 2020 6578 6974 5f63            exit_c
+0000e580: 6f64 653d 302c 0a20 2020 2020 2020 2029  ode=0,.        )
+0000e590: 0a0a 2020 2020 6465 6620 7465 7374 5f69  ..    def test_i
+0000e5a0: 6e76 616c 6964 5f63 6c69 5f72 6567 6578  nvalid_cli_regex
+0000e5b0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000e5c0: 2020 2020 2020 2020 666f 7220 6f70 7469          for opti
+0000e5d0: 6f6e 2069 6e20 5b22 2d2d 696e 636c 7564  on in ["--includ
+0000e5e0: 6522 2c20 222d 2d65 7863 6c75 6465 222c  e", "--exclude",
+0000e5f0: 2022 2d2d 6578 7465 6e64 2d65 7863 6c75   "--extend-exclu
+0000e600: 6465 222c 2022 2d2d 666f 7263 652d 6578  de", "--force-ex
+0000e610: 636c 7564 6522 5d3a 0a20 2020 2020 2020  clude"]:.       
+0000e620: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
+0000e630: 426c 6163 6b28 5b22 2d22 2c20 6f70 7469  Black(["-", opti
+0000e640: 6f6e 2c20 222a 2a28 2928 2121 2a29 225d  on, "**()(!!*)"]
+0000e650: 2c20 6578 6974 5f63 6f64 653d 3229 0a0a  , exit_code=2)..
+0000e660: 2020 2020 6465 6620 7465 7374 5f72 6571      def test_req
+0000e670: 7569 7265 645f 7665 7273 696f 6e5f 6d61  uired_version_ma
+0000e680: 7463 6865 735f 7665 7273 696f 6e28 7365  tches_version(se
+0000e690: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000e6a0: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
+0000e6b0: 426c 6163 6b28 0a20 2020 2020 2020 2020  Black(.         
+0000e6c0: 2020 205b 222d 2d72 6571 7569 7265 642d     ["--required-
+0000e6d0: 7665 7273 696f 6e22 2c20 626c 6163 6b2e  version", black.
+0000e6e0: 5f5f 7665 7273 696f 6e5f 5f2c 2022 2d63  __version__, "-c
+0000e6f0: 222c 2022 3022 5d2c 0a20 2020 2020 2020  ", "0"],.       
+0000e700: 2020 2020 2065 7869 745f 636f 6465 3d30       exit_code=0
+0000e710: 2c0a 2020 2020 2020 2020 2020 2020 6967  ,.            ig
+0000e720: 6e6f 7265 5f63 6f6e 6669 673d 5472 7565  nore_config=True
+0000e730: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0000e740: 2064 6566 2074 6573 745f 7265 7175 6972   def test_requir
+0000e750: 6564 5f76 6572 7369 6f6e 5f6d 6174 6368  ed_version_match
+0000e760: 6573 5f70 6172 7469 616c 5f76 6572 7369  es_partial_versi
+0000e770: 6f6e 2873 656c 6629 202d 3e20 4e6f 6e65  on(self) -> None
+0000e780: 3a0a 2020 2020 2020 2020 7365 6c66 2e69  :.        self.i
+0000e790: 6e76 6f6b 6542 6c61 636b 280a 2020 2020  nvokeBlack(.    
+0000e7a0: 2020 2020 2020 2020 5b22 2d2d 7265 7175          ["--requ
+0000e7b0: 6972 6564 2d76 6572 7369 6f6e 222c 2062  ired-version", b
+0000e7c0: 6c61 636b 2e5f 5f76 6572 7369 6f6e 5f5f  lack.__version__
+0000e7d0: 2e73 706c 6974 2822 2e22 295b 305d 2c20  .split(".")[0], 
+0000e7e0: 222d 6322 2c20 2230 225d 2c0a 2020 2020  "-c", "0"],.    
+0000e7f0: 2020 2020 2020 2020 6578 6974 5f63 6f64          exit_cod
+0000e800: 653d 302c 0a20 2020 2020 2020 2020 2020  e=0,.           
+0000e810: 2069 676e 6f72 655f 636f 6e66 6967 3d54   ignore_config=T
+0000e820: 7275 652c 0a20 2020 2020 2020 2029 0a0a  rue,.        )..
+0000e830: 2020 2020 6465 6620 7465 7374 5f72 6571      def test_req
+0000e840: 7569 7265 645f 7665 7273 696f 6e5f 646f  uired_version_do
+0000e850: 6573 5f6e 6f74 5f6d 6174 6368 5f6f 6e5f  es_not_match_on_
+0000e860: 6d69 6e6f 725f 7665 7273 696f 6e28 7365  minor_version(se
+0000e870: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000e880: 2020 2020 2073 656c 662e 696e 766f 6b65       self.invoke
+0000e890: 426c 6163 6b28 0a20 2020 2020 2020 2020  Black(.         
+0000e8a0: 2020 205b 222d 2d72 6571 7569 7265 642d     ["--required-
+0000e8b0: 7665 7273 696f 6e22 2c20 626c 6163 6b2e  version", black.
+0000e8c0: 5f5f 7665 7273 696f 6e5f 5f2e 7370 6c69  __version__.spli
+0000e8d0: 7428 222e 2229 5b30 5d20 2b20 222e 3939  t(".")[0] + ".99
+0000e8e0: 3922 2c20 222d 6322 2c20 2230 225d 2c0a  9", "-c", "0"],.
+0000e8f0: 2020 2020 2020 2020 2020 2020 6578 6974              exit
+0000e900: 5f63 6f64 653d 312c 0a20 2020 2020 2020  _code=1,.       
+0000e910: 2020 2020 2069 676e 6f72 655f 636f 6e66       ignore_conf
+0000e920: 6967 3d54 7275 652c 0a20 2020 2020 2020  ig=True,.       
+0000e930: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
+0000e940: 5f72 6571 7569 7265 645f 7665 7273 696f  _required_versio
+0000e950: 6e5f 646f 6573 5f6e 6f74 5f6d 6174 6368  n_does_not_match
+0000e960: 5f76 6572 7369 6f6e 2873 656c 6629 202d  _version(self) -
+0000e970: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000e980: 7265 7375 6c74 203d 2042 6c61 636b 5275  result = BlackRu
+0000e990: 6e6e 6572 2829 2e69 6e76 6f6b 6528 0a20  nner().invoke(. 
+0000e9a0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0000e9b0: 2e6d 6169 6e2c 0a20 2020 2020 2020 2020  .main,.         
+0000e9c0: 2020 205b 222d 2d72 6571 7569 7265 642d     ["--required-
+0000e9d0: 7665 7273 696f 6e22 2c20 2232 302e 3939  version", "20.99
+0000e9e0: 6222 2c20 222d 6322 2c20 2230 225d 2c0a  b", "-c", "0"],.
+0000e9f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000ea00: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000ea10: 616c 2872 6573 756c 742e 6578 6974 5f63  al(result.exit_c
+0000ea20: 6f64 652c 2031 290a 2020 2020 2020 2020  ode, 1).        
+0000ea30: 7365 6c66 2e61 7373 6572 7449 6e28 2272  self.assertIn("r
+0000ea40: 6571 7569 7265 6420 7665 7273 696f 6e22  equired version"
+0000ea50: 2c20 7265 7375 6c74 2e73 7464 6572 7229  , result.stderr)
+0000ea60: 0a0a 2020 2020 6465 6620 7465 7374 5f70  ..    def test_p
+0000ea70: 7265 7365 7276 6573 5f6c 696e 655f 656e  reserves_line_en
+0000ea80: 6469 6e67 7328 7365 6c66 2920 2d3e 204e  dings(self) -> N
+0000ea90: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
+0000eaa0: 6820 5465 6d70 6f72 6172 7944 6972 6563  h TemporaryDirec
+0000eab0: 746f 7279 2829 2061 7320 776f 726b 7370  tory() as worksp
+0000eac0: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
+0000ead0: 2074 6573 745f 6669 6c65 203d 2050 6174   test_file = Pat
+0000eae0: 6828 776f 726b 7370 6163 6529 202f 2022  h(workspace) / "
+0000eaf0: 7465 7374 2e70 7922 0a20 2020 2020 2020  test.py".       
+0000eb00: 2020 2020 2066 6f72 206e 6c20 696e 205b       for nl in [
+0000eb10: 225c 6e22 2c20 225c 725c 6e22 5d3a 0a20  "\n", "\r\n"]:. 
+0000eb20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000eb30: 6f6e 7465 6e74 7320 3d20 6e6c 2e6a 6f69  ontents = nl.joi
+0000eb40: 6e28 5b22 6465 6620 6628 2020 293a 222c  n(["def f(  ):",
+0000eb50: 2022 2020 2020 7061 7373 225d 290a 2020   "    pass"]).  
+0000eb60: 2020 2020 2020 2020 2020 2020 2020 7465                te
+0000eb70: 7374 5f66 696c 652e 7772 6974 655f 6279  st_file.write_by
+0000eb80: 7465 7328 636f 6e74 656e 7473 2e65 6e63  tes(contents.enc
+0000eb90: 6f64 6528 2929 0a20 2020 2020 2020 2020  ode()).         
+0000eba0: 2020 2020 2020 2066 6628 7465 7374 5f66         ff(test_f
+0000ebb0: 696c 652c 2077 7269 7465 5f62 6163 6b3d  ile, write_back=
+0000ebc0: 626c 6163 6b2e 5772 6974 6542 6163 6b2e  black.WriteBack.
+0000ebd0: 5945 5329 0a20 2020 2020 2020 2020 2020  YES).           
+0000ebe0: 2020 2020 2075 7064 6174 6564 5f63 6f6e       updated_con
+0000ebf0: 7465 6e74 733a 2062 7974 6573 203d 2074  tents: bytes = t
+0000ec00: 6573 745f 6669 6c65 2e72 6561 645f 6279  est_file.read_by
+0000ec10: 7465 7328 290a 2020 2020 2020 2020 2020  tes().          
+0000ec20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000ec30: 7449 6e28 6e6c 2e65 6e63 6f64 6528 292c  tIn(nl.encode(),
+0000ec40: 2075 7064 6174 6564 5f63 6f6e 7465 6e74   updated_content
+0000ec50: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0000ec60: 2020 2069 6620 6e6c 203d 3d20 225c 6e22     if nl == "\n"
+0000ec70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ec80: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0000ec90: 744e 6f74 496e 2862 225c 725c 6e22 2c20  tNotIn(b"\r\n", 
+0000eca0: 7570 6461 7465 645f 636f 6e74 656e 7473  updated_contents
+0000ecb0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000ecc0: 7072 6573 6572 7665 735f 6c69 6e65 5f65  preserves_line_e
+0000ecd0: 6e64 696e 6773 5f76 6961 5f73 7464 696e  ndings_via_stdin
+0000ece0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+0000ecf0: 2020 2020 2020 2020 666f 7220 6e6c 2069          for nl i
+0000ed00: 6e20 5b22 5c6e 222c 2022 5c72 5c6e 225d  n ["\n", "\r\n"]
+0000ed10: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0000ed20: 6e74 656e 7473 203d 206e 6c2e 6a6f 696e  ntents = nl.join
+0000ed30: 285b 2264 6566 2066 2820 2029 3a22 2c20  (["def f(  ):", 
+0000ed40: 2220 2020 2070 6173 7322 5d29 0a20 2020  "    pass"]).   
+0000ed50: 2020 2020 2020 2020 2072 756e 6e65 7220           runner 
+0000ed60: 3d20 426c 6163 6b52 756e 6e65 7228 290a  = BlackRunner().
+0000ed70: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0000ed80: 6c74 203d 2072 756e 6e65 722e 696e 766f  lt = runner.invo
+0000ed90: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
+0000eda0: 2020 2020 626c 6163 6b2e 6d61 696e 2c20      black.main, 
+0000edb0: 5b22 2d22 2c20 222d 2d66 6173 7422 5d2c  ["-", "--fast"],
+0000edc0: 2069 6e70 7574 3d42 7974 6573 494f 2863   input=BytesIO(c
+0000edd0: 6f6e 7465 6e74 732e 656e 636f 6465 2822  ontents.encode("
+0000ede0: 7574 662d 3822 2929 0a20 2020 2020 2020  utf-8")).       
+0000edf0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000ee00: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000ee10: 7561 6c28 7265 7375 6c74 2e65 7869 745f  ual(result.exit_
+0000ee20: 636f 6465 2c20 3029 0a20 2020 2020 2020  code, 0).       
+0000ee30: 2020 2020 206f 7574 7075 7420 3d20 7265       output = re
+0000ee40: 7375 6c74 2e73 7464 6f75 745f 6279 7465  sult.stdout_byte
+0000ee50: 730a 2020 2020 2020 2020 2020 2020 7365  s.            se
+0000ee60: 6c66 2e61 7373 6572 7449 6e28 6e6c 2e65  lf.assertIn(nl.e
+0000ee70: 6e63 6f64 6528 2275 7466 2d38 2229 2c20  ncode("utf-8"), 
+0000ee80: 6f75 7470 7574 290a 2020 2020 2020 2020  output).        
+0000ee90: 2020 2020 6966 206e 6c20 3d3d 2022 5c6e      if nl == "\n
+0000eea0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000eeb0: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
+0000eec0: 7449 6e28 6222 5c72 5c6e 222c 206f 7574  tIn(b"\r\n", out
+0000eed0: 7075 7429 0a0a 2020 2020 6465 6620 7465  put)..    def te
+0000eee0: 7374 5f6e 6f72 6d61 6c69 7a65 5f6c 696e  st_normalize_lin
+0000eef0: 655f 656e 6469 6e67 7328 7365 6c66 2920  e_endings(self) 
+0000ef00: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000ef10: 2077 6974 6820 5465 6d70 6f72 6172 7944   with TemporaryD
+0000ef20: 6972 6563 746f 7279 2829 2061 7320 776f  irectory() as wo
+0000ef30: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
+0000ef40: 2020 2020 2074 6573 745f 6669 6c65 203d       test_file =
+0000ef50: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
+0000ef60: 202f 2022 7465 7374 2e70 7922 0a20 2020   / "test.py".   
+0000ef70: 2020 2020 2020 2020 2066 6f72 2064 6174           for dat
+0000ef80: 612c 2065 7870 6563 7465 6420 696e 2028  a, expected in (
+0000ef90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000efa0: 2028 6222 635c 725c 6e63 5c6e 2022 2c20   (b"c\r\nc\n ", 
+0000efb0: 6222 635c 725c 6e63 5c72 5c6e 2229 2c0a  b"c\r\nc\r\n"),.
+0000efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efd0: 2862 226c 5c6e 6c5c 725c 6e20 222c 2062  (b"l\nl\r\n ", b
+0000efe0: 226c 5c6e 6c5c 6e22 292c 0a20 2020 2020  "l\nl\n"),.     
+0000eff0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+0000f000: 2020 2020 2020 2020 2020 7465 7374 5f66            test_f
+0000f010: 696c 652e 7772 6974 655f 6279 7465 7328  ile.write_bytes(
+0000f020: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
+0000f030: 2020 2020 2020 6666 2874 6573 745f 6669        ff(test_fi
+0000f040: 6c65 2c20 7772 6974 655f 6261 636b 3d62  le, write_back=b
+0000f050: 6c61 636b 2e57 7269 7465 4261 636b 2e59  lack.WriteBack.Y
+0000f060: 4553 290a 2020 2020 2020 2020 2020 2020  ES).            
+0000f070: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000f080: 7175 616c 2874 6573 745f 6669 6c65 2e72  qual(test_file.r
+0000f090: 6561 645f 6279 7465 7328 292c 2065 7870  ead_bytes(), exp
+0000f0a0: 6563 7465 6429 0a0a 2020 2020 6465 6620  ected)..    def 
+0000f0b0: 7465 7374 5f72 6f6f 745f 6c6f 6767 6572  test_root_logger
+0000f0c0: 5f6e 6f74 5f75 7365 645f 6469 7265 6374  _not_used_direct
+0000f0d0: 6c79 2873 656c 6629 202d 3e20 4e6f 6e65  ly(self) -> None
+0000f0e0: 3a0a 2020 2020 2020 2020 6465 6620 6661  :.        def fa
+0000f0f0: 696c 282a 6172 6773 3a20 416e 792c 202a  il(*args: Any, *
+0000f100: 2a6b 7761 7267 733a 2041 6e79 2920 2d3e  *kwargs: Any) ->
+0000f110: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000f120: 2020 2073 656c 662e 6661 696c 2822 5265     self.fail("Re
+0000f130: 636f 7264 2063 7265 6174 6564 2077 6974  cord created wit
+0000f140: 6820 726f 6f74 206c 6f67 6765 7222 290a  h root logger").
+0000f150: 0a20 2020 2020 2020 2077 6974 6820 7061  .        with pa
+0000f160: 7463 682e 6d75 6c74 6970 6c65 280a 2020  tch.multiple(.  
+0000f170: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
+0000f180: 672e 726f 6f74 2c0a 2020 2020 2020 2020  g.root,.        
+0000f190: 2020 2020 6465 6275 673d 6661 696c 2c0a      debug=fail,.
+0000f1a0: 2020 2020 2020 2020 2020 2020 696e 666f              info
+0000f1b0: 3d66 6169 6c2c 0a20 2020 2020 2020 2020  =fail,.         
+0000f1c0: 2020 2077 6172 6e69 6e67 3d66 6169 6c2c     warning=fail,
+0000f1d0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+0000f1e0: 6f72 3d66 6169 6c2c 0a20 2020 2020 2020  or=fail,.       
+0000f1f0: 2020 2020 2063 7269 7469 6361 6c3d 6661       critical=fa
+0000f200: 696c 2c0a 2020 2020 2020 2020 2020 2020  il,.            
+0000f210: 6c6f 673d 6661 696c 2c0a 2020 2020 2020  log=fail,.      
+0000f220: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0000f230: 2066 6628 5448 4953 5f44 4952 202f 2022   ff(THIS_DIR / "
+0000f240: 7574 696c 2e70 7922 290a 0a20 2020 2064  util.py")..    d
+0000f250: 6566 2074 6573 745f 696e 7661 6c69 645f  ef test_invalid_
+0000f260: 636f 6e66 6967 5f72 6574 7572 6e5f 636f  config_return_co
+0000f270: 6465 2873 656c 6629 202d 3e20 4e6f 6e65  de(self) -> None
+0000f280: 3a0a 2020 2020 2020 2020 746d 705f 6669  :.        tmp_fi
+0000f290: 6c65 203d 2050 6174 6828 626c 6163 6b2e  le = Path(black.
+0000f2a0: 6475 6d70 5f74 6f5f 6669 6c65 2829 290a  dump_to_file()).
+0000f2b0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000f2c0: 2020 2020 2020 2020 2074 6d70 5f63 6f6e           tmp_con
+0000f2d0: 6669 6720 3d20 5061 7468 2862 6c61 636b  fig = Path(black
+0000f2e0: 2e64 756d 705f 746f 5f66 696c 6528 2929  .dump_to_file())
+0000f2f0: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
+0000f300: 5f63 6f6e 6669 672e 756e 6c69 6e6b 2829  _config.unlink()
+0000f310: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
+0000f320: 7320 3d20 5b22 2d2d 636f 6e66 6967 222c  s = ["--config",
+0000f330: 2073 7472 2874 6d70 5f63 6f6e 6669 6729   str(tmp_config)
+0000f340: 2c20 7374 7228 746d 705f 6669 6c65 295d  , str(tmp_file)]
+0000f350: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f360: 662e 696e 766f 6b65 426c 6163 6b28 6172  f.invokeBlack(ar
+0000f370: 6773 2c20 6578 6974 5f63 6f64 653d 322c  gs, exit_code=2,
+0000f380: 2069 676e 6f72 655f 636f 6e66 6967 3d46   ignore_config=F
+0000f390: 616c 7365 290a 2020 2020 2020 2020 6669  alse).        fi
+0000f3a0: 6e61 6c6c 793a 0a20 2020 2020 2020 2020  nally:.         
+0000f3b0: 2020 2074 6d70 5f66 696c 652e 756e 6c69     tmp_file.unli
+0000f3c0: 6e6b 2829 0a0a 2020 2020 6465 6620 7465  nk()..    def te
+0000f3d0: 7374 5f70 6172 7365 5f70 7970 726f 6a65  st_parse_pyproje
+0000f3e0: 6374 5f74 6f6d 6c28 7365 6c66 2920 2d3e  ct_toml(self) ->
+0000f3f0: 204e 6f6e 653a 0a20 2020 2020 2020 2074   None:.        t
+0000f400: 6573 745f 746f 6d6c 5f66 696c 6520 3d20  est_toml_file = 
+0000f410: 5448 4953 5f44 4952 202f 2022 7465 7374  THIS_DIR / "test
+0000f420: 2e74 6f6d 6c22 0a20 2020 2020 2020 2063  .toml".        c
+0000f430: 6f6e 6669 6720 3d20 626c 6163 6b2e 7061  onfig = black.pa
+0000f440: 7273 655f 7079 7072 6f6a 6563 745f 746f  rse_pyproject_to
+0000f450: 6d6c 2873 7472 2874 6573 745f 746f 6d6c  ml(str(test_toml
+0000f460: 5f66 696c 6529 290a 2020 2020 2020 2020  _file)).        
+0000f470: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000f480: 2863 6f6e 6669 675b 2276 6572 626f 7365  (config["verbose
+0000f490: 225d 2c20 3129 0a20 2020 2020 2020 2073  "], 1).        s
+0000f4a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000f4b0: 636f 6e66 6967 5b22 6368 6563 6b22 5d2c  config["check"],
+0000f4c0: 2022 6e6f 2229 0a20 2020 2020 2020 2073   "no").        s
+0000f4d0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000f4e0: 636f 6e66 6967 5b22 6469 6666 225d 2c20  config["diff"], 
+0000f4f0: 2279 2229 0a20 2020 2020 2020 2073 656c  "y").        sel
+0000f500: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
+0000f510: 6e66 6967 5b22 636f 6c6f 7222 5d2c 2054  nfig["color"], T
+0000f520: 7275 6529 0a20 2020 2020 2020 2073 656c  rue).        sel
+0000f530: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
+0000f540: 6e66 6967 5b22 6c69 6e65 5f6c 656e 6774  nfig["line_lengt
+0000f550: 6822 5d2c 2037 3929 0a20 2020 2020 2020  h"], 79).       
+0000f560: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000f570: 6c28 636f 6e66 6967 5b22 7461 7267 6574  l(config["target
+0000f580: 5f76 6572 7369 6f6e 225d 2c20 5b22 7079  _version"], ["py
+0000f590: 3336 222c 2022 7079 3337 222c 2022 7079  36", "py37", "py
+0000f5a0: 3338 225d 290a 2020 2020 2020 2020 7365  38"]).        se
+0000f5b0: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+0000f5c0: 6f6e 6669 675b 2270 7974 686f 6e5f 6365  onfig["python_ce
+0000f5d0: 6c6c 5f6d 6167 6963 7322 5d2c 205b 2263  ll_magics"], ["c
+0000f5e0: 7573 746f 6d31 222c 2022 6375 7374 6f6d  ustom1", "custom
+0000f5f0: 3222 5d29 0a20 2020 2020 2020 2073 656c  2"]).        sel
+0000f600: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
+0000f610: 6e66 6967 5b22 6578 636c 7564 6522 5d2c  nfig["exclude"],
+0000f620: 2072 225c 2e70 7969 3f24 2229 0a20 2020   r"\.pyi?$").   
+0000f630: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000f640: 4571 7561 6c28 636f 6e66 6967 5b22 696e  Equal(config["in
+0000f650: 636c 7564 6522 5d2c 2072 225c 2e70 793f  clude"], r"\.py?
+0000f660: 2422 290a 0a20 2020 2064 6566 2074 6573  $")..    def tes
+0000f670: 745f 7370 656c 6c63 6865 636b 5f70 7970  t_spellcheck_pyp
+0000f680: 726f 6a65 6374 5f74 6f6d 6c28 7365 6c66  roject_toml(self
+0000f690: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000f6a0: 2020 2074 6573 745f 746f 6d6c 5f66 696c     test_toml_fil
+0000f6b0: 6520 3d20 5448 4953 5f44 4952 202f 2022  e = THIS_DIR / "
+0000f6c0: 6461 7461 2220 2f20 2269 6e63 6f72 7265  data" / "incorre
+0000f6d0: 6374 5f73 7065 6c6c 696e 672e 746f 6d6c  ct_spelling.toml
+0000f6e0: 220a 2020 2020 2020 2020 7265 7375 6c74  ".        result
+0000f6f0: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
+0000f700: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
+0000f710: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
+0000f720: 0a20 2020 2020 2020 2020 2020 205b 0a20  .            [. 
+0000f730: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000f740: 2d2d 636f 6465 3d70 7269 6e74 2827 6865  --code=print('he
+0000f750: 6c6c 6f20 776f 726c 6427 2922 2c0a 2020  llo world')",.  
+0000f760: 2020 2020 2020 2020 2020 2020 2020 222d                "-
+0000f770: 2d76 6572 626f 7365 222c 0a20 2020 2020  -verbose",.     
+0000f780: 2020 2020 2020 2020 2020 2066 222d 2d63             f"--c
+0000f790: 6f6e 6669 673d 7b73 7472 2874 6573 745f  onfig={str(test_
+0000f7a0: 746f 6d6c 5f66 696c 6529 7d22 2c0a 2020  toml_file)}",.  
+0000f7b0: 2020 2020 2020 2020 2020 5d2c 0a20 2020            ],.   
+0000f7c0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000f7d0: 6173 7365 7274 2028 0a20 2020 2020 2020  assert (.       
+0000f7e0: 2020 2020 2072 2249 6e76 616c 6964 2063       r"Invalid c
+0000f7f0: 6f6e 6669 6720 6b65 7973 2064 6574 6563  onfig keys detec
+0000f800: 7465 643a 2027 696e 655f 6c65 6e67 7468  ted: 'ine_length
+0000f810: 272c 2027 7461 7267 6574 5f65 7273 696f  ', 'target_ersio
+0000f820: 6e27 2028 696e 220a 2020 2020 2020 2020  n' (in".        
+0000f830: 2020 2020 7266 2220 7b74 6573 745f 746f      rf" {test_to
+0000f840: 6d6c 5f66 696c 657d 2922 2069 6e20 7265  ml_file})" in re
+0000f850: 7375 6c74 2e73 7464 6572 720a 2020 2020  sult.stderr.    
+0000f860: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+0000f870: 6573 745f 7061 7273 655f 7079 7072 6f6a  est_parse_pyproj
+0000f880: 6563 745f 746f 6d6c 5f70 726f 6a65 6374  ect_toml_project
+0000f890: 5f6d 6574 6164 6174 6128 7365 6c66 2920  _metadata(self) 
+0000f8a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000f8b0: 2066 6f72 2074 6573 745f 746f 6d6c 2c20   for test_toml, 
+0000f8c0: 6578 7065 6374 6564 2069 6e20 5b0a 2020  expected in [.  
+0000f8d0: 2020 2020 2020 2020 2020 2822 6f6e 6c79            ("only
+0000f8e0: 5f62 6c61 636b 5f70 7970 726f 6a65 6374  _black_pyproject
+0000f8f0: 2e74 6f6d 6c22 2c20 5b22 7079 3331 3022  .toml", ["py310"
+0000f900: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
+0000f910: 2822 6f6e 6c79 5f6d 6574 6164 6174 615f  ("only_metadata_
+0000f920: 7079 7072 6f6a 6563 742e 746f 6d6c 222c  pyproject.toml",
+0000f930: 205b 2270 7933 3722 2c20 2270 7933 3822   ["py37", "py38"
+0000f940: 2c20 2270 7933 3922 2c20 2270 7933 3130  , "py39", "py310
+0000f950: 225d 292c 0a20 2020 2020 2020 2020 2020  "]),.           
+0000f960: 2028 226e 6569 7468 6572 5f70 7970 726f   ("neither_pypro
+0000f970: 6a65 6374 2e74 6f6d 6c22 2c20 4e6f 6e65  ject.toml", None
+0000f980: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+0000f990: 2262 6f74 685f 7079 7072 6f6a 6563 742e  "both_pyproject.
+0000f9a0: 746f 6d6c 222c 205b 2270 7933 3130 225d  toml", ["py310"]
+0000f9b0: 292c 0a20 2020 2020 2020 205d 3a0a 2020  ),.        ]:.  
+0000f9c0: 2020 2020 2020 2020 2020 7465 7374 5f74            test_t
+0000f9d0: 6f6d 6c5f 6669 6c65 203d 2054 4849 535f  oml_file = THIS_
+0000f9e0: 4449 5220 2f20 2264 6174 6122 202f 2022  DIR / "data" / "
+0000f9f0: 7072 6f6a 6563 745f 6d65 7461 6461 7461  project_metadata
+0000fa00: 2220 2f20 7465 7374 5f74 6f6d 6c0a 2020  " / test_toml.  
+0000fa10: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+0000fa20: 203d 2062 6c61 636b 2e70 6172 7365 5f70   = black.parse_p
+0000fa30: 7970 726f 6a65 6374 5f74 6f6d 6c28 7374  yproject_toml(st
+0000fa40: 7228 7465 7374 5f74 6f6d 6c5f 6669 6c65  r(test_toml_file
+0000fa50: 2929 0a20 2020 2020 2020 2020 2020 2073  )).            s
+0000fa60: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000fa70: 636f 6e66 6967 2e67 6574 2822 7461 7267  config.get("targ
+0000fa80: 6574 5f76 6572 7369 6f6e 2229 2c20 6578  et_version"), ex
+0000fa90: 7065 6374 6564 290a 0a20 2020 2064 6566  pected)..    def
+0000faa0: 2074 6573 745f 696e 6665 725f 7461 7267   test_infer_targ
+0000fab0: 6574 5f76 6572 7369 6f6e 2873 656c 6629  et_version(self)
+0000fac0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000fad0: 2020 666f 7220 7665 7273 696f 6e2c 2065    for version, e
+0000fae0: 7870 6563 7465 6420 696e 205b 0a20 2020  xpected in [.   
+0000faf0: 2020 2020 2020 2020 2028 2233 2e36 222c           ("3.6",
+0000fb00: 205b 5461 7267 6574 5665 7273 696f 6e2e   [TargetVersion.
+0000fb10: 5059 3336 5d29 2c0a 2020 2020 2020 2020  PY36]),.        
+0000fb20: 2020 2020 2822 332e 3131 2e30 7263 3122      ("3.11.0rc1"
+0000fb30: 2c20 5b54 6172 6765 7456 6572 7369 6f6e  , [TargetVersion
+0000fb40: 2e50 5933 3131 5d29 2c0a 2020 2020 2020  .PY311]),.      
+0000fb50: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
+0000fb60: 2020 2020 2020 2020 223e 3d33 2e31 3022          ">=3.10"
+0000fb70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000fb80: 2020 5b0a 2020 2020 2020 2020 2020 2020    [.            
+0000fb90: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+0000fba0: 7273 696f 6e2e 5059 3331 302c 0a20 2020  rsion.PY310,.   
+0000fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fbc0: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
+0000fbd0: 5933 3131 2c0a 2020 2020 2020 2020 2020  Y311,.          
+0000fbe0: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000fbf0: 5665 7273 696f 6e2e 5059 3331 322c 0a20  Version.PY312,. 
+0000fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc10: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+0000fc20: 2e50 5933 3133 2c0a 2020 2020 2020 2020  .PY313,.        
+0000fc30: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
+0000fc40: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+0000fc50: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
+0000fc60: 2020 2020 2020 2020 223e 3d33 2e31 302e          ">=3.10.
+0000fc70: 3622 2c0a 2020 2020 2020 2020 2020 2020  6",.            
+0000fc80: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
+0000fc90: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000fca0: 5665 7273 696f 6e2e 5059 3331 302c 0a20  Version.PY310,. 
+0000fcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fcc0: 2020 2054 6172 6765 7456 6572 7369 6f6e     TargetVersion
+0000fcd0: 2e50 5933 3131 2c0a 2020 2020 2020 2020  .PY311,.        
+0000fce0: 2020 2020 2020 2020 2020 2020 5461 7267              Targ
+0000fcf0: 6574 5665 7273 696f 6e2e 5059 3331 322c  etVersion.PY312,
+0000fd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fd10: 2020 2020 2054 6172 6765 7456 6572 7369       TargetVersi
+0000fd20: 6f6e 2e50 5933 3133 2c0a 2020 2020 2020  on.PY313,.      
+0000fd30: 2020 2020 2020 2020 2020 5d2c 0a20 2020            ],.   
+0000fd40: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
+0000fd50: 2020 2020 2020 2020 2822 3c33 2e36 222c          ("<3.6",
+0000fd60: 205b 5461 7267 6574 5665 7273 696f 6e2e   [TargetVersion.
+0000fd70: 5059 3333 2c20 5461 7267 6574 5665 7273  PY33, TargetVers
+0000fd80: 696f 6e2e 5059 3334 2c20 5461 7267 6574  ion.PY34, Target
+0000fd90: 5665 7273 696f 6e2e 5059 3335 5d29 2c0a  Version.PY35]),.
+0000fda0: 2020 2020 2020 2020 2020 2020 2822 3e33              (">3
+0000fdb0: 2e37 2c3c 332e 3130 222c 205b 5461 7267  .7,<3.10", [Targ
+0000fdc0: 6574 5665 7273 696f 6e2e 5059 3338 2c20  etVersion.PY38, 
+0000fdd0: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+0000fde0: 3339 5d29 2c0a 2020 2020 2020 2020 2020  39]),.          
+0000fdf0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+0000fe00: 2020 2020 223e 332e 372c 213d 332e 382c      ">3.7,!=3.8,
+0000fe10: 213d 332e 3922 2c0a 2020 2020 2020 2020  !=3.9",.        
+0000fe20: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+0000fe30: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
+0000fe40: 7267 6574 5665 7273 696f 6e2e 5059 3331  rgetVersion.PY31
+0000fe50: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0000fe60: 2020 2020 2020 2054 6172 6765 7456 6572         TargetVer
+0000fe70: 7369 6f6e 2e50 5933 3131 2c0a 2020 2020  sion.PY311,.    
+0000fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe90: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
+0000fea0: 3331 322c 0a20 2020 2020 2020 2020 2020  312,.           
+0000feb0: 2020 2020 2020 2020 2054 6172 6765 7456           TargetV
+0000fec0: 6572 7369 6f6e 2e50 5933 3133 2c0a 2020  ersion.PY313,.  
+0000fed0: 2020 2020 2020 2020 2020 2020 2020 5d2c                ],
+0000fee0: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+0000fef0: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
+0000ff00: 2020 2020 2020 2020 2020 2020 2020 223e                ">
+0000ff10: 2033 2e39 2e34 2c20 213d 2033 2e31 302e   3.9.4, != 3.10.
+0000ff20: 3322 2c0a 2020 2020 2020 2020 2020 2020  3",.            
+0000ff30: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
+0000ff40: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+0000ff50: 5665 7273 696f 6e2e 5059 3339 2c0a 2020  Version.PY39,.  
 0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff70: 5461 7267 6574 5665 7273 696f 6e2e 5059  TargetVersion.PY
-0000ff80: 3339 2c0a 2020 2020 2020 2020 2020 2020  39,.            
-0000ff90: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
-0000ffa0: 7273 696f 6e2e 5059 3331 302c 0a20 2020  rsion.PY310,.   
+0000ff70: 2020 5461 7267 6574 5665 7273 696f 6e2e    TargetVersion.
+0000ff80: 5059 3331 302c 0a20 2020 2020 2020 2020  PY310,.         
+0000ff90: 2020 2020 2020 2020 2020 2054 6172 6765             Targe
+0000ffa0: 7456 6572 7369 6f6e 2e50 5933 3131 2c0a  tVersion.PY311,.
 0000ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffc0: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
-0000ffd0: 5933 3131 2c0a 2020 2020 2020 2020 2020  Y311,.          
-0000ffe0: 2020 2020 2020 2020 2020 5461 7267 6574            Target
-0000fff0: 5665 7273 696f 6e2e 5059 3331 322c 0a20  Version.PY312,. 
-00010000: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-00010010: 2c0a 2020 2020 2020 2020 2020 2020 292c  ,.            ),
-00010020: 0a20 2020 2020 2020 2020 2020 2028 223d  .            ("=
-00010030: 3d33 2e38 2e2a 222c 205b 5461 7267 6574  =3.8.*", [Target
-00010040: 5665 7273 696f 6e2e 5059 3338 5d29 2c0a  Version.PY38]),.
-00010050: 2020 2020 2020 2020 2020 2020 284e 6f6e              (Non
-00010060: 652c 204e 6f6e 6529 2c0a 2020 2020 2020  e, None),.      
-00010070: 2020 2020 2020 2822 222c 204e 6f6e 6529        ("", None)
-00010080: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
-00010090: 696e 7661 6c69 6422 2c20 4e6f 6e65 292c  invalid", None),
-000100a0: 0a20 2020 2020 2020 2020 2020 2028 223d  .            ("=
-000100b0: 3d69 6e76 616c 6964 222c 204e 6f6e 6529  =invalid", None)
-000100c0: 2c0a 2020 2020 2020 2020 2020 2020 2822  ,.            ("
-000100d0: 3e33 2e39 2c21 3d69 6e76 616c 6964 222c  >3.9,!=invalid",
-000100e0: 204e 6f6e 6529 2c0a 2020 2020 2020 2020   None),.        
-000100f0: 2020 2020 2822 3322 2c20 4e6f 6e65 292c      ("3", None),
-00010100: 0a20 2020 2020 2020 2020 2020 2028 2233  .            ("3
-00010110: 2e32 222c 204e 6f6e 6529 2c0a 2020 2020  .2", None),.    
-00010120: 2020 2020 2020 2020 2822 322e 372e 3138          ("2.7.18
-00010130: 222c 204e 6f6e 6529 2c0a 2020 2020 2020  ", None),.      
-00010140: 2020 2020 2020 2822 3d3d 322e 3722 2c20        ("==2.7", 
-00010150: 4e6f 6e65 292c 0a20 2020 2020 2020 2020  None),.         
-00010160: 2020 2028 223e 332e 3130 2c3c 332e 3131     (">3.10,<3.11
-00010170: 222c 204e 6f6e 6529 2c0a 2020 2020 2020  ", None),.      
-00010180: 2020 5d3a 0a20 2020 2020 2020 2020 2020    ]:.           
-00010190: 2074 6573 745f 746f 6d6c 203d 207b 2270   test_toml = {"p
-000101a0: 726f 6a65 6374 223a 207b 2272 6571 7569  roject": {"requi
-000101b0: 7265 732d 7079 7468 6f6e 223a 2076 6572  res-python": ver
-000101c0: 7369 6f6e 7d7d 0a20 2020 2020 2020 2020  sion}}.         
-000101d0: 2020 2072 6573 756c 7420 3d20 626c 6163     result = blac
-000101e0: 6b2e 6669 6c65 732e 696e 6665 725f 7461  k.files.infer_ta
-000101f0: 7267 6574 5f76 6572 7369 6f6e 2874 6573  rget_version(tes
-00010200: 745f 746f 6d6c 290a 2020 2020 2020 2020  t_toml).        
-00010210: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00010220: 7175 616c 2872 6573 756c 742c 2065 7870  qual(result, exp
-00010230: 6563 7465 6429 0a0a 2020 2020 6465 6620  ected)..    def 
-00010240: 7465 7374 5f72 6561 645f 7079 7072 6f6a  test_read_pyproj
-00010250: 6563 745f 746f 6d6c 2873 656c 6629 202d  ect_toml(self) -
-00010260: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00010270: 7465 7374 5f74 6f6d 6c5f 6669 6c65 203d  test_toml_file =
-00010280: 2054 4849 535f 4449 5220 2f20 2274 6573   THIS_DIR / "tes
-00010290: 742e 746f 6d6c 220a 2020 2020 2020 2020  t.toml".        
-000102a0: 6661 6b65 5f63 7478 203d 2046 616b 6543  fake_ctx = FakeC
-000102b0: 6f6e 7465 7874 2829 0a20 2020 2020 2020  ontext().       
-000102c0: 2062 6c61 636b 2e72 6561 645f 7079 7072   black.read_pypr
-000102d0: 6f6a 6563 745f 746f 6d6c 2866 616b 655f  oject_toml(fake_
-000102e0: 6374 782c 2046 616b 6550 6172 616d 6574  ctx, FakeParamet
-000102f0: 6572 2829 2c20 7374 7228 7465 7374 5f74  er(), str(test_t
-00010300: 6f6d 6c5f 6669 6c65 2929 0a20 2020 2020  oml_file)).     
-00010310: 2020 2063 6f6e 6669 6720 3d20 6661 6b65     config = fake
-00010320: 5f63 7478 2e64 6566 6175 6c74 5f6d 6170  _ctx.default_map
-00010330: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00010340: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
-00010350: 5b22 7665 7262 6f73 6522 5d2c 2022 3122  ["verbose"], "1"
-00010360: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00010370: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-00010380: 675b 2263 6865 636b 225d 2c20 226e 6f22  g["check"], "no"
-00010390: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000103a0: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-000103b0: 675b 2264 6966 6622 5d2c 2022 7922 290a  g["diff"], "y").
-000103c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000103d0: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-000103e0: 2263 6f6c 6f72 225d 2c20 2254 7275 6522  "color"], "True"
-000103f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00010400: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-00010410: 675b 226c 696e 655f 6c65 6e67 7468 225d  g["line_length"]
-00010420: 2c20 2237 3922 290a 2020 2020 2020 2020  , "79").        
-00010430: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00010440: 2863 6f6e 6669 675b 2274 6172 6765 745f  (config["target_
-00010450: 7665 7273 696f 6e22 5d2c 205b 2270 7933  version"], ["py3
-00010460: 3622 2c20 2270 7933 3722 2c20 2270 7933  6", "py37", "py3
-00010470: 3822 5d29 0a20 2020 2020 2020 2073 656c  8"]).        sel
-00010480: 662e 6173 7365 7274 4571 7561 6c28 636f  f.assertEqual(co
-00010490: 6e66 6967 5b22 6578 636c 7564 6522 5d2c  nfig["exclude"],
-000104a0: 2072 225c 2e70 7969 3f24 2229 0a20 2020   r"\.pyi?$").   
-000104b0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000104c0: 4571 7561 6c28 636f 6e66 6967 5b22 696e  Equal(config["in
-000104d0: 636c 7564 6522 5d2c 2072 225c 2e70 793f  clude"], r"\.py?
-000104e0: 2422 290a 0a20 2020 2064 6566 2074 6573  $")..    def tes
-000104f0: 745f 7265 6164 5f70 7970 726f 6a65 6374  t_read_pyproject
-00010500: 5f74 6f6d 6c5f 6672 6f6d 5f73 7464 696e  _toml_from_stdin
-00010510: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00010520: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
-00010530: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
-00010540: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
-00010550: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-00010560: 203d 2050 6174 6828 776f 726b 7370 6163   = Path(workspac
-00010570: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-00010580: 7372 635f 6469 7220 3d20 726f 6f74 202f  src_dir = root /
-00010590: 2022 7372 6322 0a20 2020 2020 2020 2020   "src".         
-000105a0: 2020 2073 7263 5f64 6972 2e6d 6b64 6972     src_dir.mkdir
-000105b0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-000105c0: 7372 635f 7079 7072 6f6a 6563 7420 3d20  src_pyproject = 
-000105d0: 7372 635f 6469 7220 2f20 2270 7970 726f  src_dir / "pypro
-000105e0: 6a65 6374 2e74 6f6d 6c22 0a20 2020 2020  ject.toml".     
-000105f0: 2020 2020 2020 2073 7263 5f70 7970 726f         src_pypro
-00010600: 6a65 6374 2e74 6f75 6368 2829 0a0a 2020  ject.touch()..  
-00010610: 2020 2020 2020 2020 2020 7465 7374 5f74            test_t
-00010620: 6f6d 6c5f 636f 6e74 656e 7420 3d20 2854  oml_content = (T
-00010630: 4849 535f 4449 5220 2f20 2274 6573 742e  HIS_DIR / "test.
-00010640: 746f 6d6c 2229 2e72 6561 645f 7465 7874  toml").read_text
-00010650: 2865 6e63 6f64 696e 673d 2275 7466 2d38  (encoding="utf-8
-00010660: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-00010670: 7263 5f70 7970 726f 6a65 6374 2e77 7269  rc_pyproject.wri
-00010680: 7465 5f74 6578 7428 7465 7374 5f74 6f6d  te_text(test_tom
-00010690: 6c5f 636f 6e74 656e 742c 2065 6e63 6f64  l_content, encod
-000106a0: 696e 673d 2275 7466 2d38 2229 0a0a 2020  ing="utf-8")..  
-000106b0: 2020 2020 2020 2020 2020 7372 635f 7079            src_py
-000106c0: 7468 6f6e 203d 2073 7263 5f64 6972 202f  thon = src_dir /
-000106d0: 2022 666f 6f2e 7079 220a 2020 2020 2020   "foo.py".      
-000106e0: 2020 2020 2020 7372 635f 7079 7468 6f6e        src_python
-000106f0: 2e74 6f75 6368 2829 0a0a 2020 2020 2020  .touch()..      
-00010700: 2020 2020 2020 6661 6b65 5f63 7478 203d        fake_ctx =
-00010710: 2046 616b 6543 6f6e 7465 7874 2829 0a20   FakeContext(). 
-00010720: 2020 2020 2020 2020 2020 2066 616b 655f             fake_
-00010730: 6374 782e 7061 7261 6d73 5b22 7372 6322  ctx.params["src"
-00010740: 5d20 3d20 2822 2d22 2c29 0a20 2020 2020  ] = ("-",).     
-00010750: 2020 2020 2020 2066 616b 655f 6374 782e         fake_ctx.
-00010760: 7061 7261 6d73 5b22 7374 6469 6e5f 6669  params["stdin_fi
-00010770: 6c65 6e61 6d65 225d 203d 2073 7472 2873  lename"] = str(s
-00010780: 7263 5f70 7974 686f 6e29 0a0a 2020 2020  rc_python)..    
-00010790: 2020 2020 2020 2020 7769 7468 2063 6861          with cha
-000107a0: 6e67 655f 6469 7265 6374 6f72 7928 726f  nge_directory(ro
-000107b0: 6f74 293a 0a20 2020 2020 2020 2020 2020  ot):.           
-000107c0: 2020 2020 2062 6c61 636b 2e72 6561 645f       black.read_
-000107d0: 7079 7072 6f6a 6563 745f 746f 6d6c 2866  pyproject_toml(f
-000107e0: 616b 655f 6374 782c 2046 616b 6550 6172  ake_ctx, FakePar
-000107f0: 616d 6574 6572 2829 2c20 4e6f 6e65 290a  ameter(), None).
-00010800: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00010810: 6669 6720 3d20 6661 6b65 5f63 7478 2e64  fig = fake_ctx.d
-00010820: 6566 6175 6c74 5f6d 6170 0a20 2020 2020  efault_map.     
-00010830: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00010840: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
-00010850: 7665 7262 6f73 6522 5d2c 2022 3122 290a  verbose"], "1").
-00010860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00010870: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
-00010880: 6669 675b 2263 6865 636b 225d 2c20 226e  fig["check"], "n
-00010890: 6f22 290a 2020 2020 2020 2020 2020 2020  o").            
-000108a0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000108b0: 2863 6f6e 6669 675b 2264 6966 6622 5d2c  (config["diff"],
-000108c0: 2022 7922 290a 2020 2020 2020 2020 2020   "y").          
-000108d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000108e0: 616c 2863 6f6e 6669 675b 2263 6f6c 6f72  al(config["color
-000108f0: 225d 2c20 2254 7275 6522 290a 2020 2020  "], "True").    
-00010900: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00010910: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-00010920: 226c 696e 655f 6c65 6e67 7468 225d 2c20  "line_length"], 
-00010930: 2237 3922 290a 2020 2020 2020 2020 2020  "79").          
-00010940: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00010950: 616c 2863 6f6e 6669 675b 2274 6172 6765  al(config["targe
-00010960: 745f 7665 7273 696f 6e22 5d2c 205b 2270  t_version"], ["p
-00010970: 7933 3622 2c20 2270 7933 3722 2c20 2270  y36", "py37", "p
-00010980: 7933 3822 5d29 0a20 2020 2020 2020 2020  y38"]).         
-00010990: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000109a0: 7561 6c28 636f 6e66 6967 5b22 6578 636c  ual(config["excl
-000109b0: 7564 6522 5d2c 2072 225c 2e70 7969 3f24  ude"], r"\.pyi?$
-000109c0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-000109d0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000109e0: 636f 6e66 6967 5b22 696e 636c 7564 6522  config["include"
-000109f0: 5d2c 2072 225c 2e70 793f 2422 290a 0a20  ], r"\.py?$").. 
-00010a00: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
-00010a10: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
-00010a20: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
-00010a30: 7465 7374 5f66 696e 645f 7072 6f6a 6563  test_find_projec
-00010a40: 745f 726f 6f74 2873 656c 6629 202d 3e20  t_root(self) -> 
-00010a50: 4e6f 6e65 3a0a 2020 2020 2020 2020 7769  None:.        wi
-00010a60: 7468 2054 656d 706f 7261 7279 4469 7265  th TemporaryDire
-00010a70: 6374 6f72 7928 2920 6173 2077 6f72 6b73  ctory() as works
-00010a80: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
-00010a90: 2020 726f 6f74 203d 2050 6174 6828 776f    root = Path(wo
-00010aa0: 726b 7370 6163 6529 0a20 2020 2020 2020  rkspace).       
-00010ab0: 2020 2020 2074 6573 745f 6469 7220 3d20       test_dir = 
-00010ac0: 726f 6f74 202f 2022 7465 7374 220a 2020  root / "test".  
-00010ad0: 2020 2020 2020 2020 2020 7465 7374 5f64            test_d
-00010ae0: 6972 2e6d 6b64 6972 2829 0a0a 2020 2020  ir.mkdir()..    
-00010af0: 2020 2020 2020 2020 7372 635f 6469 7220          src_dir 
-00010b00: 3d20 726f 6f74 202f 2022 7372 6322 0a20  = root / "src". 
-00010b10: 2020 2020 2020 2020 2020 2073 7263 5f64             src_d
-00010b20: 6972 2e6d 6b64 6972 2829 0a0a 2020 2020  ir.mkdir()..    
-00010b30: 2020 2020 2020 2020 726f 6f74 5f70 7970          root_pyp
-00010b40: 726f 6a65 6374 203d 2072 6f6f 7420 2f20  roject = root / 
-00010b50: 2270 7970 726f 6a65 6374 2e74 6f6d 6c22  "pyproject.toml"
-00010b60: 0a20 2020 2020 2020 2020 2020 2072 6f6f  .            roo
-00010b70: 745f 7079 7072 6f6a 6563 742e 7772 6974  t_pyproject.writ
-00010b80: 655f 7465 7874 2822 5b74 6f6f 6c2e 626c  e_text("[tool.bl
-00010b90: 6163 6b5d 222c 2065 6e63 6f64 696e 673d  ack]", encoding=
-00010ba0: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
-00010bb0: 2020 2020 2073 7263 5f70 7970 726f 6a65       src_pyproje
-00010bc0: 6374 203d 2073 7263 5f64 6972 202f 2022  ct = src_dir / "
-00010bd0: 7079 7072 6f6a 6563 742e 746f 6d6c 220a  pyproject.toml".
-00010be0: 2020 2020 2020 2020 2020 2020 7372 635f              src_
-00010bf0: 7079 7072 6f6a 6563 742e 7772 6974 655f  pyproject.write_
-00010c00: 7465 7874 2822 5b74 6f6f 6c2e 626c 6163  text("[tool.blac
-00010c10: 6b5d 222c 2065 6e63 6f64 696e 673d 2275  k]", encoding="u
-00010c20: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
-00010c30: 2020 2073 7263 5f70 7974 686f 6e20 3d20     src_python = 
-00010c40: 7372 635f 6469 7220 2f20 2266 6f6f 2e70  src_dir / "foo.p
-00010c50: 7922 0a20 2020 2020 2020 2020 2020 2073  y".            s
-00010c60: 7263 5f70 7974 686f 6e2e 746f 7563 6828  rc_python.touch(
-00010c70: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00010c80: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00010c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ca0: 2062 6c61 636b 2e66 696e 645f 7072 6f6a   black.find_proj
-00010cb0: 6563 745f 726f 6f74 2828 7372 635f 6469  ect_root((src_di
-00010cc0: 722c 2074 6573 745f 6469 7229 292c 0a20  r, test_dir)),. 
-00010cd0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00010ce0: 726f 6f74 2e72 6573 6f6c 7665 2829 2c20  root.resolve(), 
-00010cf0: 2270 7970 726f 6a65 6374 2e74 6f6d 6c22  "pyproject.toml"
-00010d00: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
-00010d10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00010d20: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00010d30: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00010d40: 6c61 636b 2e66 696e 645f 7072 6f6a 6563  lack.find_projec
-00010d50: 745f 726f 6f74 2828 7372 635f 6469 722c  t_root((src_dir,
-00010d60: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00010d70: 2020 2020 2873 7263 5f64 6972 2e72 6573      (src_dir.res
-00010d80: 6f6c 7665 2829 2c20 2270 7970 726f 6a65  olve(), "pyproje
-00010d90: 6374 2e74 6f6d 6c22 292c 0a20 2020 2020  ct.toml"),.     
-00010da0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00010db0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00010dc0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00010dd0: 2020 2020 2020 2062 6c61 636b 2e66 696e         black.fin
-00010de0: 645f 7072 6f6a 6563 745f 726f 6f74 2828  d_project_root((
-00010df0: 7372 635f 7079 7468 6f6e 2c29 292c 0a20  src_python,)),. 
-00010e00: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00010e10: 7372 635f 6469 722e 7265 736f 6c76 6528  src_dir.resolve(
-00010e20: 292c 2022 7079 7072 6f6a 6563 742e 746f  ), "pyproject.to
-00010e30: 6d6c 2229 2c0a 2020 2020 2020 2020 2020  ml"),.          
-00010e40: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-00010e50: 2077 6974 6820 6368 616e 6765 5f64 6972   with change_dir
-00010e60: 6563 746f 7279 2874 6573 745f 6469 7229  ectory(test_dir)
-00010e70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010e80: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00010e90: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00010ea0: 2020 2020 2020 2020 626c 6163 6b2e 6669          black.fi
-00010eb0: 6e64 5f70 726f 6a65 6374 5f72 6f6f 7428  nd_project_root(
-00010ec0: 2822 2d22 2c29 2c20 7374 6469 6e5f 6669  ("-",), stdin_fi
-00010ed0: 6c65 6e61 6d65 3d22 2e2e 2f73 7263 2f61  lename="../src/a
-00010ee0: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
-00010ef0: 2020 2020 2020 2020 2020 2028 7372 635f             (src_
-00010f00: 6469 722e 7265 736f 6c76 6528 292c 2022  dir.resolve(), "
-00010f10: 7079 7072 6f6a 6563 742e 746f 6d6c 2229  pyproject.toml")
-00010f20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010f30: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-00010f40: 2073 7263 5f73 7562 203d 2073 7263 5f64   src_sub = src_d
-00010f50: 6972 202f 2022 7375 6222 0a20 2020 2020  ir / "sub".     
-00010f60: 2020 2020 2020 2073 7263 5f73 7562 2e6d         src_sub.m
-00010f70: 6b64 6972 2829 0a0a 2020 2020 2020 2020  kdir()..        
-00010f80: 2020 2020 7372 635f 7375 625f 7079 7072      src_sub_pypr
-00010f90: 6f6a 6563 7420 3d20 7372 635f 7375 6220  oject = src_sub 
-00010fa0: 2f20 2270 7970 726f 6a65 6374 2e74 6f6d  / "pyproject.tom
-00010fb0: 6c22 0a20 2020 2020 2020 2020 2020 2073  l".            s
-00010fc0: 7263 5f73 7562 5f70 7970 726f 6a65 6374  rc_sub_pyproject
-00010fd0: 2e74 6f75 6368 2829 2020 2320 656d 7074  .touch()  # empt
-00010fe0: 790a 0a20 2020 2020 2020 2020 2020 2073  y..            s
-00010ff0: 7263 5f73 7562 5f70 7974 686f 6e20 3d20  rc_sub_python = 
-00011000: 7372 635f 7375 6220 2f20 2262 6172 2e70  src_sub / "bar.p
-00011010: 7922 0a0a 2020 2020 2020 2020 2020 2020  y"..            
-00011020: 2320 7765 2073 6b69 7020 7372 635f 7375  # we skip src_su
-00011030: 625f 7079 7072 6f6a 6563 7420 7369 6e63  b_pyproject sinc
-00011040: 6520 6974 2069 7320 6d69 7373 696e 6720  e it is missing 
-00011050: 7468 6520 5b74 6f6f 6c2e 626c 6163 6b5d  the [tool.black]
-00011060: 2073 6563 7469 6f6e 0a20 2020 2020 2020   section.       
-00011070: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00011080: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00011090: 2020 2020 2020 2062 6c61 636b 2e66 696e         black.fin
-000110a0: 645f 7072 6f6a 6563 745f 726f 6f74 2828  d_project_root((
-000110b0: 7372 635f 7375 625f 7079 7468 6f6e 2c29  src_sub_python,)
-000110c0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-000110d0: 2020 2028 7372 635f 6469 722e 7265 736f     (src_dir.reso
-000110e0: 6c76 6528 292c 2022 7079 7072 6f6a 6563  lve(), "pyprojec
-000110f0: 742e 746f 6d6c 2229 2c0a 2020 2020 2020  t.toml"),.      
-00011100: 2020 2020 2020 290a 0a20 2020 2040 7061        )..    @pa
-00011110: 7463 6828 0a20 2020 2020 2020 2022 626c  tch(.        "bl
-00011120: 6163 6b2e 6669 6c65 732e 6669 6e64 5f75  ack.files.find_u
-00011130: 7365 725f 7079 7072 6f6a 6563 745f 746f  ser_pyproject_to
-00011140: 6d6c 222c 0a20 2020 2029 0a20 2020 2064  ml",.    ).    d
-00011150: 6566 2074 6573 745f 6669 6e64 5f70 7970  ef test_find_pyp
-00011160: 726f 6a65 6374 5f74 6f6d 6c28 7365 6c66  roject_toml(self
-00011170: 2c20 6669 6e64 5f75 7365 725f 7079 7072  , find_user_pypr
-00011180: 6f6a 6563 745f 746f 6d6c 3a20 4d61 6769  oject_toml: Magi
-00011190: 634d 6f63 6b29 202d 3e20 4e6f 6e65 3a0a  cMock) -> None:.
-000111a0: 2020 2020 2020 2020 6669 6e64 5f75 7365          find_use
-000111b0: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
-000111c0: 2e73 6964 655f 6566 6665 6374 203d 2052  .side_effect = R
-000111d0: 756e 7469 6d65 4572 726f 7228 290a 0a20  untimeError().. 
-000111e0: 2020 2020 2020 2077 6974 6820 7265 6469         with redi
-000111f0: 7265 6374 5f73 7464 6572 7228 696f 2e53  rect_stderr(io.S
-00011200: 7472 696e 6749 4f28 2929 2061 7320 7374  tringIO()) as st
-00011210: 6465 7272 3a0a 2020 2020 2020 2020 2020  derr:.          
-00011220: 2020 7265 7375 6c74 203d 2062 6c61 636b    result = black
-00011230: 2e66 696c 6573 2e66 696e 645f 7079 7072  .files.find_pypr
-00011240: 6f6a 6563 745f 746f 6d6c 280a 2020 2020  oject_toml(.    
-00011250: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00011260: 5f73 6561 7263 685f 7374 6172 743d 2873  _search_start=(s
-00011270: 7472 2850 6174 682e 6377 6428 292e 726f  tr(Path.cwd().ro
-00011280: 6f74 292c 290a 2020 2020 2020 2020 2020  ot),).          
-00011290: 2020 290a 0a20 2020 2020 2020 2061 7373    )..        ass
-000112a0: 6572 7420 7265 7375 6c74 2069 7320 4e6f  ert result is No
-000112b0: 6e65 0a20 2020 2020 2020 2065 7272 203d  ne.        err =
-000112c0: 2073 7464 6572 722e 6765 7476 616c 7565   stderr.getvalue
-000112d0: 2829 0a20 2020 2020 2020 2061 7373 6572  ().        asser
-000112e0: 7420 2249 676e 6f72 696e 6720 7573 6572  t "Ignoring user
-000112f0: 2063 6f6e 6669 6775 7261 7469 6f6e 2220   configuration" 
-00011300: 696e 2065 7272 0a0a 2020 2020 4070 6174  in err..    @pat
-00011310: 6368 280a 2020 2020 2020 2020 2262 6c61  ch(.        "bla
-00011320: 636b 2e66 696c 6573 2e66 696e 645f 7573  ck.files.find_us
-00011330: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
-00011340: 6c22 2c0a 2020 2020 2020 2020 626c 6163  l",.        blac
-00011350: 6b2e 6669 6c65 732e 6669 6e64 5f75 7365  k.files.find_use
-00011360: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
-00011370: 2e5f 5f77 7261 7070 6564 5f5f 2c0a 2020  .__wrapped__,.  
-00011380: 2020 290a 2020 2020 6465 6620 7465 7374    ).    def test
-00011390: 5f66 696e 645f 7573 6572 5f70 7970 726f  _find_user_pypro
-000113a0: 6a65 6374 5f74 6f6d 6c5f 6c69 6e75 7828  ject_toml_linux(
-000113b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000113c0: 2020 2020 2020 2069 6620 7379 7374 656d         if system
-000113d0: 2829 203d 3d20 2257 696e 646f 7773 223a  () == "Windows":
-000113e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000113f0: 7572 6e0a 0a20 2020 2020 2020 2023 2054  urn..        # T
-00011400: 6573 7420 6966 2058 4447 5f43 4f4e 4649  est if XDG_CONFI
-00011410: 475f 484f 4d45 2069 7320 6368 6563 6b65  G_HOME is checke
-00011420: 640a 2020 2020 2020 2020 7769 7468 2054  d.        with T
-00011430: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
-00011440: 7928 2920 6173 2077 6f72 6b73 7061 6365  y() as workspace
-00011450: 3a0a 2020 2020 2020 2020 2020 2020 746d  :.            tm
-00011460: 705f 7573 6572 5f63 6f6e 6669 6720 3d20  p_user_config = 
-00011470: 5061 7468 2877 6f72 6b73 7061 6365 2920  Path(workspace) 
-00011480: 2f20 2262 6c61 636b 220a 2020 2020 2020  / "black".      
-00011490: 2020 2020 2020 7769 7468 2070 6174 6368        with patch
-000114a0: 2e64 6963 7428 226f 732e 656e 7669 726f  .dict("os.enviro
-000114b0: 6e22 2c20 7b22 5844 475f 434f 4e46 4947  n", {"XDG_CONFIG
-000114c0: 5f48 4f4d 4522 3a20 776f 726b 7370 6163  _HOME": workspac
-000114d0: 657d 293a 0a20 2020 2020 2020 2020 2020  e}):.           
-000114e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000114f0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-00011500: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-00011510: 2e66 696c 6573 2e66 696e 645f 7573 6572  .files.find_user
-00011520: 5f70 7970 726f 6a65 6374 5f74 6f6d 6c28  _pyproject_toml(
-00011530: 292c 2074 6d70 5f75 7365 725f 636f 6e66  ), tmp_user_conf
-00011540: 6967 2e72 6573 6f6c 7665 2829 0a20 2020  ig.resolve().   
-00011550: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00011560: 2020 2020 2020 2020 2320 5465 7374 2066          # Test f
-00011570: 616c 6c62 6163 6b20 666f 7220 5844 475f  allback for XDG_
-00011580: 434f 4e46 4947 5f48 4f4d 450a 2020 2020  CONFIG_HOME.    
-00011590: 2020 2020 7769 7468 2070 6174 6368 2e64      with patch.d
-000115a0: 6963 7428 226f 732e 656e 7669 726f 6e22  ict("os.environ"
-000115b0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
-000115c0: 732e 656e 7669 726f 6e2e 706f 7028 2258  s.environ.pop("X
-000115d0: 4447 5f43 4f4e 4649 475f 484f 4d45 222c  DG_CONFIG_HOME",
-000115e0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
-000115f0: 2020 2066 616c 6c62 6163 6b5f 7573 6572     fallback_user
-00011600: 5f63 6f6e 6669 6720 3d20 5061 7468 2822  _config = Path("
-00011610: 7e2f 2e63 6f6e 6669 6722 292e 6578 7061  ~/.config").expa
-00011620: 6e64 7573 6572 2829 202f 2022 626c 6163  nduser() / "blac
-00011630: 6b22 0a20 2020 2020 2020 2020 2020 2073  k".            s
-00011640: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00011650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011660: 2062 6c61 636b 2e66 696c 6573 2e66 696e   black.files.fin
-00011670: 645f 7573 6572 5f70 7970 726f 6a65 6374  d_user_pyproject
-00011680: 5f74 6f6d 6c28 292c 2066 616c 6c62 6163  _toml(), fallbac
-00011690: 6b5f 7573 6572 5f63 6f6e 6669 672e 7265  k_user_config.re
-000116a0: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
-000116b0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
-000116c0: 6573 745f 6669 6e64 5f75 7365 725f 7079  est_find_user_py
-000116d0: 7072 6f6a 6563 745f 746f 6d6c 5f77 696e  project_toml_win
-000116e0: 646f 7773 2873 656c 6629 202d 3e20 4e6f  dows(self) -> No
-000116f0: 6e65 3a0a 2020 2020 2020 2020 6966 2073  ne:.        if s
-00011700: 7973 7465 6d28 2920 213d 2022 5769 6e64  ystem() != "Wind
-00011710: 6f77 7322 3a0a 2020 2020 2020 2020 2020  ows":.          
-00011720: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-00011730: 2020 7573 6572 5f63 6f6e 6669 675f 7061    user_config_pa
-00011740: 7468 203d 2050 6174 682e 686f 6d65 2829  th = Path.home()
-00011750: 202f 2022 2e62 6c61 636b 220a 2020 2020   / ".black".    
-00011760: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00011770: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00011780: 2020 626c 6163 6b2e 6669 6c65 732e 6669    black.files.fi
-00011790: 6e64 5f75 7365 725f 7079 7072 6f6a 6563  nd_user_pyprojec
-000117a0: 745f 746f 6d6c 2829 2c20 7573 6572 5f63  t_toml(), user_c
-000117b0: 6f6e 6669 675f 7061 7468 2e72 6573 6f6c  onfig_path.resol
-000117c0: 7665 2829 0a20 2020 2020 2020 2029 0a0a  ve().        )..
-000117d0: 2020 2020 6465 6620 7465 7374 5f62 706f      def test_bpo
-000117e0: 5f33 3336 3630 5f77 6f72 6b61 726f 756e  _33660_workaroun
-000117f0: 6428 7365 6c66 2920 2d3e 204e 6f6e 653a  d(self) -> None:
-00011800: 0a20 2020 2020 2020 2069 6620 7379 7374  .        if syst
-00011810: 656d 2829 203d 3d20 2257 696e 646f 7773  em() == "Windows
-00011820: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
-00011830: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
-00011840: 2068 7474 7073 3a2f 2f62 7567 732e 7079   https://bugs.py
-00011850: 7468 6f6e 2e6f 7267 2f69 7373 7565 3333  thon.org/issue33
-00011860: 3636 300a 2020 2020 2020 2020 2320 4361  660.        # Ca
-00011870: 6e20 6265 2072 656d 6f76 6564 2077 6865  n be removed whe
-00011880: 6e20 7765 2064 726f 7020 7375 7070 6f72  n we drop suppor
-00011890: 7420 666f 7220 5079 7468 6f6e 2033 2e38  t for Python 3.8
-000118a0: 2e35 0a20 2020 2020 2020 2072 6f6f 7420  .5.        root 
-000118b0: 3d20 5061 7468 2822 2f22 290a 2020 2020  = Path("/").    
-000118c0: 2020 2020 7769 7468 2063 6861 6e67 655f      with change_
-000118d0: 6469 7265 6374 6f72 7928 726f 6f74 293a  directory(root):
-000118e0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-000118f0: 6820 3d20 5061 7468 2822 776f 726b 7370  h = Path("worksp
-00011900: 6163 6522 2920 2f20 2270 726f 6a65 6374  ace") / "project
-00011910: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
-00011920: 706f 7274 203d 2062 6c61 636b 2e52 6570  port = black.Rep
-00011930: 6f72 7428 7665 7262 6f73 653d 5472 7565  ort(verbose=True
-00011940: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00011950: 736f 6c76 6573 5f6f 7574 7369 6465 203d  solves_outside =
-00011960: 2062 6c61 636b 2e72 6573 6f6c 7665 735f   black.resolves_
-00011970: 6f75 7473 6964 655f 726f 6f74 5f6f 725f  outside_root_or_
-00011980: 6361 6e6e 6f74 5f73 7461 7428 0a20 2020  cannot_stat(.   
-00011990: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-000119a0: 682c 2072 6f6f 742c 2072 6570 6f72 740a  h, root, report.
-000119b0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000119c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000119d0: 7373 6572 7449 7328 7265 736f 6c76 6573  ssertIs(resolves
-000119e0: 5f6f 7574 7369 6465 2c20 4661 6c73 6529  _outside, False)
-000119f0: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
-00011a00: 6f72 6d61 6c69 7a65 5f70 6174 685f 6967  ormalize_path_ig
-00011a10: 6e6f 7265 5f77 696e 646f 7773 5f6a 756e  nore_windows_jun
-00011a20: 6374 696f 6e73 5f6f 7574 7369 6465 5f6f  ctions_outside_o
-00011a30: 665f 726f 6f74 2873 656c 6629 202d 3e20  f_root(self) -> 
-00011a40: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
-00011a50: 2073 7973 7465 6d28 2920 213d 2022 5769   system() != "Wi
-00011a60: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
-00011a70: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00011a80: 2020 2020 7769 7468 2054 656d 706f 7261      with Tempora
-00011a90: 7279 4469 7265 6374 6f72 7928 2920 6173  ryDirectory() as
-00011aa0: 2077 6f72 6b73 7061 6365 3a0a 2020 2020   workspace:.    
-00011ab0: 2020 2020 2020 2020 726f 6f74 203d 2050          root = P
-00011ac0: 6174 6828 776f 726b 7370 6163 6529 0a20  ath(workspace). 
-00011ad0: 2020 2020 2020 2020 2020 206a 756e 6374             junct
-00011ae0: 696f 6e5f 6469 7220 3d20 726f 6f74 202f  ion_dir = root /
-00011af0: 2022 6a75 6e63 7469 6f6e 220a 2020 2020   "junction".    
-00011b00: 2020 2020 2020 2020 6a75 6e63 7469 6f6e          junction
-00011b10: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
-00011b20: 6f66 5f72 6f6f 7420 3d20 726f 6f74 202f  of_root = root /
-00011b30: 2022 2e2e 220a 2020 2020 2020 2020 2020   "..".          
-00011b40: 2020 6f73 2e73 7973 7465 6d28 6622 6d6b    os.system(f"mk
-00011b50: 6c69 6e6b 202f 4a20 7b6a 756e 6374 696f  link /J {junctio
-00011b60: 6e5f 6469 727d 207b 6a75 6e63 7469 6f6e  n_dir} {junction
-00011b70: 5f74 6172 6765 745f 6f75 7473 6964 655f  _target_outside_
-00011b80: 6f66 5f72 6f6f 747d 2229 0a0a 2020 2020  of_root}")..    
-00011b90: 2020 2020 2020 2020 7265 706f 7274 203d          report =
-00011ba0: 2062 6c61 636b 2e52 6570 6f72 7428 7665   black.Report(ve
-00011bb0: 7262 6f73 653d 5472 7565 290a 2020 2020  rbose=True).    
-00011bc0: 2020 2020 2020 2020 7265 736f 6c76 6573          resolves
-00011bd0: 5f6f 7574 7369 6465 203d 2062 6c61 636b  _outside = black
-00011be0: 2e72 6573 6f6c 7665 735f 6f75 7473 6964  .resolves_outsid
-00011bf0: 655f 726f 6f74 5f6f 725f 6361 6e6e 6f74  e_root_or_cannot
-00011c00: 5f73 7461 7428 0a20 2020 2020 2020 2020  _stat(.         
-00011c10: 2020 2020 2020 206a 756e 6374 696f 6e5f         junction_
-00011c20: 6469 722c 2072 6f6f 742c 2072 6570 6f72  dir, root, repor
-00011c30: 740a 2020 2020 2020 2020 2020 2020 290a  t.            ).
-00011c40: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
-00011c50: 6e75 616c 6c79 2064 656c 6574 6520 666f  nually delete fo
-00011c60: 7220 5079 7468 6f6e 203c 2033 2e38 0a20  r Python < 3.8. 
-00011c70: 2020 2020 2020 2020 2020 206f 732e 7379             os.sy
-00011c80: 7374 656d 2866 2272 6d64 6972 207b 6a75  stem(f"rmdir {ju
-00011c90: 6e63 7469 6f6e 5f64 6972 7d22 290a 0a20  nction_dir}").. 
-00011ca0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00011cb0: 6173 7365 7274 4973 2872 6573 6f6c 7665  assertIs(resolve
-00011cc0: 735f 6f75 7473 6964 652c 2054 7275 6529  s_outside, True)
-00011cd0: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
-00011ce0: 6577 6c69 6e65 5f63 6f6d 6d65 6e74 5f69  ewline_comment_i
-00011cf0: 6e74 6572 6163 7469 6f6e 2873 656c 6629  nteraction(self)
-00011d00: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00011d10: 2020 736f 7572 6365 203d 2022 636c 6173    source = "clas
-00011d20: 7320 413a 5c5c 5c72 5c6e 2320 7479 7065  s A:\\\r\n# type
-00011d30: 3a20 6967 6e6f 7265 5c6e 2070 6173 735c  : ignore\n pass\
-00011d40: 6e22 0a20 2020 2020 2020 206f 7574 7075  n".        outpu
-00011d50: 7420 3d20 626c 6163 6b2e 666f 726d 6174  t = black.format
-00011d60: 5f73 7472 2873 6f75 7263 652c 206d 6f64  _str(source, mod
-00011d70: 653d 4445 4641 554c 545f 4d4f 4445 290a  e=DEFAULT_MODE).
-00011d80: 2020 2020 2020 2020 626c 6163 6b2e 6173          black.as
-00011d90: 7365 7274 5f73 7461 626c 6528 736f 7572  sert_stable(sour
-00011da0: 6365 2c20 6f75 7470 7574 2c20 6d6f 6465  ce, output, mode
-00011db0: 3d44 4546 4155 4c54 5f4d 4f44 4529 0a0a  =DEFAULT_MODE)..
-00011dc0: 2020 2020 6465 6620 7465 7374 5f62 706f      def test_bpo
-00011dd0: 5f32 3134 325f 776f 726b 6172 6f75 6e64  _2142_workaround
-00011de0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00011df0: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
-00011e00: 2f2f 6275 6773 2e70 7974 686f 6e2e 6f72  //bugs.python.or
-00011e10: 672f 6973 7375 6532 3134 320a 0a20 2020  g/issue2142..   
-00011e20: 2020 2020 2073 6f75 7263 652c 205f 203d       source, _ =
-00011e30: 2072 6561 645f 6461 7461 2822 6d69 7363   read_data("misc
-00011e40: 656c 6c61 6e65 6f75 7322 2c20 226d 6973  ellaneous", "mis
-00011e50: 7369 6e67 5f66 696e 616c 5f6e 6577 6c69  sing_final_newli
-00011e60: 6e65 2229 0a20 2020 2020 2020 2023 2072  ne").        # r
-00011e70: 6561 645f 6461 7461 2061 6464 7320 6120  ead_data adds a 
-00011e80: 7472 6169 6c69 6e67 206e 6577 6c69 6e65  trailing newline
-00011e90: 0a20 2020 2020 2020 2073 6f75 7263 6520  .        source 
-00011ea0: 3d20 736f 7572 6365 2e72 7374 7269 7028  = source.rstrip(
-00011eb0: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
-00011ec0: 6564 2c20 5f20 3d20 7265 6164 5f64 6174  ed, _ = read_dat
-00011ed0: 6128 226d 6973 6365 6c6c 616e 656f 7573  a("miscellaneous
-00011ee0: 222c 2022 6d69 7373 696e 675f 6669 6e61  ", "missing_fina
-00011ef0: 6c5f 6e65 776c 696e 652e 6469 6666 2229  l_newline.diff")
-00011f00: 0a20 2020 2020 2020 2074 6d70 5f66 696c  .        tmp_fil
-00011f10: 6520 3d20 5061 7468 2862 6c61 636b 2e64  e = Path(black.d
-00011f20: 756d 705f 746f 5f66 696c 6528 736f 7572  ump_to_file(sour
-00011f30: 6365 2c20 656e 7375 7265 5f66 696e 616c  ce, ensure_final
-00011f40: 5f6e 6577 6c69 6e65 3d46 616c 7365 2929  _newline=False))
-00011f50: 0a20 2020 2020 2020 2064 6966 665f 6865  .        diff_he
-00011f60: 6164 6572 203d 2072 652e 636f 6d70 696c  ader = re.compil
-00011f70: 6528 0a20 2020 2020 2020 2020 2020 2072  e(.            r
-00011f80: 6622 7b72 652e 6573 6361 7065 2873 7472  f"{re.escape(str
-00011f90: 2874 6d70 5f66 696c 6529 297d 5c74 5c64  (tmp_file))}\t\d
-00011fa0: 5c64 5c64 5c64 2d5c 645c 642d 5c64 5c64  \d\d\d-\d\d-\d\d
-00011fb0: 2022 0a20 2020 2020 2020 2020 2020 2072   ".            r
-00011fc0: 225c 645c 643a 5c64 5c64 3a5c 645c 645c  "\d\d:\d\d:\d\d\
-00011fd0: 2e5c 645c 645c 645c 645c 645c 645c 2b5c  .\d\d\d\d\d\d\+\
-00011fe0: 645c 643a 5c64 5c64 220a 2020 2020 2020  d\d:\d\d".      
-00011ff0: 2020 290a 2020 2020 2020 2020 7472 793a    ).        try:
-00012000: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00012010: 756c 7420 3d20 426c 6163 6b52 756e 6e65  ult = BlackRunne
-00012020: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
-00012030: 2e6d 6169 6e2c 205b 222d 2d64 6966 6622  .main, ["--diff"
-00012040: 2c20 7374 7228 746d 705f 6669 6c65 295d  , str(tmp_file)]
-00012050: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00012060: 6c66 2e61 7373 6572 7445 7175 616c 2872  lf.assertEqual(r
-00012070: 6573 756c 742e 6578 6974 5f63 6f64 652c  esult.exit_code,
-00012080: 2030 290a 2020 2020 2020 2020 6669 6e61   0).        fina
-00012090: 6c6c 793a 0a20 2020 2020 2020 2020 2020  lly:.           
-000120a0: 206f 732e 756e 6c69 6e6b 2874 6d70 5f66   os.unlink(tmp_f
-000120b0: 696c 6529 0a20 2020 2020 2020 2061 6374  ile).        act
-000120c0: 7561 6c20 3d20 7265 7375 6c74 2e6f 7574  ual = result.out
-000120d0: 7075 740a 2020 2020 2020 2020 6163 7475  put.        actu
-000120e0: 616c 203d 2064 6966 665f 6865 6164 6572  al = diff_header
-000120f0: 2e73 7562 2844 4554 4552 4d49 4e49 5354  .sub(DETERMINIST
-00012100: 4943 5f48 4541 4445 522c 2061 6374 7561  IC_HEADER, actua
-00012110: 6c29 0a20 2020 2020 2020 2073 656c 662e  l).        self.
-00012120: 6173 7365 7274 4571 7561 6c28 6163 7475  assertEqual(actu
-00012130: 616c 2c20 6578 7065 6374 6564 290a 0a20  al, expected).. 
-00012140: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-00012150: 0a20 2020 2064 6566 2063 6f6d 7061 7265  .    def compare
-00012160: 5f72 6573 756c 7473 280a 2020 2020 2020  _results(.      
-00012170: 2020 7265 7375 6c74 3a20 636c 6963 6b2e    result: click.
-00012180: 7465 7374 696e 672e 5265 7375 6c74 2c20  testing.Result, 
-00012190: 6578 7065 6374 6564 5f76 616c 7565 3a20  expected_value: 
-000121a0: 7374 722c 2065 7870 6563 7465 645f 6578  str, expected_ex
-000121b0: 6974 5f63 6f64 653a 2069 6e74 0a20 2020  it_code: int.   
-000121c0: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
-000121d0: 2020 2020 2222 2248 656c 7065 7220 6d65      """Helper me
-000121e0: 7468 6f64 2074 6f20 7465 7374 2074 6865  thod to test the
-000121f0: 2076 616c 7565 2061 6e64 2065 7869 7420   value and exit 
-00012200: 636f 6465 206f 6620 6120 636c 6963 6b20  code of a click 
-00012210: 5265 7375 6c74 2e22 2222 0a20 2020 2020  Result.""".     
-00012220: 2020 2061 7373 6572 7420 280a 2020 2020     assert (.    
-00012230: 2020 2020 2020 2020 7265 7375 6c74 2e6f          result.o
-00012240: 7574 7075 7420 3d3d 2065 7870 6563 7465  utput == expecte
-00012250: 645f 7661 6c75 650a 2020 2020 2020 2020  d_value.        
-00012260: 292c 2022 5468 6520 6f75 7470 7574 2064  ), "The output d
-00012270: 6964 206e 6f74 206d 6174 6368 2074 6865  id not match the
-00012280: 2065 7870 6563 7465 6420 7661 6c75 652e   expected value.
-00012290: 220a 2020 2020 2020 2020 6173 7365 7274  ".        assert
-000122a0: 2072 6573 756c 742e 6578 6974 5f63 6f64   result.exit_cod
-000122b0: 6520 3d3d 2065 7870 6563 7465 645f 6578  e == expected_ex
-000122c0: 6974 5f63 6f64 652c 2022 5468 6520 6578  it_code, "The ex
-000122d0: 6974 2063 6f64 6520 6973 2069 6e63 6f72  it code is incor
-000122e0: 7265 6374 2e22 0a0a 2020 2020 6465 6620  rect."..    def 
-000122f0: 7465 7374 5f63 6f64 655f 6f70 7469 6f6e  test_code_option
-00012300: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00012310: 2020 2020 2020 2020 2222 2254 6573 7420          """Test 
-00012320: 7468 6520 636f 6465 206f 7074 696f 6e20  the code option 
-00012330: 7769 7468 206e 6f20 6368 616e 6765 732e  with no changes.
-00012340: 2222 220a 2020 2020 2020 2020 636f 6465  """.        code
-00012350: 203d 2027 7072 696e 7428 2248 656c 6c6f   = 'print("Hello
-00012360: 2077 6f72 6c64 2229 5c6e 270a 2020 2020   world")\n'.    
-00012370: 2020 2020 6172 6773 203d 205b 222d 2d63      args = ["--c
-00012380: 6f64 6522 2c20 636f 6465 5d0a 2020 2020  ode", code].    
-00012390: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
-000123a0: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
-000123b0: 626c 6163 6b2e 6d61 696e 2c20 6172 6773  black.main, args
-000123c0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000123d0: 636f 6d70 6172 655f 7265 7375 6c74 7328  compare_results(
-000123e0: 7265 7375 6c74 2c20 636f 6465 2c20 3029  result, code, 0)
-000123f0: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
-00012400: 6f64 655f 6f70 7469 6f6e 5f63 6861 6e67  ode_option_chang
-00012410: 6564 2873 656c 6629 202d 3e20 4e6f 6e65  ed(self) -> None
-00012420: 3a0a 2020 2020 2020 2020 2222 2254 6573  :.        """Tes
-00012430: 7420 7468 6520 636f 6465 206f 7074 696f  t the code optio
-00012440: 6e20 7768 656e 2063 6861 6e67 6573 2061  n when changes a
-00012450: 7265 2072 6571 7569 7265 642e 2222 220a  re required.""".
-00012460: 2020 2020 2020 2020 636f 6465 203d 2022          code = "
-00012470: 7072 696e 7428 2768 656c 6c6f 2077 6f72  print('hello wor
-00012480: 6c64 2729 220a 2020 2020 2020 2020 666f  ld')".        fo
-00012490: 726d 6174 7465 6420 3d20 626c 6163 6b2e  rmatted = black.
-000124a0: 666f 726d 6174 5f73 7472 2863 6f64 652c  format_str(code,
-000124b0: 206d 6f64 653d 4445 4641 554c 545f 4d4f   mode=DEFAULT_MO
-000124c0: 4445 290a 0a20 2020 2020 2020 2061 7267  DE)..        arg
-000124d0: 7320 3d20 5b22 2d2d 636f 6465 222c 2063  s = ["--code", c
-000124e0: 6f64 655d 0a20 2020 2020 2020 2072 6573  ode].        res
-000124f0: 756c 7420 3d20 436c 6952 756e 6e65 7228  ult = CliRunner(
-00012500: 292e 696e 766f 6b65 2862 6c61 636b 2e6d  ).invoke(black.m
-00012510: 6169 6e2c 2061 7267 7329 0a0a 2020 2020  ain, args)..    
-00012520: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
-00012530: 5f72 6573 756c 7473 2872 6573 756c 742c  _results(result,
-00012540: 2066 6f72 6d61 7474 6564 2c20 3029 0a0a   formatted, 0)..
-00012550: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
-00012560: 655f 6f70 7469 6f6e 5f63 6865 636b 2873  e_option_check(s
-00012570: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00012580: 2020 2020 2020 2222 2254 6573 7420 7468        """Test th
-00012590: 6520 636f 6465 206f 7074 696f 6e20 7768  e code option wh
-000125a0: 656e 2063 6865 636b 2069 7320 7061 7373  en check is pass
-000125b0: 6564 2e22 2222 0a20 2020 2020 2020 2061  ed.""".        a
-000125c0: 7267 7320 3d20 5b22 2d2d 6368 6563 6b22  rgs = ["--check"
-000125d0: 2c20 222d 2d63 6f64 6522 2c20 2770 7269  , "--code", 'pri
-000125e0: 6e74 2822 4865 6c6c 6f20 776f 726c 6422  nt("Hello world"
-000125f0: 295c 6e27 5d0a 2020 2020 2020 2020 7265  )\n'].        re
-00012600: 7375 6c74 203d 2043 6c69 5275 6e6e 6572  sult = CliRunner
-00012610: 2829 2e69 6e76 6f6b 6528 626c 6163 6b2e  ().invoke(black.
-00012620: 6d61 696e 2c20 6172 6773 290a 2020 2020  main, args).    
-00012630: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
-00012640: 5f72 6573 756c 7473 2872 6573 756c 742c  _results(result,
-00012650: 2022 222c 2030 290a 0a20 2020 2064 6566   "", 0)..    def
-00012660: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
-00012670: 6e5f 6368 6563 6b5f 6368 616e 6765 6428  n_check_changed(
-00012680: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00012690: 2020 2020 2020 2022 2222 5465 7374 2074         """Test t
-000126a0: 6865 2063 6f64 6520 6f70 7469 6f6e 2077  he code option w
-000126b0: 6865 6e20 6368 616e 6765 7320 6172 6520  hen changes are 
-000126c0: 7265 7175 6972 6564 2c20 616e 6420 6368  required, and ch
-000126d0: 6563 6b20 6973 2070 6173 7365 642e 2222  eck is passed.""
-000126e0: 220a 2020 2020 2020 2020 6172 6773 203d  ".        args =
-000126f0: 205b 222d 2d63 6865 636b 222c 2022 2d2d   ["--check", "--
-00012700: 636f 6465 222c 2022 7072 696e 7428 2768  code", "print('h
-00012710: 656c 6c6f 2077 6f72 6c64 2729 225d 0a20  ello world')"]. 
-00012720: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00012730: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
-00012740: 6b65 2862 6c61 636b 2e6d 6169 6e2c 2061  ke(black.main, a
-00012750: 7267 7329 0a20 2020 2020 2020 2073 656c  rgs).        sel
-00012760: 662e 636f 6d70 6172 655f 7265 7375 6c74  f.compare_result
-00012770: 7328 7265 7375 6c74 2c20 2222 2c20 3129  s(result, "", 1)
-00012780: 0a0a 2020 2020 6465 6620 7465 7374 5f63  ..    def test_c
-00012790: 6f64 655f 6f70 7469 6f6e 5f64 6966 6628  ode_option_diff(
-000127a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000127b0: 2020 2020 2020 2022 2222 5465 7374 2074         """Test t
-000127c0: 6865 2063 6f64 6520 6f70 7469 6f6e 2077  he code option w
-000127d0: 6865 6e20 6469 6666 2069 7320 7061 7373  hen diff is pass
-000127e0: 6564 2e22 2222 0a20 2020 2020 2020 2063  ed.""".        c
-000127f0: 6f64 6520 3d20 2270 7269 6e74 2827 6865  ode = "print('he
-00012800: 6c6c 6f20 776f 726c 6427 2922 0a20 2020  llo world')".   
-00012810: 2020 2020 2066 6f72 6d61 7474 6564 203d       formatted =
-00012820: 2062 6c61 636b 2e66 6f72 6d61 745f 7374   black.format_st
-00012830: 7228 636f 6465 2c20 6d6f 6465 3d44 4546  r(code, mode=DEF
-00012840: 4155 4c54 5f4d 4f44 4529 0a20 2020 2020  AULT_MODE).     
-00012850: 2020 2072 6573 756c 745f 6469 6666 203d     result_diff =
-00012860: 2064 6966 6628 636f 6465 2c20 666f 726d   diff(code, form
-00012870: 6174 7465 642c 2022 5354 4449 4e22 2c20  atted, "STDIN", 
-00012880: 2253 5444 4f55 5422 290a 0a20 2020 2020  "STDOUT")..     
-00012890: 2020 2061 7267 7320 3d20 5b22 2d2d 6469     args = ["--di
-000128a0: 6666 222c 2022 2d2d 636f 6465 222c 2063  ff", "--code", c
-000128b0: 6f64 655d 0a20 2020 2020 2020 2072 6573  ode].        res
-000128c0: 756c 7420 3d20 436c 6952 756e 6e65 7228  ult = CliRunner(
-000128d0: 292e 696e 766f 6b65 2862 6c61 636b 2e6d  ).invoke(black.m
-000128e0: 6169 6e2c 2061 7267 7329 0a0a 2020 2020  ain, args)..    
-000128f0: 2020 2020 2320 5265 6d6f 7665 2074 696d      # Remove tim
-00012900: 6520 6672 6f6d 2064 6966 660a 2020 2020  e from diff.    
-00012910: 2020 2020 6f75 7470 7574 203d 2044 4946      output = DIF
-00012920: 465f 5449 4d45 2e73 7562 2822 222c 2072  F_TIME.sub("", r
-00012930: 6573 756c 742e 6f75 7470 7574 290a 0a20  esult.output).. 
-00012940: 2020 2020 2020 2061 7373 6572 7420 6f75         assert ou
-00012950: 7470 7574 203d 3d20 7265 7375 6c74 5f64  tput == result_d
-00012960: 6966 662c 2022 5468 6520 6f75 7470 7574  iff, "The output
-00012970: 2064 6964 206e 6f74 206d 6174 6368 2074   did not match t
-00012980: 6865 2065 7870 6563 7465 6420 7661 6c75  he expected valu
-00012990: 652e 220a 2020 2020 2020 2020 6173 7365  e.".        asse
-000129a0: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
-000129b0: 6f64 6520 3d3d 2030 2c20 2254 6865 2065  ode == 0, "The e
-000129c0: 7869 7420 636f 6465 2069 7320 696e 636f  xit code is inco
-000129d0: 7272 6563 742e 220a 0a20 2020 2064 6566  rrect."..    def
-000129e0: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
-000129f0: 6e5f 636f 6c6f 725f 6469 6666 2873 656c  n_color_diff(sel
-00012a00: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00012a10: 2020 2020 2222 2254 6573 7420 7468 6520      """Test the 
-00012a20: 636f 6465 206f 7074 696f 6e20 7768 656e  code option when
-00012a30: 2063 6f6c 6f72 2061 6e64 2064 6966 6620   color and diff 
-00012a40: 6172 6520 7061 7373 6564 2e22 2222 0a20  are passed.""". 
-00012a50: 2020 2020 2020 2063 6f64 6520 3d20 2270         code = "p
-00012a60: 7269 6e74 2827 6865 6c6c 6f20 776f 726c  rint('hello worl
-00012a70: 6427 2922 0a20 2020 2020 2020 2066 6f72  d')".        for
-00012a80: 6d61 7474 6564 203d 2062 6c61 636b 2e66  matted = black.f
-00012a90: 6f72 6d61 745f 7374 7228 636f 6465 2c20  ormat_str(code, 
-00012aa0: 6d6f 6465 3d44 4546 4155 4c54 5f4d 4f44  mode=DEFAULT_MOD
-00012ab0: 4529 0a0a 2020 2020 2020 2020 7265 7375  E)..        resu
-00012ac0: 6c74 5f64 6966 6620 3d20 6469 6666 2863  lt_diff = diff(c
-00012ad0: 6f64 652c 2066 6f72 6d61 7474 6564 2c20  ode, formatted, 
-00012ae0: 2253 5444 494e 222c 2022 5354 444f 5554  "STDIN", "STDOUT
-00012af0: 2229 0a20 2020 2020 2020 2072 6573 756c  ").        resul
-00012b00: 745f 6469 6666 203d 2063 6f6c 6f72 5f64  t_diff = color_d
-00012b10: 6966 6628 7265 7375 6c74 5f64 6966 6629  iff(result_diff)
-00012b20: 0a0a 2020 2020 2020 2020 6172 6773 203d  ..        args =
-00012b30: 205b 222d 2d64 6966 6622 2c20 222d 2d63   ["--diff", "--c
-00012b40: 6f6c 6f72 222c 2022 2d2d 636f 6465 222c  olor", "--code",
-00012b50: 2063 6f64 655d 0a20 2020 2020 2020 2072   code].        r
-00012b60: 6573 756c 7420 3d20 436c 6952 756e 6e65  esult = CliRunne
-00012b70: 7228 292e 696e 766f 6b65 2862 6c61 636b  r().invoke(black
-00012b80: 2e6d 6169 6e2c 2061 7267 7329 0a0a 2020  .main, args)..  
-00012b90: 2020 2020 2020 2320 5265 6d6f 7665 2074        # Remove t
-00012ba0: 696d 6520 6672 6f6d 2064 6966 660a 2020  ime from diff.  
-00012bb0: 2020 2020 2020 6f75 7470 7574 203d 2044        output = D
-00012bc0: 4946 465f 5449 4d45 2e73 7562 2822 222c  IFF_TIME.sub("",
-00012bd0: 2072 6573 756c 742e 6f75 7470 7574 290a   result.output).
-00012be0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00012bf0: 6f75 7470 7574 203d 3d20 7265 7375 6c74  output == result
-00012c00: 5f64 6966 662c 2022 5468 6520 6f75 7470  _diff, "The outp
-00012c10: 7574 2064 6964 206e 6f74 206d 6174 6368  ut did not match
-00012c20: 2074 6865 2065 7870 6563 7465 6420 7661   the expected va
-00012c30: 6c75 652e 220a 2020 2020 2020 2020 6173  lue.".        as
-00012c40: 7365 7274 2072 6573 756c 742e 6578 6974  sert result.exit
-00012c50: 5f63 6f64 6520 3d3d 2030 2c20 2254 6865  _code == 0, "The
-00012c60: 2065 7869 7420 636f 6465 2069 7320 696e   exit code is in
-00012c70: 636f 7272 6563 742e 220a 0a20 2020 2040  correct."..    @
-00012c80: 7079 7465 7374 2e6d 6172 6b2e 696e 636f  pytest.mark.inco
-00012c90: 6d70 6174 6962 6c65 5f77 6974 685f 6d79  mpatible_with_my
-00012ca0: 7079 630a 2020 2020 6465 6620 7465 7374  pyc.    def test
-00012cb0: 5f63 6f64 655f 6f70 7469 6f6e 5f73 6166  _code_option_saf
-00012cc0: 6528 7365 6c66 2920 2d3e 204e 6f6e 653a  e(self) -> None:
-00012cd0: 0a20 2020 2020 2020 2022 2222 5465 7374  .        """Test
-00012ce0: 2074 6861 7420 7468 6520 636f 6465 206f   that the code o
-00012cf0: 7074 696f 6e20 7468 726f 7773 2061 6e20  ption throws an 
-00012d00: 6572 726f 7220 7768 656e 2074 6865 2073  error when the s
-00012d10: 616e 6974 7920 6368 6563 6b73 2066 6169  anity checks fai
-00012d20: 6c2e 2222 220a 2020 2020 2020 2020 2320  l.""".        # 
-00012d30: 5061 7463 6820 626c 6163 6b2e 6173 7365  Patch black.asse
-00012d40: 7274 5f65 7175 6976 616c 656e 7420 746f  rt_equivalent to
-00012d50: 2065 6e73 7572 6520 7468 6520 7361 6e69   ensure the sani
-00012d60: 7479 2063 6865 636b 7320 6661 696c 0a20  ty checks fail. 
-00012d70: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
-00012d80: 682e 6f62 6a65 6374 2862 6c61 636b 2c20  h.object(black, 
-00012d90: 2261 7373 6572 745f 6571 7569 7661 6c65  "assert_equivale
-00012da0: 6e74 222c 2073 6964 655f 6566 6665 6374  nt", side_effect
-00012db0: 3d41 7373 6572 7469 6f6e 4572 726f 7229  =AssertionError)
-00012dc0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00012dd0: 6465 203d 2027 7072 696e 7428 2248 656c  de = 'print("Hel
-00012de0: 6c6f 2077 6f72 6c64 2229 270a 2020 2020  lo world")'.    
-00012df0: 2020 2020 2020 2020 6572 726f 725f 6d73          error_ms
-00012e00: 6720 3d20 6622 7b63 6f64 657d 5c6e 6572  g = f"{code}\ner
-00012e10: 726f 723a 2063 616e 6e6f 7420 666f 726d  ror: cannot form
-00012e20: 6174 203c 7374 7269 6e67 3e3a 205c 6e22  at <string>: \n"
-00012e30: 0a0a 2020 2020 2020 2020 2020 2020 6172  ..            ar
-00012e40: 6773 203d 205b 222d 2d73 6166 6522 2c20  gs = ["--safe", 
-00012e50: 222d 2d63 6f64 6522 2c20 636f 6465 5d0a  "--code", code].
-00012e60: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00012e70: 6c74 203d 2043 6c69 5275 6e6e 6572 2829  lt = CliRunner()
-00012e80: 2e69 6e76 6f6b 6528 626c 6163 6b2e 6d61  .invoke(black.ma
-00012e90: 696e 2c20 6172 6773 290a 0a20 2020 2020  in, args)..     
-00012ea0: 2020 2020 2020 2073 656c 662e 636f 6d70         self.comp
-00012eb0: 6172 655f 7265 7375 6c74 7328 7265 7375  are_results(resu
-00012ec0: 6c74 2c20 6572 726f 725f 6d73 672c 2031  lt, error_msg, 1
-00012ed0: 3233 290a 0a20 2020 2064 6566 2074 6573  23)..    def tes
-00012ee0: 745f 636f 6465 5f6f 7074 696f 6e5f 6661  t_code_option_fa
-00012ef0: 7374 2873 656c 6629 202d 3e20 4e6f 6e65  st(self) -> None
-00012f00: 3a0a 2020 2020 2020 2020 2222 2254 6573  :.        """Tes
-00012f10: 7420 7468 6174 2074 6865 2063 6f64 6520  t that the code 
-00012f20: 6f70 7469 6f6e 2069 676e 6f72 6573 2065  option ignores e
-00012f30: 7272 6f72 7320 7768 656e 2074 6865 2073  rrors when the s
-00012f40: 616e 6974 7920 6368 6563 6b73 2066 6169  anity checks fai
-00012f50: 6c2e 2222 220a 2020 2020 2020 2020 2320  l.""".        # 
-00012f60: 5061 7463 6820 626c 6163 6b2e 6173 7365  Patch black.asse
-00012f70: 7274 5f65 7175 6976 616c 656e 7420 746f  rt_equivalent to
-00012f80: 2065 6e73 7572 6520 7468 6520 7361 6e69   ensure the sani
-00012f90: 7479 2063 6865 636b 7320 6661 696c 0a20  ty checks fail. 
-00012fa0: 2020 2020 2020 2077 6974 6820 7061 7463         with patc
-00012fb0: 682e 6f62 6a65 6374 2862 6c61 636b 2c20  h.object(black, 
-00012fc0: 2261 7373 6572 745f 6571 7569 7661 6c65  "assert_equivale
-00012fd0: 6e74 222c 2073 6964 655f 6566 6665 6374  nt", side_effect
-00012fe0: 3d41 7373 6572 7469 6f6e 4572 726f 7229  =AssertionError)
-00012ff0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00013000: 6465 203d 2027 7072 696e 7428 2248 656c  de = 'print("Hel
-00013010: 6c6f 2077 6f72 6c64 2229 270a 2020 2020  lo world")'.    
-00013020: 2020 2020 2020 2020 666f 726d 6174 7465          formatte
-00013030: 6420 3d20 626c 6163 6b2e 666f 726d 6174  d = black.format
-00013040: 5f73 7472 2863 6f64 652c 206d 6f64 653d  _str(code, mode=
-00013050: 4445 4641 554c 545f 4d4f 4445 290a 0a20  DEFAULT_MODE).. 
-00013060: 2020 2020 2020 2020 2020 2061 7267 7320             args 
-00013070: 3d20 5b22 2d2d 6661 7374 222c 2022 2d2d  = ["--fast", "--
-00013080: 636f 6465 222c 2063 6f64 655d 0a20 2020  code", code].   
-00013090: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-000130a0: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
-000130b0: 766f 6b65 2862 6c61 636b 2e6d 6169 6e2c  voke(black.main,
-000130c0: 2061 7267 7329 0a0a 2020 2020 2020 2020   args)..        
-000130d0: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
-000130e0: 5f72 6573 756c 7473 2872 6573 756c 742c  _results(result,
-000130f0: 2066 6f72 6d61 7474 6564 2c20 3029 0a0a   formatted, 0)..
-00013100: 2020 2020 4070 7974 6573 742e 6d61 726b      @pytest.mark
-00013110: 2e69 6e63 6f6d 7061 7469 626c 655f 7769  .incompatible_wi
-00013120: 7468 5f6d 7970 7963 0a20 2020 2064 6566  th_mypyc.    def
-00013130: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
-00013140: 6e5f 636f 6e66 6967 2873 656c 6629 202d  n_config(self) -
-00013150: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00013160: 2222 220a 2020 2020 2020 2020 5465 7374  """.        Test
-00013170: 2074 6861 7420 7468 6520 636f 6465 206f   that the code o
-00013180: 7074 696f 6e20 6669 6e64 7320 7468 6520  ption finds the 
-00013190: 7079 7072 6f6a 6563 742e 746f 6d6c 2069  pyproject.toml i
-000131a0: 6e20 7468 6520 6375 7272 656e 7420 6469  n the current di
-000131b0: 7265 6374 6f72 792e 0a20 2020 2020 2020  rectory..       
-000131c0: 2022 2222 0a20 2020 2020 2020 2077 6974   """.        wit
-000131d0: 6820 7061 7463 682e 6f62 6a65 6374 2862  h patch.object(b
-000131e0: 6c61 636b 2c20 2270 6172 7365 5f70 7970  lack, "parse_pyp
-000131f0: 726f 6a65 6374 5f74 6f6d 6c22 2c20 7265  roject_toml", re
-00013200: 7475 726e 5f76 616c 7565 3d7b 7d29 2061  turn_value={}) a
-00013210: 7320 7061 7273 653a 0a20 2020 2020 2020  s parse:.       
+0000ffc0: 2020 2020 5461 7267 6574 5665 7273 696f      TargetVersio
+0000ffd0: 6e2e 5059 3331 322c 0a20 2020 2020 2020  n.PY312,.       
+0000ffe0: 2020 2020 2020 2020 2020 2020 2054 6172               Tar
+0000fff0: 6765 7456 6572 7369 6f6e 2e50 5933 3133  getVersion.PY313
+00010000: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010010: 2020 5d2c 0a20 2020 2020 2020 2020 2020    ],.           
+00010020: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+00010030: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010040: 2020 2221 3d33 2e33 2c21 3d33 2e34 222c    "!=3.3,!=3.4",
+00010050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010060: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+00010070: 2020 2020 2020 2054 6172 6765 7456 6572         TargetVer
+00010080: 7369 6f6e 2e50 5933 352c 0a20 2020 2020  sion.PY35,.     
+00010090: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+000100a0: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+000100b0: 362c 0a20 2020 2020 2020 2020 2020 2020  6,.             
+000100c0: 2020 2020 2020 2054 6172 6765 7456 6572         TargetVer
+000100d0: 7369 6f6e 2e50 5933 372c 0a20 2020 2020  sion.PY37,.     
+000100e0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+000100f0: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+00010100: 382c 0a20 2020 2020 2020 2020 2020 2020  8,.             
+00010110: 2020 2020 2020 2054 6172 6765 7456 6572         TargetVer
+00010120: 7369 6f6e 2e50 5933 392c 0a20 2020 2020  sion.PY39,.     
+00010130: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+00010140: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+00010150: 3130 2c0a 2020 2020 2020 2020 2020 2020  10,.            
+00010160: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+00010170: 7273 696f 6e2e 5059 3331 312c 0a20 2020  rsion.PY311,.   
+00010180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010190: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
+000101a0: 5933 3132 2c0a 2020 2020 2020 2020 2020  Y312,.          
+000101b0: 2020 2020 2020 2020 2020 5461 7267 6574            Target
+000101c0: 5665 7273 696f 6e2e 5059 3331 332c 0a20  Version.PY313,. 
+000101d0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+000101e0: 2c0a 2020 2020 2020 2020 2020 2020 292c  ,.            ),
+000101f0: 0a20 2020 2020 2020 2020 2020 2028 0a20  .            (. 
+00010200: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00010210: 3d3d 332e 2a22 2c0a 2020 2020 2020 2020  ==3.*",.        
+00010220: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+00010230: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
+00010240: 7267 6574 5665 7273 696f 6e2e 5059 3333  rgetVersion.PY33
+00010250: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010260: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
+00010270: 696f 6e2e 5059 3334 2c0a 2020 2020 2020  ion.PY34,.      
+00010280: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
+00010290: 7267 6574 5665 7273 696f 6e2e 5059 3335  rgetVersion.PY35
+000102a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000102b0: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
+000102c0: 696f 6e2e 5059 3336 2c0a 2020 2020 2020  ion.PY36,.      
+000102d0: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
+000102e0: 7267 6574 5665 7273 696f 6e2e 5059 3337  rgetVersion.PY37
+000102f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010300: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
+00010310: 696f 6e2e 5059 3338 2c0a 2020 2020 2020  ion.PY38,.      
+00010320: 2020 2020 2020 2020 2020 2020 2020 5461                Ta
+00010330: 7267 6574 5665 7273 696f 6e2e 5059 3339  rgetVersion.PY39
+00010340: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010350: 2020 2020 2020 5461 7267 6574 5665 7273        TargetVers
+00010360: 696f 6e2e 5059 3331 302c 0a20 2020 2020  ion.PY310,.     
+00010370: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+00010380: 6172 6765 7456 6572 7369 6f6e 2e50 5933  argetVersion.PY3
+00010390: 3131 2c0a 2020 2020 2020 2020 2020 2020  11,.            
+000103a0: 2020 2020 2020 2020 5461 7267 6574 5665          TargetVe
+000103b0: 7273 696f 6e2e 5059 3331 322c 0a20 2020  rsion.PY312,.   
+000103c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103d0: 2054 6172 6765 7456 6572 7369 6f6e 2e50   TargetVersion.P
+000103e0: 5933 3133 2c0a 2020 2020 2020 2020 2020  Y313,.          
+000103f0: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
+00010400: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+00010410: 2020 2020 2822 3d3d 332e 382e 2a22 2c20      ("==3.8.*", 
+00010420: 5b54 6172 6765 7456 6572 7369 6f6e 2e50  [TargetVersion.P
+00010430: 5933 385d 292c 0a20 2020 2020 2020 2020  Y38]),.         
+00010440: 2020 2028 4e6f 6e65 2c20 4e6f 6e65 292c     (None, None),
+00010450: 0a20 2020 2020 2020 2020 2020 2028 2222  .            (""
+00010460: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
+00010470: 2020 2020 2028 2269 6e76 616c 6964 222c       ("invalid",
+00010480: 204e 6f6e 6529 2c0a 2020 2020 2020 2020   None),.        
+00010490: 2020 2020 2822 3d3d 696e 7661 6c69 6422      ("==invalid"
+000104a0: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
+000104b0: 2020 2020 2028 223e 332e 392c 213d 696e       (">3.9,!=in
+000104c0: 7661 6c69 6422 2c20 4e6f 6e65 292c 0a20  valid", None),. 
+000104d0: 2020 2020 2020 2020 2020 2028 2233 222c             ("3",
+000104e0: 204e 6f6e 6529 2c0a 2020 2020 2020 2020   None),.        
+000104f0: 2020 2020 2822 332e 3222 2c20 4e6f 6e65      ("3.2", None
+00010500: 292c 0a20 2020 2020 2020 2020 2020 2028  ),.            (
+00010510: 2232 2e37 2e31 3822 2c20 4e6f 6e65 292c  "2.7.18", None),
+00010520: 0a20 2020 2020 2020 2020 2020 2028 223d  .            ("=
+00010530: 3d32 2e37 222c 204e 6f6e 6529 2c0a 2020  =2.7", None),.  
+00010540: 2020 2020 2020 2020 2020 2822 3e33 2e31            (">3.1
+00010550: 302c 3c33 2e31 3122 2c20 4e6f 6e65 292c  0,<3.11", None),
+00010560: 0a20 2020 2020 2020 205d 3a0a 2020 2020  .        ]:.    
+00010570: 2020 2020 2020 2020 7465 7374 5f74 6f6d          test_tom
+00010580: 6c20 3d20 7b22 7072 6f6a 6563 7422 3a20  l = {"project": 
+00010590: 7b22 7265 7175 6972 6573 2d70 7974 686f  {"requires-pytho
+000105a0: 6e22 3a20 7665 7273 696f 6e7d 7d0a 2020  n": version}}.  
+000105b0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+000105c0: 203d 2062 6c61 636b 2e66 696c 6573 2e69   = black.files.i
+000105d0: 6e66 6572 5f74 6172 6765 745f 7665 7273  nfer_target_vers
+000105e0: 696f 6e28 7465 7374 5f74 6f6d 6c29 0a20  ion(test_toml). 
+000105f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010600: 6173 7365 7274 4571 7561 6c28 7265 7375  assertEqual(resu
+00010610: 6c74 2c20 6578 7065 6374 6564 290a 0a20  lt, expected).. 
+00010620: 2020 2064 6566 2074 6573 745f 7265 6164     def test_read
+00010630: 5f70 7970 726f 6a65 6374 5f74 6f6d 6c28  _pyproject_toml(
+00010640: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00010650: 2020 2020 2020 2074 6573 745f 746f 6d6c         test_toml
+00010660: 5f66 696c 6520 3d20 5448 4953 5f44 4952  _file = THIS_DIR
+00010670: 202f 2022 7465 7374 2e74 6f6d 6c22 0a20   / "test.toml". 
+00010680: 2020 2020 2020 2066 616b 655f 6374 7820         fake_ctx 
+00010690: 3d20 4661 6b65 436f 6e74 6578 7428 290a  = FakeContext().
+000106a0: 2020 2020 2020 2020 626c 6163 6b2e 7265          black.re
+000106b0: 6164 5f70 7970 726f 6a65 6374 5f74 6f6d  ad_pyproject_tom
+000106c0: 6c28 6661 6b65 5f63 7478 2c20 4661 6b65  l(fake_ctx, Fake
+000106d0: 5061 7261 6d65 7465 7228 292c 2073 7472  Parameter(), str
+000106e0: 2874 6573 745f 746f 6d6c 5f66 696c 6529  (test_toml_file)
+000106f0: 290a 2020 2020 2020 2020 636f 6e66 6967  ).        config
+00010700: 203d 2066 616b 655f 6374 782e 6465 6661   = fake_ctx.defa
+00010710: 756c 745f 6d61 700a 2020 2020 2020 2020  ult_map.        
+00010720: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00010730: 2863 6f6e 6669 675b 2276 6572 626f 7365  (config["verbose
+00010740: 225d 2c20 2231 2229 0a20 2020 2020 2020  "], "1").       
+00010750: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00010760: 6c28 636f 6e66 6967 5b22 6368 6563 6b22  l(config["check"
+00010770: 5d2c 2022 6e6f 2229 0a20 2020 2020 2020  ], "no").       
+00010780: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00010790: 6c28 636f 6e66 6967 5b22 6469 6666 225d  l(config["diff"]
+000107a0: 2c20 2279 2229 0a20 2020 2020 2020 2073  , "y").        s
+000107b0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+000107c0: 636f 6e66 6967 5b22 636f 6c6f 7222 5d2c  config["color"],
+000107d0: 2022 5472 7565 2229 0a20 2020 2020 2020   "True").       
+000107e0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000107f0: 6c28 636f 6e66 6967 5b22 6c69 6e65 5f6c  l(config["line_l
+00010800: 656e 6774 6822 5d2c 2022 3739 2229 0a20  ength"], "79"). 
+00010810: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00010820: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
+00010830: 7461 7267 6574 5f76 6572 7369 6f6e 225d  target_version"]
+00010840: 2c20 5b22 7079 3336 222c 2022 7079 3337  , ["py36", "py37
+00010850: 222c 2022 7079 3338 225d 290a 2020 2020  ", "py38"]).    
+00010860: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00010870: 7175 616c 2863 6f6e 6669 675b 2265 7863  qual(config["exc
+00010880: 6c75 6465 225d 2c20 7222 5c2e 7079 693f  lude"], r"\.pyi?
+00010890: 2422 290a 2020 2020 2020 2020 7365 6c66  $").        self
+000108a0: 2e61 7373 6572 7445 7175 616c 2863 6f6e  .assertEqual(con
+000108b0: 6669 675b 2269 6e63 6c75 6465 225d 2c20  fig["include"], 
+000108c0: 7222 5c2e 7079 3f24 2229 0a0a 2020 2020  r"\.py?$")..    
+000108d0: 6465 6620 7465 7374 5f72 6561 645f 7079  def test_read_py
+000108e0: 7072 6f6a 6563 745f 746f 6d6c 5f66 726f  project_toml_fro
+000108f0: 6d5f 7374 6469 6e28 7365 6c66 2920 2d3e  m_stdin(self) ->
+00010900: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
+00010910: 6974 6820 5465 6d70 6f72 6172 7944 6972  ith TemporaryDir
+00010920: 6563 746f 7279 2829 2061 7320 776f 726b  ectory() as work
+00010930: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
+00010940: 2020 2072 6f6f 7420 3d20 5061 7468 2877     root = Path(w
+00010950: 6f72 6b73 7061 6365 290a 0a20 2020 2020  orkspace)..     
+00010960: 2020 2020 2020 2073 7263 5f64 6972 203d         src_dir =
+00010970: 2072 6f6f 7420 2f20 2273 7263 220a 2020   root / "src".  
+00010980: 2020 2020 2020 2020 2020 7372 635f 6469            src_di
+00010990: 722e 6d6b 6469 7228 290a 0a20 2020 2020  r.mkdir()..     
+000109a0: 2020 2020 2020 2073 7263 5f70 7970 726f         src_pypro
+000109b0: 6a65 6374 203d 2073 7263 5f64 6972 202f  ject = src_dir /
+000109c0: 2022 7079 7072 6f6a 6563 742e 746f 6d6c   "pyproject.toml
+000109d0: 220a 2020 2020 2020 2020 2020 2020 7372  ".            sr
+000109e0: 635f 7079 7072 6f6a 6563 742e 746f 7563  c_pyproject.touc
+000109f0: 6828 290a 0a20 2020 2020 2020 2020 2020  h()..           
+00010a00: 2074 6573 745f 746f 6d6c 5f63 6f6e 7465   test_toml_conte
+00010a10: 6e74 203d 2028 5448 4953 5f44 4952 202f  nt = (THIS_DIR /
+00010a20: 2022 7465 7374 2e74 6f6d 6c22 292e 7265   "test.toml").re
+00010a30: 6164 5f74 6578 7428 656e 636f 6469 6e67  ad_text(encoding
+00010a40: 3d22 7574 662d 3822 290a 2020 2020 2020  ="utf-8").      
+00010a50: 2020 2020 2020 7372 635f 7079 7072 6f6a        src_pyproj
+00010a60: 6563 742e 7772 6974 655f 7465 7874 2874  ect.write_text(t
+00010a70: 6573 745f 746f 6d6c 5f63 6f6e 7465 6e74  est_toml_content
+00010a80: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
+00010a90: 3822 290a 0a20 2020 2020 2020 2020 2020  8")..           
+00010aa0: 2073 7263 5f70 7974 686f 6e20 3d20 7372   src_python = sr
+00010ab0: 635f 6469 7220 2f20 2266 6f6f 2e70 7922  c_dir / "foo.py"
+00010ac0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+00010ad0: 5f70 7974 686f 6e2e 746f 7563 6828 290a  _python.touch().
+00010ae0: 0a20 2020 2020 2020 2020 2020 2066 616b  .            fak
+00010af0: 655f 6374 7820 3d20 4661 6b65 436f 6e74  e_ctx = FakeCont
+00010b00: 6578 7428 290a 2020 2020 2020 2020 2020  ext().          
+00010b10: 2020 6661 6b65 5f63 7478 2e70 6172 616d    fake_ctx.param
+00010b20: 735b 2273 7263 225d 203d 2028 222d 222c  s["src"] = ("-",
+00010b30: 290a 2020 2020 2020 2020 2020 2020 6661  ).            fa
+00010b40: 6b65 5f63 7478 2e70 6172 616d 735b 2273  ke_ctx.params["s
+00010b50: 7464 696e 5f66 696c 656e 616d 6522 5d20  tdin_filename"] 
+00010b60: 3d20 7374 7228 7372 635f 7079 7468 6f6e  = str(src_python
+00010b70: 290a 0a20 2020 2020 2020 2020 2020 2077  )..            w
+00010b80: 6974 6820 6368 616e 6765 5f64 6972 6563  ith change_direc
+00010b90: 746f 7279 2872 6f6f 7429 3a0a 2020 2020  tory(root):.    
+00010ba0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+00010bb0: 6b2e 7265 6164 5f70 7970 726f 6a65 6374  k.read_pyproject
+00010bc0: 5f74 6f6d 6c28 6661 6b65 5f63 7478 2c20  _toml(fake_ctx, 
+00010bd0: 4661 6b65 5061 7261 6d65 7465 7228 292c  FakeParameter(),
+00010be0: 204e 6f6e 6529 0a0a 2020 2020 2020 2020   None)..        
+00010bf0: 2020 2020 636f 6e66 6967 203d 2066 616b      config = fak
+00010c00: 655f 6374 782e 6465 6661 756c 745f 6d61  e_ctx.default_ma
+00010c10: 700a 2020 2020 2020 2020 2020 2020 7365  p.            se
+00010c20: 6c66 2e61 7373 6572 7445 7175 616c 2863  lf.assertEqual(c
+00010c30: 6f6e 6669 675b 2276 6572 626f 7365 225d  onfig["verbose"]
+00010c40: 2c20 2231 2229 0a20 2020 2020 2020 2020  , "1").         
+00010c50: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00010c60: 7561 6c28 636f 6e66 6967 5b22 6368 6563  ual(config["chec
+00010c70: 6b22 5d2c 2022 6e6f 2229 0a20 2020 2020  k"], "no").     
+00010c80: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00010c90: 7274 4571 7561 6c28 636f 6e66 6967 5b22  rtEqual(config["
+00010ca0: 6469 6666 225d 2c20 2279 2229 0a20 2020  diff"], "y").   
+00010cb0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00010cc0: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
+00010cd0: 5b22 636f 6c6f 7222 5d2c 2022 5472 7565  ["color"], "True
+00010ce0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00010cf0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00010d00: 636f 6e66 6967 5b22 6c69 6e65 5f6c 656e  config["line_len
+00010d10: 6774 6822 5d2c 2022 3739 2229 0a20 2020  gth"], "79").   
+00010d20: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00010d30: 7365 7274 4571 7561 6c28 636f 6e66 6967  sertEqual(config
+00010d40: 5b22 7461 7267 6574 5f76 6572 7369 6f6e  ["target_version
+00010d50: 225d 2c20 5b22 7079 3336 222c 2022 7079  "], ["py36", "py
+00010d60: 3337 222c 2022 7079 3338 225d 290a 2020  37", "py38"]).  
+00010d70: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00010d80: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
+00010d90: 675b 2265 7863 6c75 6465 225d 2c20 7222  g["exclude"], r"
+00010da0: 5c2e 7079 693f 2422 290a 2020 2020 2020  \.pyi?$").      
+00010db0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00010dc0: 7445 7175 616c 2863 6f6e 6669 675b 2269  tEqual(config["i
+00010dd0: 6e63 6c75 6465 225d 2c20 7222 5c2e 7079  nclude"], r"\.py
+00010de0: 3f24 2229 0a0a 2020 2020 4070 7974 6573  ?$")..    @pytes
+00010df0: 742e 6d61 726b 2e69 6e63 6f6d 7061 7469  t.mark.incompati
+00010e00: 626c 655f 7769 7468 5f6d 7970 7963 0a20  ble_with_mypyc. 
+00010e10: 2020 2064 6566 2074 6573 745f 6669 6e64     def test_find
+00010e20: 5f70 726f 6a65 6374 5f72 6f6f 7428 7365  _project_root(se
+00010e30: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00010e40: 2020 2020 2077 6974 6820 5465 6d70 6f72       with Tempor
+00010e50: 6172 7944 6972 6563 746f 7279 2829 2061  aryDirectory() a
+00010e60: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
+00010e70: 2020 2020 2020 2020 2072 6f6f 7420 3d20           root = 
+00010e80: 5061 7468 2877 6f72 6b73 7061 6365 290a  Path(workspace).
+00010e90: 2020 2020 2020 2020 2020 2020 7465 7374              test
+00010ea0: 5f64 6972 203d 2072 6f6f 7420 2f20 2274  _dir = root / "t
+00010eb0: 6573 7422 0a20 2020 2020 2020 2020 2020  est".           
+00010ec0: 2074 6573 745f 6469 722e 6d6b 6469 7228   test_dir.mkdir(
+00010ed0: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00010ee0: 7263 5f64 6972 203d 2072 6f6f 7420 2f20  rc_dir = root / 
+00010ef0: 2273 7263 220a 2020 2020 2020 2020 2020  "src".          
+00010f00: 2020 7372 635f 6469 722e 6d6b 6469 7228    src_dir.mkdir(
+00010f10: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00010f20: 6f6f 745f 7079 7072 6f6a 6563 7420 3d20  oot_pyproject = 
+00010f30: 726f 6f74 202f 2022 7079 7072 6f6a 6563  root / "pyprojec
+00010f40: 742e 746f 6d6c 220a 2020 2020 2020 2020  t.toml".        
+00010f50: 2020 2020 726f 6f74 5f70 7970 726f 6a65      root_pyproje
+00010f60: 6374 2e77 7269 7465 5f74 6578 7428 225b  ct.write_text("[
+00010f70: 746f 6f6c 2e62 6c61 636b 5d22 2c20 656e  tool.black]", en
+00010f80: 636f 6469 6e67 3d22 7574 662d 3822 290a  coding="utf-8").
+00010f90: 2020 2020 2020 2020 2020 2020 7372 635f              src_
+00010fa0: 7079 7072 6f6a 6563 7420 3d20 7372 635f  pyproject = src_
+00010fb0: 6469 7220 2f20 2270 7970 726f 6a65 6374  dir / "pyproject
+00010fc0: 2e74 6f6d 6c22 0a20 2020 2020 2020 2020  .toml".         
+00010fd0: 2020 2073 7263 5f70 7970 726f 6a65 6374     src_pyproject
+00010fe0: 2e77 7269 7465 5f74 6578 7428 225b 746f  .write_text("[to
+00010ff0: 6f6c 2e62 6c61 636b 5d22 2c20 656e 636f  ol.black]", enco
+00011000: 6469 6e67 3d22 7574 662d 3822 290a 2020  ding="utf-8").  
+00011010: 2020 2020 2020 2020 2020 7372 635f 7079            src_py
+00011020: 7468 6f6e 203d 2073 7263 5f64 6972 202f  thon = src_dir /
+00011030: 2022 666f 6f2e 7079 220a 2020 2020 2020   "foo.py".      
+00011040: 2020 2020 2020 7372 635f 7079 7468 6f6e        src_python
+00011050: 2e74 6f75 6368 2829 0a0a 2020 2020 2020  .touch()..      
+00011060: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011070: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00011080: 2020 2020 2020 2020 626c 6163 6b2e 6669          black.fi
+00011090: 6e64 5f70 726f 6a65 6374 5f72 6f6f 7428  nd_project_root(
+000110a0: 2873 7263 5f64 6972 2c20 7465 7374 5f64  (src_dir, test_d
+000110b0: 6972 2929 2c0a 2020 2020 2020 2020 2020  ir)),.          
+000110c0: 2020 2020 2020 2872 6f6f 742e 7265 736f        (root.reso
+000110d0: 6c76 6528 292c 2022 7079 7072 6f6a 6563  lve(), "pyprojec
+000110e0: 742e 746f 6d6c 2229 2c0a 2020 2020 2020  t.toml"),.      
+000110f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00011100: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00011110: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
+00011120: 2020 2020 2020 626c 6163 6b2e 6669 6e64        black.find
+00011130: 5f70 726f 6a65 6374 5f72 6f6f 7428 2873  _project_root((s
+00011140: 7263 5f64 6972 2c29 292c 0a20 2020 2020  rc_dir,)),.     
+00011150: 2020 2020 2020 2020 2020 2028 7372 635f             (src_
+00011160: 6469 722e 7265 736f 6c76 6528 292c 2022  dir.resolve(), "
+00011170: 7079 7072 6f6a 6563 742e 746f 6d6c 2229  pyproject.toml")
+00011180: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00011190: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000111a0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+000111b0: 2020 2020 2020 2020 2020 2020 2020 626c                bl
+000111c0: 6163 6b2e 6669 6e64 5f70 726f 6a65 6374  ack.find_project
+000111d0: 5f72 6f6f 7428 2873 7263 5f70 7974 686f  _root((src_pytho
+000111e0: 6e2c 2929 2c0a 2020 2020 2020 2020 2020  n,)),.          
+000111f0: 2020 2020 2020 2873 7263 5f64 6972 2e72        (src_dir.r
+00011200: 6573 6f6c 7665 2829 2c20 2270 7970 726f  esolve(), "pypro
+00011210: 6a65 6374 2e74 6f6d 6c22 292c 0a20 2020  ject.toml"),.   
+00011220: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00011230: 2020 2020 2020 2020 7769 7468 2063 6861          with cha
+00011240: 6e67 655f 6469 7265 6374 6f72 7928 7465  nge_directory(te
+00011250: 7374 5f64 6972 293a 0a20 2020 2020 2020  st_dir):.       
+00011260: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00011270: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
+00011280: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00011290: 6c61 636b 2e66 696e 645f 7072 6f6a 6563  lack.find_projec
+000112a0: 745f 726f 6f74 2828 222d 222c 292c 2073  t_root(("-",), s
+000112b0: 7464 696e 5f66 696c 656e 616d 653d 222e  tdin_filename=".
+000112c0: 2e2f 7372 632f 612e 7079 2229 2c0a 2020  ./src/a.py"),.  
+000112d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112e0: 2020 2873 7263 5f64 6972 2e72 6573 6f6c    (src_dir.resol
+000112f0: 7665 2829 2c20 2270 7970 726f 6a65 6374  ve(), "pyproject
+00011300: 2e74 6f6d 6c22 292c 0a20 2020 2020 2020  .toml"),.       
+00011310: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00011320: 2020 2020 2020 2020 7372 635f 7375 6220          src_sub 
+00011330: 3d20 7372 635f 6469 7220 2f20 2273 7562  = src_dir / "sub
+00011340: 220a 2020 2020 2020 2020 2020 2020 7372  ".            sr
+00011350: 635f 7375 622e 6d6b 6469 7228 290a 0a20  c_sub.mkdir().. 
+00011360: 2020 2020 2020 2020 2020 2073 7263 5f73             src_s
+00011370: 7562 5f70 7970 726f 6a65 6374 203d 2073  ub_pyproject = s
+00011380: 7263 5f73 7562 202f 2022 7079 7072 6f6a  rc_sub / "pyproj
+00011390: 6563 742e 746f 6d6c 220a 2020 2020 2020  ect.toml".      
+000113a0: 2020 2020 2020 7372 635f 7375 625f 7079        src_sub_py
+000113b0: 7072 6f6a 6563 742e 746f 7563 6828 2920  project.touch() 
+000113c0: 2023 2065 6d70 7479 0a0a 2020 2020 2020   # empty..      
+000113d0: 2020 2020 2020 7372 635f 7375 625f 7079        src_sub_py
+000113e0: 7468 6f6e 203d 2073 7263 5f73 7562 202f  thon = src_sub /
+000113f0: 2022 6261 722e 7079 220a 0a20 2020 2020   "bar.py"..     
+00011400: 2020 2020 2020 2023 2077 6520 736b 6970         # we skip
+00011410: 2073 7263 5f73 7562 5f70 7970 726f 6a65   src_sub_pyproje
+00011420: 6374 2073 696e 6365 2069 7420 6973 206d  ct since it is m
+00011430: 6973 7369 6e67 2074 6865 205b 746f 6f6c  issing the [tool
+00011440: 2e62 6c61 636b 5d20 7365 6374 696f 6e0a  .black] section.
+00011450: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011460: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+00011470: 2020 2020 2020 2020 2020 2020 2020 626c                bl
+00011480: 6163 6b2e 6669 6e64 5f70 726f 6a65 6374  ack.find_project
+00011490: 5f72 6f6f 7428 2873 7263 5f73 7562 5f70  _root((src_sub_p
+000114a0: 7974 686f 6e2c 2929 2c0a 2020 2020 2020  ython,)),.      
+000114b0: 2020 2020 2020 2020 2020 2873 7263 5f64            (src_d
+000114c0: 6972 2e72 6573 6f6c 7665 2829 2c20 2270  ir.resolve(), "p
+000114d0: 7970 726f 6a65 6374 2e74 6f6d 6c22 292c  yproject.toml"),
+000114e0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+000114f0: 2020 2020 4070 6174 6368 280a 2020 2020      @patch(.    
+00011500: 2020 2020 2262 6c61 636b 2e66 696c 6573      "black.files
+00011510: 2e66 696e 645f 7573 6572 5f70 7970 726f  .find_user_pypro
+00011520: 6a65 6374 5f74 6f6d 6c22 2c0a 2020 2020  ject_toml",.    
+00011530: 290a 2020 2020 6465 6620 7465 7374 5f66  ).    def test_f
+00011540: 696e 645f 7079 7072 6f6a 6563 745f 746f  ind_pyproject_to
+00011550: 6d6c 2873 656c 662c 2066 696e 645f 7573  ml(self, find_us
+00011560: 6572 5f70 7970 726f 6a65 6374 5f74 6f6d  er_pyproject_tom
+00011570: 6c3a 204d 6167 6963 4d6f 636b 2920 2d3e  l: MagicMock) ->
+00011580: 204e 6f6e 653a 0a20 2020 2020 2020 2066   None:.        f
+00011590: 696e 645f 7573 6572 5f70 7970 726f 6a65  ind_user_pyproje
+000115a0: 6374 5f74 6f6d 6c2e 7369 6465 5f65 6666  ct_toml.side_eff
+000115b0: 6563 7420 3d20 5275 6e74 696d 6545 7272  ect = RuntimeErr
+000115c0: 6f72 2829 0a0a 2020 2020 2020 2020 7769  or()..        wi
+000115d0: 7468 2072 6564 6972 6563 745f 7374 6465  th redirect_stde
+000115e0: 7272 2869 6f2e 5374 7269 6e67 494f 2829  rr(io.StringIO()
+000115f0: 2920 6173 2073 7464 6572 723a 0a20 2020  ) as stderr:.   
+00011600: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00011610: 3d20 626c 6163 6b2e 6669 6c65 732e 6669  = black.files.fi
+00011620: 6e64 5f70 7970 726f 6a65 6374 5f74 6f6d  nd_pyproject_tom
+00011630: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00011640: 2020 2070 6174 685f 7365 6172 6368 5f73     path_search_s
+00011650: 7461 7274 3d28 7374 7228 5061 7468 2e63  tart=(str(Path.c
+00011660: 7764 2829 2e72 6f6f 7429 2c29 0a20 2020  wd().root),).   
+00011670: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00011680: 2020 2020 6173 7365 7274 2072 6573 756c      assert resul
+00011690: 7420 6973 204e 6f6e 650a 2020 2020 2020  t is None.      
+000116a0: 2020 6572 7220 3d20 7374 6465 7272 2e67    err = stderr.g
+000116b0: 6574 7661 6c75 6528 290a 2020 2020 2020  etvalue().      
+000116c0: 2020 6173 7365 7274 2022 4967 6e6f 7269    assert "Ignori
+000116d0: 6e67 2075 7365 7220 636f 6e66 6967 7572  ng user configur
+000116e0: 6174 696f 6e22 2069 6e20 6572 720a 0a20  ation" in err.. 
+000116f0: 2020 2040 7061 7463 6828 0a20 2020 2020     @patch(.     
+00011700: 2020 2022 626c 6163 6b2e 6669 6c65 732e     "black.files.
+00011710: 6669 6e64 5f75 7365 725f 7079 7072 6f6a  find_user_pyproj
+00011720: 6563 745f 746f 6d6c 222c 0a20 2020 2020  ect_toml",.     
+00011730: 2020 2062 6c61 636b 2e66 696c 6573 2e66     black.files.f
+00011740: 696e 645f 7573 6572 5f70 7970 726f 6a65  ind_user_pyproje
+00011750: 6374 5f74 6f6d 6c2e 5f5f 7772 6170 7065  ct_toml.__wrappe
+00011760: 645f 5f2c 0a20 2020 2029 0a20 2020 2064  d__,.    ).    d
+00011770: 6566 2074 6573 745f 6669 6e64 5f75 7365  ef test_find_use
+00011780: 725f 7079 7072 6f6a 6563 745f 746f 6d6c  r_pyproject_toml
+00011790: 5f6c 696e 7578 2873 656c 6629 202d 3e20  _linux(self) -> 
+000117a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
+000117b0: 2073 7973 7465 6d28 2920 3d3d 2022 5769   system() == "Wi
+000117c0: 6e64 6f77 7322 3a0a 2020 2020 2020 2020  ndows":.        
+000117d0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+000117e0: 2020 2020 2320 5465 7374 2069 6620 5844      # Test if XD
+000117f0: 475f 434f 4e46 4947 5f48 4f4d 4520 6973  G_CONFIG_HOME is
+00011800: 2063 6865 636b 6564 0a20 2020 2020 2020   checked.       
+00011810: 2077 6974 6820 5465 6d70 6f72 6172 7944   with TemporaryD
+00011820: 6972 6563 746f 7279 2829 2061 7320 776f  irectory() as wo
+00011830: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
+00011840: 2020 2020 2074 6d70 5f75 7365 725f 636f       tmp_user_co
+00011850: 6e66 6967 203d 2050 6174 6828 776f 726b  nfig = Path(work
+00011860: 7370 6163 6529 202f 2022 626c 6163 6b22  space) / "black"
+00011870: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00011880: 6820 7061 7463 682e 6469 6374 2822 6f73  h patch.dict("os
+00011890: 2e65 6e76 6972 6f6e 222c 207b 2258 4447  .environ", {"XDG
+000118a0: 5f43 4f4e 4649 475f 484f 4d45 223a 2077  _CONFIG_HOME": w
+000118b0: 6f72 6b73 7061 6365 7d29 3a0a 2020 2020  orkspace}):.    
+000118c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000118d0: 2e61 7373 6572 7445 7175 616c 280a 2020  .assertEqual(.  
+000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118f0: 2020 626c 6163 6b2e 6669 6c65 732e 6669    black.files.fi
+00011900: 6e64 5f75 7365 725f 7079 7072 6f6a 6563  nd_user_pyprojec
+00011910: 745f 746f 6d6c 2829 2c20 746d 705f 7573  t_toml(), tmp_us
+00011920: 6572 5f63 6f6e 6669 672e 7265 736f 6c76  er_config.resolv
+00011930: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00011940: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+00011950: 2054 6573 7420 6661 6c6c 6261 636b 2066   Test fallback f
+00011960: 6f72 2058 4447 5f43 4f4e 4649 475f 484f  or XDG_CONFIG_HO
+00011970: 4d45 0a20 2020 2020 2020 2077 6974 6820  ME.        with 
+00011980: 7061 7463 682e 6469 6374 2822 6f73 2e65  patch.dict("os.e
+00011990: 6e76 6972 6f6e 2229 3a0a 2020 2020 2020  nviron"):.      
+000119a0: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+000119b0: 2e70 6f70 2822 5844 475f 434f 4e46 4947  .pop("XDG_CONFIG
+000119c0: 5f48 4f4d 4522 2c20 4e6f 6e65 290a 2020  _HOME", None).  
+000119d0: 2020 2020 2020 2020 2020 6661 6c6c 6261            fallba
+000119e0: 636b 5f75 7365 725f 636f 6e66 6967 203d  ck_user_config =
+000119f0: 2050 6174 6828 227e 2f2e 636f 6e66 6967   Path("~/.config
+00011a00: 2229 2e65 7870 616e 6475 7365 7228 2920  ").expanduser() 
+00011a10: 2f20 2262 6c61 636b 220a 2020 2020 2020  / "black".      
+00011a20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00011a30: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
+00011a40: 2020 2020 2020 2020 626c 6163 6b2e 6669          black.fi
+00011a50: 6c65 732e 6669 6e64 5f75 7365 725f 7079  les.find_user_py
+00011a60: 7072 6f6a 6563 745f 746f 6d6c 2829 2c20  project_toml(), 
+00011a70: 6661 6c6c 6261 636b 5f75 7365 725f 636f  fallback_user_co
+00011a80: 6e66 6967 2e72 6573 6f6c 7665 2829 0a20  nfig.resolve(). 
+00011a90: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00011aa0: 2020 6465 6620 7465 7374 5f66 696e 645f    def test_find_
+00011ab0: 7573 6572 5f70 7970 726f 6a65 6374 5f74  user_pyproject_t
+00011ac0: 6f6d 6c5f 7769 6e64 6f77 7328 7365 6c66  oml_windows(self
+00011ad0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00011ae0: 2020 2069 6620 7379 7374 656d 2829 2021     if system() !
+00011af0: 3d20 2257 696e 646f 7773 223a 0a20 2020  = "Windows":.   
+00011b00: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00011b10: 0a20 2020 2020 2020 2075 7365 725f 636f  .        user_co
+00011b20: 6e66 6967 5f70 6174 6820 3d20 5061 7468  nfig_path = Path
+00011b30: 2e68 6f6d 6528 2920 2f20 222e 626c 6163  .home() / ".blac
+00011b40: 6b22 0a20 2020 2020 2020 2073 656c 662e  k".        self.
+00011b50: 6173 7365 7274 4571 7561 6c28 0a20 2020  assertEqual(.   
+00011b60: 2020 2020 2020 2020 2062 6c61 636b 2e66           black.f
+00011b70: 696c 6573 2e66 696e 645f 7573 6572 5f70  iles.find_user_p
+00011b80: 7970 726f 6a65 6374 5f74 6f6d 6c28 292c  yproject_toml(),
+00011b90: 2075 7365 725f 636f 6e66 6967 5f70 6174   user_config_pat
+00011ba0: 682e 7265 736f 6c76 6528 290a 2020 2020  h.resolve().    
+00011bb0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
+00011bc0: 6573 745f 6270 6f5f 3333 3636 305f 776f  est_bpo_33660_wo
+00011bd0: 726b 6172 6f75 6e64 2873 656c 6629 202d  rkaround(self) -
+00011be0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00011bf0: 6966 2073 7973 7465 6d28 2920 3d3d 2022  if system() == "
+00011c00: 5769 6e64 6f77 7322 3a0a 2020 2020 2020  Windows":.      
+00011c10: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00011c20: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+00011c30: 6275 6773 2e70 7974 686f 6e2e 6f72 672f  bugs.python.org/
+00011c40: 6973 7375 6533 3336 3630 0a20 2020 2020  issue33660.     
+00011c50: 2020 2023 2043 616e 2062 6520 7265 6d6f     # Can be remo
+00011c60: 7665 6420 7768 656e 2077 6520 6472 6f70  ved when we drop
+00011c70: 2073 7570 706f 7274 2066 6f72 2050 7974   support for Pyt
+00011c80: 686f 6e20 332e 382e 350a 2020 2020 2020  hon 3.8.5.      
+00011c90: 2020 726f 6f74 203d 2050 6174 6828 222f    root = Path("/
+00011ca0: 2229 0a20 2020 2020 2020 2077 6974 6820  ").        with 
+00011cb0: 6368 616e 6765 5f64 6972 6563 746f 7279  change_directory
+00011cc0: 2872 6f6f 7429 3a0a 2020 2020 2020 2020  (root):.        
+00011cd0: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
+00011ce0: 2277 6f72 6b73 7061 6365 2229 202f 2022  "workspace") / "
+00011cf0: 7072 6f6a 6563 7422 0a20 2020 2020 2020  project".       
+00011d00: 2020 2020 2072 6570 6f72 7420 3d20 626c       report = bl
+00011d10: 6163 6b2e 5265 706f 7274 2876 6572 626f  ack.Report(verbo
+00011d20: 7365 3d54 7275 6529 0a20 2020 2020 2020  se=True).       
+00011d30: 2020 2020 2072 6573 6f6c 7665 735f 6f75       resolves_ou
+00011d40: 7473 6964 6520 3d20 626c 6163 6b2e 7265  tside = black.re
+00011d50: 736f 6c76 6573 5f6f 7574 7369 6465 5f72  solves_outside_r
+00011d60: 6f6f 745f 6f72 5f63 616e 6e6f 745f 7374  oot_or_cannot_st
+00011d70: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
+00011d80: 2020 2020 7061 7468 2c20 726f 6f74 2c20      path, root, 
+00011d90: 7265 706f 7274 0a20 2020 2020 2020 2020  report.         
+00011da0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00011db0: 2073 656c 662e 6173 7365 7274 4973 2872   self.assertIs(r
+00011dc0: 6573 6f6c 7665 735f 6f75 7473 6964 652c  esolves_outside,
+00011dd0: 2046 616c 7365 290a 0a20 2020 2064 6566   False)..    def
+00011de0: 2074 6573 745f 6e6f 726d 616c 697a 655f   test_normalize_
+00011df0: 7061 7468 5f69 676e 6f72 655f 7769 6e64  path_ignore_wind
+00011e00: 6f77 735f 6a75 6e63 7469 6f6e 735f 6f75  ows_junctions_ou
+00011e10: 7473 6964 655f 6f66 5f72 6f6f 7428 7365  tside_of_root(se
+00011e20: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00011e30: 2020 2020 2069 6620 7379 7374 656d 2829       if system()
+00011e40: 2021 3d20 2257 696e 646f 7773 223a 0a20   != "Windows":. 
+00011e50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011e60: 6e0a 0a20 2020 2020 2020 2077 6974 6820  n..        with 
+00011e70: 5465 6d70 6f72 6172 7944 6972 6563 746f  TemporaryDirecto
+00011e80: 7279 2829 2061 7320 776f 726b 7370 6163  ry() as workspac
+00011e90: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00011ea0: 6f6f 7420 3d20 5061 7468 2877 6f72 6b73  oot = Path(works
+00011eb0: 7061 6365 290a 2020 2020 2020 2020 2020  pace).          
+00011ec0: 2020 6a75 6e63 7469 6f6e 5f64 6972 203d    junction_dir =
+00011ed0: 2072 6f6f 7420 2f20 226a 756e 6374 696f   root / "junctio
+00011ee0: 6e22 0a20 2020 2020 2020 2020 2020 206a  n".            j
+00011ef0: 756e 6374 696f 6e5f 7461 7267 6574 5f6f  unction_target_o
+00011f00: 7574 7369 6465 5f6f 665f 726f 6f74 203d  utside_of_root =
+00011f10: 2072 6f6f 7420 2f20 222e 2e22 0a20 2020   root / "..".   
+00011f20: 2020 2020 2020 2020 206f 732e 7379 7374           os.syst
+00011f30: 656d 2866 226d 6b6c 696e 6b20 2f4a 207b  em(f"mklink /J {
+00011f40: 6a75 6e63 7469 6f6e 5f64 6972 7d20 7b6a  junction_dir} {j
+00011f50: 756e 6374 696f 6e5f 7461 7267 6574 5f6f  unction_target_o
+00011f60: 7574 7369 6465 5f6f 665f 726f 6f74 7d22  utside_of_root}"
+00011f70: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00011f80: 6570 6f72 7420 3d20 626c 6163 6b2e 5265  eport = black.Re
+00011f90: 706f 7274 2876 6572 626f 7365 3d54 7275  port(verbose=Tru
+00011fa0: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+00011fb0: 6573 6f6c 7665 735f 6f75 7473 6964 6520  esolves_outside 
+00011fc0: 3d20 626c 6163 6b2e 7265 736f 6c76 6573  = black.resolves
+00011fd0: 5f6f 7574 7369 6465 5f72 6f6f 745f 6f72  _outside_root_or
+00011fe0: 5f63 616e 6e6f 745f 7374 6174 280a 2020  _cannot_stat(.  
+00011ff0: 2020 2020 2020 2020 2020 2020 2020 6a75                ju
+00012000: 6e63 7469 6f6e 5f64 6972 2c20 726f 6f74  nction_dir, root
+00012010: 2c20 7265 706f 7274 0a20 2020 2020 2020  , report.       
+00012020: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00012030: 2020 2023 204d 616e 7561 6c6c 7920 6465     # Manually de
+00012040: 6c65 7465 2066 6f72 2050 7974 686f 6e20  lete for Python 
+00012050: 3c20 332e 380a 2020 2020 2020 2020 2020  < 3.8.          
+00012060: 2020 6f73 2e73 7973 7465 6d28 6622 726d    os.system(f"rm
+00012070: 6469 7220 7b6a 756e 6374 696f 6e5f 6469  dir {junction_di
+00012080: 727d 2229 0a0a 2020 2020 2020 2020 2020  r}")..          
+00012090: 2020 7365 6c66 2e61 7373 6572 7449 7328    self.assertIs(
+000120a0: 7265 736f 6c76 6573 5f6f 7574 7369 6465  resolves_outside
+000120b0: 2c20 5472 7565 290a 0a20 2020 2064 6566  , True)..    def
+000120c0: 2074 6573 745f 6e65 776c 696e 655f 636f   test_newline_co
+000120d0: 6d6d 656e 745f 696e 7465 7261 6374 696f  mment_interactio
+000120e0: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
+000120f0: 0a20 2020 2020 2020 2073 6f75 7263 6520  .        source 
+00012100: 3d20 2263 6c61 7373 2041 3a5c 5c5c 725c  = "class A:\\\r\
+00012110: 6e23 2074 7970 653a 2069 676e 6f72 655c  n# type: ignore\
+00012120: 6e20 7061 7373 5c6e 220a 2020 2020 2020  n pass\n".      
+00012130: 2020 6f75 7470 7574 203d 2062 6c61 636b    output = black
+00012140: 2e66 6f72 6d61 745f 7374 7228 736f 7572  .format_str(sour
+00012150: 6365 2c20 6d6f 6465 3d44 4546 4155 4c54  ce, mode=DEFAULT
+00012160: 5f4d 4f44 4529 0a20 2020 2020 2020 2062  _MODE).        b
+00012170: 6c61 636b 2e61 7373 6572 745f 7374 6162  lack.assert_stab
+00012180: 6c65 2873 6f75 7263 652c 206f 7574 7075  le(source, outpu
+00012190: 742c 206d 6f64 653d 4445 4641 554c 545f  t, mode=DEFAULT_
+000121a0: 4d4f 4445 290a 0a20 2020 2064 6566 2074  MODE)..    def t
+000121b0: 6573 745f 6270 6f5f 3231 3432 5f77 6f72  est_bpo_2142_wor
+000121c0: 6b61 726f 756e 6428 7365 6c66 2920 2d3e  karound(self) ->
+000121d0: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
+000121e0: 2068 7474 7073 3a2f 2f62 7567 732e 7079   https://bugs.py
+000121f0: 7468 6f6e 2e6f 7267 2f69 7373 7565 3231  thon.org/issue21
+00012200: 3432 0a0a 2020 2020 2020 2020 736f 7572  42..        sour
+00012210: 6365 2c20 5f20 3d20 7265 6164 5f64 6174  ce, _ = read_dat
+00012220: 6128 226d 6973 6365 6c6c 616e 656f 7573  a("miscellaneous
+00012230: 222c 2022 6d69 7373 696e 675f 6669 6e61  ", "missing_fina
+00012240: 6c5f 6e65 776c 696e 6522 290a 2020 2020  l_newline").    
+00012250: 2020 2020 2320 7265 6164 5f64 6174 6120      # read_data 
+00012260: 6164 6473 2061 2074 7261 696c 696e 6720  adds a trailing 
+00012270: 6e65 776c 696e 650a 2020 2020 2020 2020  newline.        
+00012280: 736f 7572 6365 203d 2073 6f75 7263 652e  source = source.
+00012290: 7273 7472 6970 2829 0a20 2020 2020 2020  rstrip().       
+000122a0: 2065 7870 6563 7465 642c 205f 203d 2072   expected, _ = r
+000122b0: 6561 645f 6461 7461 2822 6d69 7363 656c  ead_data("miscel
+000122c0: 6c61 6e65 6f75 7322 2c20 226d 6973 7369  laneous", "missi
+000122d0: 6e67 5f66 696e 616c 5f6e 6577 6c69 6e65  ng_final_newline
+000122e0: 2e64 6966 6622 290a 2020 2020 2020 2020  .diff").        
+000122f0: 746d 705f 6669 6c65 203d 2050 6174 6828  tmp_file = Path(
+00012300: 626c 6163 6b2e 6475 6d70 5f74 6f5f 6669  black.dump_to_fi
+00012310: 6c65 2873 6f75 7263 652c 2065 6e73 7572  le(source, ensur
+00012320: 655f 6669 6e61 6c5f 6e65 776c 696e 653d  e_final_newline=
+00012330: 4661 6c73 6529 290a 2020 2020 2020 2020  False)).        
+00012340: 6469 6666 5f68 6561 6465 7220 3d20 7265  diff_header = re
+00012350: 2e63 6f6d 7069 6c65 280a 2020 2020 2020  .compile(.      
+00012360: 2020 2020 2020 7266 227b 7265 2e65 7363        rf"{re.esc
+00012370: 6170 6528 7374 7228 746d 705f 6669 6c65  ape(str(tmp_file
+00012380: 2929 7d5c 745c 645c 645c 645c 642d 5c64  ))}\t\d\d\d\d-\d
+00012390: 5c64 2d5c 645c 6420 220a 2020 2020 2020  \d-\d\d ".      
+000123a0: 2020 2020 2020 7222 5c64 5c64 3a5c 645c        r"\d\d:\d\
+000123b0: 643a 5c64 5c64 5c2e 5c64 5c64 5c64 5c64  d:\d\d\.\d\d\d\d
+000123c0: 5c64 5c64 5c2b 5c64 5c64 3a5c 645c 6422  \d\d\+\d\d:\d\d"
+000123d0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+000123e0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+000123f0: 2020 2020 7265 7375 6c74 203d 2042 6c61      result = Bla
+00012400: 636b 5275 6e6e 6572 2829 2e69 6e76 6f6b  ckRunner().invok
+00012410: 6528 626c 6163 6b2e 6d61 696e 2c20 5b22  e(black.main, ["
+00012420: 2d2d 6469 6666 222c 2073 7472 2874 6d70  --diff", str(tmp
+00012430: 5f66 696c 6529 5d29 0a20 2020 2020 2020  _file)]).       
+00012440: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00012450: 4571 7561 6c28 7265 7375 6c74 2e65 7869  Equal(result.exi
+00012460: 745f 636f 6465 2c20 3029 0a20 2020 2020  t_code, 0).     
+00012470: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
+00012480: 2020 2020 2020 2020 6f73 2e75 6e6c 696e          os.unlin
+00012490: 6b28 746d 705f 6669 6c65 290a 2020 2020  k(tmp_file).    
+000124a0: 2020 2020 6163 7475 616c 203d 2072 6573      actual = res
+000124b0: 756c 742e 6f75 7470 7574 0a20 2020 2020  ult.output.     
+000124c0: 2020 2061 6374 7561 6c20 3d20 6469 6666     actual = diff
+000124d0: 5f68 6561 6465 722e 7375 6228 4445 5445  _header.sub(DETE
+000124e0: 524d 494e 4953 5449 435f 4845 4144 4552  RMINISTIC_HEADER
+000124f0: 2c20 6163 7475 616c 290a 2020 2020 2020  , actual).      
+00012500: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00012510: 616c 2861 6374 7561 6c2c 2065 7870 6563  al(actual, expec
+00012520: 7465 6429 0a0a 2020 2020 4073 7461 7469  ted)..    @stati
+00012530: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+00012540: 636f 6d70 6172 655f 7265 7375 6c74 7328  compare_results(
+00012550: 0a20 2020 2020 2020 2072 6573 756c 743a  .        result:
+00012560: 2063 6c69 636b 2e74 6573 7469 6e67 2e52   click.testing.R
+00012570: 6573 756c 742c 2065 7870 6563 7465 645f  esult, expected_
+00012580: 7661 6c75 653a 2073 7472 2c20 6578 7065  value: str, expe
+00012590: 6374 6564 5f65 7869 745f 636f 6465 3a20  cted_exit_code: 
+000125a0: 696e 740a 2020 2020 2920 2d3e 204e 6f6e  int.    ) -> Non
+000125b0: 653a 0a20 2020 2020 2020 2022 2222 4865  e:.        """He
+000125c0: 6c70 6572 206d 6574 686f 6420 746f 2074  lper method to t
+000125d0: 6573 7420 7468 6520 7661 6c75 6520 616e  est the value an
+000125e0: 6420 6578 6974 2063 6f64 6520 6f66 2061  d exit code of a
+000125f0: 2063 6c69 636b 2052 6573 756c 742e 2222   click Result.""
+00012600: 220a 2020 2020 2020 2020 6173 7365 7274  ".        assert
+00012610: 2028 0a20 2020 2020 2020 2020 2020 2072   (.            r
+00012620: 6573 756c 742e 6f75 7470 7574 203d 3d20  esult.output == 
+00012630: 6578 7065 6374 6564 5f76 616c 7565 0a20  expected_value. 
+00012640: 2020 2020 2020 2029 2c20 2254 6865 206f         ), "The o
+00012650: 7574 7075 7420 6469 6420 6e6f 7420 6d61  utput did not ma
+00012660: 7463 6820 7468 6520 6578 7065 6374 6564  tch the expected
+00012670: 2076 616c 7565 2e22 0a20 2020 2020 2020   value.".       
+00012680: 2061 7373 6572 7420 7265 7375 6c74 2e65   assert result.e
+00012690: 7869 745f 636f 6465 203d 3d20 6578 7065  xit_code == expe
+000126a0: 6374 6564 5f65 7869 745f 636f 6465 2c20  cted_exit_code, 
+000126b0: 2254 6865 2065 7869 7420 636f 6465 2069  "The exit code i
+000126c0: 7320 696e 636f 7272 6563 742e 220a 0a20  s incorrect.".. 
+000126d0: 2020 2064 6566 2074 6573 745f 636f 6465     def test_code
+000126e0: 5f6f 7074 696f 6e28 7365 6c66 2920 2d3e  _option(self) ->
+000126f0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00012700: 2222 5465 7374 2074 6865 2063 6f64 6520  ""Test the code 
+00012710: 6f70 7469 6f6e 2077 6974 6820 6e6f 2063  option with no c
+00012720: 6861 6e67 6573 2e22 2222 0a20 2020 2020  hanges.""".     
+00012730: 2020 2063 6f64 6520 3d20 2770 7269 6e74     code = 'print
+00012740: 2822 4865 6c6c 6f20 776f 726c 6422 295c  ("Hello world")\
+00012750: 6e27 0a20 2020 2020 2020 2061 7267 7320  n'.        args 
+00012760: 3d20 5b22 2d2d 636f 6465 222c 2063 6f64  = ["--code", cod
+00012770: 655d 0a20 2020 2020 2020 2072 6573 756c  e].        resul
+00012780: 7420 3d20 436c 6952 756e 6e65 7228 292e  t = CliRunner().
+00012790: 696e 766f 6b65 2862 6c61 636b 2e6d 6169  invoke(black.mai
+000127a0: 6e2c 2061 7267 7329 0a0a 2020 2020 2020  n, args)..      
+000127b0: 2020 7365 6c66 2e63 6f6d 7061 7265 5f72    self.compare_r
+000127c0: 6573 756c 7473 2872 6573 756c 742c 2063  esults(result, c
+000127d0: 6f64 652c 2030 290a 0a20 2020 2064 6566  ode, 0)..    def
+000127e0: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
+000127f0: 6e5f 6368 616e 6765 6428 7365 6c66 2920  n_changed(self) 
+00012800: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00012810: 2022 2222 5465 7374 2074 6865 2063 6f64   """Test the cod
+00012820: 6520 6f70 7469 6f6e 2077 6865 6e20 6368  e option when ch
+00012830: 616e 6765 7320 6172 6520 7265 7175 6972  anges are requir
+00012840: 6564 2e22 2222 0a20 2020 2020 2020 2063  ed.""".        c
+00012850: 6f64 6520 3d20 2270 7269 6e74 2827 6865  ode = "print('he
+00012860: 6c6c 6f20 776f 726c 6427 2922 0a20 2020  llo world')".   
+00012870: 2020 2020 2066 6f72 6d61 7474 6564 203d       formatted =
+00012880: 2062 6c61 636b 2e66 6f72 6d61 745f 7374   black.format_st
+00012890: 7228 636f 6465 2c20 6d6f 6465 3d44 4546  r(code, mode=DEF
+000128a0: 4155 4c54 5f4d 4f44 4529 0a0a 2020 2020  AULT_MODE)..    
+000128b0: 2020 2020 6172 6773 203d 205b 222d 2d63      args = ["--c
+000128c0: 6f64 6522 2c20 636f 6465 5d0a 2020 2020  ode", code].    
+000128d0: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
+000128e0: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
+000128f0: 626c 6163 6b2e 6d61 696e 2c20 6172 6773  black.main, args
+00012900: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00012910: 636f 6d70 6172 655f 7265 7375 6c74 7328  compare_results(
+00012920: 7265 7375 6c74 2c20 666f 726d 6174 7465  result, formatte
+00012930: 642c 2030 290a 0a20 2020 2064 6566 2074  d, 0)..    def t
+00012940: 6573 745f 636f 6465 5f6f 7074 696f 6e5f  est_code_option_
+00012950: 6368 6563 6b28 7365 6c66 2920 2d3e 204e  check(self) -> N
+00012960: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00012970: 5465 7374 2074 6865 2063 6f64 6520 6f70  Test the code op
+00012980: 7469 6f6e 2077 6865 6e20 6368 6563 6b20  tion when check 
+00012990: 6973 2070 6173 7365 642e 2222 220a 2020  is passed.""".  
+000129a0: 2020 2020 2020 6172 6773 203d 205b 222d        args = ["-
+000129b0: 2d63 6865 636b 222c 2022 2d2d 636f 6465  -check", "--code
+000129c0: 222c 2027 7072 696e 7428 2248 656c 6c6f  ", 'print("Hello
+000129d0: 2077 6f72 6c64 2229 5c6e 275d 0a20 2020   world")\n'].   
+000129e0: 2020 2020 2072 6573 756c 7420 3d20 436c       result = Cl
+000129f0: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
+00012a00: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
+00012a10: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+00012a20: 636f 6d70 6172 655f 7265 7375 6c74 7328  compare_results(
+00012a30: 7265 7375 6c74 2c20 2222 2c20 3029 0a0a  result, "", 0)..
+00012a40: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
+00012a50: 655f 6f70 7469 6f6e 5f63 6865 636b 5f63  e_option_check_c
+00012a60: 6861 6e67 6564 2873 656c 6629 202d 3e20  hanged(self) -> 
+00012a70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00012a80: 2254 6573 7420 7468 6520 636f 6465 206f  "Test the code o
+00012a90: 7074 696f 6e20 7768 656e 2063 6861 6e67  ption when chang
+00012aa0: 6573 2061 7265 2072 6571 7569 7265 642c  es are required,
+00012ab0: 2061 6e64 2063 6865 636b 2069 7320 7061   and check is pa
+00012ac0: 7373 6564 2e22 2222 0a20 2020 2020 2020  ssed.""".       
+00012ad0: 2061 7267 7320 3d20 5b22 2d2d 6368 6563   args = ["--chec
+00012ae0: 6b22 2c20 222d 2d63 6f64 6522 2c20 2270  k", "--code", "p
+00012af0: 7269 6e74 2827 6865 6c6c 6f20 776f 726c  rint('hello worl
+00012b00: 6427 2922 5d0a 2020 2020 2020 2020 7265  d')"].        re
+00012b10: 7375 6c74 203d 2043 6c69 5275 6e6e 6572  sult = CliRunner
+00012b20: 2829 2e69 6e76 6f6b 6528 626c 6163 6b2e  ().invoke(black.
+00012b30: 6d61 696e 2c20 6172 6773 290a 2020 2020  main, args).    
+00012b40: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
+00012b50: 5f72 6573 756c 7473 2872 6573 756c 742c  _results(result,
+00012b60: 2022 222c 2031 290a 0a20 2020 2064 6566   "", 1)..    def
+00012b70: 2074 6573 745f 636f 6465 5f6f 7074 696f   test_code_optio
+00012b80: 6e5f 6469 6666 2873 656c 6629 202d 3e20  n_diff(self) -> 
+00012b90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00012ba0: 2254 6573 7420 7468 6520 636f 6465 206f  "Test the code o
+00012bb0: 7074 696f 6e20 7768 656e 2064 6966 6620  ption when diff 
+00012bc0: 6973 2070 6173 7365 642e 2222 220a 2020  is passed.""".  
+00012bd0: 2020 2020 2020 636f 6465 203d 2022 7072        code = "pr
+00012be0: 696e 7428 2768 656c 6c6f 2077 6f72 6c64  int('hello world
+00012bf0: 2729 220a 2020 2020 2020 2020 666f 726d  ')".        form
+00012c00: 6174 7465 6420 3d20 626c 6163 6b2e 666f  atted = black.fo
+00012c10: 726d 6174 5f73 7472 2863 6f64 652c 206d  rmat_str(code, m
+00012c20: 6f64 653d 4445 4641 554c 545f 4d4f 4445  ode=DEFAULT_MODE
+00012c30: 290a 2020 2020 2020 2020 7265 7375 6c74  ).        result
+00012c40: 5f64 6966 6620 3d20 6469 6666 2863 6f64  _diff = diff(cod
+00012c50: 652c 2066 6f72 6d61 7474 6564 2c20 2253  e, formatted, "S
+00012c60: 5444 494e 222c 2022 5354 444f 5554 2229  TDIN", "STDOUT")
+00012c70: 0a0a 2020 2020 2020 2020 6172 6773 203d  ..        args =
+00012c80: 205b 222d 2d64 6966 6622 2c20 222d 2d63   ["--diff", "--c
+00012c90: 6f64 6522 2c20 636f 6465 5d0a 2020 2020  ode", code].    
+00012ca0: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
+00012cb0: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
+00012cc0: 626c 6163 6b2e 6d61 696e 2c20 6172 6773  black.main, args
+00012cd0: 290a 0a20 2020 2020 2020 2023 2052 656d  )..        # Rem
+00012ce0: 6f76 6520 7469 6d65 2066 726f 6d20 6469  ove time from di
+00012cf0: 6666 0a20 2020 2020 2020 206f 7574 7075  ff.        outpu
+00012d00: 7420 3d20 4449 4646 5f54 494d 452e 7375  t = DIFF_TIME.su
+00012d10: 6228 2222 2c20 7265 7375 6c74 2e6f 7574  b("", result.out
+00012d20: 7075 7429 0a0a 2020 2020 2020 2020 6173  put)..        as
+00012d30: 7365 7274 206f 7574 7075 7420 3d3d 2072  sert output == r
+00012d40: 6573 756c 745f 6469 6666 2c20 2254 6865  esult_diff, "The
+00012d50: 206f 7574 7075 7420 6469 6420 6e6f 7420   output did not 
+00012d60: 6d61 7463 6820 7468 6520 6578 7065 6374  match the expect
+00012d70: 6564 2076 616c 7565 2e22 0a20 2020 2020  ed value.".     
+00012d80: 2020 2061 7373 6572 7420 7265 7375 6c74     assert result
+00012d90: 2e65 7869 745f 636f 6465 203d 3d20 302c  .exit_code == 0,
+00012da0: 2022 5468 6520 6578 6974 2063 6f64 6520   "The exit code 
+00012db0: 6973 2069 6e63 6f72 7265 6374 2e22 0a0a  is incorrect."..
+00012dc0: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
+00012dd0: 655f 6f70 7469 6f6e 5f63 6f6c 6f72 5f64  e_option_color_d
+00012de0: 6966 6628 7365 6c66 2920 2d3e 204e 6f6e  iff(self) -> Non
+00012df0: 653a 0a20 2020 2020 2020 2022 2222 5465  e:.        """Te
+00012e00: 7374 2074 6865 2063 6f64 6520 6f70 7469  st the code opti
+00012e10: 6f6e 2077 6865 6e20 636f 6c6f 7220 616e  on when color an
+00012e20: 6420 6469 6666 2061 7265 2070 6173 7365  d diff are passe
+00012e30: 642e 2222 220a 2020 2020 2020 2020 636f  d.""".        co
+00012e40: 6465 203d 2022 7072 696e 7428 2768 656c  de = "print('hel
+00012e50: 6c6f 2077 6f72 6c64 2729 220a 2020 2020  lo world')".    
+00012e60: 2020 2020 666f 726d 6174 7465 6420 3d20      formatted = 
+00012e70: 626c 6163 6b2e 666f 726d 6174 5f73 7472  black.format_str
+00012e80: 2863 6f64 652c 206d 6f64 653d 4445 4641  (code, mode=DEFA
+00012e90: 554c 545f 4d4f 4445 290a 0a20 2020 2020  ULT_MODE)..     
+00012ea0: 2020 2072 6573 756c 745f 6469 6666 203d     result_diff =
+00012eb0: 2064 6966 6628 636f 6465 2c20 666f 726d   diff(code, form
+00012ec0: 6174 7465 642c 2022 5354 4449 4e22 2c20  atted, "STDIN", 
+00012ed0: 2253 5444 4f55 5422 290a 2020 2020 2020  "STDOUT").      
+00012ee0: 2020 7265 7375 6c74 5f64 6966 6620 3d20    result_diff = 
+00012ef0: 636f 6c6f 725f 6469 6666 2872 6573 756c  color_diff(resul
+00012f00: 745f 6469 6666 290a 0a20 2020 2020 2020  t_diff)..       
+00012f10: 2061 7267 7320 3d20 5b22 2d2d 6469 6666   args = ["--diff
+00012f20: 222c 2022 2d2d 636f 6c6f 7222 2c20 222d  ", "--color", "-
+00012f30: 2d63 6f64 6522 2c20 636f 6465 5d0a 2020  -code", code].  
+00012f40: 2020 2020 2020 7265 7375 6c74 203d 2043        result = C
+00012f50: 6c69 5275 6e6e 6572 2829 2e69 6e76 6f6b  liRunner().invok
+00012f60: 6528 626c 6163 6b2e 6d61 696e 2c20 6172  e(black.main, ar
+00012f70: 6773 290a 0a20 2020 2020 2020 2023 2052  gs)..        # R
+00012f80: 656d 6f76 6520 7469 6d65 2066 726f 6d20  emove time from 
+00012f90: 6469 6666 0a20 2020 2020 2020 206f 7574  diff.        out
+00012fa0: 7075 7420 3d20 4449 4646 5f54 494d 452e  put = DIFF_TIME.
+00012fb0: 7375 6228 2222 2c20 7265 7375 6c74 2e6f  sub("", result.o
+00012fc0: 7574 7075 7429 0a0a 2020 2020 2020 2020  utput)..        
+00012fd0: 6173 7365 7274 206f 7574 7075 7420 3d3d  assert output ==
+00012fe0: 2072 6573 756c 745f 6469 6666 2c20 2254   result_diff, "T
+00012ff0: 6865 206f 7574 7075 7420 6469 6420 6e6f  he output did no
+00013000: 7420 6d61 7463 6820 7468 6520 6578 7065  t match the expe
+00013010: 6374 6564 2076 616c 7565 2e22 0a20 2020  cted value.".   
+00013020: 2020 2020 2061 7373 6572 7420 7265 7375       assert resu
+00013030: 6c74 2e65 7869 745f 636f 6465 203d 3d20  lt.exit_code == 
+00013040: 302c 2022 5468 6520 6578 6974 2063 6f64  0, "The exit cod
+00013050: 6520 6973 2069 6e63 6f72 7265 6374 2e22  e is incorrect."
+00013060: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
+00013070: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
+00013080: 7769 7468 5f6d 7970 7963 0a20 2020 2064  with_mypyc.    d
+00013090: 6566 2074 6573 745f 636f 6465 5f6f 7074  ef test_code_opt
+000130a0: 696f 6e5f 7361 6665 2873 656c 6629 202d  ion_safe(self) -
+000130b0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000130c0: 2222 2254 6573 7420 7468 6174 2074 6865  """Test that the
+000130d0: 2063 6f64 6520 6f70 7469 6f6e 2074 6872   code option thr
+000130e0: 6f77 7320 616e 2065 7272 6f72 2077 6865  ows an error whe
+000130f0: 6e20 7468 6520 7361 6e69 7479 2063 6865  n the sanity che
+00013100: 636b 7320 6661 696c 2e22 2222 0a20 2020  cks fail.""".   
+00013110: 2020 2020 2023 2050 6174 6368 2062 6c61       # Patch bla
+00013120: 636b 2e61 7373 6572 745f 6571 7569 7661  ck.assert_equiva
+00013130: 6c65 6e74 2074 6f20 656e 7375 7265 2074  lent to ensure t
+00013140: 6865 2073 616e 6974 7920 6368 6563 6b73  he sanity checks
+00013150: 2066 6169 6c0a 2020 2020 2020 2020 7769   fail.        wi
+00013160: 7468 2070 6174 6368 2e6f 626a 6563 7428  th patch.object(
+00013170: 626c 6163 6b2c 2022 6173 7365 7274 5f65  black, "assert_e
+00013180: 7175 6976 616c 656e 7422 2c20 7369 6465  quivalent", side
+00013190: 5f65 6666 6563 743d 4173 7365 7274 696f  _effect=Assertio
+000131a0: 6e45 7272 6f72 293a 0a20 2020 2020 2020  nError):.       
+000131b0: 2020 2020 2063 6f64 6520 3d20 2770 7269       code = 'pri
+000131c0: 6e74 2822 4865 6c6c 6f20 776f 726c 6422  nt("Hello world"
+000131d0: 2927 0a20 2020 2020 2020 2020 2020 2065  )'.            e
+000131e0: 7272 6f72 5f6d 7367 203d 2066 227b 636f  rror_msg = f"{co
+000131f0: 6465 7d5c 6e65 7272 6f72 3a20 6361 6e6e  de}\nerror: cann
+00013200: 6f74 2066 6f72 6d61 7420 3c73 7472 696e  ot format <strin
+00013210: 673e 3a20 5c6e 220a 0a20 2020 2020 2020  g>: \n"..       
 00013220: 2020 2020 2061 7267 7320 3d20 5b22 2d2d       args = ["--
-00013230: 636f 6465 222c 2022 7072 696e 7422 5d0a  code", "print"].
-00013240: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-00013250: 6973 2069 7320 7468 6520 6f6e 6c79 2064  is is the only d
-00013260: 6972 6563 746f 7279 206b 6e6f 776e 2074  irectory known t
-00013270: 6f20 636f 6e74 6169 6e20 6120 7079 7072  o contain a pypr
-00013280: 6f6a 6563 742e 746f 6d6c 0a20 2020 2020  oject.toml.     
-00013290: 2020 2020 2020 2077 6974 6820 6368 616e         with chan
-000132a0: 6765 5f64 6972 6563 746f 7279 2850 524f  ge_directory(PRO
-000132b0: 4a45 4354 5f52 4f4f 5429 3a0a 2020 2020  JECT_ROOT):.    
-000132c0: 2020 2020 2020 2020 2020 2020 436c 6952              CliR
-000132d0: 756e 6e65 7228 292e 696e 766f 6b65 2862  unner().invoke(b
-000132e0: 6c61 636b 2e6d 6169 6e2c 2061 7267 7329  lack.main, args)
-000132f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013300: 2070 7970 726f 6a65 6374 5f70 6174 6820   pyproject_path 
-00013310: 3d20 5061 7468 2850 6174 682e 6377 6428  = Path(Path.cwd(
-00013320: 292c 2022 7079 7072 6f6a 6563 742e 746f  ), "pyproject.to
-00013330: 6d6c 2229 2e72 6573 6f6c 7665 2829 0a0a  ml").resolve()..
-00013340: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00013350: 7274 2028 0a20 2020 2020 2020 2020 2020  rt (.           
-00013360: 2020 2020 206c 656e 2870 6172 7365 2e6d       len(parse.m
-00013370: 6f63 6b5f 6361 6c6c 7329 203e 3d20 310a  ock_calls) >= 1.
-00013380: 2020 2020 2020 2020 2020 2020 292c 2022              ), "
-00013390: 4578 7065 6374 6564 2063 6f6e 6669 6720  Expected config 
-000133a0: 7061 7273 6520 746f 2062 6520 6361 6c6c  parse to be call
-000133b0: 6564 2077 6974 6820 7468 6520 6375 7272  ed with the curr
-000133c0: 656e 7420 6469 7265 6374 6f72 792e 220a  ent directory.".
-000133d0: 0a20 2020 2020 2020 2020 2020 205f 2c20  .            _, 
-000133e0: 6361 6c6c 5f61 7267 732c 205f 203d 2070  call_args, _ = p
-000133f0: 6172 7365 2e6d 6f63 6b5f 6361 6c6c 735b  arse.mock_calls[
-00013400: 305d 0a20 2020 2020 2020 2020 2020 2061  0].            a
-00013410: 7373 6572 7420 280a 2020 2020 2020 2020  ssert (.        
-00013420: 2020 2020 2020 2020 6361 6c6c 5f61 7267          call_arg
-00013430: 735b 305d 2e6c 6f77 6572 2829 203d 3d20  s[0].lower() == 
-00013440: 7374 7228 7079 7072 6f6a 6563 745f 7061  str(pyproject_pa
-00013450: 7468 292e 6c6f 7765 7228 290a 2020 2020  th).lower().    
-00013460: 2020 2020 2020 2020 292c 2022 496e 636f          ), "Inco
-00013470: 7272 6563 7420 636f 6e66 6967 206c 6f61  rrect config loa
-00013480: 6465 642e 220a 0a20 2020 2040 7079 7465  ded."..    @pyte
-00013490: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
-000134a0: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
-000134b0: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
-000134c0: 655f 6f70 7469 6f6e 5f70 6172 656e 745f  e_option_parent_
-000134d0: 636f 6e66 6967 2873 656c 6629 202d 3e20  config(self) -> 
-000134e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-000134f0: 220a 2020 2020 2020 2020 5465 7374 2074  ".        Test t
-00013500: 6861 7420 7468 6520 636f 6465 206f 7074  hat the code opt
-00013510: 696f 6e20 6669 6e64 7320 7468 6520 7079  ion finds the py
-00013520: 7072 6f6a 6563 742e 746f 6d6c 2069 6e20  project.toml in 
-00013530: 7468 6520 7061 7265 6e74 2064 6972 6563  the parent direc
-00013540: 746f 7279 2e0a 2020 2020 2020 2020 2222  tory..        ""
-00013550: 220a 2020 2020 2020 2020 7769 7468 2070  ".        with p
-00013560: 6174 6368 2e6f 626a 6563 7428 626c 6163  atch.object(blac
-00013570: 6b2c 2022 7061 7273 655f 7079 7072 6f6a  k, "parse_pyproj
-00013580: 6563 745f 746f 6d6c 222c 2072 6574 7572  ect_toml", retur
-00013590: 6e5f 7661 6c75 653d 7b7d 2920 6173 2070  n_value={}) as p
-000135a0: 6172 7365 3a0a 2020 2020 2020 2020 2020  arse:.          
-000135b0: 2020 7769 7468 2063 6861 6e67 655f 6469    with change_di
-000135c0: 7265 6374 6f72 7928 5448 4953 5f44 4952  rectory(THIS_DIR
-000135d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000135e0: 2020 2061 7267 7320 3d20 5b22 2d2d 636f     args = ["--co
-000135f0: 6465 222c 2022 7072 696e 7422 5d0a 2020  de", "print"].  
-00013600: 2020 2020 2020 2020 2020 2020 2020 436c                Cl
-00013610: 6952 756e 6e65 7228 292e 696e 766f 6b65  iRunner().invoke
-00013620: 2862 6c61 636b 2e6d 6169 6e2c 2061 7267  (black.main, arg
-00013630: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-00013640: 2020 2020 7079 7072 6f6a 6563 745f 7061      pyproject_pa
-00013650: 7468 203d 2050 6174 6828 5061 7468 2829  th = Path(Path()
-00013660: 2e63 7764 2829 2e70 6172 656e 742c 2022  .cwd().parent, "
-00013670: 7079 7072 6f6a 6563 742e 746f 6d6c 2229  pyproject.toml")
-00013680: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-00013690: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-000136a0: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
-000136b0: 2020 2020 2020 2020 6c65 6e28 7061 7273          len(pars
-000136c0: 652e 6d6f 636b 5f63 616c 6c73 2920 3e3d  e.mock_calls) >=
-000136d0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-000136e0: 2020 2029 2c20 2245 7870 6563 7465 6420     ), "Expected 
-000136f0: 636f 6e66 6967 2070 6172 7365 2074 6f20  config parse to 
-00013700: 6265 2063 616c 6c65 6420 7769 7468 2074  be called with t
-00013710: 6865 2063 7572 7265 6e74 2064 6972 6563  he current direc
-00013720: 746f 7279 2e22 0a0a 2020 2020 2020 2020  tory."..        
-00013730: 2020 2020 2020 2020 5f2c 2063 616c 6c5f          _, call_
-00013740: 6172 6773 2c20 5f20 3d20 7061 7273 652e  args, _ = parse.
-00013750: 6d6f 636b 5f63 616c 6c73 5b30 5d0a 2020  mock_calls[0].  
-00013760: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00013770: 7365 7274 2028 0a20 2020 2020 2020 2020  sert (.         
-00013780: 2020 2020 2020 2020 2020 2063 616c 6c5f             call_
-00013790: 6172 6773 5b30 5d2e 6c6f 7765 7228 2920  args[0].lower() 
-000137a0: 3d3d 2073 7472 2870 7970 726f 6a65 6374  == str(pyproject
-000137b0: 5f70 6174 6829 2e6c 6f77 6572 2829 0a20  _path).lower(). 
-000137c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000137d0: 2c20 2249 6e63 6f72 7265 6374 2063 6f6e  , "Incorrect con
-000137e0: 6669 6720 6c6f 6164 6564 2e22 0a0a 2020  fig loaded."..  
-000137f0: 2020 6465 6620 7465 7374 5f66 6f72 5f68    def test_for_h
-00013800: 616e 646c 6564 5f75 6e65 7870 6563 7465  andled_unexpecte
-00013810: 645f 656f 665f 6572 726f 7228 7365 6c66  d_eof_error(self
-00013820: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00013830: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
-00013840: 6573 7420 7468 6174 2061 6e20 756e 6578  est that an unex
-00013850: 7065 6374 6564 2045 4f46 2053 796e 7461  pected EOF Synta
-00013860: 7845 7272 6f72 2069 7320 6e69 6365 6c79  xError is nicely
-00013870: 2070 7265 7365 6e74 6564 2e0a 2020 2020   presented..    
-00013880: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00013890: 7769 7468 2070 7974 6573 742e 7261 6973  with pytest.rais
-000138a0: 6573 2862 6c61 636b 2e70 6172 7369 6e67  es(black.parsing
-000138b0: 2e49 6e76 616c 6964 496e 7075 7429 2061  .InvalidInput) a
-000138c0: 7320 6578 635f 696e 666f 3a0a 2020 2020  s exc_info:.    
-000138d0: 2020 2020 2020 2020 626c 6163 6b2e 6c69          black.li
-000138e0: 6232 746f 335f 7061 7273 6528 2270 7269  b2to3_parse("pri
-000138f0: 6e74 2822 2c20 7b7d 290a 0a20 2020 2020  nt(", {})..     
-00013900: 2020 2065 7863 5f69 6e66 6f2e 6d61 7463     exc_info.matc
-00013910: 6828 2243 616e 6e6f 7420 7061 7273 653a  h("Cannot parse:
-00013920: 2032 3a30 3a20 454f 4620 696e 206d 756c   2:0: EOF in mul
-00013930: 7469 2d6c 696e 6520 7374 6174 656d 656e  ti-line statemen
-00013940: 7422 290a 0a20 2020 2064 6566 2074 6573  t")..    def tes
-00013950: 745f 6c69 6e65 5f72 616e 6765 735f 7769  t_line_ranges_wi
-00013960: 7468 5f63 6f64 655f 6f70 7469 6f6e 2873  th_code_option(s
-00013970: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00013980: 2020 2020 2020 636f 6465 203d 2074 6578        code = tex
-00013990: 7477 7261 702e 6465 6465 6e74 2822 2222  twrap.dedent("""
-000139a0: 5c0a 2020 2020 2020 2020 2020 2020 6966  \.            if
-000139b0: 2020 6120 203d 3d20 2062 3a0a 2020 2020    a  ==  b:.    
-000139c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000139d0: 7420 2028 2022 4f4b 2220 290a 2020 2020  t  ( "OK" ).    
-000139e0: 2020 2020 2020 2020 2222 2229 0a20 2020          """).   
-000139f0: 2020 2020 2061 7267 7320 3d20 5b22 2d2d       args = ["--
-00013a00: 6c69 6e65 2d72 616e 6765 733d 312d 3122  line-ranges=1-1"
-00013a10: 2c20 222d 2d63 6f64 6522 2c20 636f 6465  , "--code", code
-00013a20: 5d0a 2020 2020 2020 2020 7265 7375 6c74  ].        result
-00013a30: 203d 2043 6c69 5275 6e6e 6572 2829 2e69   = CliRunner().i
-00013a40: 6e76 6f6b 6528 626c 6163 6b2e 6d61 696e  nvoke(black.main
-00013a50: 2c20 6172 6773 290a 0a20 2020 2020 2020  , args)..       
-00013a60: 2065 7870 6563 7465 6420 3d20 7465 7874   expected = text
-00013a70: 7772 6170 2e64 6564 656e 7428 2222 225c  wrap.dedent("""\
-00013a80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00013a90: 6120 3d3d 2062 3a0a 2020 2020 2020 2020  a == b:.        
-00013aa0: 2020 2020 2020 2020 7072 696e 7420 2028          print  (
-00013ab0: 2022 4f4b 2220 290a 2020 2020 2020 2020   "OK" ).        
-00013ac0: 2020 2020 2222 2229 0a20 2020 2020 2020      """).       
-00013ad0: 2073 656c 662e 636f 6d70 6172 655f 7265   self.compare_re
-00013ae0: 7375 6c74 7328 7265 7375 6c74 2c20 6578  sults(result, ex
-00013af0: 7065 6374 6564 2c20 6578 7065 6374 6564  pected, expected
-00013b00: 5f65 7869 745f 636f 6465 3d30 290a 0a20  _exit_code=0).. 
-00013b10: 2020 2064 6566 2074 6573 745f 6c69 6e65     def test_line
-00013b20: 5f72 616e 6765 735f 7769 7468 5f73 7464  _ranges_with_std
-00013b30: 696e 2873 656c 6629 202d 3e20 4e6f 6e65  in(self) -> None
-00013b40: 3a0a 2020 2020 2020 2020 636f 6465 203d  :.        code =
-00013b50: 2074 6578 7477 7261 702e 6465 6465 6e74   textwrap.dedent
-00013b60: 2822 2222 5c0a 2020 2020 2020 2020 2020  ("""\.          
-00013b70: 2020 6966 2020 6120 203d 3d20 2062 3a0a    if  a  ==  b:.
-00013b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b90: 7072 696e 7420 2028 2022 4f4b 2220 290a  print  ( "OK" ).
-00013ba0: 2020 2020 2020 2020 2020 2020 2222 2229              """)
-00013bb0: 0a20 2020 2020 2020 2072 756e 6e65 7220  .        runner 
-00013bc0: 3d20 426c 6163 6b52 756e 6e65 7228 290a  = BlackRunner().
-00013bd0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00013be0: 2072 756e 6e65 722e 696e 766f 6b65 280a   runner.invoke(.
-00013bf0: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-00013c00: 6b2e 6d61 696e 2c20 5b22 2d2d 6c69 6e65  k.main, ["--line
-00013c10: 2d72 616e 6765 733d 312d 3122 2c20 222d  -ranges=1-1", "-
-00013c20: 225d 2c20 696e 7075 743d 4279 7465 7349  "], input=BytesI
-00013c30: 4f28 636f 6465 2e65 6e63 6f64 6528 2275  O(code.encode("u
-00013c40: 7466 2d38 2229 290a 2020 2020 2020 2020  tf-8")).        
-00013c50: 290a 0a20 2020 2020 2020 2065 7870 6563  )..        expec
-00013c60: 7465 6420 3d20 7465 7874 7772 6170 2e64  ted = textwrap.d
-00013c70: 6564 656e 7428 2222 225c 0a20 2020 2020  edent("""\.     
-00013c80: 2020 2020 2020 2069 6620 6120 3d3d 2062         if a == b
-00013c90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013ca0: 2020 7072 696e 7420 2028 2022 4f4b 2220    print  ( "OK" 
-00013cb0: 290a 2020 2020 2020 2020 2020 2020 2222  ).            ""
-00013cc0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00013cd0: 636f 6d70 6172 655f 7265 7375 6c74 7328  compare_results(
-00013ce0: 7265 7375 6c74 2c20 6578 7065 6374 6564  result, expected
-00013cf0: 2c20 6578 7065 6374 6564 5f65 7869 745f  , expected_exit_
-00013d00: 636f 6465 3d30 290a 0a20 2020 2064 6566  code=0)..    def
-00013d10: 2074 6573 745f 6c69 6e65 5f72 616e 6765   test_line_range
-00013d20: 735f 7769 7468 5f73 6f75 7263 6528 7365  s_with_source(se
-00013d30: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00013d40: 2020 2020 2077 6974 6820 5465 6d70 6f72       with Tempor
-00013d50: 6172 7944 6972 6563 746f 7279 2829 2061  aryDirectory() a
-00013d60: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
-00013d70: 2020 2020 2020 2020 2074 6573 745f 6669           test_fi
-00013d80: 6c65 203d 2050 6174 6828 776f 726b 7370  le = Path(worksp
-00013d90: 6163 6529 202f 2022 7465 7374 2e70 7922  ace) / "test.py"
-00013da0: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
-00013db0: 745f 6669 6c65 2e77 7269 7465 5f74 6578  t_file.write_tex
-00013dc0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00013dd0: 2020 2074 6578 7477 7261 702e 6465 6465     textwrap.dede
-00013de0: 6e74 2822 2222 5c0a 2020 2020 2020 2020  nt("""\.        
-00013df0: 2020 2020 6966 2020 6120 203d 3d20 2062      if  a  ==  b
-00013e00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013e10: 2020 7072 696e 7420 2028 2022 4f4b 2220    print  ( "OK" 
-00013e20: 290a 2020 2020 2020 2020 2020 2020 2222  ).            ""
-00013e30: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00013e40: 2020 2020 656e 636f 6469 6e67 3d22 7574      encoding="ut
-00013e50: 662d 3822 2c0a 2020 2020 2020 2020 2020  f-8",.          
-00013e60: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00013e70: 6172 6773 203d 205b 222d 2d6c 696e 652d  args = ["--line-
-00013e80: 7261 6e67 6573 3d31 2d31 222c 2073 7472  ranges=1-1", str
-00013e90: 2874 6573 745f 6669 6c65 295d 0a20 2020  (test_file)].   
-00013ea0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00013eb0: 3d20 436c 6952 756e 6e65 7228 292e 696e  = CliRunner().in
-00013ec0: 766f 6b65 2862 6c61 636b 2e6d 6169 6e2c  voke(black.main,
-00013ed0: 2061 7267 7329 0a20 2020 2020 2020 2020   args).         
-00013ee0: 2020 2061 7373 6572 7420 6e6f 7420 7265     assert not re
-00013ef0: 7375 6c74 2e65 7869 745f 636f 6465 0a0a  sult.exit_code..
-00013f00: 2020 2020 2020 2020 2020 2020 666f 726d              form
-00013f10: 6174 7465 6420 3d20 7465 7374 5f66 696c  atted = test_fil
-00013f20: 652e 7265 6164 5f74 6578 7428 656e 636f  e.read_text(enco
-00013f30: 6469 6e67 3d22 7574 662d 3822 290a 2020  ding="utf-8").  
-00013f40: 2020 2020 2020 2020 2020 6578 7065 6374            expect
-00013f50: 6564 203d 2074 6578 7477 7261 702e 6465  ed = textwrap.de
-00013f60: 6465 6e74 2822 2222 5c0a 2020 2020 2020  dent("""\.      
-00013f70: 2020 2020 2020 6966 2061 203d 3d20 623a        if a == b:
-00013f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013f90: 2070 7269 6e74 2020 2820 224f 4b22 2029   print  ( "OK" )
-00013fa0: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-00013fb0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00013fc0: 7365 7274 2065 7870 6563 7465 6420 3d3d  sert expected ==
-00013fd0: 2066 6f72 6d61 7474 6564 0a0a 2020 2020   formatted..    
-00013fe0: 6465 6620 7465 7374 5f6c 696e 655f 7261  def test_line_ra
-00013ff0: 6e67 6573 5f77 6974 685f 6d75 6c74 6970  nges_with_multip
-00014000: 6c65 5f73 6f75 7263 6573 2873 656c 6629  le_sources(self)
-00014010: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00014020: 2020 7769 7468 2054 656d 706f 7261 7279    with Temporary
-00014030: 4469 7265 6374 6f72 7928 2920 6173 2077  Directory() as w
-00014040: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
-00014050: 2020 2020 2020 7465 7374 315f 6669 6c65        test1_file
-00014060: 203d 2050 6174 6828 776f 726b 7370 6163   = Path(workspac
-00014070: 6529 202f 2022 7465 7374 312e 7079 220a  e) / "test1.py".
-00014080: 2020 2020 2020 2020 2020 2020 7465 7374              test
-00014090: 315f 6669 6c65 2e77 7269 7465 5f74 6578  1_file.write_tex
-000140a0: 7428 2222 2c20 656e 636f 6469 6e67 3d22  t("", encoding="
-000140b0: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
-000140c0: 2020 2020 7465 7374 325f 6669 6c65 203d      test2_file =
-000140d0: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
-000140e0: 202f 2022 7465 7374 322e 7079 220a 2020   / "test2.py".  
-000140f0: 2020 2020 2020 2020 2020 7465 7374 325f            test2_
-00014100: 6669 6c65 2e77 7269 7465 5f74 6578 7428  file.write_text(
-00014110: 2222 2c20 656e 636f 6469 6e67 3d22 7574  "", encoding="ut
-00014120: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
-00014130: 2020 6172 6773 203d 205b 222d 2d6c 696e    args = ["--lin
-00014140: 652d 7261 6e67 6573 3d31 2d31 222c 2073  e-ranges=1-1", s
-00014150: 7472 2874 6573 7431 5f66 696c 6529 2c20  tr(test1_file), 
-00014160: 7374 7228 7465 7374 325f 6669 6c65 295d  str(test2_file)]
-00014170: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00014180: 756c 7420 3d20 436c 6952 756e 6e65 7228  ult = CliRunner(
-00014190: 292e 696e 766f 6b65 2862 6c61 636b 2e6d  ).invoke(black.m
-000141a0: 6169 6e2c 2061 7267 7329 0a20 2020 2020  ain, args).     
-000141b0: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
-000141c0: 7375 6c74 2e65 7869 745f 636f 6465 203d  sult.exit_code =
-000141d0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-000141e0: 6173 7365 7274 2022 4361 6e6e 6f74 2075  assert "Cannot u
-000141f0: 7365 202d 2d6c 696e 652d 7261 6e67 6573  se --line-ranges
-00014200: 2074 6f20 666f 726d 6174 206d 756c 7469   to format multi
-00014210: 706c 6520 6669 6c65 7322 2069 6e20 7265  ple files" in re
-00014220: 7375 6c74 2e6f 7574 7075 740a 0a20 2020  sult.output..   
-00014230: 2064 6566 2074 6573 745f 6c69 6e65 5f72   def test_line_r
-00014240: 616e 6765 735f 7769 7468 5f69 7079 6e62  anges_with_ipynb
-00014250: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00014260: 2020 2020 2020 2020 7769 7468 2054 656d          with Tem
-00014270: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
-00014280: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
-00014290: 2020 2020 2020 2020 2020 2020 7465 7374              test
-000142a0: 5f66 696c 6520 3d20 5061 7468 2877 6f72  _file = Path(wor
-000142b0: 6b73 7061 6365 2920 2f20 2274 6573 742e  kspace) / "test.
-000142c0: 6970 796e 6222 0a20 2020 2020 2020 2020  ipynb".         
-000142d0: 2020 2074 6573 745f 6669 6c65 2e77 7269     test_file.wri
-000142e0: 7465 5f74 6578 7428 227b 7d22 2c20 656e  te_text("{}", en
-000142f0: 636f 6469 6e67 3d22 7574 662d 3822 290a  coding="utf-8").
-00014300: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00014310: 203d 205b 222d 2d6c 696e 652d 7261 6e67   = ["--line-rang
-00014320: 6573 3d31 2d31 222c 2022 2d2d 6970 796e  es=1-1", "--ipyn
-00014330: 6222 2c20 7374 7228 7465 7374 5f66 696c  b", str(test_fil
-00014340: 6529 5d0a 2020 2020 2020 2020 2020 2020  e)].            
-00014350: 7265 7375 6c74 203d 2043 6c69 5275 6e6e  result = CliRunn
-00014360: 6572 2829 2e69 6e76 6f6b 6528 626c 6163  er().invoke(blac
-00014370: 6b2e 6d61 696e 2c20 6172 6773 290a 2020  k.main, args).  
-00014380: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00014390: 2022 4361 6e6e 6f74 2075 7365 202d 2d6c   "Cannot use --l
-000143a0: 696e 652d 7261 6e67 6573 2077 6974 6820  ine-ranges with 
-000143b0: 6970 796e 6220 6669 6c65 7322 2069 6e20  ipynb files" in 
-000143c0: 7265 7375 6c74 2e6f 7574 7075 740a 2020  result.output.  
-000143d0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-000143e0: 2072 6573 756c 742e 6578 6974 5f63 6f64   result.exit_cod
-000143f0: 6520 3d3d 2031 0a0a 2020 2020 6465 6620  e == 1..    def 
-00014400: 7465 7374 5f6c 696e 655f 7261 6e67 6573  test_line_ranges
-00014410: 5f69 6e5f 7079 7072 6f6a 6563 745f 746f  _in_pyproject_to
-00014420: 6d6c 2873 656c 6629 202d 3e20 4e6f 6e65  ml(self) -> None
-00014430: 3a0a 2020 2020 2020 2020 636f 6e66 6967  :.        config
-00014440: 203d 2054 4849 535f 4449 5220 2f20 2264   = THIS_DIR / "d
-00014450: 6174 6122 202f 2022 696e 7661 6c69 645f  ata" / "invalid_
-00014460: 6c69 6e65 5f72 616e 6765 732e 746f 6d6c  line_ranges.toml
-00014470: 220a 2020 2020 2020 2020 7265 7375 6c74  ".        result
-00014480: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
-00014490: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
-000144a0: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
-000144b0: 205b 222d 2d63 6f64 6522 2c20 2270 7269   ["--code", "pri
-000144c0: 6e74 2829 222c 2022 2d2d 636f 6e66 6967  nt()", "--config
-000144d0: 222c 2073 7472 2863 6f6e 6669 6729 5d0a  ", str(config)].
-000144e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000144f0: 2020 6173 7365 7274 2072 6573 756c 742e    assert result.
-00014500: 6578 6974 5f63 6f64 6520 3d3d 2032 0a20  exit_code == 2. 
-00014510: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
-00014520: 7375 6c74 2e73 7464 6572 725f 6279 7465  sult.stderr_byte
-00014530: 7320 6973 206e 6f74 204e 6f6e 650a 2020  s is not None.  
-00014540: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
-00014550: 2020 2020 2020 2020 2020 2062 2243 616e             b"Can
-00014560: 6e6f 7420 7573 6520 6c69 6e65 2d72 616e  not use line-ran
-00014570: 6765 7320 696e 2074 6865 2070 7970 726f  ges in the pypro
-00014580: 6a65 6374 2e74 6f6d 6c20 6669 6c65 2e22  ject.toml file."
-00014590: 2069 6e20 7265 7375 6c74 2e73 7464 6572   in result.stder
-000145a0: 725f 6279 7465 730a 2020 2020 2020 2020  r_bytes.        
-000145b0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-000145c0: 6c69 6e65 735f 7769 7468 5f6c 6561 6469  lines_with_leadi
-000145d0: 6e67 5f74 6162 735f 6578 7061 6e64 6564  ng_tabs_expanded
-000145e0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-000145f0: 2020 2020 2020 2020 2320 5365 6520 4356          # See CV
-00014600: 452d 3230 3234 2d32 3135 3033 2e20 4d6f  E-2024-21503. Mo
-00014610: 7374 6c79 2074 6573 7420 7468 6174 2074  stly test that t
-00014620: 6869 7320 636f 6d70 6c65 7465 7320 696e  his completes in
-00014630: 2061 2072 6561 736f 6e61 626c 650a 2020   a reasonable.  
-00014640: 2020 2020 2020 2320 7469 6d65 2e0a 2020        # time..  
-00014650: 2020 2020 2020 7061 796c 6f61 6420 3d20        payload = 
-00014660: 225c 7422 202a 2031 305f 3030 300a 2020  "\t" * 10_000.  
-00014670: 2020 2020 2020 6173 7365 7274 206c 696e        assert lin
-00014680: 6573 5f77 6974 685f 6c65 6164 696e 675f  es_with_leading_
-00014690: 7461 6273 5f65 7870 616e 6465 6428 7061  tabs_expanded(pa
-000146a0: 796c 6f61 6429 203d 3d20 5b70 6179 6c6f  yload) == [paylo
-000146b0: 6164 5d0a 0a20 2020 2020 2020 2074 6162  ad]..        tab
-000146c0: 203d 2022 2022 202a 2038 0a20 2020 2020   = " " * 8.     
-000146d0: 2020 2061 7373 6572 7420 6c69 6e65 735f     assert lines_
-000146e0: 7769 7468 5f6c 6561 6469 6e67 5f74 6162  with_leading_tab
-000146f0: 735f 6578 7061 6e64 6564 2822 5c74 7822  s_expanded("\tx"
-00014700: 2920 3d3d 205b 6622 7b74 6162 7d78 225d  ) == [f"{tab}x"]
-00014710: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00014720: 6c69 6e65 735f 7769 7468 5f6c 6561 6469  lines_with_leadi
-00014730: 6e67 5f74 6162 735f 6578 7061 6e64 6564  ng_tabs_expanded
-00014740: 2822 5c74 5c74 7822 2920 3d3d 205b 6622  ("\t\tx") == [f"
-00014750: 7b74 6162 7d7b 7461 627d 7822 5d0a 2020  {tab}{tab}x"].  
-00014760: 2020 2020 2020 6173 7365 7274 206c 696e        assert lin
-00014770: 6573 5f77 6974 685f 6c65 6164 696e 675f  es_with_leading_
-00014780: 7461 6273 5f65 7870 616e 6465 6428 225c  tabs_expanded("\
-00014790: 7478 5c6e 2020 7922 2920 3d3d 205b 6622  tx\n  y") == [f"
-000147a0: 7b74 6162 7d78 222c 2022 2020 7922 5d0a  {tab}x", "  y"].
-000147b0: 0a0a 636c 6173 7320 5465 7374 4361 6368  ..class TestCach
-000147c0: 696e 673a 0a20 2020 2064 6566 2074 6573  ing:.    def tes
-000147d0: 745f 6765 745f 6361 6368 655f 6469 7228  t_get_cache_dir(
-000147e0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-000147f0: 2020 2020 2020 2074 6d70 5f70 6174 683a         tmp_path:
-00014800: 2050 6174 682c 0a20 2020 2020 2020 206d   Path,.        m
-00014810: 6f6e 6b65 7970 6174 6368 3a20 7079 7465  onkeypatch: pyte
-00014820: 7374 2e4d 6f6e 6b65 7950 6174 6368 2c0a  st.MonkeyPatch,.
-00014830: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-00014840: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-00014850: 6d75 6c74 6970 6c65 2063 6163 6865 2064  multiple cache d
-00014860: 6972 6563 746f 7269 6573 0a20 2020 2020  irectories.     
-00014870: 2020 2077 6f72 6b73 7061 6365 3120 3d20     workspace1 = 
-00014880: 746d 705f 7061 7468 202f 2022 7773 3122  tmp_path / "ws1"
-00014890: 0a20 2020 2020 2020 2077 6f72 6b73 7061  .        workspa
-000148a0: 6365 312e 6d6b 6469 7228 290a 2020 2020  ce1.mkdir().    
-000148b0: 2020 2020 776f 726b 7370 6163 6532 203d      workspace2 =
-000148c0: 2074 6d70 5f70 6174 6820 2f20 2277 7332   tmp_path / "ws2
-000148d0: 220a 2020 2020 2020 2020 776f 726b 7370  ".        worksp
-000148e0: 6163 6532 2e6d 6b64 6972 2829 0a0a 2020  ace2.mkdir()..  
-000148f0: 2020 2020 2020 2320 466f 7263 6520 7573        # Force us
-00014900: 6572 5f63 6163 6865 5f64 6972 2074 6f20  er_cache_dir to 
-00014910: 7573 6520 7468 6520 7465 6d70 6f72 6172  use the temporar
-00014920: 7920 6469 7265 6374 6f72 7920 666f 7220  y directory for 
-00014930: 6561 7369 6572 2061 7373 6572 7469 6f6e  easier assertion
-00014940: 730a 2020 2020 2020 2020 7061 7463 685f  s.        patch_
-00014950: 7573 6572 5f63 6163 6865 5f64 6972 203d  user_cache_dir =
-00014960: 2070 6174 6368 280a 2020 2020 2020 2020   patch(.        
-00014970: 2020 2020 7461 7267 6574 3d22 626c 6163      target="blac
-00014980: 6b2e 6361 6368 652e 7573 6572 5f63 6163  k.cache.user_cac
-00014990: 6865 5f64 6972 222c 0a20 2020 2020 2020  he_dir",.       
-000149a0: 2020 2020 2061 7574 6f73 7065 633d 5472       autospec=Tr
-000149b0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-000149c0: 7265 7475 726e 5f76 616c 7565 3d73 7472  return_value=str
-000149d0: 2877 6f72 6b73 7061 6365 3129 2c0a 2020  (workspace1),.  
-000149e0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000149f0: 2023 2049 6620 424c 4143 4b5f 4341 4348   # If BLACK_CACH
-00014a00: 455f 4449 5220 6973 206e 6f74 2073 6574  E_DIR is not set
-00014a10: 2c20 7573 6520 7573 6572 5f63 6163 6865  , use user_cache
-00014a20: 5f64 6972 0a20 2020 2020 2020 206d 6f6e  _dir.        mon
-00014a30: 6b65 7970 6174 6368 2e64 656c 656e 7628  keypatch.delenv(
-00014a40: 2242 4c41 434b 5f43 4143 4845 5f44 4952  "BLACK_CACHE_DIR
-00014a50: 222c 2072 6169 7369 6e67 3d46 616c 7365  ", raising=False
-00014a60: 290a 2020 2020 2020 2020 7769 7468 2070  ).        with p
-00014a70: 6174 6368 5f75 7365 725f 6361 6368 655f  atch_user_cache_
-00014a80: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
-00014a90: 2061 7373 6572 7420 6765 745f 6361 6368   assert get_cach
-00014aa0: 655f 6469 7228 292e 7061 7265 6e74 203d  e_dir().parent =
-00014ab0: 3d20 776f 726b 7370 6163 6531 0a0a 2020  = workspace1..  
-00014ac0: 2020 2020 2020 2320 4966 2069 7420 6973        # If it is
-00014ad0: 2073 6574 2c20 7573 6520 7468 6520 7061   set, use the pa
-00014ae0: 7468 2070 726f 7669 6465 6420 696e 2074  th provided in t
-00014af0: 6865 2065 6e76 2076 6172 2e0a 2020 2020  he env var..    
-00014b00: 2020 2020 6d6f 6e6b 6579 7061 7463 682e      monkeypatch.
-00014b10: 7365 7465 6e76 2822 424c 4143 4b5f 4341  setenv("BLACK_CA
-00014b20: 4348 455f 4449 5222 2c20 7374 7228 776f  CHE_DIR", str(wo
-00014b30: 726b 7370 6163 6532 2929 0a20 2020 2020  rkspace2)).     
-00014b40: 2020 2061 7373 6572 7420 6765 745f 6361     assert get_ca
-00014b50: 6368 655f 6469 7228 292e 7061 7265 6e74  che_dir().parent
-00014b60: 203d 3d20 776f 726b 7370 6163 6532 0a0a   == workspace2..
-00014b70: 2020 2020 6465 6620 7465 7374 5f63 6163      def test_cac
-00014b80: 6865 5f66 696c 655f 6c65 6e67 7468 2873  he_file_length(s
-00014b90: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00014ba0: 2020 2020 2020 6361 7365 7320 3d20 5b0a        cases = [.
-00014bb0: 2020 2020 2020 2020 2020 2020 4445 4641              DEFA
-00014bc0: 554c 545f 4d4f 4445 2c0a 2020 2020 2020  ULT_MODE,.      
-00014bd0: 2020 2020 2020 2320 616c 6c20 6f66 2074        # all of t
-00014be0: 6865 2074 6172 6765 7420 7665 7273 696f  he target versio
-00014bf0: 6e73 0a20 2020 2020 2020 2020 2020 204d  ns.            M
-00014c00: 6f64 6528 7461 7267 6574 5f76 6572 7369  ode(target_versi
-00014c10: 6f6e 733d 7365 7428 5461 7267 6574 5665  ons=set(TargetVe
-00014c20: 7273 696f 6e29 292c 0a20 2020 2020 2020  rsion)),.       
-00014c30: 2020 2020 2023 2061 6c6c 206f 6620 7468       # all of th
-00014c40: 6520 6665 6174 7572 6573 0a20 2020 2020  e features.     
-00014c50: 2020 2020 2020 204d 6f64 6528 656e 6162         Mode(enab
-00014c60: 6c65 645f 6665 6174 7572 6573 3d73 6574  led_features=set
-00014c70: 2850 7265 7669 6577 2929 2c0a 2020 2020  (Preview)),.    
-00014c80: 2020 2020 2020 2020 2320 616c 6c20 6f66          # all of
-00014c90: 2074 6865 206d 6167 6963 730a 2020 2020   the magics.    
-00014ca0: 2020 2020 2020 2020 4d6f 6465 2870 7974          Mode(pyt
-00014cb0: 686f 6e5f 6365 6c6c 5f6d 6167 6963 733d  hon_cell_magics=
-00014cc0: 7b66 226d 6167 6963 7b69 7d22 2066 6f72  {f"magic{i}" for
-00014cd0: 2069 2069 6e20 7261 6e67 6528 3530 3029   i in range(500)
-00014ce0: 7d29 2c0a 2020 2020 2020 2020 2020 2020  }),.            
-00014cf0: 2320 616c 6c20 6f66 2074 6865 2074 6869  # all of the thi
-00014d00: 6e67 730a 2020 2020 2020 2020 2020 2020  ngs.            
-00014d10: 4d6f 6465 280a 2020 2020 2020 2020 2020  Mode(.          
-00014d20: 2020 2020 2020 7461 7267 6574 5f76 6572        target_ver
-00014d30: 7369 6f6e 733d 7365 7428 5461 7267 6574  sions=set(Target
-00014d40: 5665 7273 696f 6e29 2c0a 2020 2020 2020  Version),.      
-00014d50: 2020 2020 2020 2020 2020 656e 6162 6c65            enable
-00014d60: 645f 6665 6174 7572 6573 3d73 6574 2850  d_features=set(P
-00014d70: 7265 7669 6577 292c 0a20 2020 2020 2020  review),.       
-00014d80: 2020 2020 2020 2020 2070 7974 686f 6e5f           python_
-00014d90: 6365 6c6c 5f6d 6167 6963 733d 7b66 226d  cell_magics={f"m
-00014da0: 6167 6963 7b69 7d22 2066 6f72 2069 2069  agic{i}" for i i
-00014db0: 6e20 7261 6e67 6528 3530 3029 7d2c 0a20  n range(500)},. 
-00014dc0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00014dd0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00014de0: 666f 7220 6361 7365 2069 6e20 6361 7365  for case in case
-00014df0: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-00014e00: 6163 6865 5f66 696c 6520 3d20 6765 745f  ache_file = get_
-00014e10: 6361 6368 655f 6669 6c65 2863 6173 6529  cache_file(case)
-00014e20: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-00014e30: 6f6d 6520 636f 6d6d 6f6e 2066 696c 6520  ome common file 
-00014e40: 7379 7374 656d 7320 656e 666f 7263 6520  systems enforce 
-00014e50: 6120 6d61 7869 6d75 6d20 7061 7468 206c  a maximum path l
-00014e60: 656e 6774 680a 2020 2020 2020 2020 2020  ength.          
-00014e70: 2020 2320 6f66 2031 3433 2028 6973 7375    # of 143 (issu
-00014e80: 6520 2334 3137 3429 2e20 5765 2063 616e  e #4174). We can
-00014e90: 2774 2064 6f20 616e 7974 6869 6e67 2069  't do anything i
-00014ea0: 6620 7468 6520 6469 7265 6374 6f72 790a  f the directory.
-00014eb0: 2020 2020 2020 2020 2020 2020 2320 7061              # pa
-00014ec0: 7468 2069 7320 746f 6f20 6c6f 6e67 2c20  th is too long, 
-00014ed0: 6275 7420 656e 7375 7265 2074 6865 206e  but ensure the n
-00014ee0: 616d 6520 6f66 2074 6865 2063 6163 6865  ame of the cache
-00014ef0: 2066 696c 6520 6974 7365 6c66 0a20 2020   file itself.   
-00014f00: 2020 2020 2020 2020 2023 2064 6f65 736e           # doesn
-00014f10: 2774 2067 6574 2074 6f6f 2063 7261 7a79  't get too crazy
-00014f20: 2e0a 2020 2020 2020 2020 2020 2020 6173  ..            as
-00014f30: 7365 7274 206c 656e 2863 6163 6865 5f66  sert len(cache_f
-00014f40: 696c 652e 6e61 6d65 2920 3c3d 2039 360a  ile.name) <= 96.
-00014f50: 0a20 2020 2064 6566 2074 6573 745f 6361  .    def test_ca
-00014f60: 6368 655f 6272 6f6b 656e 5f66 696c 6528  che_broken_file(
-00014f70: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00014f80: 2020 2020 2020 206d 6f64 6520 3d20 4445         mode = DE
-00014f90: 4641 554c 545f 4d4f 4445 0a20 2020 2020  FAULT_MODE.     
-00014fa0: 2020 2077 6974 6820 6361 6368 655f 6469     with cache_di
-00014fb0: 7228 2920 6173 2077 6f72 6b73 7061 6365  r() as workspace
-00014fc0: 3a0a 2020 2020 2020 2020 2020 2020 6361  :.            ca
-00014fd0: 6368 655f 6669 6c65 203d 2067 6574 5f63  che_file = get_c
-00014fe0: 6163 6865 5f66 696c 6528 6d6f 6465 290a  ache_file(mode).
-00014ff0: 2020 2020 2020 2020 2020 2020 6361 6368              cach
-00015000: 655f 6669 6c65 2e77 7269 7465 5f74 6578  e_file.write_tex
-00015010: 7428 2274 6869 7320 6973 206e 6f74 2061  t("this is not a
-00015020: 2070 6963 6b6c 6522 2c20 656e 636f 6469   pickle", encodi
-00015030: 6e67 3d22 7574 662d 3822 290a 2020 2020  ng="utf-8").    
-00015040: 2020 2020 2020 2020 6173 7365 7274 2062          assert b
-00015050: 6c61 636b 2e43 6163 6865 2e72 6561 6428  lack.Cache.read(
-00015060: 6d6f 6465 292e 6669 6c65 5f64 6174 6120  mode).file_data 
-00015070: 3d3d 207b 7d0a 2020 2020 2020 2020 2020  == {}.          
-00015080: 2020 7372 6320 3d20 2877 6f72 6b73 7061    src = (workspa
-00015090: 6365 202f 2022 7465 7374 2e70 7922 292e  ce / "test.py").
-000150a0: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
-000150b0: 2020 2020 2020 7372 632e 7772 6974 655f        src.write_
-000150c0: 7465 7874 2822 7072 696e 7428 2768 656c  text("print('hel
-000150d0: 6c6f 2729 222c 2065 6e63 6f64 696e 673d  lo')", encoding=
-000150e0: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
-000150f0: 2020 2020 2069 6e76 6f6b 6542 6c61 636b       invokeBlack
-00015100: 285b 7374 7228 7372 6329 5d29 0a20 2020  ([str(src)]).   
-00015110: 2020 2020 2020 2020 2063 6163 6865 203d           cache =
-00015120: 2062 6c61 636b 2e43 6163 6865 2e72 6561   black.Cache.rea
-00015130: 6428 6d6f 6465 290a 2020 2020 2020 2020  d(mode).        
-00015140: 2020 2020 6173 7365 7274 206e 6f74 2063      assert not c
-00015150: 6163 6865 2e69 735f 6368 616e 6765 6428  ache.is_changed(
-00015160: 7372 6329 0a0a 2020 2020 6465 6620 7465  src)..    def te
-00015170: 7374 5f63 6163 6865 5f73 696e 676c 655f  st_cache_single_
-00015180: 6669 6c65 5f61 6c72 6561 6479 5f63 6163  file_already_cac
-00015190: 6865 6428 7365 6c66 2920 2d3e 204e 6f6e  hed(self) -> Non
-000151a0: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
-000151b0: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
-000151c0: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
-000151d0: 655f 6469 7228 2920 6173 2077 6f72 6b73  e_dir() as works
-000151e0: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
-000151f0: 2020 7372 6320 3d20 2877 6f72 6b73 7061    src = (workspa
-00015200: 6365 202f 2022 7465 7374 2e70 7922 292e  ce / "test.py").
-00015210: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
-00015220: 2020 2020 2020 7372 632e 7772 6974 655f        src.write_
-00015230: 7465 7874 2822 7072 696e 7428 2768 656c  text("print('hel
-00015240: 6c6f 2729 222c 2065 6e63 6f64 696e 673d  lo')", encoding=
-00015250: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
-00015260: 2020 2020 2063 6163 6865 203d 2062 6c61       cache = bla
-00015270: 636b 2e43 6163 6865 2e72 6561 6428 6d6f  ck.Cache.read(mo
-00015280: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-00015290: 6361 6368 652e 7772 6974 6528 5b73 7263  cache.write([src
-000152a0: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
-000152b0: 6e76 6f6b 6542 6c61 636b 285b 7374 7228  nvokeBlack([str(
-000152c0: 7372 6329 5d29 0a20 2020 2020 2020 2020  src)]).         
-000152d0: 2020 2061 7373 6572 7420 7372 632e 7265     assert src.re
-000152e0: 6164 5f74 6578 7428 656e 636f 6469 6e67  ad_text(encoding
-000152f0: 3d22 7574 662d 3822 2920 3d3d 2022 7072  ="utf-8") == "pr
-00015300: 696e 7428 2768 656c 6c6f 2729 220a 0a20  int('hello')".. 
-00015310: 2020 2040 6576 656e 745f 6c6f 6f70 2829     @event_loop()
-00015320: 0a20 2020 2064 6566 2074 6573 745f 6361  .    def test_ca
-00015330: 6368 655f 6d75 6c74 6970 6c65 5f66 696c  che_multiple_fil
-00015340: 6573 2873 656c 6629 202d 3e20 4e6f 6e65  es(self) -> None
-00015350: 3a0a 2020 2020 2020 2020 6d6f 6465 203d  :.        mode =
-00015360: 2044 4546 4155 4c54 5f4d 4f44 450a 2020   DEFAULT_MODE.  
-00015370: 2020 2020 2020 7769 7468 2063 6163 6865        with cache
-00015380: 5f64 6972 2829 2061 7320 776f 726b 7370  _dir() as worksp
-00015390: 6163 652c 2070 6174 6368 280a 2020 2020  ace, patch(.    
-000153a0: 2020 2020 2020 2020 2263 6f6e 6375 7272          "concurr
-000153b0: 656e 742e 6675 7475 7265 732e 5072 6f63  ent.futures.Proc
-000153c0: 6573 7350 6f6f 6c45 7865 6375 746f 7222  essPoolExecutor"
-000153d0: 2c20 6e65 773d 5468 7265 6164 506f 6f6c  , new=ThreadPool
-000153e0: 4578 6563 7574 6f72 0a20 2020 2020 2020  Executor.       
-000153f0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-00015400: 6f6e 6520 3d20 2877 6f72 6b73 7061 6365  one = (workspace
-00015410: 202f 2022 6f6e 652e 7079 2229 2e72 6573   / "one.py").res
-00015420: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
-00015430: 2020 206f 6e65 2e77 7269 7465 5f74 6578     one.write_tex
-00015440: 7428 2270 7269 6e74 2827 6865 6c6c 6f27  t("print('hello'
-00015450: 2922 2c20 656e 636f 6469 6e67 3d22 7574  )", encoding="ut
-00015460: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
-00015470: 2020 7477 6f20 3d20 2877 6f72 6b73 7061    two = (workspa
-00015480: 6365 202f 2022 7477 6f2e 7079 2229 2e72  ce / "two.py").r
-00015490: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
-000154a0: 2020 2020 2074 776f 2e77 7269 7465 5f74       two.write_t
-000154b0: 6578 7428 2270 7269 6e74 2827 6865 6c6c  ext("print('hell
-000154c0: 6f27 2922 2c20 656e 636f 6469 6e67 3d22  o')", encoding="
-000154d0: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
-000154e0: 2020 2020 6361 6368 6520 3d20 626c 6163      cache = blac
-000154f0: 6b2e 4361 6368 652e 7265 6164 286d 6f64  k.Cache.read(mod
-00015500: 6529 0a20 2020 2020 2020 2020 2020 2063  e).            c
-00015510: 6163 6865 2e77 7269 7465 285b 6f6e 655d  ache.write([one]
-00015520: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-00015530: 766f 6b65 426c 6163 6b28 5b73 7472 2877  vokeBlack([str(w
-00015540: 6f72 6b73 7061 6365 295d 290a 2020 2020  orkspace)]).    
-00015550: 2020 2020 2020 2020 6173 7365 7274 206f          assert o
-00015560: 6e65 2e72 6561 645f 7465 7874 2865 6e63  ne.read_text(enc
-00015570: 6f64 696e 673d 2275 7466 2d38 2229 203d  oding="utf-8") =
-00015580: 3d20 2270 7269 6e74 2827 6865 6c6c 6f27  = "print('hello'
-00015590: 2922 0a20 2020 2020 2020 2020 2020 2061  )".            a
-000155a0: 7373 6572 7420 7477 6f2e 7265 6164 5f74  ssert two.read_t
-000155b0: 6578 7428 656e 636f 6469 6e67 3d22 7574  ext(encoding="ut
-000155c0: 662d 3822 2920 3d3d 2027 7072 696e 7428  f-8") == 'print(
-000155d0: 2268 656c 6c6f 2229 5c6e 270a 2020 2020  "hello")\n'.    
-000155e0: 2020 2020 2020 2020 6361 6368 6520 3d20          cache = 
-000155f0: 626c 6163 6b2e 4361 6368 652e 7265 6164  black.Cache.read
-00015600: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
-00015610: 2020 2061 7373 6572 7420 6e6f 7420 6361     assert not ca
-00015620: 6368 652e 6973 5f63 6861 6e67 6564 286f  che.is_changed(o
-00015630: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-00015640: 6173 7365 7274 206e 6f74 2063 6163 6865  assert not cache
-00015650: 2e69 735f 6368 616e 6765 6428 7477 6f29  .is_changed(two)
-00015660: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
-00015670: 726b 2e69 6e63 6f6d 7061 7469 626c 655f  rk.incompatible_
-00015680: 7769 7468 5f6d 7970 7963 0a20 2020 2040  with_mypyc.    @
-00015690: 7079 7465 7374 2e6d 6172 6b2e 7061 7261  pytest.mark.para
-000156a0: 6d65 7472 697a 6528 2263 6f6c 6f72 222c  metrize("color",
-000156b0: 205b 4661 6c73 652c 2054 7275 655d 2c20   [False, True], 
-000156c0: 6964 733d 5b22 6e6f 2d63 6f6c 6f72 222c  ids=["no-color",
-000156d0: 2022 7769 7468 2d63 6f6c 6f72 225d 290a   "with-color"]).
-000156e0: 2020 2020 6465 6620 7465 7374 5f6e 6f5f      def test_no_
-000156f0: 6361 6368 655f 7768 656e 5f77 7269 7465  cache_when_write
-00015700: 6261 636b 5f64 6966 6628 7365 6c66 2c20  back_diff(self, 
-00015710: 636f 6c6f 723a 2062 6f6f 6c29 202d 3e20  color: bool) -> 
-00015720: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d6f  None:.        mo
-00015730: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
-00015740: 450a 2020 2020 2020 2020 7769 7468 2063  E.        with c
-00015750: 6163 6865 5f64 6972 2829 2061 7320 776f  ache_dir() as wo
-00015760: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
-00015770: 2020 2020 2073 7263 203d 2028 776f 726b       src = (work
-00015780: 7370 6163 6520 2f20 2274 6573 742e 7079  space / "test.py
-00015790: 2229 2e72 6573 6f6c 7665 2829 0a20 2020  ").resolve().   
-000157a0: 2020 2020 2020 2020 2073 7263 2e77 7269           src.wri
-000157b0: 7465 5f74 6578 7428 2270 7269 6e74 2827  te_text("print('
-000157c0: 6865 6c6c 6f27 2922 2c20 656e 636f 6469  hello')", encodi
-000157d0: 6e67 3d22 7574 662d 3822 290a 2020 2020  ng="utf-8").    
-000157e0: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
-000157f0: 6368 2e6f 626a 6563 7428 626c 6163 6b2e  ch.object(black.
-00015800: 4361 6368 652c 2022 7265 6164 2229 2061  Cache, "read") a
-00015810: 7320 7265 6164 5f63 6163 6865 2c20 7061  s read_cache, pa
-00015820: 7463 682e 6f62 6a65 6374 280a 2020 2020  tch.object(.    
-00015830: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-00015840: 6b2e 4361 6368 652c 2022 7772 6974 6522  k.Cache, "write"
-00015850: 0a20 2020 2020 2020 2020 2020 2029 2061  .            ) a
-00015860: 7320 7772 6974 655f 6361 6368 653a 0a20  s write_cache:. 
-00015870: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00015880: 6d64 203d 205b 7374 7228 7372 6329 2c20  md = [str(src), 
-00015890: 222d 2d64 6966 6622 5d0a 2020 2020 2020  "--diff"].      
-000158a0: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
-000158b0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-000158c0: 2020 2020 2020 2020 636d 642e 6170 7065          cmd.appe
-000158d0: 6e64 2822 2d2d 636f 6c6f 7222 290a 2020  nd("--color").  
-000158e0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-000158f0: 766f 6b65 426c 6163 6b28 636d 6429 0a20  vokeBlack(cmd). 
-00015900: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00015910: 6163 6865 5f66 696c 6520 3d20 6765 745f  ache_file = get_
-00015920: 6361 6368 655f 6669 6c65 286d 6f64 6529  cache_file(mode)
-00015930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015940: 2061 7373 6572 7420 6361 6368 655f 6669   assert cache_fi
-00015950: 6c65 2e65 7869 7374 7328 2920 6973 2046  le.exists() is F
-00015960: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00015970: 2020 2020 2072 6561 645f 6361 6368 652e       read_cache.
-00015980: 6173 7365 7274 5f63 616c 6c65 645f 6f6e  assert_called_on
-00015990: 6365 2829 0a20 2020 2020 2020 2020 2020  ce().           
-000159a0: 2020 2020 2077 7269 7465 5f63 6163 6865       write_cache
-000159b0: 2e61 7373 6572 745f 6e6f 745f 6361 6c6c  .assert_not_call
-000159c0: 6564 2829 0a0a 2020 2020 4070 7974 6573  ed()..    @pytes
-000159d0: 742e 6d61 726b 2e70 6172 616d 6574 7269  t.mark.parametri
-000159e0: 7a65 2822 636f 6c6f 7222 2c20 5b46 616c  ze("color", [Fal
-000159f0: 7365 2c20 5472 7565 5d2c 2069 6473 3d5b  se, True], ids=[
-00015a00: 226e 6f2d 636f 6c6f 7222 2c20 2277 6974  "no-color", "wit
-00015a10: 682d 636f 6c6f 7222 5d29 0a20 2020 2040  h-color"]).    @
-00015a20: 6576 656e 745f 6c6f 6f70 2829 0a20 2020  event_loop().   
-00015a30: 2064 6566 2074 6573 745f 6f75 7470 7574   def test_output
-00015a40: 5f6c 6f63 6b69 6e67 5f77 6865 6e5f 7772  _locking_when_wr
-00015a50: 6974 6562 6163 6b5f 6469 6666 2873 656c  iteback_diff(sel
-00015a60: 662c 2063 6f6c 6f72 3a20 626f 6f6c 2920  f, color: bool) 
-00015a70: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00015a80: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
-00015a90: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
-00015aa0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00015ab0: 7461 6720 696e 2072 616e 6765 2830 2c20  tag in range(0, 
-00015ac0: 3429 3a0a 2020 2020 2020 2020 2020 2020  4):.            
-00015ad0: 2020 2020 7372 6320 3d20 2877 6f72 6b73      src = (works
-00015ae0: 7061 6365 202f 2066 2274 6573 747b 7461  pace / f"test{ta
-00015af0: 677d 2e70 7922 292e 7265 736f 6c76 6528  g}.py").resolve(
-00015b00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015b10: 2020 7372 632e 7772 6974 655f 7465 7874    src.write_text
-00015b20: 2822 7072 696e 7428 2768 656c 6c6f 2729  ("print('hello')
-00015b30: 222c 2065 6e63 6f64 696e 673d 2275 7466  ", encoding="utf
-00015b40: 2d38 2229 0a20 2020 2020 2020 2020 2020  -8").           
-00015b50: 2077 6974 6820 7061 7463 6828 0a20 2020   with patch(.   
-00015b60: 2020 2020 2020 2020 2020 2020 2022 626c               "bl
-00015b70: 6163 6b2e 636f 6e63 7572 7265 6e63 792e  ack.concurrency.
-00015b80: 4d61 6e61 6765 7222 2c20 7772 6170 733d  Manager", wraps=
-00015b90: 6d75 6c74 6970 726f 6365 7373 696e 672e  multiprocessing.
-00015ba0: 4d61 6e61 6765 720a 2020 2020 2020 2020  Manager.        
-00015bb0: 2020 2020 2920 6173 206d 6772 3a0a 2020      ) as mgr:.  
-00015bc0: 2020 2020 2020 2020 2020 2020 2020 636d                cm
-00015bd0: 6420 3d20 5b22 2d2d 6469 6666 222c 2073  d = ["--diff", s
-00015be0: 7472 2877 6f72 6b73 7061 6365 295d 0a20  tr(workspace)]. 
-00015bf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015c00: 6620 636f 6c6f 723a 0a20 2020 2020 2020  f color:.       
-00015c10: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-00015c20: 2e61 7070 656e 6428 222d 2d63 6f6c 6f72  .append("--color
-00015c30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00015c40: 2020 2069 6e76 6f6b 6542 6c61 636b 2863     invokeBlack(c
-00015c50: 6d64 2c20 6578 6974 5f63 6f64 653d 3029  md, exit_code=0)
-00015c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015c70: 2023 2074 6869 7320 6973 6e27 7420 7175   # this isn't qu
-00015c80: 6974 6520 646f 696e 6720 7768 6174 2077  ite doing what w
-00015c90: 6520 7761 6e74 2c20 6275 7420 6966 2069  e want, but if i
-00015ca0: 7420 5f69 736e 2774 5f0a 2020 2020 2020  t _isn't_.      
-00015cb0: 2020 2020 2020 2020 2020 2320 6361 6c6c            # call
-00015cc0: 6564 2074 6865 6e20 7765 2063 616e 6e6f  ed then we canno
-00015cd0: 7420 6265 2075 7369 6e67 2074 6865 206c  t be using the l
-00015ce0: 6f63 6b20 6974 2070 726f 7669 6465 730a  ock it provides.
-00015cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d00: 6d67 722e 6173 7365 7274 5f63 616c 6c65  mgr.assert_calle
-00015d10: 6428 290a 0a20 2020 2064 6566 2074 6573  d()..    def tes
-00015d20: 745f 6e6f 5f63 6163 6865 5f77 6865 6e5f  t_no_cache_when_
-00015d30: 7374 6469 6e28 7365 6c66 2920 2d3e 204e  stdin(self) -> N
-00015d40: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
-00015d50: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
-00015d60: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
-00015d70: 6368 655f 6469 7228 293a 0a20 2020 2020  che_dir():.     
-00015d80: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00015d90: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
-00015da0: 6b65 280a 2020 2020 2020 2020 2020 2020  ke(.            
-00015db0: 2020 2020 626c 6163 6b2e 6d61 696e 2c20      black.main, 
-00015dc0: 5b22 2d22 5d2c 2069 6e70 7574 3d42 7974  ["-"], input=Byt
-00015dd0: 6573 494f 2862 2270 7269 6e74 2827 6865  esIO(b"print('he
-00015de0: 6c6c 6f27 2922 290a 2020 2020 2020 2020  llo')").        
-00015df0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00015e00: 2020 6173 7365 7274 206e 6f74 2072 6573    assert not res
-00015e10: 756c 742e 6578 6974 5f63 6f64 650a 2020  ult.exit_code.  
-00015e20: 2020 2020 2020 2020 2020 6361 6368 655f            cache_
-00015e30: 6669 6c65 203d 2067 6574 5f63 6163 6865  file = get_cache
-00015e40: 5f66 696c 6528 6d6f 6465 290a 2020 2020  _file(mode).    
-00015e50: 2020 2020 2020 2020 6173 7365 7274 206e          assert n
-00015e60: 6f74 2063 6163 6865 5f66 696c 652e 6578  ot cache_file.ex
-00015e70: 6973 7473 2829 0a0a 2020 2020 6465 6620  ists()..    def 
-00015e80: 7465 7374 5f72 6561 645f 6361 6368 655f  test_read_cache_
-00015e90: 6e6f 5f63 6163 6865 6669 6c65 2873 656c  no_cachefile(sel
-00015ea0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00015eb0: 2020 2020 6d6f 6465 203d 2044 4546 4155      mode = DEFAU
-00015ec0: 4c54 5f4d 4f44 450a 2020 2020 2020 2020  LT_MODE.        
-00015ed0: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
-00015ee0: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
-00015ef0: 7365 7274 2062 6c61 636b 2e43 6163 6865  sert black.Cache
-00015f00: 2e72 6561 6428 6d6f 6465 292e 6669 6c65  .read(mode).file
-00015f10: 5f64 6174 6120 3d3d 207b 7d0a 0a20 2020  _data == {}..   
-00015f20: 2064 6566 2074 6573 745f 7772 6974 655f   def test_write_
-00015f30: 6361 6368 655f 7265 6164 5f63 6163 6865  cache_read_cache
-00015f40: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00015f50: 2020 2020 2020 2020 6d6f 6465 203d 2044          mode = D
-00015f60: 4546 4155 4c54 5f4d 4f44 450a 2020 2020  EFAULT_MODE.    
-00015f70: 2020 2020 7769 7468 2063 6163 6865 5f64      with cache_d
-00015f80: 6972 2829 2061 7320 776f 726b 7370 6163  ir() as workspac
-00015f90: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00015fa0: 7263 203d 2028 776f 726b 7370 6163 6520  rc = (workspace 
-00015fb0: 2f20 2274 6573 742e 7079 2229 2e72 6573  / "test.py").res
-00015fc0: 6f6c 7665 2829 0a20 2020 2020 2020 2020  olve().         
-00015fd0: 2020 2073 7263 2e74 6f75 6368 2829 0a20     src.touch(). 
-00015fe0: 2020 2020 2020 2020 2020 2077 7269 7465             write
-00015ff0: 5f63 6163 6865 203d 2062 6c61 636b 2e43  _cache = black.C
-00016000: 6163 6865 2e72 6561 6428 6d6f 6465 290a  ache.read(mode).
-00016010: 2020 2020 2020 2020 2020 2020 7772 6974              writ
-00016020: 655f 6361 6368 652e 7772 6974 6528 5b73  e_cache.write([s
-00016030: 7263 5d29 0a20 2020 2020 2020 2020 2020  rc]).           
-00016040: 2072 6561 645f 6361 6368 6520 3d20 626c   read_cache = bl
-00016050: 6163 6b2e 4361 6368 652e 7265 6164 286d  ack.Cache.read(m
-00016060: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
-00016070: 2061 7373 6572 7420 6e6f 7420 7265 6164   assert not read
-00016080: 5f63 6163 6865 2e69 735f 6368 616e 6765  _cache.is_change
-00016090: 6428 7372 6329 0a0a 2020 2020 4070 7974  d(src)..    @pyt
-000160a0: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
-000160b0: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
-000160c0: 0a20 2020 2064 6566 2074 6573 745f 6669  .    def test_fi
-000160d0: 6c74 6572 5f63 6163 6865 6428 7365 6c66  lter_cached(self
-000160e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000160f0: 2020 2077 6974 6820 5465 6d70 6f72 6172     with Temporar
-00016100: 7944 6972 6563 746f 7279 2829 2061 7320  yDirectory() as 
-00016110: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
-00016120: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
-00016130: 7468 2877 6f72 6b73 7061 6365 290a 2020  th(workspace).  
-00016140: 2020 2020 2020 2020 2020 756e 6361 6368            uncach
-00016150: 6564 203d 2028 7061 7468 202f 2022 756e  ed = (path / "un
-00016160: 6361 6368 6564 2229 2e72 6573 6f6c 7665  cached").resolve
-00016170: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
-00016180: 6163 6865 6420 3d20 2870 6174 6820 2f20  ached = (path / 
-00016190: 2263 6163 6865 6422 292e 7265 736f 6c76  "cached").resolv
-000161a0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-000161b0: 6361 6368 6564 5f62 7574 5f63 6861 6e67  cached_but_chang
-000161c0: 6564 203d 2028 7061 7468 202f 2022 6368  ed = (path / "ch
-000161d0: 616e 6765 6422 292e 7265 736f 6c76 6528  anged").resolve(
-000161e0: 290a 2020 2020 2020 2020 2020 2020 756e  ).            un
-000161f0: 6361 6368 6564 2e74 6f75 6368 2829 0a20  cached.touch(). 
-00016200: 2020 2020 2020 2020 2020 2063 6163 6865             cache
-00016210: 642e 746f 7563 6828 290a 2020 2020 2020  d.touch().      
-00016220: 2020 2020 2020 6361 6368 6564 5f62 7574        cached_but
-00016230: 5f63 6861 6e67 6564 2e74 6f75 6368 2829  _changed.touch()
-00016240: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
-00016250: 6865 203d 2062 6c61 636b 2e43 6163 6865  he = black.Cache
-00016260: 2e72 6561 6428 4445 4641 554c 545f 4d4f  .read(DEFAULT_MO
-00016270: 4445 290a 0a20 2020 2020 2020 2020 2020  DE)..           
-00016280: 206f 7269 675f 6675 6e63 203d 2062 6c61   orig_func = bla
-00016290: 636b 2e43 6163 6865 2e67 6574 5f66 696c  ck.Cache.get_fil
-000162a0: 655f 6461 7461 0a0a 2020 2020 2020 2020  e_data..        
-000162b0: 2020 2020 6465 6620 7772 6170 7065 645f      def wrapped_
-000162c0: 6675 6e63 2870 6174 683a 2050 6174 6829  func(path: Path)
-000162d0: 202d 3e20 4669 6c65 4461 7461 3a0a 2020   -> FileData:.  
-000162e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000162f0: 2070 6174 6820 3d3d 2063 6163 6865 643a   path == cached:
-00016300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016310: 2020 2020 2072 6574 7572 6e20 6f72 6967       return orig
-00016320: 5f66 756e 6328 7061 7468 290a 2020 2020  _func(path).    
-00016330: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00016340: 6174 6820 3d3d 2063 6163 6865 645f 6275  ath == cached_bu
-00016350: 745f 6368 616e 6765 643a 0a20 2020 2020  t_changed:.     
-00016360: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00016370: 6574 7572 6e20 4669 6c65 4461 7461 2830  eturn FileData(0
-00016380: 2e30 2c20 302c 2022 2229 0a20 2020 2020  .0, 0, "").     
-00016390: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000163a0: 2041 7373 6572 7469 6f6e 4572 726f 720a   AssertionError.
-000163b0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-000163c0: 6820 7061 7463 682e 6f62 6a65 6374 2862  h patch.object(b
-000163d0: 6c61 636b 2e43 6163 6865 2c20 2267 6574  lack.Cache, "get
-000163e0: 5f66 696c 655f 6461 7461 222c 2073 6964  _file_data", sid
-000163f0: 655f 6566 6665 6374 3d77 7261 7070 6564  e_effect=wrapped
-00016400: 5f66 756e 6329 3a0a 2020 2020 2020 2020  _func):.        
-00016410: 2020 2020 2020 2020 6361 6368 652e 7772          cache.wr
-00016420: 6974 6528 5b63 6163 6865 642c 2063 6163  ite([cached, cac
-00016430: 6865 645f 6275 745f 6368 616e 6765 645d  hed_but_changed]
-00016440: 290a 2020 2020 2020 2020 2020 2020 746f  ).            to
-00016450: 646f 2c20 646f 6e65 203d 2063 6163 6865  do, done = cache
-00016460: 2e66 696c 7465 7265 645f 6361 6368 6564  .filtered_cached
-00016470: 287b 756e 6361 6368 6564 2c20 6361 6368  ({uncached, cach
-00016480: 6564 2c20 6361 6368 6564 5f62 7574 5f63  ed, cached_but_c
-00016490: 6861 6e67 6564 7d29 0a20 2020 2020 2020  hanged}).       
-000164a0: 2020 2020 2061 7373 6572 7420 746f 646f       assert todo
-000164b0: 203d 3d20 7b75 6e63 6163 6865 642c 2063   == {uncached, c
-000164c0: 6163 6865 645f 6275 745f 6368 616e 6765  ached_but_change
-000164d0: 647d 0a20 2020 2020 2020 2020 2020 2061  d}.            a
-000164e0: 7373 6572 7420 646f 6e65 203d 3d20 7b63  ssert done == {c
-000164f0: 6163 6865 647d 0a0a 2020 2020 6465 6620  ached}..    def 
-00016500: 7465 7374 5f66 696c 7465 725f 6361 6368  test_filter_cach
-00016510: 6564 5f68 6173 6828 7365 6c66 2920 2d3e  ed_hash(self) ->
-00016520: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
-00016530: 6974 6820 5465 6d70 6f72 6172 7944 6972  ith TemporaryDir
-00016540: 6563 746f 7279 2829 2061 7320 776f 726b  ectory() as work
-00016550: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
-00016560: 2020 2070 6174 6820 3d20 5061 7468 2877     path = Path(w
-00016570: 6f72 6b73 7061 6365 290a 2020 2020 2020  orkspace).      
-00016580: 2020 2020 2020 7372 6320 3d20 2870 6174        src = (pat
-00016590: 6820 2f20 2274 6573 742e 7079 2229 2e72  h / "test.py").r
-000165a0: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
-000165b0: 2020 2020 2073 7263 2e77 7269 7465 5f74       src.write_t
-000165c0: 6578 7428 2270 7269 6e74 2827 6865 6c6c  ext("print('hell
-000165d0: 6f27 2922 2c20 656e 636f 6469 6e67 3d22  o')", encoding="
-000165e0: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
-000165f0: 2020 2020 7374 203d 2073 7263 2e73 7461      st = src.sta
-00016600: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00016610: 6361 6368 6520 3d20 626c 6163 6b2e 4361  cache = black.Ca
-00016620: 6368 652e 7265 6164 2844 4546 4155 4c54  che.read(DEFAULT
-00016630: 5f4d 4f44 4529 0a20 2020 2020 2020 2020  _MODE).         
-00016640: 2020 2063 6163 6865 2e77 7269 7465 285b     cache.write([
-00016650: 7372 635d 290a 2020 2020 2020 2020 2020  src]).          
-00016660: 2020 6361 6368 6564 5f66 696c 655f 6461    cached_file_da
-00016670: 7461 203d 2063 6163 6865 2e66 696c 655f  ta = cache.file_
-00016680: 6461 7461 5b73 7472 2873 7263 295d 0a0a  data[str(src)]..
-00016690: 2020 2020 2020 2020 2020 2020 746f 646f              todo
-000166a0: 2c20 646f 6e65 203d 2063 6163 6865 2e66  , done = cache.f
-000166b0: 696c 7465 7265 645f 6361 6368 6564 285b  iltered_cached([
-000166c0: 7372 635d 290a 2020 2020 2020 2020 2020  src]).          
-000166d0: 2020 6173 7365 7274 2074 6f64 6f20 3d3d    assert todo ==
-000166e0: 2073 6574 2829 0a20 2020 2020 2020 2020   set().         
-000166f0: 2020 2061 7373 6572 7420 646f 6e65 203d     assert done =
-00016700: 3d20 7b73 7263 7d0a 2020 2020 2020 2020  = {src}.        
-00016710: 2020 2020 6173 7365 7274 2063 6163 6865      assert cache
-00016720: 645f 6669 6c65 5f64 6174 612e 7374 5f6d  d_file_data.st_m
-00016730: 7469 6d65 203d 3d20 7374 2e73 745f 6d74  time == st.st_mt
-00016740: 696d 650a 0a20 2020 2020 2020 2020 2020  ime..           
-00016750: 2023 204d 6f64 6966 7920 7374 5f6d 7469   # Modify st_mti
-00016760: 6d65 0a20 2020 2020 2020 2020 2020 2063  me.            c
-00016770: 6163 6865 645f 6669 6c65 5f64 6174 6120  ached_file_data 
-00016780: 3d20 6361 6368 652e 6669 6c65 5f64 6174  = cache.file_dat
-00016790: 615b 7374 7228 7372 6329 5d20 3d20 4669  a[str(src)] = Fi
-000167a0: 6c65 4461 7461 280a 2020 2020 2020 2020  leData(.        
-000167b0: 2020 2020 2020 2020 6361 6368 6564 5f66          cached_f
-000167c0: 696c 655f 6461 7461 2e73 745f 6d74 696d  ile_data.st_mtim
-000167d0: 6520 2d20 312c 0a20 2020 2020 2020 2020  e - 1,.         
-000167e0: 2020 2020 2020 2063 6163 6865 645f 6669         cached_fi
-000167f0: 6c65 5f64 6174 612e 7374 5f73 697a 652c  le_data.st_size,
-00016800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016810: 2063 6163 6865 645f 6669 6c65 5f64 6174   cached_file_dat
-00016820: 612e 6861 7368 2c0a 2020 2020 2020 2020  a.hash,.        
-00016830: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00016840: 2020 746f 646f 2c20 646f 6e65 203d 2063    todo, done = c
-00016850: 6163 6865 2e66 696c 7465 7265 645f 6361  ache.filtered_ca
-00016860: 6368 6564 285b 7372 635d 290a 2020 2020  ched([src]).    
-00016870: 2020 2020 2020 2020 6173 7365 7274 2074          assert t
-00016880: 6f64 6f20 3d3d 2073 6574 2829 0a20 2020  odo == set().   
-00016890: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-000168a0: 646f 6e65 203d 3d20 7b73 7263 7d0a 2020  done == {src}.  
-000168b0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-000168c0: 2063 6163 6865 645f 6669 6c65 5f64 6174   cached_file_dat
-000168d0: 612e 7374 5f6d 7469 6d65 203c 2073 742e  a.st_mtime < st.
-000168e0: 7374 5f6d 7469 6d65 0a20 2020 2020 2020  st_mtime.       
-000168f0: 2020 2020 2061 7373 6572 7420 6361 6368       assert cach
-00016900: 6564 5f66 696c 655f 6461 7461 2e73 745f  ed_file_data.st_
-00016910: 7369 7a65 203d 3d20 7374 2e73 745f 7369  size == st.st_si
-00016920: 7a65 0a20 2020 2020 2020 2020 2020 2061  ze.            a
-00016930: 7373 6572 7420 6361 6368 6564 5f66 696c  ssert cached_fil
-00016940: 655f 6461 7461 2e68 6173 6820 3d3d 2062  e_data.hash == b
-00016950: 6c61 636b 2e43 6163 6865 2e68 6173 685f  lack.Cache.hash_
-00016960: 6469 6765 7374 2873 7263 290a 0a20 2020  digest(src)..   
-00016970: 2020 2020 2020 2020 2023 204d 6f64 6966           # Modif
-00016980: 7920 636f 6e74 656e 7473 0a20 2020 2020  y contents.     
-00016990: 2020 2020 2020 2073 7263 2e77 7269 7465         src.write
-000169a0: 5f74 6578 7428 2270 7269 6e74 2827 6865  _text("print('he
-000169b0: 6c6c 6f20 776f 726c 6427 2922 2c20 656e  llo world')", en
-000169c0: 636f 6469 6e67 3d22 7574 662d 3822 290a  coding="utf-8").
-000169d0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-000169e0: 7374 203d 2073 7263 2e73 7461 7428 290a  st = src.stat().
-000169f0: 2020 2020 2020 2020 2020 2020 746f 646f              todo
-00016a00: 2c20 646f 6e65 203d 2063 6163 6865 2e66  , done = cache.f
-00016a10: 696c 7465 7265 645f 6361 6368 6564 285b  iltered_cached([
-00016a20: 7372 635d 290a 2020 2020 2020 2020 2020  src]).          
-00016a30: 2020 6173 7365 7274 2074 6f64 6f20 3d3d    assert todo ==
-00016a40: 207b 7372 637d 0a20 2020 2020 2020 2020   {src}.         
-00016a50: 2020 2061 7373 6572 7420 646f 6e65 203d     assert done =
-00016a60: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
-00016a70: 2020 2020 6173 7365 7274 2063 6163 6865      assert cache
-00016a80: 645f 6669 6c65 5f64 6174 612e 7374 5f6d  d_file_data.st_m
-00016a90: 7469 6d65 203c 206e 6577 5f73 742e 7374  time < new_st.st
-00016aa0: 5f6d 7469 6d65 0a20 2020 2020 2020 2020  _mtime.         
-00016ab0: 2020 2061 7373 6572 7420 6361 6368 6564     assert cached
-00016ac0: 5f66 696c 655f 6461 7461 2e73 745f 7369  _file_data.st_si
-00016ad0: 7a65 2021 3d20 6e65 775f 7374 2e73 745f  ze != new_st.st_
-00016ae0: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
-00016af0: 2061 7373 6572 7420 6361 6368 6564 5f66   assert cached_f
-00016b00: 696c 655f 6461 7461 2e68 6173 6820 213d  ile_data.hash !=
-00016b10: 2062 6c61 636b 2e43 6163 6865 2e68 6173   black.Cache.has
-00016b20: 685f 6469 6765 7374 2873 7263 290a 0a20  h_digest(src).. 
-00016b30: 2020 2064 6566 2074 6573 745f 7772 6974     def test_writ
-00016b40: 655f 6361 6368 655f 6372 6561 7465 735f  e_cache_creates_
-00016b50: 6469 7265 6374 6f72 795f 6966 5f6e 6565  directory_if_nee
-00016b60: 6465 6428 7365 6c66 2920 2d3e 204e 6f6e  ded(self) -> Non
-00016b70: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
-00016b80: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
-00016b90: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
-00016ba0: 655f 6469 7228 6578 6973 7473 3d46 616c  e_dir(exists=Fal
-00016bb0: 7365 2920 6173 2077 6f72 6b73 7061 6365  se) as workspace
-00016bc0: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
-00016bd0: 7365 7274 206e 6f74 2077 6f72 6b73 7061  sert not workspa
-00016be0: 6365 2e65 7869 7374 7328 290a 2020 2020  ce.exists().    
-00016bf0: 2020 2020 2020 2020 6361 6368 6520 3d20          cache = 
-00016c00: 626c 6163 6b2e 4361 6368 652e 7265 6164  black.Cache.read
-00016c10: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
-00016c20: 2020 2063 6163 6865 2e77 7269 7465 285b     cache.write([
-00016c30: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-00016c40: 7373 6572 7420 776f 726b 7370 6163 652e  ssert workspace.
-00016c50: 6578 6973 7473 2829 0a0a 2020 2020 4065  exists()..    @e
-00016c60: 7665 6e74 5f6c 6f6f 7028 290a 2020 2020  vent_loop().    
-00016c70: 6465 6620 7465 7374 5f66 6169 6c65 645f  def test_failed_
-00016c80: 666f 726d 6174 7469 6e67 5f64 6f65 735f  formatting_does_
-00016c90: 6e6f 745f 6765 745f 6361 6368 6564 2873  not_get_cached(s
-00016ca0: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00016cb0: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
-00016cc0: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
-00016cd0: 2020 7769 7468 2063 6163 6865 5f64 6972    with cache_dir
-00016ce0: 2829 2061 7320 776f 726b 7370 6163 652c  () as workspace,
-00016cf0: 2070 6174 6368 280a 2020 2020 2020 2020   patch(.        
-00016d00: 2020 2020 2263 6f6e 6375 7272 656e 742e      "concurrent.
-00016d10: 6675 7475 7265 732e 5072 6f63 6573 7350  futures.ProcessP
-00016d20: 6f6f 6c45 7865 6375 746f 7222 2c20 6e65  oolExecutor", ne
-00016d30: 773d 5468 7265 6164 506f 6f6c 4578 6563  w=ThreadPoolExec
-00016d40: 7574 6f72 0a20 2020 2020 2020 2029 3a0a  utor.        ):.
-00016d50: 2020 2020 2020 2020 2020 2020 6661 696c              fail
-00016d60: 696e 6720 3d20 2877 6f72 6b73 7061 6365  ing = (workspace
-00016d70: 202f 2022 6661 696c 696e 672e 7079 2229   / "failing.py")
-00016d80: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
-00016d90: 2020 2020 2020 2066 6169 6c69 6e67 2e77         failing.w
-00016da0: 7269 7465 5f74 6578 7428 226e 6f74 2061  rite_text("not a
-00016db0: 6374 7561 6c6c 7920 7079 7468 6f6e 222c  ctually python",
-00016dc0: 2065 6e63 6f64 696e 673d 2275 7466 2d38   encoding="utf-8
-00016dd0: 2229 0a20 2020 2020 2020 2020 2020 2063  ").            c
-00016de0: 6c65 616e 203d 2028 776f 726b 7370 6163  lean = (workspac
-00016df0: 6520 2f20 2263 6c65 616e 2e70 7922 292e  e / "clean.py").
-00016e00: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
-00016e10: 2020 2020 2020 636c 6561 6e2e 7772 6974        clean.writ
-00016e20: 655f 7465 7874 2827 7072 696e 7428 2268  e_text('print("h
-00016e30: 656c 6c6f 2229 5c6e 272c 2065 6e63 6f64  ello")\n', encod
-00016e40: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
-00016e50: 2020 2020 2020 2020 2069 6e76 6f6b 6542           invokeB
-00016e60: 6c61 636b 285b 7374 7228 776f 726b 7370  lack([str(worksp
-00016e70: 6163 6529 5d2c 2065 7869 745f 636f 6465  ace)], exit_code
-00016e80: 3d31 3233 290a 2020 2020 2020 2020 2020  =123).          
-00016e90: 2020 6361 6368 6520 3d20 626c 6163 6b2e    cache = black.
-00016ea0: 4361 6368 652e 7265 6164 286d 6f64 6529  Cache.read(mode)
-00016eb0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00016ec0: 6572 7420 6361 6368 652e 6973 5f63 6861  ert cache.is_cha
-00016ed0: 6e67 6564 2866 6169 6c69 6e67 290a 2020  nged(failing).  
-00016ee0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00016ef0: 206e 6f74 2063 6163 6865 2e69 735f 6368   not cache.is_ch
-00016f00: 616e 6765 6428 636c 6561 6e29 0a0a 2020  anged(clean)..  
-00016f10: 2020 6465 6620 7465 7374 5f77 7269 7465    def test_write
-00016f20: 5f63 6163 6865 5f77 7269 7465 5f66 6169  _cache_write_fai
-00016f30: 6c28 7365 6c66 2920 2d3e 204e 6f6e 653a  l(self) -> None:
-00016f40: 0a20 2020 2020 2020 206d 6f64 6520 3d20  .        mode = 
-00016f50: 4445 4641 554c 545f 4d4f 4445 0a20 2020  DEFAULT_MODE.   
-00016f60: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-00016f70: 6469 7228 293a 0a20 2020 2020 2020 2020  dir():.         
-00016f80: 2020 2063 6163 6865 203d 2062 6c61 636b     cache = black
-00016f90: 2e43 6163 6865 2e72 6561 6428 6d6f 6465  .Cache.read(mode
-00016fa0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-00016fb0: 7468 2070 6174 6368 2e6f 626a 6563 7428  th patch.object(
-00016fc0: 5061 7468 2c20 226f 7065 6e22 2920 6173  Path, "open") as
-00016fd0: 206d 6f63 6b3a 0a20 2020 2020 2020 2020   mock:.         
-00016fe0: 2020 2020 2020 206d 6f63 6b2e 7369 6465         mock.side
-00016ff0: 5f65 6666 6563 7420 3d20 4f53 4572 726f  _effect = OSErro
-00017000: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-00017010: 2020 6361 6368 652e 7772 6974 6528 5b5d    cache.write([]
-00017020: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00017030: 7265 6164 5f63 6163 6865 5f6c 696e 655f  read_cache_line_
-00017040: 6c65 6e67 7468 7328 7365 6c66 2920 2d3e  lengths(self) ->
-00017050: 204e 6f6e 653a 0a20 2020 2020 2020 206d   None:.        m
-00017060: 6f64 6520 3d20 4445 4641 554c 545f 4d4f  ode = DEFAULT_MO
-00017070: 4445 0a20 2020 2020 2020 2073 686f 7274  DE.        short
-00017080: 5f6d 6f64 6520 3d20 7265 706c 6163 6528  _mode = replace(
-00017090: 4445 4641 554c 545f 4d4f 4445 2c20 6c69  DEFAULT_MODE, li
-000170a0: 6e65 5f6c 656e 6774 683d 3129 0a20 2020  ne_length=1).   
-000170b0: 2020 2020 2077 6974 6820 6361 6368 655f       with cache_
-000170c0: 6469 7228 2920 6173 2077 6f72 6b73 7061  dir() as workspa
-000170d0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-000170e0: 7061 7468 203d 2028 776f 726b 7370 6163  path = (workspac
-000170f0: 6520 2f20 2266 696c 652e 7079 2229 2e72  e / "file.py").r
-00017100: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
-00017110: 2020 2020 2070 6174 682e 746f 7563 6828       path.touch(
-00017120: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
-00017130: 6368 6520 3d20 626c 6163 6b2e 4361 6368  che = black.Cach
-00017140: 652e 7265 6164 286d 6f64 6529 0a20 2020  e.read(mode).   
-00017150: 2020 2020 2020 2020 2063 6163 6865 2e77           cache.w
-00017160: 7269 7465 285b 7061 7468 5d29 0a20 2020  rite([path]).   
-00017170: 2020 2020 2020 2020 206f 6e65 203d 2062           one = b
-00017180: 6c61 636b 2e43 6163 6865 2e72 6561 6428  lack.Cache.read(
-00017190: 6d6f 6465 290a 2020 2020 2020 2020 2020  mode).          
-000171a0: 2020 6173 7365 7274 206e 6f74 206f 6e65    assert not one
-000171b0: 2e69 735f 6368 616e 6765 6428 7061 7468  .is_changed(path
-000171c0: 290a 2020 2020 2020 2020 2020 2020 7477  ).            tw
-000171d0: 6f20 3d20 626c 6163 6b2e 4361 6368 652e  o = black.Cache.
-000171e0: 7265 6164 2873 686f 7274 5f6d 6f64 6529  read(short_mode)
-000171f0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00017200: 6572 7420 7477 6f2e 6973 5f63 6861 6e67  ert two.is_chang
-00017210: 6564 2870 6174 6829 0a0a 0a64 6566 2061  ed(path)...def a
-00017220: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
-00017230: 736f 7572 6365 7328 0a20 2020 2073 7263  sources(.    src
-00017240: 3a20 5365 7175 656e 6365 5b55 6e69 6f6e  : Sequence[Union
-00017250: 5b73 7472 2c20 5061 7468 5d5d 2c0a 2020  [str, Path]],.  
-00017260: 2020 6578 7065 6374 6564 3a20 5365 7175    expected: Sequ
-00017270: 656e 6365 5b55 6e69 6f6e 5b73 7472 2c20  ence[Union[str, 
-00017280: 5061 7468 5d5d 2c0a 2020 2020 2a2c 0a20  Path]],.    *,. 
-00017290: 2020 2072 6f6f 743a 204f 7074 696f 6e61     root: Optiona
-000172a0: 6c5b 5061 7468 5d20 3d20 4e6f 6e65 2c0a  l[Path] = None,.
-000172b0: 2020 2020 6578 636c 7564 653a 204f 7074      exclude: Opt
-000172c0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-000172d0: 652c 0a20 2020 2069 6e63 6c75 6465 3a20  e,.    include: 
-000172e0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-000172f0: 4e6f 6e65 2c0a 2020 2020 6578 7465 6e64  None,.    extend
-00017300: 5f65 7863 6c75 6465 3a20 4f70 7469 6f6e  _exclude: Option
-00017310: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-00017320: 2020 2020 666f 7263 655f 6578 636c 7564      force_exclud
-00017330: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
-00017340: 203d 204e 6f6e 652c 0a20 2020 2073 7464   = None,.    std
-00017350: 696e 5f66 696c 656e 616d 653a 204f 7074  in_filename: Opt
-00017360: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-00017370: 652c 0a29 202d 3e20 4e6f 6e65 3a0a 2020  e,.) -> None:.  
-00017380: 2020 6773 5f73 7263 203d 2074 7570 6c65    gs_src = tuple
-00017390: 2873 7472 2850 6174 6828 7329 2920 666f  (str(Path(s)) fo
-000173a0: 7220 7320 696e 2073 7263 290a 2020 2020  r s in src).    
-000173b0: 6773 5f65 7870 6563 7465 6420 3d20 5b50  gs_expected = [P
-000173c0: 6174 6828 7329 2066 6f72 2073 2069 6e20  ath(s) for s in 
-000173d0: 6578 7065 6374 6564 5d0a 2020 2020 6773  expected].    gs
-000173e0: 5f65 7863 6c75 6465 203d 204e 6f6e 6520  _exclude = None 
-000173f0: 6966 2065 7863 6c75 6465 2069 7320 4e6f  if exclude is No
-00017400: 6e65 2065 6c73 6520 636f 6d70 696c 655f  ne else compile_
-00017410: 7061 7474 6572 6e28 6578 636c 7564 6529  pattern(exclude)
-00017420: 0a20 2020 2067 735f 696e 636c 7564 6520  .    gs_include 
-00017430: 3d20 4445 4641 554c 545f 494e 434c 5544  = DEFAULT_INCLUD
-00017440: 4520 6966 2069 6e63 6c75 6465 2069 7320  E if include is 
-00017450: 4e6f 6e65 2065 6c73 6520 636f 6d70 696c  None else compil
-00017460: 655f 7061 7474 6572 6e28 696e 636c 7564  e_pattern(includ
-00017470: 6529 0a20 2020 2067 735f 6578 7465 6e64  e).    gs_extend
-00017480: 5f65 7863 6c75 6465 203d 2028 0a20 2020  _exclude = (.   
-00017490: 2020 2020 204e 6f6e 6520 6966 2065 7874       None if ext
-000174a0: 656e 645f 6578 636c 7564 6520 6973 204e  end_exclude is N
-000174b0: 6f6e 6520 656c 7365 2063 6f6d 7069 6c65  one else compile
-000174c0: 5f70 6174 7465 726e 2865 7874 656e 645f  _pattern(extend_
-000174d0: 6578 636c 7564 6529 0a20 2020 2029 0a20  exclude).    ). 
-000174e0: 2020 2067 735f 666f 7263 655f 6578 636c     gs_force_excl
-000174f0: 7564 6520 3d20 4e6f 6e65 2069 6620 666f  ude = None if fo
-00017500: 7263 655f 6578 636c 7564 6520 6973 204e  rce_exclude is N
-00017510: 6f6e 6520 656c 7365 2063 6f6d 7069 6c65  one else compile
-00017520: 5f70 6174 7465 726e 2866 6f72 6365 5f65  _pattern(force_e
-00017530: 7863 6c75 6465 290a 2020 2020 636f 6c6c  xclude).    coll
-00017540: 6563 7465 6420 3d20 626c 6163 6b2e 6765  ected = black.ge
-00017550: 745f 736f 7572 6365 7328 0a20 2020 2020  t_sources(.     
-00017560: 2020 2072 6f6f 743d 726f 6f74 206f 7220     root=root or 
-00017570: 5448 4953 5f44 4952 2c0a 2020 2020 2020  THIS_DIR,.      
-00017580: 2020 7372 633d 6773 5f73 7263 2c0a 2020    src=gs_src,.  
-00017590: 2020 2020 2020 7175 6965 743d 4661 6c73        quiet=Fals
-000175a0: 652c 0a20 2020 2020 2020 2076 6572 626f  e,.        verbo
-000175b0: 7365 3d46 616c 7365 2c0a 2020 2020 2020  se=False,.      
-000175c0: 2020 696e 636c 7564 653d 6773 5f69 6e63    include=gs_inc
-000175d0: 6c75 6465 2c0a 2020 2020 2020 2020 6578  lude,.        ex
-000175e0: 636c 7564 653d 6773 5f65 7863 6c75 6465  clude=gs_exclude
-000175f0: 2c0a 2020 2020 2020 2020 6578 7465 6e64  ,.        extend
-00017600: 5f65 7863 6c75 6465 3d67 735f 6578 7465  _exclude=gs_exte
-00017610: 6e64 5f65 7863 6c75 6465 2c0a 2020 2020  nd_exclude,.    
-00017620: 2020 2020 666f 7263 655f 6578 636c 7564      force_exclud
-00017630: 653d 6773 5f66 6f72 6365 5f65 7863 6c75  e=gs_force_exclu
-00017640: 6465 2c0a 2020 2020 2020 2020 7265 706f  de,.        repo
-00017650: 7274 3d62 6c61 636b 2e52 6570 6f72 7428  rt=black.Report(
-00017660: 292c 0a20 2020 2020 2020 2073 7464 696e  ),.        stdin
-00017670: 5f66 696c 656e 616d 653d 7374 6469 6e5f  _filename=stdin_
-00017680: 6669 6c65 6e61 6d65 2c0a 2020 2020 290a  filename,.    ).
-00017690: 2020 2020 6173 7365 7274 2073 6f72 7465      assert sorte
-000176a0: 6428 636f 6c6c 6563 7465 6429 203d 3d20  d(collected) == 
-000176b0: 736f 7274 6564 2867 735f 6578 7065 6374  sorted(gs_expect
-000176c0: 6564 290a 0a0a 636c 6173 7320 5465 7374  ed)...class Test
-000176d0: 4669 6c65 436f 6c6c 6563 7469 6f6e 3a0a  FileCollection:.
-000176e0: 2020 2020 6465 6620 7465 7374 5f69 6e63      def test_inc
-000176f0: 6c75 6465 5f65 7863 6c75 6465 2873 656c  lude_exclude(sel
-00017700: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00017710: 2020 2020 7061 7468 203d 2054 4849 535f      path = THIS_
-00017720: 4449 5220 2f20 2264 6174 6122 202f 2022  DIR / "data" / "
-00017730: 696e 636c 7564 655f 6578 636c 7564 655f  include_exclude_
-00017740: 7465 7374 7322 0a20 2020 2020 2020 2073  tests".        s
-00017750: 7263 203d 205b 7061 7468 5d0a 2020 2020  rc = [path].    
-00017760: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
-00017770: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
-00017780: 6828 7061 7468 202f 2022 622f 646f 6e74  h(path / "b/dont
-00017790: 5f65 7863 6c75 6465 2f61 2e70 7922 292c  _exclude/a.py"),
-000177a0: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
-000177b0: 6828 7061 7468 202f 2022 622f 646f 6e74  h(path / "b/dont
-000177c0: 5f65 7863 6c75 6465 2f61 2e70 7969 2229  _exclude/a.pyi")
-000177d0: 2c0a 2020 2020 2020 2020 5d0a 2020 2020  ,.        ].    
-000177e0: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
-000177f0: 6374 6564 5f73 6f75 7263 6573 280a 2020  cted_sources(.  
-00017800: 2020 2020 2020 2020 2020 7372 632c 0a20            src,. 
-00017810: 2020 2020 2020 2020 2020 2065 7870 6563             expec
-00017820: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-00017830: 2069 6e63 6c75 6465 3d72 225c 2e70 7969   include=r"\.pyi
-00017840: 3f24 222c 0a20 2020 2020 2020 2020 2020  ?$",.           
-00017850: 2065 7863 6c75 6465 3d72 222f 6578 636c   exclude=r"/excl
-00017860: 7564 652f 7c2f 5c2e 6465 6669 6e69 7465  ude/|/\.definite
-00017870: 6c79 5f65 7863 6c75 6465 2f22 2c0a 2020  ly_exclude/",.  
-00017880: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-00017890: 2074 6573 745f 6769 7469 676e 6f72 655f   test_gitignore_
-000178a0: 7573 6564 5f61 735f 6465 6661 756c 7428  used_as_default(
-000178b0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000178c0: 2020 2020 2020 2062 6173 6520 3d20 5061         base = Pa
-000178d0: 7468 2844 4154 415f 4449 5220 2f20 2269  th(DATA_DIR / "i
-000178e0: 6e63 6c75 6465 5f65 7863 6c75 6465 5f74  nclude_exclude_t
-000178f0: 6573 7473 2229 0a20 2020 2020 2020 2065  ests").        e
-00017900: 7870 6563 7465 6420 3d20 5b0a 2020 2020  xpected = [.    
-00017910: 2020 2020 2020 2020 6261 7365 202f 2022          base / "
-00017920: 622f 2e64 6566 696e 6974 656c 795f 6578  b/.definitely_ex
-00017930: 636c 7564 652f 612e 7079 222c 0a20 2020  clude/a.py",.   
-00017940: 2020 2020 2020 2020 2062 6173 6520 2f20           base / 
-00017950: 2262 2f2e 6465 6669 6e69 7465 6c79 5f65  "b/.definitely_e
-00017960: 7863 6c75 6465 2f61 2e70 7969 222c 0a20  xclude/a.pyi",. 
-00017970: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00017980: 2073 7263 203d 205b 6261 7365 202f 2022   src = [base / "
-00017990: 622f 225d 0a20 2020 2020 2020 2061 7373  b/"].        ass
-000179a0: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-000179b0: 7572 6365 7328 7372 632c 2065 7870 6563  urces(src, expec
-000179c0: 7465 642c 2072 6f6f 743d 6261 7365 2c20  ted, root=base, 
-000179d0: 6578 7465 6e64 5f65 7863 6c75 6465 3d72  extend_exclude=r
-000179e0: 222f 6578 636c 7564 652f 2229 0a0a 2020  "/exclude/")..  
-000179f0: 2020 6465 6620 7465 7374 5f67 6974 6967    def test_gitig
-00017a00: 6e6f 7265 5f75 7365 645f 6f6e 5f6d 756c  nore_used_on_mul
-00017a10: 7469 706c 655f 736f 7572 6365 7328 7365  tiple_sources(se
-00017a20: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00017a30: 2020 2020 2072 6f6f 7420 3d20 5061 7468       root = Path
-00017a40: 2844 4154 415f 4449 5220 2f20 2267 6974  (DATA_DIR / "git
-00017a50: 6967 6e6f 7265 5f75 7365 645f 6f6e 5f6d  ignore_used_on_m
-00017a60: 756c 7469 706c 655f 736f 7572 6365 7322  ultiple_sources"
-00017a70: 290a 2020 2020 2020 2020 6578 7065 6374  ).        expect
-00017a80: 6564 203d 205b 0a20 2020 2020 2020 2020  ed = [.         
-00017a90: 2020 2072 6f6f 7420 2f20 2264 6972 3122     root / "dir1"
-00017aa0: 202f 2022 622e 7079 222c 0a20 2020 2020   / "b.py",.     
-00017ab0: 2020 2020 2020 2072 6f6f 7420 2f20 2264         root / "d
-00017ac0: 6972 3222 202f 2022 622e 7079 222c 0a20  ir2" / "b.py",. 
-00017ad0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00017ae0: 2073 7263 203d 205b 726f 6f74 202f 2022   src = [root / "
-00017af0: 6469 7231 222c 2072 6f6f 7420 2f20 2264  dir1", root / "d
-00017b00: 6972 3222 5d0a 2020 2020 2020 2020 6173  ir2"].        as
-00017b10: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
-00017b20: 6f75 7263 6573 2873 7263 2c20 6578 7065  ources(src, expe
-00017b30: 6374 6564 2c20 726f 6f74 3d72 6f6f 7429  cted, root=root)
-00017b40: 0a0a 2020 2020 4070 6174 6368 2822 626c  ..    @patch("bl
-00017b50: 6163 6b2e 6669 6e64 5f70 726f 6a65 6374  ack.find_project
-00017b60: 5f72 6f6f 7422 2c20 6c61 6d62 6461 202a  _root", lambda *
-00017b70: 6172 6773 3a20 2854 4849 535f 4449 522e  args: (THIS_DIR.
-00017b80: 7265 736f 6c76 6528 292c 204e 6f6e 6529  resolve(), None)
-00017b90: 290a 2020 2020 6465 6620 7465 7374 5f65  ).    def test_e
-00017ba0: 7863 6c75 6465 5f66 6f72 5f69 7373 7565  xclude_for_issue
-00017bb0: 5f31 3537 3228 7365 6c66 2920 2d3e 204e  _1572(self) -> N
-00017bc0: 6f6e 653a 0a20 2020 2020 2020 2023 2045  one:.        # E
-00017bd0: 7863 6c75 6465 2073 686f 756c 646e 2774  xclude shouldn't
-00017be0: 2074 6f75 6368 2066 696c 6573 2074 6861   touch files tha
-00017bf0: 7420 7765 7265 2065 7870 6c69 6369 746c  t were explicitl
-00017c00: 7920 6769 7665 6e20 746f 2042 6c61 636b  y given to Black
-00017c10: 2074 6872 6f75 6768 2074 6865 0a20 2020   through the.   
-00017c20: 2020 2020 2023 2043 4c49 2e20 4578 636c       # CLI. Excl
-00017c30: 7564 6520 6973 2073 7570 706f 7365 6420  ude is supposed 
-00017c40: 746f 206f 6e6c 7920 6170 706c 7920 746f  to only apply to
-00017c50: 2074 6865 2072 6563 7572 7369 7665 2064   the recursive d
-00017c60: 6973 636f 7665 7279 206f 6620 6669 6c65  iscovery of file
-00017c70: 732e 0a20 2020 2020 2020 2023 2068 7474  s..        # htt
-00017c80: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
-00017c90: 7073 662f 626c 6163 6b2f 6973 7375 6573  psf/black/issues
-00017ca0: 2f31 3537 320a 2020 2020 2020 2020 7061  /1572.        pa
-00017cb0: 7468 203d 2044 4154 415f 4449 5220 2f20  th = DATA_DIR / 
-00017cc0: 2269 6e63 6c75 6465 5f65 7863 6c75 6465  "include_exclude
-00017cd0: 5f74 6573 7473 220a 2020 2020 2020 2020  _tests".        
-00017ce0: 7372 6320 3d20 5b70 6174 6820 2f20 2262  src = [path / "b
-00017cf0: 2f65 7863 6c75 6465 2f61 2e70 7922 5d0a  /exclude/a.py"].
-00017d00: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-00017d10: 203d 205b 7061 7468 202f 2022 622f 6578   = [path / "b/ex
-00017d20: 636c 7564 652f 612e 7079 225d 0a20 2020  clude/a.py"].   
-00017d30: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
-00017d40: 6563 7465 645f 736f 7572 6365 7328 7372  ected_sources(sr
-00017d50: 632c 2065 7870 6563 7465 642c 2069 6e63  c, expected, inc
-00017d60: 6c75 6465 3d22 222c 2065 7863 6c75 6465  lude="", exclude
-00017d70: 3d72 222f 6578 636c 7564 652f 7c61 5c2e  =r"/exclude/|a\.
-00017d80: 7079 2229 0a0a 2020 2020 6465 6620 7465  py")..    def te
-00017d90: 7374 5f67 6974 6967 6e6f 7265 5f65 7863  st_gitignore_exc
-00017da0: 6c75 6465 2873 656c 6629 202d 3e20 4e6f  lude(self) -> No
-00017db0: 6e65 3a0a 2020 2020 2020 2020 7061 7468  ne:.        path
-00017dc0: 203d 2054 4849 535f 4449 5220 2f20 2264   = THIS_DIR / "d
-00017dd0: 6174 6122 202f 2022 696e 636c 7564 655f  ata" / "include_
-00017de0: 6578 636c 7564 655f 7465 7374 7322 0a20  exclude_tests". 
-00017df0: 2020 2020 2020 2069 6e63 6c75 6465 203d         include =
-00017e00: 2072 652e 636f 6d70 696c 6528 7222 5c2e   re.compile(r"\.
-00017e10: 7079 693f 2422 290a 2020 2020 2020 2020  pyi?$").        
-00017e20: 6578 636c 7564 6520 3d20 7265 2e63 6f6d  exclude = re.com
-00017e30: 7069 6c65 2872 2222 290a 2020 2020 2020  pile(r"").      
-00017e40: 2020 7265 706f 7274 203d 2062 6c61 636b    report = black
-00017e50: 2e52 6570 6f72 7428 290a 2020 2020 2020  .Report().      
-00017e60: 2020 6769 7469 676e 6f72 6520 3d20 5061    gitignore = Pa
-00017e70: 7468 5370 6563 2e66 726f 6d5f 6c69 6e65  thSpec.from_line
-00017e80: 7328 0a20 2020 2020 2020 2020 2020 2022  s(.            "
-00017e90: 6769 7477 696c 646d 6174 6368 222c 205b  gitwildmatch", [
-00017ea0: 2265 7863 6c75 6465 2f22 2c20 222e 6465  "exclude/", ".de
-00017eb0: 6669 6e69 7465 6c79 5f65 7863 6c75 6465  finitely_exclude
-00017ec0: 225d 0a20 2020 2020 2020 2029 0a20 2020  "].        ).   
-00017ed0: 2020 2020 2073 6f75 7263 6573 3a20 4c69       sources: Li
-00017ee0: 7374 5b50 6174 685d 203d 205b 5d0a 2020  st[Path] = [].  
-00017ef0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-00017f00: 205b 0a20 2020 2020 2020 2020 2020 2050   [.            P
-00017f10: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
-00017f20: 6e74 5f65 7863 6c75 6465 2f61 2e70 7922  nt_exclude/a.py"
-00017f30: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
-00017f40: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
-00017f50: 6e74 5f65 7863 6c75 6465 2f61 2e70 7969  nt_exclude/a.pyi
-00017f60: 2229 2c0a 2020 2020 2020 2020 5d0a 2020  "),.        ].  
-00017f70: 2020 2020 2020 7468 6973 5f61 6273 203d        this_abs =
-00017f80: 2054 4849 535f 4449 522e 7265 736f 6c76   THIS_DIR.resolv
-00017f90: 6528 290a 2020 2020 2020 2020 736f 7572  e().        sour
-00017fa0: 6365 732e 6578 7465 6e64 280a 2020 2020  ces.extend(.    
-00017fb0: 2020 2020 2020 2020 626c 6163 6b2e 6765          black.ge
-00017fc0: 6e5f 7079 7468 6f6e 5f66 696c 6573 280a  n_python_files(.
-00017fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fe0: 7061 7468 2e69 7465 7264 6972 2829 2c0a  path.iterdir(),.
-00017ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018000: 7468 6973 5f61 6273 2c0a 2020 2020 2020  this_abs,.      
-00018010: 2020 2020 2020 2020 2020 696e 636c 7564            includ
-00018020: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00018030: 2020 2065 7863 6c75 6465 2c0a 2020 2020     exclude,.    
-00018040: 2020 2020 2020 2020 2020 2020 4e6f 6e65              None
-00018050: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018060: 2020 4e6f 6e65 2c0a 2020 2020 2020 2020    None,.        
-00018070: 2020 2020 2020 2020 7265 706f 7274 2c0a          report,.
-00018080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018090: 7b70 6174 683a 2067 6974 6967 6e6f 7265  {path: gitignore
-000180a0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-000180b0: 2020 2076 6572 626f 7365 3d46 616c 7365     verbose=False
-000180c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000180d0: 2020 7175 6965 743d 4661 6c73 652c 0a20    quiet=False,. 
-000180e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000180f0: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
-00018100: 7373 6572 7420 736f 7274 6564 2865 7870  ssert sorted(exp
-00018110: 6563 7465 6429 203d 3d20 736f 7274 6564  ected) == sorted
-00018120: 2873 6f75 7263 6573 290a 0a20 2020 2064  (sources)..    d
-00018130: 6566 2074 6573 745f 6e65 7374 6564 5f67  ef test_nested_g
-00018140: 6974 6967 6e6f 7265 2873 656c 6629 202d  itignore(self) -
-00018150: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00018160: 7061 7468 203d 2050 6174 6828 5448 4953  path = Path(THIS
-00018170: 5f44 4952 202f 2022 6461 7461 2220 2f20  _DIR / "data" / 
-00018180: 226e 6573 7465 645f 6769 7469 676e 6f72  "nested_gitignor
-00018190: 655f 7465 7374 7322 290a 2020 2020 2020  e_tests").      
-000181a0: 2020 696e 636c 7564 6520 3d20 7265 2e63    include = re.c
-000181b0: 6f6d 7069 6c65 2872 225c 2e70 7969 3f24  ompile(r"\.pyi?$
-000181c0: 2229 0a20 2020 2020 2020 2065 7863 6c75  ").        exclu
-000181d0: 6465 203d 2072 652e 636f 6d70 696c 6528  de = re.compile(
-000181e0: 7222 2229 0a20 2020 2020 2020 2072 6f6f  r"").        roo
-000181f0: 745f 6769 7469 676e 6f72 6520 3d20 626c  t_gitignore = bl
-00018200: 6163 6b2e 6669 6c65 732e 6765 745f 6769  ack.files.get_gi
-00018210: 7469 676e 6f72 6528 7061 7468 290a 2020  tignore(path).  
-00018220: 2020 2020 2020 7265 706f 7274 203d 2062        report = b
-00018230: 6c61 636b 2e52 6570 6f72 7428 290a 2020  lack.Report().  
-00018240: 2020 2020 2020 6578 7065 6374 6564 3a20        expected: 
-00018250: 4c69 7374 5b50 6174 685d 203d 205b 0a20  List[Path] = [. 
-00018260: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-00018270: 7061 7468 202f 2022 782e 7079 2229 2c0a  path / "x.py"),.
-00018280: 2020 2020 2020 2020 2020 2020 5061 7468              Path
-00018290: 2870 6174 6820 2f20 2272 6f6f 742f 622e  (path / "root/b.
-000182a0: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
-000182b0: 2020 5061 7468 2870 6174 6820 2f20 2272    Path(path / "r
-000182c0: 6f6f 742f 632e 7079 2229 2c0a 2020 2020  oot/c.py"),.    
-000182d0: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
-000182e0: 6820 2f20 2272 6f6f 742f 6368 696c 642f  h / "root/child/
-000182f0: 632e 7079 2229 2c0a 2020 2020 2020 2020  c.py"),.        
-00018300: 5d0a 2020 2020 2020 2020 7468 6973 5f61  ].        this_a
-00018310: 6273 203d 2054 4849 535f 4449 522e 7265  bs = THIS_DIR.re
-00018320: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
-00018330: 736f 7572 6365 7320 3d20 6c69 7374 280a  sources = list(.
-00018340: 2020 2020 2020 2020 2020 2020 626c 6163              blac
-00018350: 6b2e 6765 6e5f 7079 7468 6f6e 5f66 696c  k.gen_python_fil
-00018360: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
-00018370: 2020 2020 7061 7468 2e69 7465 7264 6972      path.iterdir
-00018380: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-00018390: 2020 2020 7468 6973 5f61 6273 2c0a 2020      this_abs,.  
-000183a0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-000183b0: 636c 7564 652c 0a20 2020 2020 2020 2020  clude,.         
-000183c0: 2020 2020 2020 2065 7863 6c75 6465 2c0a         exclude,.
-000183d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-000183f0: 2020 2020 2020 4e6f 6e65 2c0a 2020 2020        None,.    
-00018400: 2020 2020 2020 2020 2020 2020 7265 706f              repo
-00018410: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-00018420: 2020 2020 7b70 6174 683a 2072 6f6f 745f      {path: root_
-00018430: 6769 7469 676e 6f72 657d 2c0a 2020 2020  gitignore},.    
-00018440: 2020 2020 2020 2020 2020 2020 7665 7262              verb
-00018450: 6f73 653d 4661 6c73 652c 0a20 2020 2020  ose=False,.     
-00018460: 2020 2020 2020 2020 2020 2071 7569 6574             quiet
-00018470: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00018480: 2020 2020 290a 2020 2020 2020 2020 290a      ).        ).
-00018490: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
-000184a0: 6f72 7465 6428 6578 7065 6374 6564 2920  orted(expected) 
-000184b0: 3d3d 2073 6f72 7465 6428 736f 7572 6365  == sorted(source
-000184c0: 7329 0a0a 2020 2020 6465 6620 7465 7374  s)..    def test
-000184d0: 5f6e 6573 7465 645f 6769 7469 676e 6f72  _nested_gitignor
-000184e0: 655f 6469 7265 6374 6c79 5f69 6e5f 736f  e_directly_in_so
-000184f0: 7572 6365 5f64 6972 6563 746f 7279 2873  urce_directory(s
-00018500: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00018510: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
-00018520: 6769 7468 7562 2e63 6f6d 2f70 7366 2f62  github.com/psf/b
-00018530: 6c61 636b 2f69 7373 7565 732f 3235 3938  lack/issues/2598
-00018540: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-00018550: 5061 7468 2844 4154 415f 4449 5220 2f20  Path(DATA_DIR / 
-00018560: 226e 6573 7465 645f 6769 7469 676e 6f72  "nested_gitignor
-00018570: 655f 7465 7374 7322 290a 2020 2020 2020  e_tests").      
-00018580: 2020 7372 6320 3d20 5061 7468 2870 6174    src = Path(pat
-00018590: 6820 2f20 2272 6f6f 7422 202f 2022 6368  h / "root" / "ch
-000185a0: 696c 6422 290a 2020 2020 2020 2020 6578  ild").        ex
-000185b0: 7065 6374 6564 203d 205b 7372 6320 2f20  pected = [src / 
-000185c0: 2261 2e70 7922 2c20 7372 6320 2f20 2263  "a.py", src / "c
-000185d0: 2e70 7922 5d0a 2020 2020 2020 2020 6173  .py"].        as
-000185e0: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
-000185f0: 6f75 7263 6573 285b 7372 635d 2c20 6578  ources([src], ex
-00018600: 7065 6374 6564 290a 0a20 2020 2064 6566  pected)..    def
-00018610: 2074 6573 745f 696e 7661 6c69 645f 6769   test_invalid_gi
-00018620: 7469 676e 6f72 6528 7365 6c66 2920 2d3e  tignore(self) ->
-00018630: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
-00018640: 6174 6820 3d20 5448 4953 5f44 4952 202f  ath = THIS_DIR /
-00018650: 2022 6461 7461 2220 2f20 2269 6e76 616c   "data" / "inval
-00018660: 6964 5f67 6974 6967 6e6f 7265 5f74 6573  id_gitignore_tes
-00018670: 7473 220a 2020 2020 2020 2020 656d 7074  ts".        empt
-00018680: 795f 636f 6e66 6967 203d 2070 6174 6820  y_config = path 
-00018690: 2f20 2270 7970 726f 6a65 6374 2e74 6f6d  / "pyproject.tom
-000186a0: 6c22 0a20 2020 2020 2020 2072 6573 756c  l".        resul
-000186b0: 7420 3d20 426c 6163 6b52 756e 6e65 7228  t = BlackRunner(
-000186c0: 292e 696e 766f 6b65 280a 2020 2020 2020  ).invoke(.      
-000186d0: 2020 2020 2020 626c 6163 6b2e 6d61 696e        black.main
-000186e0: 2c20 5b22 2d2d 7665 7262 6f73 6522 2c20  , ["--verbose", 
-000186f0: 222d 2d63 6f6e 6669 6722 2c20 7374 7228  "--config", str(
-00018700: 656d 7074 795f 636f 6e66 6967 292c 2073  empty_config), s
-00018710: 7472 2870 6174 6829 5d0a 2020 2020 2020  tr(path)].      
-00018720: 2020 290a 2020 2020 2020 2020 6173 7365    ).        asse
-00018730: 7274 2072 6573 756c 742e 6578 6974 5f63  rt result.exit_c
-00018740: 6f64 6520 3d3d 2031 0a20 2020 2020 2020  ode == 1.       
-00018750: 2061 7373 6572 7420 7265 7375 6c74 2e73   assert result.s
-00018760: 7464 6572 725f 6279 7465 7320 6973 206e  tderr_bytes is n
-00018770: 6f74 204e 6f6e 650a 0a20 2020 2020 2020  ot None..       
-00018780: 2067 6974 6967 6e6f 7265 203d 2070 6174   gitignore = pat
-00018790: 6820 2f20 222e 6769 7469 676e 6f72 6522  h / ".gitignore"
-000187a0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-000187b0: 7265 2e73 6561 7263 6828 0a20 2020 2020  re.search(.     
-000187c0: 2020 2020 2020 2066 2243 6f75 6c64 206e         f"Could n
-000187d0: 6f74 2070 6172 7365 207b 6769 7469 676e  ot parse {gitign
-000187e0: 6f72 657d 222e 7265 706c 6163 6528 225c  ore}".replace("\
-000187f0: 5c22 2c20 225c 5c5c 5c22 292c 0a20 2020  \", "\\\\"),.   
-00018800: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-00018810: 7374 6465 7272 5f62 7974 6573 2e64 6563  stderr_bytes.dec
-00018820: 6f64 6528 292c 0a20 2020 2020 2020 2020  ode(),.         
-00018830: 2020 2072 652e 4947 4e4f 5245 4341 5345     re.IGNORECASE
-00018840: 2069 6620 6973 696e 7374 616e 6365 2867   if isinstance(g
-00018850: 6974 6967 6e6f 7265 2c20 5769 6e64 6f77  itignore, Window
-00018860: 7350 6174 6829 2065 6c73 6520 302c 0a20  sPath) else 0,. 
-00018870: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00018880: 6620 7465 7374 5f69 6e76 616c 6964 5f6e  f test_invalid_n
-00018890: 6573 7465 645f 6769 7469 676e 6f72 6528  ested_gitignore(
-000188a0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000188b0: 2020 2020 2020 2070 6174 6820 3d20 5448         path = TH
-000188c0: 4953 5f44 4952 202f 2022 6461 7461 2220  IS_DIR / "data" 
-000188d0: 2f20 2269 6e76 616c 6964 5f6e 6573 7465  / "invalid_neste
-000188e0: 645f 6769 7469 676e 6f72 655f 7465 7374  d_gitignore_test
-000188f0: 7322 0a20 2020 2020 2020 2065 6d70 7479  s".        empty
-00018900: 5f63 6f6e 6669 6720 3d20 7061 7468 202f  _config = path /
-00018910: 2022 7079 7072 6f6a 6563 742e 746f 6d6c   "pyproject.toml
-00018920: 220a 2020 2020 2020 2020 7265 7375 6c74  ".        result
-00018930: 203d 2042 6c61 636b 5275 6e6e 6572 2829   = BlackRunner()
-00018940: 2e69 6e76 6f6b 6528 0a20 2020 2020 2020  .invoke(.       
-00018950: 2020 2020 2062 6c61 636b 2e6d 6169 6e2c       black.main,
-00018960: 205b 222d 2d76 6572 626f 7365 222c 2022   ["--verbose", "
-00018970: 2d2d 636f 6e66 6967 222c 2073 7472 2865  --config", str(e
-00018980: 6d70 7479 5f63 6f6e 6669 6729 2c20 7374  mpty_config), st
-00018990: 7228 7061 7468 295d 0a20 2020 2020 2020  r(path)].       
-000189a0: 2029 0a20 2020 2020 2020 2061 7373 6572   ).        asser
-000189b0: 7420 7265 7375 6c74 2e65 7869 745f 636f  t result.exit_co
-000189c0: 6465 203d 3d20 310a 2020 2020 2020 2020  de == 1.        
-000189d0: 6173 7365 7274 2072 6573 756c 742e 7374  assert result.st
-000189e0: 6465 7272 5f62 7974 6573 2069 7320 6e6f  derr_bytes is no
-000189f0: 7420 4e6f 6e65 0a0a 2020 2020 2020 2020  t None..        
-00018a00: 6769 7469 676e 6f72 6520 3d20 7061 7468  gitignore = path
-00018a10: 202f 2022 6122 202f 2022 2e67 6974 6967   / "a" / ".gitig
-00018a20: 6e6f 7265 220a 2020 2020 2020 2020 6173  nore".        as
-00018a30: 7365 7274 2072 652e 7365 6172 6368 280a  sert re.search(.
-00018a40: 2020 2020 2020 2020 2020 2020 6622 436f              f"Co
-00018a50: 756c 6420 6e6f 7420 7061 7273 6520 7b67  uld not parse {g
-00018a60: 6974 6967 6e6f 7265 7d22 2e72 6570 6c61  itignore}".repla
-00018a70: 6365 2822 5c5c 222c 2022 5c5c 5c5c 2229  ce("\\", "\\\\")
-00018a80: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
-00018a90: 7375 6c74 2e73 7464 6572 725f 6279 7465  sult.stderr_byte
-00018aa0: 732e 6465 636f 6465 2829 2c0a 2020 2020  s.decode(),.    
-00018ab0: 2020 2020 2020 2020 7265 2e49 474e 4f52          re.IGNOR
-00018ac0: 4543 4153 4520 6966 2069 7369 6e73 7461  ECASE if isinsta
-00018ad0: 6e63 6528 6769 7469 676e 6f72 652c 2057  nce(gitignore, W
-00018ae0: 696e 646f 7773 5061 7468 2920 656c 7365  indowsPath) else
-00018af0: 2030 2c0a 2020 2020 2020 2020 290a 0a20   0,.        ).. 
-00018b00: 2020 2064 6566 2074 6573 745f 6769 7469     def test_giti
-00018b10: 676e 6f72 655f 7468 6174 5f69 676e 6f72  gnore_that_ignor
-00018b20: 6573 5f73 7562 666f 6c64 6572 7328 7365  es_subfolders(se
-00018b30: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00018b40: 2020 2020 2023 2049 6620 6769 7469 676e       # If gitign
-00018b50: 6f72 6520 7769 7468 202a 2f2a 2069 7320  ore with */* is 
-00018b60: 696e 2072 6f6f 740a 2020 2020 2020 2020  in root.        
-00018b70: 726f 6f74 203d 2050 6174 6828 4441 5441  root = Path(DATA
-00018b80: 5f44 4952 202f 2022 6967 6e6f 7265 5f73  _DIR / "ignore_s
-00018b90: 7562 666f 6c64 6572 735f 6769 7469 676e  ubfolders_gitign
-00018ba0: 6f72 655f 7465 7374 7322 202f 2022 7375  ore_tests" / "su
-00018bb0: 6264 6972 2229 0a20 2020 2020 2020 2065  bdir").        e
-00018bc0: 7870 6563 7465 6420 3d20 5b72 6f6f 7420  xpected = [root 
-00018bd0: 2f20 2262 2e70 7922 5d0a 2020 2020 2020  / "b.py"].      
-00018be0: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
-00018bf0: 6564 5f73 6f75 7263 6573 285b 726f 6f74  ed_sources([root
-00018c00: 5d2c 2065 7870 6563 7465 642c 2072 6f6f  ], expected, roo
-00018c10: 743d 726f 6f74 290a 0a20 2020 2020 2020  t=root)..       
-00018c20: 2023 2049 6620 2e67 6974 6967 6e6f 7265   # If .gitignore
-00018c30: 2077 6974 6820 2a2f 2a20 6973 206e 6573   with */* is nes
-00018c40: 7465 640a 2020 2020 2020 2020 726f 6f74  ted.        root
-00018c50: 203d 2050 6174 6828 4441 5441 5f44 4952   = Path(DATA_DIR
-00018c60: 202f 2022 6967 6e6f 7265 5f73 7562 666f   / "ignore_subfo
-00018c70: 6c64 6572 735f 6769 7469 676e 6f72 655f  lders_gitignore_
-00018c80: 7465 7374 7322 290a 2020 2020 2020 2020  tests").        
-00018c90: 6578 7065 6374 6564 203d 205b 0a20 2020  expected = [.   
-00018ca0: 2020 2020 2020 2020 2072 6f6f 7420 2f20           root / 
-00018cb0: 2261 2e70 7922 2c0a 2020 2020 2020 2020  "a.py",.        
-00018cc0: 2020 2020 726f 6f74 202f 2022 7375 6264      root / "subd
-00018cd0: 6972 2220 2f20 2262 2e70 7922 2c0a 2020  ir" / "b.py",.  
-00018ce0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00018cf0: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
-00018d00: 5f73 6f75 7263 6573 285b 726f 6f74 5d2c  _sources([root],
-00018d10: 2065 7870 6563 7465 642c 2072 6f6f 743d   expected, root=
-00018d20: 726f 6f74 290a 0a20 2020 2020 2020 2023  root)..        #
-00018d30: 2049 6620 636f 6d6d 616e 6420 6973 2065   If command is e
-00018d40: 7865 6375 7465 6420 6672 6f6d 206f 7574  xecuted from out
-00018d50: 6572 2064 6972 0a20 2020 2020 2020 2072  er dir.        r
-00018d60: 6f6f 7420 3d20 5061 7468 2844 4154 415f  oot = Path(DATA_
-00018d70: 4449 5220 2f20 2269 676e 6f72 655f 7375  DIR / "ignore_su
-00018d80: 6266 6f6c 6465 7273 5f67 6974 6967 6e6f  bfolders_gitigno
-00018d90: 7265 5f74 6573 7473 2229 0a20 2020 2020  re_tests").     
-00018da0: 2020 2074 6172 6765 7420 3d20 726f 6f74     target = root
-00018db0: 202f 2022 7375 6264 6972 220a 2020 2020   / "subdir".    
-00018dc0: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
-00018dd0: 7461 7267 6574 202f 2022 622e 7079 225d  target / "b.py"]
-00018de0: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
-00018df0: 636f 6c6c 6563 7465 645f 736f 7572 6365  collected_source
-00018e00: 7328 5b74 6172 6765 745d 2c20 6578 7065  s([target], expe
-00018e10: 6374 6564 2c20 726f 6f74 3d72 6f6f 7429  cted, root=root)
-00018e20: 0a0a 2020 2020 6465 6620 7465 7374 5f65  ..    def test_e
-00018e30: 6d70 7479 5f69 6e63 6c75 6465 2873 656c  mpty_include(sel
-00018e40: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00018e50: 2020 2020 7061 7468 203d 2044 4154 415f      path = DATA_
-00018e60: 4449 5220 2f20 2269 6e63 6c75 6465 5f65  DIR / "include_e
-00018e70: 7863 6c75 6465 5f74 6573 7473 220a 2020  xclude_tests".  
-00018e80: 2020 2020 2020 7372 6320 3d20 5b70 6174        src = [pat
-00018e90: 685d 0a20 2020 2020 2020 2065 7870 6563  h].        expec
-00018ea0: 7465 6420 3d20 5b0a 2020 2020 2020 2020  ted = [.        
-00018eb0: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
-00018ec0: 2262 2f65 7863 6c75 6465 2f61 2e70 6965  "b/exclude/a.pie
-00018ed0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00018ee0: 5061 7468 2870 6174 6820 2f20 2262 2f65  Path(path / "b/e
-00018ef0: 7863 6c75 6465 2f61 2e70 7922 292c 0a20  xclude/a.py"),. 
-00018f00: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
-00018f10: 7061 7468 202f 2022 622f 6578 636c 7564  path / "b/exclud
-00018f20: 652f 612e 7079 6922 292c 0a20 2020 2020  e/a.pyi"),.     
-00018f30: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
-00018f40: 202f 2022 622f 646f 6e74 5f65 7863 6c75   / "b/dont_exclu
-00018f50: 6465 2f61 2e70 6965 2229 2c0a 2020 2020  de/a.pie"),.    
-00018f60: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
-00018f70: 6820 2f20 2262 2f64 6f6e 745f 6578 636c  h / "b/dont_excl
-00018f80: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
-00018f90: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
-00018fa0: 6820 2f20 2262 2f64 6f6e 745f 6578 636c  h / "b/dont_excl
-00018fb0: 7564 652f 612e 7079 6922 292c 0a20 2020  ude/a.pyi"),.   
-00018fc0: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
-00018fd0: 7468 202f 2022 622f 2e64 6566 696e 6974  th / "b/.definit
-00018fe0: 656c 795f 6578 636c 7564 652f 612e 7069  ely_exclude/a.pi
-00018ff0: 6522 292c 0a20 2020 2020 2020 2020 2020  e"),.           
-00019000: 2050 6174 6828 7061 7468 202f 2022 622f   Path(path / "b/
-00019010: 2e64 6566 696e 6974 656c 795f 6578 636c  .definitely_excl
-00019020: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
-00019030: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
-00019040: 6820 2f20 2262 2f2e 6465 6669 6e69 7465  h / "b/.definite
-00019050: 6c79 5f65 7863 6c75 6465 2f61 2e70 7969  ly_exclude/a.pyi
-00019060: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00019070: 5061 7468 2870 6174 6820 2f20 222e 6769  Path(path / ".gi
-00019080: 7469 676e 6f72 6522 292c 0a20 2020 2020  tignore"),.     
-00019090: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
-000190a0: 202f 2022 7079 7072 6f6a 6563 742e 746f   / "pyproject.to
-000190b0: 6d6c 2229 2c0a 2020 2020 2020 2020 5d0a  ml"),.        ].
-000190c0: 2020 2020 2020 2020 2320 5365 7474 696e          # Settin
-000190d0: 6720 6578 636c 7564 6520 6578 706c 6963  g exclude explic
-000190e0: 6974 6c79 2074 6f20 616e 2065 6d70 7479  itly to an empty
-000190f0: 2073 7472 696e 6720 746f 2062 6c6f 636b   string to block
-00019100: 202e 6769 7469 676e 6f72 6520 7573 6167   .gitignore usag
-00019110: 652e 0a20 2020 2020 2020 2061 7373 6572  e..        asser
-00019120: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
-00019130: 6365 7328 7372 632c 2065 7870 6563 7465  ces(src, expecte
-00019140: 642c 2069 6e63 6c75 6465 3d22 222c 2065  d, include="", e
-00019150: 7863 6c75 6465 3d22 2229 0a0a 2020 2020  xclude="")..    
-00019160: 6465 6620 7465 7374 5f69 6e63 6c75 6465  def test_include
-00019170: 5f61 6273 6f6c 7574 655f 7061 7468 2873  _absolute_path(s
-00019180: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00019190: 2020 2020 2020 7061 7468 203d 2044 4154        path = DAT
-000191a0: 415f 4449 5220 2f20 2269 6e63 6c75 6465  A_DIR / "include
-000191b0: 5f65 7863 6c75 6465 5f74 6573 7473 220a  _exclude_tests".
-000191c0: 2020 2020 2020 2020 7372 6320 3d20 5b70          src = [p
-000191d0: 6174 685d 0a20 2020 2020 2020 2065 7870  ath].        exp
-000191e0: 6563 7465 6420 3d20 5b0a 2020 2020 2020  ected = [.      
-000191f0: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
-00019200: 2f20 2262 2f64 6f6e 745f 6578 636c 7564  / "b/dont_exclud
-00019210: 652f 612e 7069 6522 292c 0a20 2020 2020  e/a.pie"),.     
-00019220: 2020 205d 0a20 2020 2020 2020 2061 7373     ].        ass
-00019230: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-00019240: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
-00019250: 2020 2073 7263 2c20 6578 7065 6374 6564     src, expected
-00019260: 2c20 726f 6f74 3d70 6174 682c 2069 6e63  , root=path, inc
-00019270: 6c75 6465 3d72 225e 2f62 2f64 6f6e 745f  lude=r"^/b/dont_
-00019280: 6578 636c 7564 652f 615c 2e70 6965 2422  exclude/a\.pie$"
-00019290: 2c20 6578 636c 7564 653d 2222 0a20 2020  , exclude="".   
-000192a0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-000192b0: 7465 7374 5f65 7863 6c75 6465 5f61 6273  test_exclude_abs
-000192c0: 6f6c 7574 655f 7061 7468 2873 656c 6629  olute_path(self)
-000192d0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000192e0: 2020 7061 7468 203d 2044 4154 415f 4449    path = DATA_DI
-000192f0: 5220 2f20 2269 6e63 6c75 6465 5f65 7863  R / "include_exc
-00019300: 6c75 6465 5f74 6573 7473 220a 2020 2020  lude_tests".    
-00019310: 2020 2020 7372 6320 3d20 5b70 6174 685d      src = [path]
-00019320: 0a20 2020 2020 2020 2065 7870 6563 7465  .        expecte
-00019330: 6420 3d20 5b0a 2020 2020 2020 2020 2020  d = [.          
-00019340: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
-00019350: 2f64 6f6e 745f 6578 636c 7564 652f 612e  /dont_exclude/a.
-00019360: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
-00019370: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
-00019380: 2f2e 6465 6669 6e69 7465 6c79 5f65 7863  /.definitely_exc
-00019390: 6c75 6465 2f61 2e70 7922 292c 0a20 2020  lude/a.py"),.   
-000193a0: 2020 2020 205d 0a20 2020 2020 2020 2061       ].        a
-000193b0: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
-000193c0: 736f 7572 6365 7328 0a20 2020 2020 2020  sources(.       
-000193d0: 2020 2020 2073 7263 2c20 6578 7065 6374       src, expect
-000193e0: 6564 2c20 726f 6f74 3d70 6174 682c 2069  ed, root=path, i
-000193f0: 6e63 6c75 6465 3d72 225c 2e70 7924 222c  nclude=r"\.py$",
-00019400: 2065 7863 6c75 6465 3d72 225e 2f62 2f65   exclude=r"^/b/e
-00019410: 7863 6c75 6465 2f61 5c2e 7079 2422 0a20  xclude/a\.py$". 
-00019420: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00019430: 6620 7465 7374 5f65 7874 656e 645f 6578  f test_extend_ex
-00019440: 636c 7564 6528 7365 6c66 2920 2d3e 204e  clude(self) -> N
-00019450: 6f6e 653a 0a20 2020 2020 2020 2070 6174  one:.        pat
-00019460: 6820 3d20 4441 5441 5f44 4952 202f 2022  h = DATA_DIR / "
-00019470: 696e 636c 7564 655f 6578 636c 7564 655f  include_exclude_
-00019480: 7465 7374 7322 0a20 2020 2020 2020 2073  tests".        s
-00019490: 7263 203d 205b 7061 7468 5d0a 2020 2020  rc = [path].    
-000194a0: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
-000194b0: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
-000194c0: 6828 7061 7468 202f 2022 622f 6578 636c  h(path / "b/excl
-000194d0: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
-000194e0: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
-000194f0: 6820 2f20 2262 2f64 6f6e 745f 6578 636c  h / "b/dont_excl
-00019500: 7564 652f 612e 7079 2229 2c0a 2020 2020  ude/a.py"),.    
-00019510: 2020 2020 5d0a 2020 2020 2020 2020 6173      ].        as
-00019520: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
-00019530: 6f75 7263 6573 280a 2020 2020 2020 2020  ources(.        
-00019540: 2020 2020 7372 632c 2065 7870 6563 7465      src, expecte
-00019550: 642c 2065 7863 6c75 6465 3d72 225c 2e70  d, exclude=r"\.p
-00019560: 7969 2422 2c20 6578 7465 6e64 5f65 7863  yi$", extend_exc
-00019570: 6c75 6465 3d72 225c 2e64 6566 696e 6974  lude=r"\.definit
-00019580: 656c 795f 6578 636c 7564 6522 0a20 2020  ely_exclude".   
-00019590: 2020 2020 2029 0a0a 2020 2020 4070 7974       )..    @pyt
-000195a0: 6573 742e 6d61 726b 2e69 6e63 6f6d 7061  est.mark.incompa
-000195b0: 7469 626c 655f 7769 7468 5f6d 7970 7963  tible_with_mypyc
-000195c0: 0a20 2020 2064 6566 2074 6573 745f 7379  .    def test_sy
-000195d0: 6d6c 696e 6b73 2873 656c 6629 202d 3e20  mlinks(self) -> 
-000195e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 726f  None:.        ro
-000195f0: 6f74 203d 2054 4849 535f 4449 522e 7265  ot = THIS_DIR.re
-00019600: 736f 6c76 6528 290a 2020 2020 2020 2020  solve().        
-00019610: 696e 636c 7564 6520 3d20 7265 2e63 6f6d  include = re.com
-00019620: 7069 6c65 2862 6c61 636b 2e44 4546 4155  pile(black.DEFAU
-00019630: 4c54 5f49 4e43 4c55 4445 5329 0a20 2020  LT_INCLUDES).   
-00019640: 2020 2020 2065 7863 6c75 6465 203d 2072       exclude = r
-00019650: 652e 636f 6d70 696c 6528 626c 6163 6b2e  e.compile(black.
-00019660: 4445 4641 554c 545f 4558 434c 5544 4553  DEFAULT_EXCLUDES
-00019670: 290a 2020 2020 2020 2020 7265 706f 7274  ).        report
-00019680: 203d 2062 6c61 636b 2e52 6570 6f72 7428   = black.Report(
-00019690: 290a 2020 2020 2020 2020 6769 7469 676e  ).        gitign
-000196a0: 6f72 6520 3d20 5061 7468 5370 6563 2e66  ore = PathSpec.f
-000196b0: 726f 6d5f 6c69 6e65 7328 2267 6974 7769  rom_lines("gitwi
-000196c0: 6c64 6d61 7463 6822 2c20 5b5d 290a 0a20  ldmatch", []).. 
-000196d0: 2020 2020 2020 2072 6567 756c 6172 203d         regular =
-000196e0: 204d 6167 6963 4d6f 636b 2829 0a20 2020   MagicMock().   
-000196f0: 2020 2020 2072 6567 756c 6172 2e72 656c       regular.rel
-00019700: 6174 6976 655f 746f 2e72 6574 7572 6e5f  ative_to.return_
-00019710: 7661 6c75 6520 3d20 5061 7468 2822 7265  value = Path("re
-00019720: 6775 6c61 722e 7079 2229 0a20 2020 2020  gular.py").     
-00019730: 2020 2072 6567 756c 6172 2e72 6573 6f6c     regular.resol
-00019740: 7665 2e72 6574 7572 6e5f 7661 6c75 6520  ve.return_value 
-00019750: 3d20 726f 6f74 202f 2022 7265 6775 6c61  = root / "regula
-00019760: 722e 7079 220a 2020 2020 2020 2020 7265  r.py".        re
-00019770: 6775 6c61 722e 6973 5f64 6972 2e72 6574  gular.is_dir.ret
-00019780: 7572 6e5f 7661 6c75 6520 3d20 4661 6c73  urn_value = Fals
-00019790: 650a 2020 2020 2020 2020 7265 6775 6c61  e.        regula
-000197a0: 722e 6973 5f66 696c 652e 7265 7475 726e  r.is_file.return
-000197b0: 5f76 616c 7565 203d 2054 7275 650a 0a20  _value = True.. 
-000197c0: 2020 2020 2020 206f 7574 7369 6465 5f72         outside_r
-000197d0: 6f6f 745f 7379 6d6c 696e 6b20 3d20 4d61  oot_symlink = Ma
-000197e0: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
-000197f0: 2020 6f75 7473 6964 655f 726f 6f74 5f73    outside_root_s
-00019800: 796d 6c69 6e6b 2e72 656c 6174 6976 655f  ymlink.relative_
-00019810: 746f 2e72 6574 7572 6e5f 7661 6c75 6520  to.return_value 
-00019820: 3d20 5061 7468 2822 7379 6d6c 696e 6b2e  = Path("symlink.
-00019830: 7079 2229 0a20 2020 2020 2020 206f 7574  py").        out
-00019840: 7369 6465 5f72 6f6f 745f 7379 6d6c 696e  side_root_symlin
-00019850: 6b2e 7265 736f 6c76 652e 7265 7475 726e  k.resolve.return
-00019860: 5f76 616c 7565 203d 2050 6174 6828 222f  _value = Path("/
-00019870: 6e6f 7768 6572 6522 290a 2020 2020 2020  nowhere").      
-00019880: 2020 6f75 7473 6964 655f 726f 6f74 5f73    outside_root_s
-00019890: 796d 6c69 6e6b 2e69 735f 6469 722e 7265  ymlink.is_dir.re
-000198a0: 7475 726e 5f76 616c 7565 203d 2046 616c  turn_value = Fal
-000198b0: 7365 0a20 2020 2020 2020 206f 7574 7369  se.        outsi
-000198c0: 6465 5f72 6f6f 745f 7379 6d6c 696e 6b2e  de_root_symlink.
-000198d0: 6973 5f66 696c 652e 7265 7475 726e 5f76  is_file.return_v
-000198e0: 616c 7565 203d 2054 7275 650a 0a20 2020  alue = True..   
-000198f0: 2020 2020 2069 676e 6f72 6564 5f73 796d       ignored_sym
-00019900: 6c69 6e6b 203d 204d 6167 6963 4d6f 636b  link = MagicMock
-00019910: 2829 0a20 2020 2020 2020 2069 676e 6f72  ().        ignor
-00019920: 6564 5f73 796d 6c69 6e6b 2e72 656c 6174  ed_symlink.relat
-00019930: 6976 655f 746f 2e72 6574 7572 6e5f 7661  ive_to.return_va
-00019940: 6c75 6520 3d20 5061 7468 2822 2e6d 7970  lue = Path(".myp
-00019950: 795f 6361 6368 6522 2920 2f20 2273 796d  y_cache") / "sym
-00019960: 6c69 6e6b 2e70 7922 0a20 2020 2020 2020  link.py".       
-00019970: 2069 676e 6f72 6564 5f73 796d 6c69 6e6b   ignored_symlink
-00019980: 2e69 735f 6469 722e 7265 7475 726e 5f76  .is_dir.return_v
-00019990: 616c 7565 203d 2046 616c 7365 0a20 2020  alue = False.   
-000199a0: 2020 2020 2069 676e 6f72 6564 5f73 796d       ignored_sym
-000199b0: 6c69 6e6b 2e69 735f 6669 6c65 2e72 6574  link.is_file.ret
-000199c0: 7572 6e5f 7661 6c75 6520 3d20 5472 7565  urn_value = True
-000199d0: 0a0a 2020 2020 2020 2020 2320 4120 7379  ..        # A sy
-000199e0: 6d6c 696e 6b20 7468 6174 2068 6173 2061  mlink that has a
-000199f0: 6e20 6578 636c 7564 6564 206e 616d 652c  n excluded name,
-00019a00: 2062 7574 2070 6f69 6e74 7320 746f 2061   but points to a
-00019a10: 6e20 696e 636c 7564 6564 206e 616d 650a  n included name.
-00019a20: 2020 2020 2020 2020 7379 6d6c 696e 6b5f          symlink_
-00019a30: 6578 636c 7564 6564 5f6e 616d 6520 3d20  excluded_name = 
-00019a40: 4d61 6769 634d 6f63 6b28 290a 2020 2020  MagicMock().    
-00019a50: 2020 2020 7379 6d6c 696e 6b5f 6578 636c      symlink_excl
-00019a60: 7564 6564 5f6e 616d 652e 7265 6c61 7469  uded_name.relati
-00019a70: 7665 5f74 6f2e 7265 7475 726e 5f76 616c  ve_to.return_val
-00019a80: 7565 203d 2050 6174 6828 2265 7863 6c75  ue = Path("exclu
-00019a90: 6465 645f 6e61 6d65 2229 0a20 2020 2020  ded_name").     
-00019aa0: 2020 2073 796d 6c69 6e6b 5f65 7863 6c75     symlink_exclu
-00019ab0: 6465 645f 6e61 6d65 2e72 6573 6f6c 7665  ded_name.resolve
-00019ac0: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-00019ad0: 726f 6f74 202f 2022 696e 636c 7564 6564  root / "included
-00019ae0: 5f6e 616d 652e 7079 220a 2020 2020 2020  _name.py".      
-00019af0: 2020 7379 6d6c 696e 6b5f 6578 636c 7564    symlink_exclud
-00019b00: 6564 5f6e 616d 652e 6973 5f64 6972 2e72  ed_name.is_dir.r
-00019b10: 6574 7572 6e5f 7661 6c75 6520 3d20 4661  eturn_value = Fa
-00019b20: 6c73 650a 2020 2020 2020 2020 7379 6d6c  lse.        syml
-00019b30: 696e 6b5f 6578 636c 7564 6564 5f6e 616d  ink_excluded_nam
-00019b40: 652e 6973 5f66 696c 652e 7265 7475 726e  e.is_file.return
-00019b50: 5f76 616c 7565 203d 2054 7275 650a 0a20  _value = True.. 
-00019b60: 2020 2020 2020 2023 2041 2073 796d 6c69         # A symli
-00019b70: 6e6b 2074 6861 7420 6861 7320 616e 2069  nk that has an i
-00019b80: 6e63 6c75 6465 6420 6e61 6d65 2c20 6275  ncluded name, bu
-00019b90: 7420 706f 696e 7473 2074 6f20 616e 2065  t points to an e
-00019ba0: 7863 6c75 6465 6420 6e61 6d65 0a20 2020  xcluded name.   
-00019bb0: 2020 2020 2073 796d 6c69 6e6b 5f69 6e63       symlink_inc
-00019bc0: 6c75 6465 645f 6e61 6d65 203d 204d 6167  luded_name = Mag
-00019bd0: 6963 4d6f 636b 2829 0a20 2020 2020 2020  icMock().       
-00019be0: 2073 796d 6c69 6e6b 5f69 6e63 6c75 6465   symlink_include
-00019bf0: 645f 6e61 6d65 2e72 656c 6174 6976 655f  d_name.relative_
-00019c00: 746f 2e72 6574 7572 6e5f 7661 6c75 6520  to.return_value 
-00019c10: 3d20 5061 7468 2822 696e 636c 7564 6564  = Path("included
-00019c20: 5f6e 616d 652e 7079 2229 0a20 2020 2020  _name.py").     
-00019c30: 2020 2073 796d 6c69 6e6b 5f69 6e63 6c75     symlink_inclu
-00019c40: 6465 645f 6e61 6d65 2e72 6573 6f6c 7665  ded_name.resolve
-00019c50: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
-00019c60: 726f 6f74 202f 2022 6578 636c 7564 6564  root / "excluded
-00019c70: 5f6e 616d 6522 0a20 2020 2020 2020 2073  _name".        s
-00019c80: 796d 6c69 6e6b 5f69 6e63 6c75 6465 645f  ymlink_included_
-00019c90: 6e61 6d65 2e69 735f 6469 722e 7265 7475  name.is_dir.retu
-00019ca0: 726e 5f76 616c 7565 203d 2046 616c 7365  rn_value = False
-00019cb0: 0a20 2020 2020 2020 2073 796d 6c69 6e6b  .        symlink
-00019cc0: 5f69 6e63 6c75 6465 645f 6e61 6d65 2e69  _included_name.i
-00019cd0: 735f 6669 6c65 2e72 6574 7572 6e5f 7661  s_file.return_va
-00019ce0: 6c75 6520 3d20 5472 7565 0a0a 2020 2020  lue = True..    
-00019cf0: 2020 2020 7061 7468 203d 204d 6167 6963      path = Magic
-00019d00: 4d6f 636b 2829 0a20 2020 2020 2020 2070  Mock().        p
-00019d10: 6174 682e 6974 6572 6469 722e 7265 7475  ath.iterdir.retu
-00019d20: 726e 5f76 616c 7565 203d 205b 0a20 2020  rn_value = [.   
-00019d30: 2020 2020 2020 2020 2072 6567 756c 6172           regular
-00019d40: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
-00019d50: 7473 6964 655f 726f 6f74 5f73 796d 6c69  tside_root_symli
-00019d60: 6e6b 2c0a 2020 2020 2020 2020 2020 2020  nk,.            
-00019d70: 6967 6e6f 7265 645f 7379 6d6c 696e 6b2c  ignored_symlink,
-00019d80: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
-00019d90: 6c69 6e6b 5f65 7863 6c75 6465 645f 6e61  link_excluded_na
-00019da0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00019db0: 7379 6d6c 696e 6b5f 696e 636c 7564 6564  symlink_included
-00019dc0: 5f6e 616d 652c 0a20 2020 2020 2020 205d  _name,.        ]
-00019dd0: 0a0a 2020 2020 2020 2020 6669 6c65 7320  ..        files 
-00019de0: 3d20 6c69 7374 280a 2020 2020 2020 2020  = list(.        
-00019df0: 2020 2020 626c 6163 6b2e 6765 6e5f 7079      black.gen_py
-00019e00: 7468 6f6e 5f66 696c 6573 280a 2020 2020  thon_files(.    
-00019e10: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00019e20: 2e69 7465 7264 6972 2829 2c0a 2020 2020  .iterdir(),.    
-00019e30: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-00019e40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019e50: 2020 696e 636c 7564 652c 0a20 2020 2020    include,.     
-00019e60: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
-00019e70: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
-00019e80: 2020 2020 4e6f 6e65 2c0a 2020 2020 2020      None,.      
-00019e90: 2020 2020 2020 2020 2020 4e6f 6e65 2c0a            None,.
-00019ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019eb0: 7265 706f 7274 2c0a 2020 2020 2020 2020  report,.        
-00019ec0: 2020 2020 2020 2020 7b70 6174 683a 2067          {path: g
-00019ed0: 6974 6967 6e6f 7265 7d2c 0a20 2020 2020  itignore},.     
-00019ee0: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
-00019ef0: 7365 3d46 616c 7365 2c0a 2020 2020 2020  se=False,.      
-00019f00: 2020 2020 2020 2020 2020 7175 6965 743d            quiet=
-00019f10: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-00019f20: 2020 2029 0a20 2020 2020 2020 2029 0a20     ).        ). 
-00019f30: 2020 2020 2020 2061 7373 6572 7420 6669         assert fi
-00019f40: 6c65 7320 3d3d 205b 7265 6775 6c61 722c  les == [regular,
-00019f50: 2073 796d 6c69 6e6b 5f69 6e63 6c75 6465   symlink_include
-00019f60: 645f 6e61 6d65 5d0a 0a20 2020 2020 2020  d_name]..       
-00019f70: 2070 6174 682e 6974 6572 6469 722e 6173   path.iterdir.as
-00019f80: 7365 7274 5f63 616c 6c65 645f 6f6e 6365  sert_called_once
-00019f90: 2829 0a20 2020 2020 2020 206f 7574 7369  ().        outsi
-00019fa0: 6465 5f72 6f6f 745f 7379 6d6c 696e 6b2e  de_root_symlink.
-00019fb0: 7265 736f 6c76 652e 6173 7365 7274 5f63  resolve.assert_c
-00019fc0: 616c 6c65 645f 6f6e 6365 2829 0a20 2020  alled_once().   
-00019fd0: 2020 2020 2069 676e 6f72 6564 5f73 796d       ignored_sym
-00019fe0: 6c69 6e6b 2e72 6573 6f6c 7665 2e61 7373  link.resolve.ass
-00019ff0: 6572 745f 6e6f 745f 6361 6c6c 6564 2829  ert_not_called()
-0001a000: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
-0001a010: 6574 5f73 6f75 7263 6573 5f73 796d 6c69  et_sources_symli
-0001a020: 6e6b 5f61 6e64 5f66 6f72 6365 5f65 7863  nk_and_force_exc
-0001a030: 6c75 6465 2873 656c 6629 202d 3e20 4e6f  lude(self) -> No
-0001a040: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
-0001a050: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
-0001a060: 6f72 7928 2920 6173 2074 656d 7064 6972  ory() as tempdir
-0001a070: 3a0a 2020 2020 2020 2020 2020 2020 746d  :.            tm
-0001a080: 7020 3d20 5061 7468 2874 656d 7064 6972  p = Path(tempdir
-0001a090: 292e 7265 736f 6c76 6528 290a 2020 2020  ).resolve().    
-0001a0a0: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
-0001a0b0: 2074 6d70 202f 2022 6163 7475 616c 220a   tmp / "actual".
-0001a0c0: 2020 2020 2020 2020 2020 2020 6163 7475              actu
-0001a0d0: 616c 2e6d 6b64 6972 2829 0a20 2020 2020  al.mkdir().     
-0001a0e0: 2020 2020 2020 2073 796d 6c69 6e6b 203d         symlink =
-0001a0f0: 2074 6d70 202f 2022 7379 6d6c 696e 6b22   tmp / "symlink"
-0001a100: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
-0001a110: 6c69 6e6b 2e73 796d 6c69 6e6b 5f74 6f28  link.symlink_to(
-0001a120: 6163 7475 616c 290a 0a20 2020 2020 2020  actual)..       
-0001a130: 2020 2020 2061 6374 7561 6c5f 7072 6f6a       actual_proj
-0001a140: 203d 2061 6374 7561 6c20 2f20 2270 726f   = actual / "pro
-0001a150: 6a65 6374 220a 2020 2020 2020 2020 2020  ject".          
-0001a160: 2020 6163 7475 616c 5f70 726f 6a2e 6d6b    actual_proj.mk
-0001a170: 6469 7228 290a 2020 2020 2020 2020 2020  dir().          
-0001a180: 2020 2861 6374 7561 6c5f 7072 6f6a 202f    (actual_proj /
-0001a190: 2022 6d6f 6475 6c65 2e70 7922 292e 7772   "module.py").wr
-0001a1a0: 6974 655f 7465 7874 2822 7072 696e 7428  ite_text("print(
-0001a1b0: 2768 656c 6c6f 2729 222c 2065 6e63 6f64  'hello')", encod
-0001a1c0: 696e 673d 2275 7466 2d38 2229 0a0a 2020  ing="utf-8")..  
-0001a1d0: 2020 2020 2020 2020 2020 7379 6d6c 696e            symlin
-0001a1e0: 6b5f 7072 6f6a 203d 2073 796d 6c69 6e6b  k_proj = symlink
-0001a1f0: 202f 2022 7072 6f6a 6563 7422 0a0a 2020   / "project"..  
-0001a200: 2020 2020 2020 2020 2020 7769 7468 2063            with c
-0001a210: 6861 6e67 655f 6469 7265 6374 6f72 7928  hange_directory(
-0001a220: 7379 6d6c 696e 6b5f 7072 6f6a 293a 0a20  symlink_proj):. 
-0001a230: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001a240: 7373 6572 745f 636f 6c6c 6563 7465 645f  ssert_collected_
-0001a250: 736f 7572 6365 7328 0a20 2020 2020 2020  sources(.       
-0001a260: 2020 2020 2020 2020 2020 2020 2073 7263               src
-0001a270: 3d5b 226d 6f64 756c 652e 7079 225d 2c0a  =["module.py"],.
-0001a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a290: 2020 2020 726f 6f74 3d73 796d 6c69 6e6b      root=symlink
-0001a2a0: 5f70 726f 6a2e 7265 736f 6c76 6528 292c  _proj.resolve(),
-0001a2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a2c0: 2020 2020 2065 7870 6563 7465 643d 5b22       expected=["
-0001a2d0: 6d6f 6475 6c65 2e70 7922 5d2c 0a20 2020  module.py"],.   
-0001a2e0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-0001a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a300: 6162 736f 6c75 7465 5f6d 6f64 756c 6520  absolute_module 
-0001a310: 3d20 7379 6d6c 696e 6b5f 7072 6f6a 202f  = symlink_proj /
-0001a320: 2022 6d6f 6475 6c65 2e70 7922 0a20 2020   "module.py".   
-0001a330: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-0001a340: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
-0001a350: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
-0001a360: 2020 2020 2020 2020 2020 2073 7263 3d5b             src=[
-0001a370: 6162 736f 6c75 7465 5f6d 6f64 756c 655d  absolute_module]
-0001a380: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a390: 2020 2020 2020 726f 6f74 3d73 796d 6c69        root=symli
-0001a3a0: 6e6b 5f70 726f 6a2e 7265 736f 6c76 6528  nk_proj.resolve(
-0001a3b0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001a3c0: 2020 2020 2020 2065 7870 6563 7465 643d         expected=
-0001a3d0: 5b61 6273 6f6c 7574 655f 6d6f 6475 6c65  [absolute_module
-0001a3e0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001a3f0: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-0001a400: 2020 2020 2020 2320 6120 6665 7720 7472        # a few tr
-0001a410: 6963 6b79 2074 6573 7473 2066 6f72 2066  icky tests for f
-0001a420: 6f72 6365 5f65 7863 6c75 6465 0a20 2020  orce_exclude.   
-0001a430: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-0001a440: 745f 7379 6d6c 696e 6b20 3d20 7379 6d6c  t_symlink = syml
-0001a450: 696e 6b5f 7072 6f6a 202f 2022 7379 6d6c  ink_proj / "syml
-0001a460: 696e 6b5f 6d6f 6475 6c65 2e70 7922 0a20  ink_module.py". 
-0001a470: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001a480: 6c61 745f 7379 6d6c 696e 6b2e 7379 6d6c  lat_symlink.syml
-0001a490: 696e 6b5f 746f 2861 6374 7561 6c5f 7072  ink_to(actual_pr
-0001a4a0: 6f6a 202f 2022 6d6f 6475 6c65 2e70 7922  oj / "module.py"
-0001a4b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a4c0: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
-0001a4d0: 6564 5f73 6f75 7263 6573 280a 2020 2020  ed_sources(.    
-0001a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4f0: 7372 633d 5b66 6c61 745f 7379 6d6c 696e  src=[flat_symlin
-0001a500: 6b5d 2c0a 2020 2020 2020 2020 2020 2020  k],.            
-0001a510: 2020 2020 2020 2020 726f 6f74 3d73 796d          root=sym
-0001a520: 6c69 6e6b 5f70 726f 6a2e 7265 736f 6c76  link_proj.resolv
-0001a530: 6528 292c 0a20 2020 2020 2020 2020 2020  e(),.           
-0001a540: 2020 2020 2020 2020 2066 6f72 6365 5f65           force_e
-0001a550: 7863 6c75 6465 3d72 222f 7379 6d6c 696e  xclude=r"/symlin
-0001a560: 6b5f 6d6f 6475 6c65 2e70 7922 2c0a 2020  k_module.py",.  
-0001a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a580: 2020 6578 7065 6374 6564 3d5b 5d2c 0a20    expected=[],. 
-0001a590: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001a5a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a5b0: 2020 7461 7267 6574 203d 2061 6374 7561    target = actua
-0001a5c0: 6c5f 7072 6f6a 202f 2022 7461 7267 6574  l_proj / "target
-0001a5d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001a5e0: 2020 7461 7267 6574 2e6d 6b64 6972 2829    target.mkdir()
-0001a5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a600: 2028 7461 7267 6574 202f 2022 616e 6f74   (target / "anot
-0001a610: 6865 722e 7079 2229 2e77 7269 7465 5f74  her.py").write_t
-0001a620: 6578 7428 2270 7269 6e74 2827 6865 6c6c  ext("print('hell
-0001a630: 6f27 2922 2c20 656e 636f 6469 6e67 3d22  o')", encoding="
-0001a640: 7574 662d 3822 290a 2020 2020 2020 2020  utf-8").        
-0001a650: 2020 2020 2020 2020 2873 796d 6c69 6e6b          (symlink
-0001a660: 5f70 726f 6a20 2f20 226e 6573 7465 6422  _proj / "nested"
-0001a670: 292e 7379 6d6c 696e 6b5f 746f 2874 6172  ).symlink_to(tar
-0001a680: 6765 7429 0a0a 2020 2020 2020 2020 2020  get)..          
-0001a690: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
-0001a6a0: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
-0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6c0: 2020 2020 7372 633d 5b73 796d 6c69 6e6b      src=[symlink
-0001a6d0: 5f70 726f 6a20 2f20 226e 6573 7465 6422  _proj / "nested"
-0001a6e0: 202f 2022 616e 6f74 6865 722e 7079 225d   / "another.py"]
-0001a6f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a700: 2020 2020 2020 726f 6f74 3d73 796d 6c69        root=symli
-0001a710: 6e6b 5f70 726f 6a2e 7265 736f 6c76 6528  nk_proj.resolve(
-0001a720: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001a730: 2020 2020 2020 2066 6f72 6365 5f65 7863         force_exc
-0001a740: 6c75 6465 3d72 226e 6573 7465 6422 2c0a  lude=r"nested",.
-0001a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a760: 2020 2020 6578 7065 6374 6564 3d5b 5d2c      expected=[],
-0001a770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a780: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0001a790: 2020 2061 7373 6572 745f 636f 6c6c 6563     assert_collec
-0001a7a0: 7465 645f 736f 7572 6365 7328 0a20 2020  ted_sources(.   
-0001a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7c0: 2073 7263 3d5b 7379 6d6c 696e 6b5f 7072   src=[symlink_pr
-0001a7d0: 6f6a 202f 2022 6e65 7374 6564 2220 2f20  oj / "nested" / 
-0001a7e0: 2261 6e6f 7468 6572 2e70 7922 5d2c 0a20  "another.py"],. 
-0001a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a800: 2020 2072 6f6f 743d 7379 6d6c 696e 6b5f     root=symlink_
-0001a810: 7072 6f6a 2e72 6573 6f6c 7665 2829 2c0a  proj.resolve(),.
-0001a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a830: 2020 2020 666f 7263 655f 6578 636c 7564      force_exclud
-0001a840: 653d 7222 7461 7267 6574 222c 0a20 2020  e=r"target",.   
-0001a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a860: 2065 7870 6563 7465 643d 5b73 796d 6c69   expected=[symli
-0001a870: 6e6b 5f70 726f 6a20 2f20 226e 6573 7465  nk_proj / "neste
-0001a880: 6422 202f 2022 616e 6f74 6865 722e 7079  d" / "another.py
-0001a890: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-0001a8a0: 2020 2020 290a 0a20 2020 2064 6566 2074      )..    def t
-0001a8b0: 6573 745f 6765 745f 736f 7572 6365 735f  est_get_sources_
-0001a8c0: 7769 7468 5f73 7464 696e 5f73 796d 6c69  with_stdin_symli
-0001a8d0: 6e6b 5f6f 7574 7369 6465 5f72 6f6f 7428  nk_outside_root(
-0001a8e0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0001a8f0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-0001a900: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
-0001a910: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
-0001a920: 6173 2074 656d 7064 6972 3a0a 2020 2020  as tempdir:.    
-0001a930: 2020 2020 2020 2020 746d 7020 3d20 5061          tmp = Pa
-0001a940: 7468 2874 656d 7064 6972 292e 7265 736f  th(tempdir).reso
-0001a950: 6c76 6528 290a 0a20 2020 2020 2020 2020  lve()..         
-0001a960: 2020 2072 6f6f 7420 3d20 746d 7020 2f20     root = tmp / 
-0001a970: 2272 6f6f 7422 0a20 2020 2020 2020 2020  "root".         
-0001a980: 2020 2072 6f6f 742e 6d6b 6469 7228 290a     root.mkdir().
-0001a990: 2020 2020 2020 2020 2020 2020 2872 6f6f              (roo
-0001a9a0: 7420 2f20 2270 7970 726f 6a65 6374 2e74  t / "pyproject.t
-0001a9b0: 6f6d 6c22 292e 7772 6974 655f 7465 7874  oml").write_text
-0001a9c0: 2822 5b74 6f6f 6c2e 626c 6163 6b5d 222c  ("[tool.black]",
-0001a9d0: 2065 6e63 6f64 696e 673d 2275 7466 2d38   encoding="utf-8
-0001a9e0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-0001a9f0: 7461 7267 6574 203d 2074 6d70 202f 2022  target = tmp / "
-0001aa00: 6f75 7473 6964 655f 726f 6f74 2220 2f20  outside_root" / 
-0001aa10: 2261 2e70 7922 0a20 2020 2020 2020 2020  "a.py".         
-0001aa20: 2020 2074 6172 6765 742e 7061 7265 6e74     target.parent
-0001aa30: 2e6d 6b64 6972 2829 0a20 2020 2020 2020  .mkdir().       
-0001aa40: 2020 2020 2074 6172 6765 742e 7772 6974       target.writ
-0001aa50: 655f 7465 7874 2822 7072 696e 7428 2768  e_text("print('h
-0001aa60: 656c 6c6f 2729 222c 2065 6e63 6f64 696e  ello')", encodin
-0001aa70: 673d 2275 7466 2d38 2229 0a20 2020 2020  g="utf-8").     
-0001aa80: 2020 2020 2020 2028 726f 6f74 202f 2022         (root / "
-0001aa90: 612e 7079 2229 2e73 796d 6c69 6e6b 5f74  a.py").symlink_t
-0001aaa0: 6f28 7461 7267 6574 290a 0a20 2020 2020  o(target)..     
-0001aab0: 2020 2020 2020 2073 7464 696e 5f66 696c         stdin_fil
-0001aac0: 656e 616d 6520 3d20 7374 7228 726f 6f74  ename = str(root
-0001aad0: 202f 2022 612e 7079 2229 0a20 2020 2020   / "a.py").     
-0001aae0: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
-0001aaf0: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
-0001ab00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ab10: 2072 6f6f 743d 726f 6f74 2c0a 2020 2020   root=root,.    
-0001ab20: 2020 2020 2020 2020 2020 2020 7372 633d              src=
-0001ab30: 5b22 2d22 5d2c 0a20 2020 2020 2020 2020  ["-"],.         
-0001ab40: 2020 2020 2020 2065 7870 6563 7465 643d         expected=
-0001ab50: 5b5d 2c0a 2020 2020 2020 2020 2020 2020  [],.            
-0001ab60: 2020 2020 7374 6469 6e5f 6669 6c65 6e61      stdin_filena
-0001ab70: 6d65 3d73 7464 696e 5f66 696c 656e 616d  me=stdin_filenam
-0001ab80: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
-0001ab90: 0a0a 2020 2020 6465 6620 7465 7374 5f67  ..    def test_g
-0001aba0: 6574 5f73 6f75 7263 6573 5f77 6974 685f  et_sources_with_
-0001abb0: 7374 6469 6e28 7365 6c66 2920 2d3e 204e  stdin(self) -> N
-0001abc0: 6f6e 653a 0a20 2020 2020 2020 2073 7263  one:.        src
-0001abd0: 203d 205b 222d 225d 0a20 2020 2020 2020   = ["-"].       
-0001abe0: 2065 7870 6563 7465 6420 3d20 5b22 2d22   expected = ["-"
-0001abf0: 5d0a 2020 2020 2020 2020 6173 7365 7274  ].        assert
-0001ac00: 5f63 6f6c 6c65 6374 6564 5f73 6f75 7263  _collected_sourc
-0001ac10: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
-0001ac20: 7372 632c 0a20 2020 2020 2020 2020 2020  src,.           
-0001ac30: 2072 6f6f 743d 5448 4953 5f44 4952 2e72   root=THIS_DIR.r
-0001ac40: 6573 6f6c 7665 2829 2c0a 2020 2020 2020  esolve(),.      
-0001ac50: 2020 2020 2020 6578 7065 6374 6564 3d65        expected=e
-0001ac60: 7870 6563 7465 642c 0a20 2020 2020 2020  xpected,.       
-0001ac70: 2020 2020 2069 6e63 6c75 6465 3d22 222c       include="",
-0001ac80: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0001ac90: 6c75 6465 3d72 222f 6578 636c 7564 652f  lude=r"/exclude/
-0001aca0: 7c61 5c2e 7079 222c 0a20 2020 2020 2020  |a\.py",.       
-0001acb0: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
-0001acc0: 5f67 6574 5f73 6f75 7263 6573 5f77 6974  _get_sources_wit
-0001acd0: 685f 7374 6469 6e5f 6669 6c65 6e61 6d65  h_stdin_filename
-0001ace0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0001acf0: 2020 2020 2020 2020 7372 6320 3d20 5b22          src = ["
-0001ad00: 2d22 5d0a 2020 2020 2020 2020 7374 6469  -"].        stdi
-0001ad10: 6e5f 6669 6c65 6e61 6d65 203d 2073 7472  n_filename = str
-0001ad20: 2854 4849 535f 4449 5220 2f20 2264 6174  (THIS_DIR / "dat
-0001ad30: 612f 636f 6c6c 6563 7469 6f6e 732e 7079  a/collections.py
-0001ad40: 2229 0a20 2020 2020 2020 2065 7870 6563  ").        expec
-0001ad50: 7465 6420 3d20 5b66 225f 5f42 4c41 434b  ted = [f"__BLACK
-0001ad60: 5f53 5444 494e 5f46 494c 454e 414d 455f  _STDIN_FILENAME_
-0001ad70: 5f7b 7374 6469 6e5f 6669 6c65 6e61 6d65  _{stdin_filename
-0001ad80: 7d22 5d0a 2020 2020 2020 2020 6173 7365  }"].        asse
-0001ad90: 7274 5f63 6f6c 6c65 6374 6564 5f73 6f75  rt_collected_sou
-0001ada0: 7263 6573 280a 2020 2020 2020 2020 2020  rces(.          
-0001adb0: 2020 7372 632c 0a20 2020 2020 2020 2020    src,.         
-0001adc0: 2020 2072 6f6f 743d 5448 4953 5f44 4952     root=THIS_DIR
-0001add0: 2e72 6573 6f6c 7665 2829 2c0a 2020 2020  .resolve(),.    
-0001ade0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-0001adf0: 3d65 7870 6563 7465 642c 0a20 2020 2020  =expected,.     
-0001ae00: 2020 2020 2020 2065 7863 6c75 6465 3d72         exclude=r
-0001ae10: 222f 6578 636c 7564 652f 615c 2e70 7922  "/exclude/a\.py"
-0001ae20: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
-0001ae30: 6469 6e5f 6669 6c65 6e61 6d65 3d73 7464  din_filename=std
-0001ae40: 696e 5f66 696c 656e 616d 652c 0a20 2020  in_filename,.   
-0001ae50: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-0001ae60: 7465 7374 5f67 6574 5f73 6f75 7263 6573  test_get_sources
-0001ae70: 5f77 6974 685f 7374 6469 6e5f 6669 6c65  _with_stdin_file
-0001ae80: 6e61 6d65 5f61 6e64 5f65 7863 6c75 6465  name_and_exclude
-0001ae90: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0001aea0: 2020 2020 2020 2020 2320 4578 636c 7564          # Exclud
-0001aeb0: 6520 7368 6f75 6c64 6e27 7420 6578 636c  e shouldn't excl
-0001aec0: 7564 6520 7374 6469 6e5f 6669 6c65 6e61  ude stdin_filena
-0001aed0: 6d65 2073 696e 6365 2069 7420 6973 206d  me since it is m
-0001aee0: 696d 6963 6b69 6e67 2074 6865 0a20 2020  imicking the.   
-0001aef0: 2020 2020 2023 2066 696c 6520 6265 696e       # file bein
-0001af00: 6720 7061 7373 6564 2064 6972 6563 746c  g passed directl
-0001af10: 792e 2054 6869 7320 6973 2074 6865 2073  y. This is the s
-0001af20: 616d 6520 6173 0a20 2020 2020 2020 2023  ame as.        #
-0001af30: 2074 6573 745f 6578 636c 7564 655f 666f   test_exclude_fo
-0001af40: 725f 6973 7375 655f 3135 3732 0a20 2020  r_issue_1572.   
-0001af50: 2020 2020 2070 6174 6820 3d20 4441 5441       path = DATA
-0001af60: 5f44 4952 202f 2022 696e 636c 7564 655f  _DIR / "include_
-0001af70: 6578 636c 7564 655f 7465 7374 7322 0a20  exclude_tests". 
-0001af80: 2020 2020 2020 2073 7263 203d 205b 222d         src = ["-
-0001af90: 225d 0a20 2020 2020 2020 2073 7464 696e  "].        stdin
-0001afa0: 5f66 696c 656e 616d 6520 3d20 7374 7228  _filename = str(
-0001afb0: 7061 7468 202f 2022 622f 6578 636c 7564  path / "b/exclud
-0001afc0: 652f 612e 7079 2229 0a20 2020 2020 2020  e/a.py").       
-0001afd0: 2065 7870 6563 7465 6420 3d20 5b66 225f   expected = [f"_
-0001afe0: 5f42 4c41 434b 5f53 5444 494e 5f46 494c  _BLACK_STDIN_FIL
-0001aff0: 454e 414d 455f 5f7b 7374 6469 6e5f 6669  ENAME__{stdin_fi
-0001b000: 6c65 6e61 6d65 7d22 5d0a 2020 2020 2020  lename}"].      
-0001b010: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
-0001b020: 6564 5f73 6f75 7263 6573 280a 2020 2020  ed_sources(.    
-0001b030: 2020 2020 2020 2020 7372 632c 0a20 2020          src,.   
-0001b040: 2020 2020 2020 2020 2072 6f6f 743d 5448           root=TH
-0001b050: 4953 5f44 4952 2e72 6573 6f6c 7665 2829  IS_DIR.resolve()
-0001b060: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
-0001b070: 7065 6374 6564 3d65 7870 6563 7465 642c  pected=expected,
-0001b080: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0001b090: 6c75 6465 3d72 222f 6578 636c 7564 652f  lude=r"/exclude/
-0001b0a0: 7c61 5c2e 7079 222c 0a20 2020 2020 2020  |a\.py",.       
-0001b0b0: 2020 2020 2073 7464 696e 5f66 696c 656e       stdin_filen
-0001b0c0: 616d 653d 7374 6469 6e5f 6669 6c65 6e61  ame=stdin_filena
-0001b0d0: 6d65 2c0a 2020 2020 2020 2020 290a 0a20  me,.        ).. 
-0001b0e0: 2020 2064 6566 2074 6573 745f 6765 745f     def test_get_
-0001b0f0: 736f 7572 6365 735f 7769 7468 5f73 7464  sources_with_std
-0001b100: 696e 5f66 696c 656e 616d 655f 616e 645f  in_filename_and_
-0001b110: 6578 7465 6e64 5f65 7863 6c75 6465 2873  extend_exclude(s
-0001b120: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0001b130: 2020 2020 2020 2320 4578 7465 6e64 2065        # Extend e
-0001b140: 7863 6c75 6465 2073 686f 756c 646e 2774  xclude shouldn't
-0001b150: 2065 7863 6c75 6465 2073 7464 696e 5f66   exclude stdin_f
-0001b160: 696c 656e 616d 6520 7369 6e63 6520 6974  ilename since it
-0001b170: 2069 7320 6d69 6d69 636b 696e 6720 7468   is mimicking th
-0001b180: 650a 2020 2020 2020 2020 2320 6669 6c65  e.        # file
-0001b190: 2062 6569 6e67 2070 6173 7365 6420 6469   being passed di
-0001b1a0: 7265 6374 6c79 2e20 5468 6973 2069 7320  rectly. This is 
-0001b1b0: 7468 6520 7361 6d65 2061 730a 2020 2020  the same as.    
-0001b1c0: 2020 2020 2320 7465 7374 5f65 7863 6c75      # test_exclu
-0001b1d0: 6465 5f66 6f72 5f69 7373 7565 5f31 3537  de_for_issue_157
-0001b1e0: 320a 2020 2020 2020 2020 7372 6320 3d20  2.        src = 
-0001b1f0: 5b22 2d22 5d0a 2020 2020 2020 2020 7061  ["-"].        pa
-0001b200: 7468 203d 2054 4849 535f 4449 5220 2f20  th = THIS_DIR / 
-0001b210: 2264 6174 6122 202f 2022 696e 636c 7564  "data" / "includ
-0001b220: 655f 6578 636c 7564 655f 7465 7374 7322  e_exclude_tests"
-0001b230: 0a20 2020 2020 2020 2073 7464 696e 5f66  .        stdin_f
-0001b240: 696c 656e 616d 6520 3d20 7374 7228 7061  ilename = str(pa
-0001b250: 7468 202f 2022 622f 6578 636c 7564 652f  th / "b/exclude/
-0001b260: 612e 7079 2229 0a20 2020 2020 2020 2065  a.py").        e
-0001b270: 7870 6563 7465 6420 3d20 5b66 225f 5f42  xpected = [f"__B
-0001b280: 4c41 434b 5f53 5444 494e 5f46 494c 454e  LACK_STDIN_FILEN
-0001b290: 414d 455f 5f7b 7374 6469 6e5f 6669 6c65  AME__{stdin_file
-0001b2a0: 6e61 6d65 7d22 5d0a 2020 2020 2020 2020  name}"].        
-0001b2b0: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
-0001b2c0: 5f73 6f75 7263 6573 280a 2020 2020 2020  _sources(.      
-0001b2d0: 2020 2020 2020 7372 632c 0a20 2020 2020        src,.     
-0001b2e0: 2020 2020 2020 2072 6f6f 743d 5448 4953         root=THIS
-0001b2f0: 5f44 4952 2e72 6573 6f6c 7665 2829 2c0a  _DIR.resolve(),.
-0001b300: 2020 2020 2020 2020 2020 2020 6578 7065              expe
-0001b310: 6374 6564 3d65 7870 6563 7465 642c 0a20  cted=expected,. 
-0001b320: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-0001b330: 645f 6578 636c 7564 653d 7222 2f65 7863  d_exclude=r"/exc
-0001b340: 6c75 6465 2f7c 615c 2e70 7922 2c0a 2020  lude/|a\.py",.  
-0001b350: 2020 2020 2020 2020 2020 7374 6469 6e5f            stdin_
-0001b360: 6669 6c65 6e61 6d65 3d73 7464 696e 5f66  filename=stdin_f
-0001b370: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
-0001b380: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
-0001b390: 5f67 6574 5f73 6f75 7263 6573 5f77 6974  _get_sources_wit
-0001b3a0: 685f 7374 6469 6e5f 6669 6c65 6e61 6d65  h_stdin_filename
-0001b3b0: 5f61 6e64 5f66 6f72 6365 5f65 7863 6c75  _and_force_exclu
-0001b3c0: 6465 2873 656c 6629 202d 3e20 4e6f 6e65  de(self) -> None
-0001b3d0: 3a0a 2020 2020 2020 2020 2320 466f 7263  :.        # Forc
-0001b3e0: 6520 6578 636c 7564 6520 7368 6f75 6c64  e exclude should
-0001b3f0: 2065 7863 6c75 6465 2074 6865 2066 696c   exclude the fil
-0001b400: 6520 7768 656e 2070 6173 7369 6e67 2069  e when passing i
-0001b410: 7420 7468 726f 7567 680a 2020 2020 2020  t through.      
-0001b420: 2020 2320 7374 6469 6e5f 6669 6c65 6e61    # stdin_filena
-0001b430: 6d65 0a20 2020 2020 2020 2070 6174 6820  me.        path 
-0001b440: 3d20 5448 4953 5f44 4952 202f 2022 6461  = THIS_DIR / "da
-0001b450: 7461 2220 2f20 2269 6e63 6c75 6465 5f65  ta" / "include_e
-0001b460: 7863 6c75 6465 5f74 6573 7473 220a 2020  xclude_tests".  
-0001b470: 2020 2020 2020 7374 6469 6e5f 6669 6c65        stdin_file
-0001b480: 6e61 6d65 203d 2073 7472 2870 6174 6820  name = str(path 
-0001b490: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
-0001b4a0: 7922 290a 2020 2020 2020 2020 6173 7365  y").        asse
-0001b4b0: 7274 5f63 6f6c 6c65 6374 6564 5f73 6f75  rt_collected_sou
-0001b4c0: 7263 6573 280a 2020 2020 2020 2020 2020  rces(.          
-0001b4d0: 2020 7372 633d 5b22 2d22 5d2c 0a20 2020    src=["-"],.   
-0001b4e0: 2020 2020 2020 2020 2072 6f6f 743d 5448           root=TH
-0001b4f0: 4953 5f44 4952 2e72 6573 6f6c 7665 2829  IS_DIR.resolve()
-0001b500: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
-0001b510: 7065 6374 6564 3d5b 5d2c 0a20 2020 2020  pected=[],.     
-0001b520: 2020 2020 2020 2066 6f72 6365 5f65 7863         force_exc
-0001b530: 6c75 6465 3d72 222f 6578 636c 7564 652f  lude=r"/exclude/
-0001b540: 7c61 5c2e 7079 222c 0a20 2020 2020 2020  |a\.py",.       
-0001b550: 2020 2020 2073 7464 696e 5f66 696c 656e       stdin_filen
-0001b560: 616d 653d 7374 6469 6e5f 6669 6c65 6e61  ame=stdin_filena
-0001b570: 6d65 2c0a 2020 2020 2020 2020 290a 0a20  me,.        ).. 
-0001b580: 2020 2064 6566 2074 6573 745f 6765 745f     def test_get_
-0001b590: 736f 7572 6365 735f 7769 7468 5f73 7464  sources_with_std
-0001b5a0: 696e 5f66 696c 656e 616d 655f 616e 645f  in_filename_and_
-0001b5b0: 666f 7263 655f 6578 636c 7564 655f 616e  force_exclude_an
-0001b5c0: 645f 7379 6d6c 696e 6b28 0a20 2020 2020  d_symlink(.     
-0001b5d0: 2020 2073 656c 662c 0a20 2020 2029 202d     self,.    ) -
-0001b5e0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0001b5f0: 2320 466f 7263 6520 6578 636c 7564 6520  # Force exclude 
-0001b600: 7368 6f75 6c64 2065 7863 6c75 6465 2061  should exclude a
-0001b610: 2073 796d 6c69 6e6b 2062 6173 6564 206f   symlink based o
-0001b620: 6e20 7468 6520 7379 6d6c 696e 6b2c 206e  n the symlink, n
-0001b630: 6f74 2069 7473 2074 6172 6765 740a 2020  ot its target.  
-0001b640: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
-0001b650: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
-0001b660: 6173 2074 656d 7064 6972 3a0a 2020 2020  as tempdir:.    
-0001b670: 2020 2020 2020 2020 746d 7020 3d20 5061          tmp = Pa
-0001b680: 7468 2874 656d 7064 6972 292e 7265 736f  th(tempdir).reso
-0001b690: 6c76 6528 290a 2020 2020 2020 2020 2020  lve().          
-0001b6a0: 2020 2874 6d70 202f 2022 6578 636c 7564    (tmp / "exclud
-0001b6b0: 6522 292e 6d6b 6469 7228 290a 2020 2020  e").mkdir().    
-0001b6c0: 2020 2020 2020 2020 2874 6d70 202f 2022          (tmp / "
-0001b6d0: 6578 636c 7564 6522 202f 2022 612e 7079  exclude" / "a.py
-0001b6e0: 2229 2e77 7269 7465 5f74 6578 7428 2270  ").write_text("p
-0001b6f0: 7269 6e74 2827 6865 6c6c 6f27 2922 2c20  rint('hello')", 
-0001b700: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
-0001b710: 290a 2020 2020 2020 2020 2020 2020 2874  ).            (t
-0001b720: 6d70 202f 2022 7379 6d6c 696e 6b2e 7079  mp / "symlink.py
-0001b730: 2229 2e73 796d 6c69 6e6b 5f74 6f28 746d  ").symlink_to(tm
-0001b740: 7020 2f20 2265 7863 6c75 6465 2220 2f20  p / "exclude" / 
-0001b750: 2261 2e70 7922 290a 0a20 2020 2020 2020  "a.py")..       
-0001b760: 2020 2020 2073 7464 696e 5f66 696c 656e       stdin_filen
-0001b770: 616d 6520 3d20 7374 7228 746d 7020 2f20  ame = str(tmp / 
-0001b780: 2273 796d 6c69 6e6b 2e70 7922 290a 2020  "symlink.py").  
-0001b790: 2020 2020 2020 2020 2020 6578 7065 6374            expect
-0001b7a0: 6564 203d 205b 6622 5f5f 424c 4143 4b5f  ed = [f"__BLACK_
-0001b7b0: 5354 4449 4e5f 4649 4c45 4e41 4d45 5f5f  STDIN_FILENAME__
-0001b7c0: 7b73 7464 696e 5f66 696c 656e 616d 657d  {stdin_filename}
-0001b7d0: 225d 0a20 2020 2020 2020 2020 2020 2077  "].            w
-0001b7e0: 6974 6820 6368 616e 6765 5f64 6972 6563  ith change_direc
-0001b7f0: 746f 7279 2874 6d70 293a 0a20 2020 2020  tory(tmp):.     
-0001b800: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0001b810: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
-0001b820: 6365 7328 0a20 2020 2020 2020 2020 2020  ces(.           
-0001b830: 2020 2020 2020 2020 2073 7263 3d5b 222d           src=["-
-0001b840: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-0001b850: 2020 2020 2020 2020 726f 6f74 3d74 6d70          root=tmp
-0001b860: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001b870: 2020 2020 2020 6578 7065 6374 6564 3d65        expected=e
-0001b880: 7870 6563 7465 642c 0a20 2020 2020 2020  xpected,.       
-0001b890: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001b8a0: 6365 5f65 7863 6c75 6465 3d72 2265 7863  ce_exclude=r"exc
-0001b8b0: 6c75 6465 2f61 5c2e 7079 222c 0a20 2020  lude/a\.py",.   
-0001b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8d0: 2073 7464 696e 5f66 696c 656e 616d 653d   stdin_filename=
-0001b8e0: 7374 6469 6e5f 6669 6c65 6e61 6d65 2c0a  stdin_filename,.
-0001b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b900: 290a 0a0a 636c 6173 7320 5465 7374 4465  )...class TestDe
-0001b910: 4661 6374 6f41 5049 3a0a 2020 2020 2222  FactoAPI:.    ""
-0001b920: 2254 6573 7420 7468 6174 2063 6572 7461  "Test that certa
-0001b930: 696e 2073 796d 626f 6c73 2074 6861 7420  in symbols that 
-0001b940: 6172 6520 636f 6d6d 6f6e 6c79 2075 7365  are commonly use
-0001b950: 6420 6578 7465 726e 616c 6c79 206b 6565  d externally kee
-0001b960: 7020 776f 726b 696e 672e 0a0a 2020 2020  p working...    
-0001b970: 5765 2064 6f6e 2774 2028 7965 7429 2066  We don't (yet) f
-0001b980: 6f72 6d61 6c6c 7920 6578 706f 7365 2061  ormally expose a
-0001b990: 6e20 4150 4920 2873 6565 2069 7373 7565  n API (see issue
-0001b9a0: 2023 3737 3929 2c20 6275 7420 7765 2073   #779), but we s
-0001b9b0: 686f 756c 6420 656e 6465 6176 6f72 2074  hould endeavor t
-0001b9c0: 6f0a 2020 2020 6b65 6570 2063 6572 7461  o.    keep certa
-0001b9d0: 696e 2066 756e 6374 696f 6e73 2074 6861  in functions tha
-0001b9e0: 7420 6578 7465 726e 616c 2075 7365 7273  t external users
-0001b9f0: 2063 6f6d 6d6f 6e6c 7920 7265 6c79 206f   commonly rely o
-0001ba00: 6e20 776f 726b 696e 672e 0a0a 2020 2020  n working...    
-0001ba10: 2222 220a 0a20 2020 2064 6566 2074 6573  """..    def tes
-0001ba20: 745f 666f 726d 6174 5f73 7472 2873 656c  t_format_str(sel
-0001ba30: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0001ba40: 2020 2020 2320 666f 726d 6174 5f73 7472      # format_str
-0001ba50: 2061 6e64 204d 6f64 6520 7368 6f75 6c64   and Mode should
-0001ba60: 206b 6565 7020 776f 726b 696e 670a 2020   keep working.  
-0001ba70: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
-0001ba80: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-0001ba90: 2e66 6f72 6d61 745f 7374 7228 2270 7269  .format_str("pri
-0001baa0: 6e74 2827 6865 6c6c 6f27 2922 2c20 6d6f  nt('hello')", mo
-0001bab0: 6465 3d62 6c61 636b 2e4d 6f64 6528 2929  de=black.Mode())
-0001bac0: 203d 3d20 2770 7269 6e74 2822 6865 6c6c   == 'print("hell
-0001bad0: 6f22 295c 6e27 0a20 2020 2020 2020 2029  o")\n'.        )
-0001bae0: 0a0a 2020 2020 2020 2020 2320 796f 7520  ..        # you 
-0001baf0: 6361 6e20 7061 7373 206c 696e 6520 6c65  can pass line le
-0001bb00: 6e67 7468 0a20 2020 2020 2020 2061 7373  ngth.        ass
-0001bb10: 6572 7420 280a 2020 2020 2020 2020 2020  ert (.          
-0001bb20: 2020 626c 6163 6b2e 666f 726d 6174 5f73    black.format_s
-0001bb30: 7472 2822 7072 696e 7428 2768 656c 6c6f  tr("print('hello
-0001bb40: 2729 222c 206d 6f64 653d 626c 6163 6b2e  ')", mode=black.
-0001bb50: 4d6f 6465 286c 696e 655f 6c65 6e67 7468  Mode(line_length
-0001bb60: 3d34 3229 290a 2020 2020 2020 2020 2020  =42)).          
-0001bb70: 2020 3d3d 2027 7072 696e 7428 2268 656c    == 'print("hel
-0001bb80: 6c6f 2229 5c6e 270a 2020 2020 2020 2020  lo")\n'.        
-0001bb90: 290a 0a20 2020 2020 2020 2023 2069 6e76  )..        # inv
-0001bba0: 616c 6964 2069 6e70 7574 2072 6169 7365  alid input raise
-0001bbb0: 7320 496e 7661 6c69 6449 6e70 7574 0a20  s InvalidInput. 
-0001bbc0: 2020 2020 2020 2077 6974 6820 7079 7465         with pyte
-0001bbd0: 7374 2e72 6169 7365 7328 626c 6163 6b2e  st.raises(black.
-0001bbe0: 496e 7661 6c69 6449 6e70 7574 293a 0a20  InvalidInput):. 
-0001bbf0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-0001bc00: 2e66 6f72 6d61 745f 7374 7228 2273 796e  .format_str("syn
-0001bc10: 7461 7820 6572 726f 7222 2c20 6d6f 6465  tax error", mode
-0001bc20: 3d62 6c61 636b 2e4d 6f64 6528 2929 0a0a  =black.Mode())..
-0001bc30: 2020 2020 6465 6620 7465 7374 5f66 6f72      def test_for
-0001bc40: 6d61 745f 6669 6c65 5f63 6f6e 7465 6e74  mat_file_content
-0001bc50: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
-0001bc60: 0a20 2020 2020 2020 2023 2059 6f75 2070  .        # You p
-0001bc70: 726f 6261 626c 7920 7368 6f75 6c64 2062  robably should b
-0001bc80: 6520 7573 696e 6720 666f 726d 6174 5f73  e using format_s
-0001bc90: 7472 2829 2069 6e73 7465 6164 2c20 6275  tr() instead, bu
-0001bca0: 7420 6c65 7427 7320 6b65 6570 0a20 2020  t let's keep.   
-0001bcb0: 2020 2020 2023 2074 6869 7320 6f6e 6520       # this one 
-0001bcc0: 6172 6f75 6e64 2073 696e 6365 2070 656f  around since peo
-0001bcd0: 706c 6520 646f 2075 7365 2069 740a 2020  ple do use it.  
-0001bce0: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
-0001bcf0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
-0001bd00: 2e66 6f72 6d61 745f 6669 6c65 5f63 6f6e  .format_file_con
-0001bd10: 7465 6e74 7328 2278 3d31 222c 2066 6173  tents("x=1", fas
-0001bd20: 743d 5472 7565 2c20 6d6f 6465 3d62 6c61  t=True, mode=bla
-0001bd30: 636b 2e4d 6f64 6528 2929 203d 3d20 2278  ck.Mode()) == "x
-0001bd40: 203d 2031 5c6e 220a 2020 2020 2020 2020   = 1\n".        
-0001bd50: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-0001bd60: 7079 7465 7374 2e72 6169 7365 7328 626c  pytest.raises(bl
-0001bd70: 6163 6b2e 4e6f 7468 696e 6743 6861 6e67  ack.NothingChang
-0001bd80: 6564 293a 0a20 2020 2020 2020 2020 2020  ed):.           
-0001bd90: 2062 6c61 636b 2e66 6f72 6d61 745f 6669   black.format_fi
-0001bda0: 6c65 5f63 6f6e 7465 6e74 7328 2278 203d  le_contents("x =
-0001bdb0: 2031 5c6e 222c 2066 6173 743d 5472 7565   1\n", fast=True
-0001bdc0: 2c20 6d6f 6465 3d62 6c61 636b 2e4d 6f64  , mode=black.Mod
-0001bdd0: 6528 2929 0a0a 0a63 6c61 7373 2054 6573  e())...class Tes
-0001bde0: 7441 5354 5361 6665 7479 2842 6c61 636b  tASTSafety(Black
-0001bdf0: 4261 7365 5465 7374 4361 7365 293a 0a20  BaseTestCase):. 
-0001be00: 2020 2064 6566 2063 6865 636b 5f61 7374     def check_ast
-0001be10: 5f65 7175 6976 616c 656e 6365 280a 2020  _equivalence(.  
-0001be20: 2020 2020 2020 7365 6c66 2c20 736f 7572        self, sour
-0001be30: 6365 3a20 7374 722c 2064 6573 743a 2073  ce: str, dest: s
-0001be40: 7472 2c20 2a2c 2073 686f 756c 645f 6661  tr, *, should_fa
-0001be50: 696c 3a20 626f 6f6c 203d 2046 616c 7365  il: bool = False
-0001be60: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
-0001be70: 2020 2020 2020 2020 2320 4966 2077 6520          # If we 
-0001be80: 6765 7420 6120 6661 696c 7572 652c 206d  get a failure, m
-0001be90: 616b 6520 7375 7265 2069 7427 7320 6e6f  ake sure it's no
-0001bea0: 7420 6265 6361 7573 6520 7468 6520 636f  t because the co
-0001beb0: 6465 2069 7473 656c 660a 2020 2020 2020  de itself.      
-0001bec0: 2020 2320 6973 2069 6e76 616c 6964 2c20    # is invalid, 
-0001bed0: 7369 6e63 6520 7468 6174 2077 696c 6c20  since that will 
-0001bee0: 616c 736f 2063 6175 7365 2061 7373 6572  also cause asser
-0001bef0: 745f 6571 7569 7661 6c65 6e74 2829 2074  t_equivalent() t
-0001bf00: 6f20 7468 726f 770a 2020 2020 2020 2020  o throw.        
-0001bf10: 2320 4153 5453 6166 6574 7945 7272 6f72  # ASTSafetyError
-0001bf20: 2e0a 2020 2020 2020 2020 736f 7572 6365  ..        source
-0001bf30: 203d 2074 6578 7477 7261 702e 6465 6465   = textwrap.dede
-0001bf40: 6e74 2873 6f75 7263 6529 0a20 2020 2020  nt(source).     
-0001bf50: 2020 2064 6573 7420 3d20 7465 7874 7772     dest = textwr
-0001bf60: 6170 2e64 6564 656e 7428 6465 7374 290a  ap.dedent(dest).
-0001bf70: 2020 2020 2020 2020 626c 6163 6b2e 7061          black.pa
-0001bf80: 7273 655f 6173 7428 736f 7572 6365 290a  rse_ast(source).
-0001bf90: 2020 2020 2020 2020 626c 6163 6b2e 7061          black.pa
-0001bfa0: 7273 655f 6173 7428 6465 7374 290a 2020  rse_ast(dest).  
-0001bfb0: 2020 2020 2020 6966 2073 686f 756c 645f        if should_
-0001bfc0: 6661 696c 3a0a 2020 2020 2020 2020 2020  fail:.          
-0001bfd0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0001bfe0: 7274 5261 6973 6573 2841 5354 5361 6665  rtRaises(ASTSafe
-0001bff0: 7479 4572 726f 7229 3a0a 2020 2020 2020  tyError):.      
-0001c000: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-0001c010: 6173 7365 7274 5f65 7175 6976 616c 656e  assert_equivalen
-0001c020: 7428 736f 7572 6365 2c20 6465 7374 290a  t(source, dest).
-0001c030: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001c040: 2020 2020 2020 2020 2020 626c 6163 6b2e            black.
-0001c050: 6173 7365 7274 5f65 7175 6976 616c 656e  assert_equivalen
-0001c060: 7428 736f 7572 6365 2c20 6465 7374 290a  t(source, dest).
-0001c070: 0a20 2020 2064 6566 2074 6573 745f 6173  .    def test_as
-0001c080: 7365 7274 5f65 7175 6976 616c 656e 745f  sert_equivalent_
-0001c090: 6261 7369 6328 7365 6c66 2920 2d3e 204e  basic(self) -> N
-0001c0a0: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
-0001c0b0: 662e 6368 6563 6b5f 6173 745f 6571 7569  f.check_ast_equi
-0001c0c0: 7661 6c65 6e63 6528 227b 7d22 2c20 224e  valence("{}", "N
-0001c0d0: 6f6e 6522 2c20 7368 6f75 6c64 5f66 6169  one", should_fai
-0001c0e0: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
-0001c0f0: 7365 6c66 2e63 6865 636b 5f61 7374 5f65  self.check_ast_e
-0001c100: 7175 6976 616c 656e 6365 2822 312b 3222  quivalence("1+2"
-0001c110: 2c20 2231 2020 2020 2b20 2020 3222 290a  , "1    +   2").
-0001c120: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-0001c130: 636b 5f61 7374 5f65 7175 6976 616c 656e  ck_ast_equivalen
-0001c140: 6365 2822 6869 2023 2063 6f6d 6d65 6e74  ce("hi # comment
-0001c150: 222c 2022 6869 2229 0a0a 2020 2020 6465  ", "hi")..    de
-0001c160: 6620 7465 7374 5f61 7373 6572 745f 6571  f test_assert_eq
-0001c170: 7569 7661 6c65 6e74 5f64 656c 2873 656c  uivalent_del(sel
-0001c180: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-0001c190: 2020 2020 7365 6c66 2e63 6865 636b 5f61      self.check_a
-0001c1a0: 7374 5f65 7175 6976 616c 656e 6365 2822  st_equivalence("
-0001c1b0: 6465 6c20 2861 2c20 6229 222c 2022 6465  del (a, b)", "de
-0001c1c0: 6c20 612c 2062 2229 0a0a 2020 2020 6465  l a, b")..    de
-0001c1d0: 6620 7465 7374 5f61 7373 6572 745f 6571  f test_assert_eq
-0001c1e0: 7569 7661 6c65 6e74 5f73 7472 696e 6773  uivalent_strings
-0001c1f0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-0001c200: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-0001c210: 636b 5f61 7374 5f65 7175 6976 616c 656e  ck_ast_equivalen
-0001c220: 6365 2827 7820 3d20 2278 2227 2c20 2778  ce('x = "x"', 'x
-0001c230: 203d 2022 2078 2022 272c 2073 686f 756c   = " x "', shoul
-0001c240: 645f 6661 696c 3d54 7275 6529 0a20 2020  d_fail=True).   
-0001c250: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-0001c260: 6173 745f 6571 7569 7661 6c65 6e63 6528  ast_equivalence(
-0001c270: 0a20 2020 2020 2020 2020 2020 2027 2727  .            '''
-0001c280: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
-0001c290: 646f 6373 7472 696e 6720 2022 2222 0a20  docstring  """. 
-0001c2a0: 2020 2020 2020 2020 2020 2027 2727 2c0a             ''',.
-0001c2b0: 2020 2020 2020 2020 2020 2020 2727 270a              '''.
-0001c2c0: 2020 2020 2020 2020 2020 2020 2222 2264              """d
-0001c2d0: 6f63 7374 7269 6e67 2222 220a 2020 2020  ocstring""".    
-0001c2e0: 2020 2020 2020 2020 2727 272c 0a20 2020          ''',.   
-0001c2f0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-0001c300: 656c 662e 6368 6563 6b5f 6173 745f 6571  elf.check_ast_eq
-0001c310: 7569 7661 6c65 6e63 6528 0a20 2020 2020  uivalence(.     
-0001c320: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
-0001c330: 2020 2020 2020 2022 2222 646f 6373 7472         """docstr
-0001c340: 696e 6720 2022 2222 0a20 2020 2020 2020  ing  """.       
-0001c350: 2020 2020 2027 2727 2c0a 2020 2020 2020       ''',.      
-0001c360: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
-0001c370: 2020 2020 2020 2222 2264 646f 6373 7472        """ddocstr
-0001c380: 696e 6722 2222 0a20 2020 2020 2020 2020  ing""".         
-0001c390: 2020 2027 2727 2c0a 2020 2020 2020 2020     ''',.        
-0001c3a0: 2020 2020 7368 6f75 6c64 5f66 6169 6c3d      should_fail=
-0001c3b0: 5472 7565 2c0a 2020 2020 2020 2020 290a  True,.        ).
-0001c3c0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-0001c3d0: 636b 5f61 7374 5f65 7175 6976 616c 656e  ck_ast_equivalen
-0001c3e0: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
-0001c3f0: 2727 270a 2020 2020 2020 2020 2020 2020  '''.            
-0001c400: 636c 6173 7320 413a 0a20 2020 2020 2020  class A:.       
-0001c410: 2020 2020 2020 2020 2022 2222 0a0a 2020           """..  
-0001c420: 2020 2020 2020 2020 2020 2020 2020 646f                do
-0001c430: 6373 7472 696e 670a 0a0a 2020 2020 2020  cstring...      
-0001c440: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
-0001c450: 2020 2020 2020 2020 2020 2727 272c 0a20            ''',. 
-0001c460: 2020 2020 2020 2020 2020 2027 2727 0a20             '''. 
-0001c470: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-0001c480: 2041 3a0a 2020 2020 2020 2020 2020 2020   A:.            
-0001c490: 2020 2020 2222 2264 6f63 7374 7269 6e67      """docstring
-0001c4a0: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0001c4b0: 2727 272c 0a20 2020 2020 2020 2029 0a20  ''',.        ). 
-0001c4c0: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
-0001c4d0: 6b5f 6173 745f 6571 7569 7661 6c65 6e63  k_ast_equivalenc
-0001c4e0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
-0001c4f0: 2222 0a20 2020 2020 2020 2020 2020 2064  "".            d
-0001c500: 6566 2066 2829 3a0a 2020 2020 2020 2020  ef f():.        
-0001c510: 2020 2020 2020 2020 2220 646f 6373 7472          " docstr
-0001c520: 696e 6720 2022 0a20 2020 2020 2020 2020  ing  ".         
-0001c530: 2020 2022 2222 2c0a 2020 2020 2020 2020     """,.        
-0001c540: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
-0001c550: 2020 2020 6465 6620 6628 293a 0a20 2020      def f():.   
-0001c560: 2020 2020 2020 2020 2020 2020 2022 2222               """
-0001c570: 646f 6373 7472 696e 6722 2222 0a20 2020  docstring""".   
-0001c580: 2020 2020 2020 2020 2027 2727 2c0a 2020           ''',.  
-0001c590: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001c5a0: 7365 6c66 2e63 6865 636b 5f61 7374 5f65  self.check_ast_e
-0001c5b0: 7175 6976 616c 656e 6365 280a 2020 2020  quivalence(.    
-0001c5c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001c5d0: 2020 2020 2020 2020 6173 796e 6320 6465          async de
-0001c5e0: 6620 6628 293a 0a20 2020 2020 2020 2020  f f():.         
-0001c5f0: 2020 2020 2020 2022 2020 2064 6f63 7374         "   docst
-0001c600: 7269 6e67 2020 220a 2020 2020 2020 2020  ring  ".        
-0001c610: 2020 2020 2222 222c 0a20 2020 2020 2020      """,.       
-0001c620: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
-0001c630: 2020 2020 2061 7379 6e63 2064 6566 2066       async def f
-0001c640: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0001c650: 2020 2020 2222 2264 6f63 7374 7269 6e67      """docstring
-0001c660: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0001c670: 2727 272c 0a20 2020 2020 2020 2029 0a20  ''',.        ). 
-0001c680: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
-0001c690: 6b5f 6173 745f 6571 7569 7661 6c65 6e63  k_ast_equivalenc
-0001c6a0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
-0001c6b0: 2222 0a20 2020 2020 2020 2020 2020 2069  "".            i
-0001c6c0: 6620 5f5f 6e61 6d65 5f5f 203d 3d20 225f  f __name__ == "_
-0001c6d0: 5f6d 6169 6e5f 5f22 3a0a 2020 2020 2020  _main__":.      
-0001c6e0: 2020 2020 2020 2020 2020 2220 2064 6f63            "  doc
-0001c6f0: 7374 7269 6e67 2d6c 696b 6520 2022 0a20  string-like  ". 
-0001c700: 2020 2020 2020 2020 2020 2022 2222 2c0a             """,.
-0001c710: 2020 2020 2020 2020 2020 2020 2727 270a              '''.
-0001c720: 2020 2020 2020 2020 2020 2020 6966 205f              if _
-0001c730: 5f6e 616d 655f 5f20 3d3d 2022 5f5f 6d61  _name__ == "__ma
-0001c740: 696e 5f5f 223a 0a20 2020 2020 2020 2020  in__":.         
-0001c750: 2020 2020 2020 2022 2222 646f 6373 7472         """docstr
-0001c760: 696e 672d 6c69 6b65 2222 220a 2020 2020  ing-like""".    
-0001c770: 2020 2020 2020 2020 2727 272c 0a20 2020          ''',.   
-0001c780: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-0001c790: 656c 662e 6368 6563 6b5f 6173 745f 6571  elf.check_ast_eq
-0001c7a0: 7569 7661 6c65 6e63 6528 7227 6465 6620  uivalence(r'def 
-0001c7b0: 6628 293a 2072 2220 5c6e 2022 272c 2072  f(): r" \n "', r
-0001c7c0: 2764 6566 2066 2829 3a20 225c 5c6e 2227  'def f(): "\\n"'
-0001c7d0: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
-0001c7e0: 6865 636b 5f61 7374 5f65 7175 6976 616c  heck_ast_equival
-0001c7f0: 656e 6365 2827 7472 793a 2070 6173 735c  ence('try: pass\
-0001c800: 6e65 7863 6570 743a 2022 2078 2022 272c  nexcept: " x "',
-0001c810: 2027 7472 793a 2070 6173 735c 6e65 7863   'try: pass\nexc
-0001c820: 6570 743a 2022 7822 2729 0a0a 2020 2020  ept: "x"')..    
-0001c830: 2020 2020 7365 6c66 2e63 6865 636b 5f61      self.check_a
-0001c840: 7374 5f65 7175 6976 616c 656e 6365 280a  st_equivalence(.
-0001c850: 2020 2020 2020 2020 2020 2020 2764 6566              'def
-0001c860: 2066 6f6f 2829 3a20 7265 7475 726e 2022   foo(): return "
-0001c870: 2078 2022 272c 2027 6465 6620 666f 6f28   x "', 'def foo(
-0001c880: 293a 2072 6574 7572 6e20 2278 2227 2c20  ): return "x"', 
-0001c890: 7368 6f75 6c64 5f66 6169 6c3d 5472 7565  should_fail=True
-0001c8a0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001c8b0: 6465 6620 7465 7374 5f61 7373 6572 745f  def test_assert_
-0001c8c0: 6571 7569 7661 6c65 6e74 5f66 7374 7269  equivalent_fstri
-0001c8d0: 6e67 2873 656c 6629 202d 3e20 4e6f 6e65  ng(self) -> None
-0001c8e0: 3a0a 2020 2020 2020 2020 6d61 6a6f 722c  :.        major,
-0001c8f0: 206d 696e 6f72 203d 2073 7973 2e76 6572   minor = sys.ver
-0001c900: 7369 6f6e 5f69 6e66 6f5b 3a32 5d0a 2020  sion_info[:2].  
-0001c910: 2020 2020 2020 6966 206d 616a 6f72 203c        if major <
-0001c920: 2033 206f 7220 286d 616a 6f72 203d 3d20   3 or (major == 
-0001c930: 3320 616e 6420 6d69 6e6f 7220 3c20 3132  3 and minor < 12
-0001c940: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-0001c950: 7974 6573 742e 736b 6970 2822 7265 6c69  ytest.skip("reli
-0001c960: 6573 206f 6e20 332e 3132 2b20 7379 6e74  es on 3.12+ synt
-0001c970: 6178 2229 0a20 2020 2020 2020 2023 2068  ax").        # h
-0001c980: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-0001c990: 6d2f 7073 662f 626c 6163 6b2f 6973 7375  m/psf/black/issu
-0001c9a0: 6573 2f34 3236 380a 2020 2020 2020 2020  es/4268.        
-0001c9b0: 7365 6c66 2e63 6865 636b 5f61 7374 5f65  self.check_ast_e
-0001c9c0: 7175 6976 616c 656e 6365 280a 2020 2020  quivalence(.    
-0001c9d0: 2020 2020 2020 2020 2222 2270 7269 6e74          """print
-0001c9e0: 2866 227b 227c 222e 6a6f 696e 285b 612c  (f"{"|".join([a,
-0001c9f0: 622c 635d 297d 2229 2222 222c 0a20 2020  b,c])}")""",.   
-0001ca00: 2020 2020 2020 2020 2022 2222 7072 696e           """prin
-0001ca10: 7428 6622 7b22 207c 2022 2e6a 6f69 6e28  t(f"{" | ".join(
-0001ca20: 5b61 2c62 2c63 5d29 7d22 2922 2222 2c0a  [a,b,c])}")""",.
-0001ca30: 2020 2020 2020 2020 2020 2020 7368 6f75              shou
-0001ca40: 6c64 5f66 6169 6c3d 5472 7565 2c0a 2020  ld_fail=True,.  
-0001ca50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001ca60: 7365 6c66 2e63 6865 636b 5f61 7374 5f65  self.check_ast_e
-0001ca70: 7175 6976 616c 656e 6365 280a 2020 2020  quivalence(.    
-0001ca80: 2020 2020 2020 2020 2222 2270 7269 6e74          """print
-0001ca90: 2866 227b 227c 222e 6a6f 696e 285b 2761  (f"{"|".join(['a
-0001caa0: 272c 2762 272c 2763 275d 297d 2229 2222  ','b','c'])}")""
-0001cab0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-0001cac0: 2222 7072 696e 7428 6622 7b22 207c 2022  ""print(f"{" | "
-0001cad0: 2e6a 6f69 6e28 5b27 6127 2c27 6227 2c27  .join(['a','b','
-0001cae0: 6327 5d29 7d22 2922 2222 2c0a 2020 2020  c'])}")""",.    
-0001caf0: 2020 2020 2020 2020 7368 6f75 6c64 5f66          should_f
-0001cb00: 6169 6c3d 5472 7565 2c0a 2020 2020 2020  ail=True,.      
-0001cb10: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
-0001cb20: 745f 6571 7569 7661 6c65 6e63 795f 6173  t_equivalency_as
-0001cb30: 745f 7061 7273 655f 6661 696c 7572 655f  t_parse_failure_
-0001cb40: 696e 636c 7564 6573 5f65 7272 6f72 2873  includes_error(s
-0001cb50: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-0001cb60: 2020 2020 2020 7769 7468 2070 7974 6573        with pytes
-0001cb70: 742e 7261 6973 6573 2841 5354 5361 6665  t.raises(ASTSafe
-0001cb80: 7479 4572 726f 7229 2061 7320 6572 723a  tyError) as err:
-0001cb90: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
-0001cba0: 636b 2e61 7373 6572 745f 6571 7569 7661  ck.assert_equiva
-0001cbb0: 6c65 6e74 2822 61c2 abc2 bb61 2020 3d20  lent("a....a  = 
-0001cbc0: 3122 2c20 2261 c2ab c2bb 6120 203d 2031  1", "a....a  = 1
-0001cbd0: 2229 0a0a 2020 2020 2020 2020 6572 722e  ")..        err.
-0001cbe0: 6d61 7463 6828 222d 2d73 6166 6522 290a  match("--safe").
-0001cbf0: 2020 2020 2020 2020 2320 556e 666f 7274          # Unfort
-0001cc00: 756e 6174 656c 7920 7468 6520 5379 6e74  unately the Synt
-0001cc10: 6178 4572 726f 7220 6d65 7373 6167 6520  axError message 
-0001cc20: 6861 7320 6368 616e 6765 6420 696e 206e  has changed in n
-0001cc30: 6577 6572 2076 6572 7369 6f6e 7320 736f  ewer versions so
-0001cc40: 2077 650a 2020 2020 2020 2020 2320 6361   we.        # ca
-0001cc50: 6e27 7420 6d61 7463 6820 6974 2064 6972  n't match it dir
-0001cc60: 6563 746c 792e 0a20 2020 2020 2020 2065  ectly..        e
-0001cc70: 7272 2e6d 6174 6368 2822 696e 7661 6c69  rr.match("invali
-0001cc80: 6420 6368 6172 6163 7465 7222 290a 2020  d character").  
-0001cc90: 2020 2020 2020 6572 722e 6d61 7463 6828        err.match(
-0001cca0: 7222 5c28 3c75 6e6b 6e6f 776e 3e2c 206c  r"\(<unknown>, l
-0001ccb0: 696e 6520 315c 2922 290a 0a0a 7472 793a  ine 1\)")...try:
-0001ccc0: 0a20 2020 2077 6974 6820 6f70 656e 2862  .    with open(b
-0001ccd0: 6c61 636b 2e5f 5f66 696c 655f 5f2c 2022  lack.__file__, "
-0001cce0: 7222 2c20 656e 636f 6469 6e67 3d22 7574  r", encoding="ut
-0001ccf0: 662d 3822 2920 6173 205f 6266 3a0a 2020  f-8") as _bf:.  
-0001cd00: 2020 2020 2020 626c 6163 6b5f 736f 7572        black_sour
-0001cd10: 6365 5f6c 696e 6573 203d 205f 6266 2e72  ce_lines = _bf.r
-0001cd20: 6561 646c 696e 6573 2829 0a65 7863 6570  eadlines().excep
-0001cd30: 7420 556e 6963 6f64 6544 6563 6f64 6545  t UnicodeDecodeE
-0001cd40: 7272 6f72 3a0a 2020 2020 6966 206e 6f74  rror:.    if not
-0001cd50: 2062 6c61 636b 2e43 4f4d 5049 4c45 443a   black.COMPILED:
-0001cd60: 0a20 2020 2020 2020 2072 6169 7365 0a0a  .        raise..
-0001cd70: 0a64 6566 2074 7261 6365 6675 6e63 280a  .def tracefunc(.
-0001cd80: 2020 2020 6672 616d 653a 2074 7970 6573      frame: types
-0001cd90: 2e46 7261 6d65 5479 7065 2c20 6576 656e  .FrameType, even
-0001cda0: 743a 2073 7472 2c20 6172 673a 2041 6e79  t: str, arg: Any
-0001cdb0: 0a29 202d 3e20 4361 6c6c 6162 6c65 5b5b  .) -> Callable[[
-0001cdc0: 7479 7065 732e 4672 616d 6554 7970 652c  types.FrameType,
-0001cdd0: 2073 7472 2c20 416e 795d 2c20 416e 795d   str, Any], Any]
-0001cde0: 3a0a 2020 2020 2222 2253 686f 7720 6675  :.    """Show fu
-0001cdf0: 6e63 7469 6f6e 2063 616c 6c73 2060 6672  nction calls `fr
-0001ce00: 6f6d 2062 6c61 636b 2f5f 5f69 6e69 745f  om black/__init_
-0001ce10: 5f2e 7079 6020 6173 2074 6865 7920 6861  _.py` as they ha
-0001ce20: 7070 656e 2e0a 0a20 2020 2052 6567 6973  ppen...    Regis
-0001ce30: 7465 7220 7468 6973 2077 6974 6820 6073  ter this with `s
-0001ce40: 7973 2e73 6574 7472 6163 6528 2960 2069  ys.settrace()` i
-0001ce50: 6e20 6120 7465 7374 2079 6f75 2772 6520  n a test you're 
-0001ce60: 6465 6275 6767 696e 672e 0a20 2020 2022  debugging..    "
-0001ce70: 2222 0a20 2020 2069 6620 6576 656e 7420  "".    if event 
-0001ce80: 213d 2022 6361 6c6c 223a 0a20 2020 2020  != "call":.     
-0001ce90: 2020 2072 6574 7572 6e20 7472 6163 6566     return tracef
-0001cea0: 756e 630a 0a20 2020 2073 7461 636b 203d  unc..    stack =
-0001ceb0: 206c 656e 2869 6e73 7065 6374 2e73 7461   len(inspect.sta
-0001cec0: 636b 2829 2920 2d20 3139 0a20 2020 2073  ck()) - 19.    s
-0001ced0: 7461 636b 202a 3d20 320a 2020 2020 6669  tack *= 2.    fi
-0001cee0: 6c65 6e61 6d65 203d 2066 7261 6d65 2e66  lename = frame.f
-0001cef0: 5f63 6f64 652e 636f 5f66 696c 656e 616d  _code.co_filenam
-0001cf00: 650a 2020 2020 6c69 6e65 6e6f 203d 2066  e.    lineno = f
-0001cf10: 7261 6d65 2e66 5f6c 696e 656e 6f0a 2020  rame.f_lineno.  
-0001cf20: 2020 6675 6e63 5f73 6967 5f6c 696e 656e    func_sig_linen
-0001cf30: 6f20 3d20 6c69 6e65 6e6f 202d 2031 0a20  o = lineno - 1. 
-0001cf40: 2020 2066 756e 636e 616d 6520 3d20 626c     funcname = bl
-0001cf50: 6163 6b5f 736f 7572 6365 5f6c 696e 6573  ack_source_lines
-0001cf60: 5b66 756e 635f 7369 675f 6c69 6e65 6e6f  [func_sig_lineno
-0001cf70: 5d2e 7374 7269 7028 290a 2020 2020 7768  ].strip().    wh
-0001cf80: 696c 6520 6675 6e63 6e61 6d65 2e73 7461  ile funcname.sta
-0001cf90: 7274 7377 6974 6828 2240 2229 3a0a 2020  rtswith("@"):.  
-0001cfa0: 2020 2020 2020 6675 6e63 5f73 6967 5f6c        func_sig_l
-0001cfb0: 696e 656e 6f20 2b3d 2031 0a20 2020 2020  ineno += 1.     
-0001cfc0: 2020 2066 756e 636e 616d 6520 3d20 626c     funcname = bl
-0001cfd0: 6163 6b5f 736f 7572 6365 5f6c 696e 6573  ack_source_lines
-0001cfe0: 5b66 756e 635f 7369 675f 6c69 6e65 6e6f  [func_sig_lineno
-0001cff0: 5d2e 7374 7269 7028 290a 2020 2020 6966  ].strip().    if
-0001d000: 2022 626c 6163 6b2f 5f5f 696e 6974 5f5f   "black/__init__
-0001d010: 2e70 7922 2069 6e20 6669 6c65 6e61 6d65  .py" in filename
-0001d020: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-0001d030: 6622 7b27 2027 202a 2073 7461 636b 7d7b  f"{' ' * stack}{
-0001d040: 6c69 6e65 6e6f 7d3a 7b66 756e 636e 616d  lineno}:{funcnam
-0001d050: 657d 2229 0a20 2020 2072 6574 7572 6e20  e}").    return 
-0001d060: 7472 6163 6566 756e 630a                 tracefunc.
+00013230: 7361 6665 222c 2022 2d2d 636f 6465 222c  safe", "--code",
+00013240: 2063 6f64 655d 0a20 2020 2020 2020 2020   code].         
+00013250: 2020 2072 6573 756c 7420 3d20 436c 6952     result = CliR
+00013260: 756e 6e65 7228 292e 696e 766f 6b65 2862  unner().invoke(b
+00013270: 6c61 636b 2e6d 6169 6e2c 2061 7267 7329  lack.main, args)
+00013280: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00013290: 6c66 2e63 6f6d 7061 7265 5f72 6573 756c  lf.compare_resul
+000132a0: 7473 2872 6573 756c 742c 2065 7272 6f72  ts(result, error
+000132b0: 5f6d 7367 2c20 3132 3329 0a0a 2020 2020  _msg, 123)..    
+000132c0: 6465 6620 7465 7374 5f63 6f64 655f 6f70  def test_code_op
+000132d0: 7469 6f6e 5f66 6173 7428 7365 6c66 2920  tion_fast(self) 
+000132e0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+000132f0: 2022 2222 5465 7374 2074 6861 7420 7468   """Test that th
+00013300: 6520 636f 6465 206f 7074 696f 6e20 6967  e code option ig
+00013310: 6e6f 7265 7320 6572 726f 7273 2077 6865  nores errors whe
+00013320: 6e20 7468 6520 7361 6e69 7479 2063 6865  n the sanity che
+00013330: 636b 7320 6661 696c 2e22 2222 0a20 2020  cks fail.""".   
+00013340: 2020 2020 2023 2050 6174 6368 2062 6c61       # Patch bla
+00013350: 636b 2e61 7373 6572 745f 6571 7569 7661  ck.assert_equiva
+00013360: 6c65 6e74 2074 6f20 656e 7375 7265 2074  lent to ensure t
+00013370: 6865 2073 616e 6974 7920 6368 6563 6b73  he sanity checks
+00013380: 2066 6169 6c0a 2020 2020 2020 2020 7769   fail.        wi
+00013390: 7468 2070 6174 6368 2e6f 626a 6563 7428  th patch.object(
+000133a0: 626c 6163 6b2c 2022 6173 7365 7274 5f65  black, "assert_e
+000133b0: 7175 6976 616c 656e 7422 2c20 7369 6465  quivalent", side
+000133c0: 5f65 6666 6563 743d 4173 7365 7274 696f  _effect=Assertio
+000133d0: 6e45 7272 6f72 293a 0a20 2020 2020 2020  nError):.       
+000133e0: 2020 2020 2063 6f64 6520 3d20 2770 7269       code = 'pri
+000133f0: 6e74 2822 4865 6c6c 6f20 776f 726c 6422  nt("Hello world"
+00013400: 2927 0a20 2020 2020 2020 2020 2020 2066  )'.            f
+00013410: 6f72 6d61 7474 6564 203d 2062 6c61 636b  ormatted = black
+00013420: 2e66 6f72 6d61 745f 7374 7228 636f 6465  .format_str(code
+00013430: 2c20 6d6f 6465 3d44 4546 4155 4c54 5f4d  , mode=DEFAULT_M
+00013440: 4f44 4529 0a0a 2020 2020 2020 2020 2020  ODE)..          
+00013450: 2020 6172 6773 203d 205b 222d 2d66 6173    args = ["--fas
+00013460: 7422 2c20 222d 2d63 6f64 6522 2c20 636f  t", "--code", co
+00013470: 6465 5d0a 2020 2020 2020 2020 2020 2020  de].            
+00013480: 7265 7375 6c74 203d 2043 6c69 5275 6e6e  result = CliRunn
+00013490: 6572 2829 2e69 6e76 6f6b 6528 626c 6163  er().invoke(blac
+000134a0: 6b2e 6d61 696e 2c20 6172 6773 290a 0a20  k.main, args).. 
+000134b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000134c0: 636f 6d70 6172 655f 7265 7375 6c74 7328  compare_results(
+000134d0: 7265 7375 6c74 2c20 666f 726d 6174 7465  result, formatte
+000134e0: 642c 2030 290a 0a20 2020 2040 7079 7465  d, 0)..    @pyte
+000134f0: 7374 2e6d 6172 6b2e 696e 636f 6d70 6174  st.mark.incompat
+00013500: 6962 6c65 5f77 6974 685f 6d79 7079 630a  ible_with_mypyc.
+00013510: 2020 2020 6465 6620 7465 7374 5f63 6f64      def test_cod
+00013520: 655f 6f70 7469 6f6e 5f63 6f6e 6669 6728  e_option_config(
+00013530: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00013540: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013550: 2020 2054 6573 7420 7468 6174 2074 6865     Test that the
+00013560: 2063 6f64 6520 6f70 7469 6f6e 2066 696e   code option fin
+00013570: 6473 2074 6865 2070 7970 726f 6a65 6374  ds the pyproject
+00013580: 2e74 6f6d 6c20 696e 2074 6865 2063 7572  .toml in the cur
+00013590: 7265 6e74 2064 6972 6563 746f 7279 2e0a  rent directory..
+000135a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000135b0: 2020 2020 7769 7468 2070 6174 6368 2e6f      with patch.o
+000135c0: 626a 6563 7428 626c 6163 6b2c 2022 7061  bject(black, "pa
+000135d0: 7273 655f 7079 7072 6f6a 6563 745f 746f  rse_pyproject_to
+000135e0: 6d6c 222c 2072 6574 7572 6e5f 7661 6c75  ml", return_valu
+000135f0: 653d 7b7d 2920 6173 2070 6172 7365 3a0a  e={}) as parse:.
+00013600: 2020 2020 2020 2020 2020 2020 6172 6773              args
+00013610: 203d 205b 222d 2d63 6f64 6522 2c20 2270   = ["--code", "p
+00013620: 7269 6e74 225d 0a20 2020 2020 2020 2020  rint"].         
+00013630: 2020 2023 2054 6869 7320 6973 2074 6865     # This is the
+00013640: 206f 6e6c 7920 6469 7265 6374 6f72 7920   only directory 
+00013650: 6b6e 6f77 6e20 746f 2063 6f6e 7461 696e  known to contain
+00013660: 2061 2070 7970 726f 6a65 6374 2e74 6f6d   a pyproject.tom
+00013670: 6c0a 2020 2020 2020 2020 2020 2020 7769  l.            wi
+00013680: 7468 2063 6861 6e67 655f 6469 7265 6374  th change_direct
+00013690: 6f72 7928 5052 4f4a 4543 545f 524f 4f54  ory(PROJECT_ROOT
+000136a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000136b0: 2020 2043 6c69 5275 6e6e 6572 2829 2e69     CliRunner().i
+000136c0: 6e76 6f6b 6528 626c 6163 6b2e 6d61 696e  nvoke(black.main
+000136d0: 2c20 6172 6773 290a 2020 2020 2020 2020  , args).        
+000136e0: 2020 2020 2020 2020 7079 7072 6f6a 6563          pyprojec
+000136f0: 745f 7061 7468 203d 2050 6174 6828 5061  t_path = Path(Pa
+00013700: 7468 2e63 7764 2829 2c20 2270 7970 726f  th.cwd(), "pypro
+00013710: 6a65 6374 2e74 6f6d 6c22 292e 7265 736f  ject.toml").reso
+00013720: 6c76 6528 290a 0a20 2020 2020 2020 2020  lve()..         
+00013730: 2020 2061 7373 6572 7420 280a 2020 2020     assert (.    
+00013740: 2020 2020 2020 2020 2020 2020 6c65 6e28              len(
+00013750: 7061 7273 652e 6d6f 636b 5f63 616c 6c73  parse.mock_calls
+00013760: 2920 3e3d 2031 0a20 2020 2020 2020 2020  ) >= 1.         
+00013770: 2020 2029 2c20 2245 7870 6563 7465 6420     ), "Expected 
+00013780: 636f 6e66 6967 2070 6172 7365 2074 6f20  config parse to 
+00013790: 6265 2063 616c 6c65 6420 7769 7468 2074  be called with t
+000137a0: 6865 2063 7572 7265 6e74 2064 6972 6563  he current direc
+000137b0: 746f 7279 2e22 0a0a 2020 2020 2020 2020  tory."..        
+000137c0: 2020 2020 5f2c 2063 616c 6c5f 6172 6773      _, call_args
+000137d0: 2c20 5f20 3d20 7061 7273 652e 6d6f 636b  , _ = parse.mock
+000137e0: 5f63 616c 6c73 5b30 5d0a 2020 2020 2020  _calls[0].      
+000137f0: 2020 2020 2020 6173 7365 7274 2028 0a20        assert (. 
+00013800: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00013810: 616c 6c5f 6172 6773 5b30 5d2e 6c6f 7765  all_args[0].lowe
+00013820: 7228 2920 3d3d 2073 7472 2870 7970 726f  r() == str(pypro
+00013830: 6a65 6374 5f70 6174 6829 2e6c 6f77 6572  ject_path).lower
+00013840: 2829 0a20 2020 2020 2020 2020 2020 2029  ().            )
+00013850: 2c20 2249 6e63 6f72 7265 6374 2063 6f6e  , "Incorrect con
+00013860: 6669 6720 6c6f 6164 6564 2e22 0a0a 2020  fig loaded."..  
+00013870: 2020 4070 7974 6573 742e 6d61 726b 2e69    @pytest.mark.i
+00013880: 6e63 6f6d 7061 7469 626c 655f 7769 7468  ncompatible_with
+00013890: 5f6d 7970 7963 0a20 2020 2064 6566 2074  _mypyc.    def t
+000138a0: 6573 745f 636f 6465 5f6f 7074 696f 6e5f  est_code_option_
+000138b0: 7061 7265 6e74 5f63 6f6e 6669 6728 7365  parent_config(se
+000138c0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+000138d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000138e0: 2054 6573 7420 7468 6174 2074 6865 2063   Test that the c
+000138f0: 6f64 6520 6f70 7469 6f6e 2066 696e 6473  ode option finds
+00013900: 2074 6865 2070 7970 726f 6a65 6374 2e74   the pyproject.t
+00013910: 6f6d 6c20 696e 2074 6865 2070 6172 656e  oml in the paren
+00013920: 7420 6469 7265 6374 6f72 792e 0a20 2020  t directory..   
+00013930: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013940: 2077 6974 6820 7061 7463 682e 6f62 6a65   with patch.obje
+00013950: 6374 2862 6c61 636b 2c20 2270 6172 7365  ct(black, "parse
+00013960: 5f70 7970 726f 6a65 6374 5f74 6f6d 6c22  _pyproject_toml"
+00013970: 2c20 7265 7475 726e 5f76 616c 7565 3d7b  , return_value={
+00013980: 7d29 2061 7320 7061 7273 653a 0a20 2020  }) as parse:.   
+00013990: 2020 2020 2020 2020 2077 6974 6820 6368           with ch
+000139a0: 616e 6765 5f64 6972 6563 746f 7279 2854  ange_directory(T
+000139b0: 4849 535f 4449 5229 3a0a 2020 2020 2020  HIS_DIR):.      
+000139c0: 2020 2020 2020 2020 2020 6172 6773 203d            args =
+000139d0: 205b 222d 2d63 6f64 6522 2c20 2270 7269   ["--code", "pri
+000139e0: 6e74 225d 0a20 2020 2020 2020 2020 2020  nt"].           
+000139f0: 2020 2020 2043 6c69 5275 6e6e 6572 2829       CliRunner()
+00013a00: 2e69 6e76 6f6b 6528 626c 6163 6b2e 6d61  .invoke(black.ma
+00013a10: 696e 2c20 6172 6773 290a 0a20 2020 2020  in, args)..     
+00013a20: 2020 2020 2020 2020 2020 2070 7970 726f             pypro
+00013a30: 6a65 6374 5f70 6174 6820 3d20 5061 7468  ject_path = Path
+00013a40: 2850 6174 6828 292e 6377 6428 292e 7061  (Path().cwd().pa
+00013a50: 7265 6e74 2c20 2270 7970 726f 6a65 6374  rent, "pyproject
+00013a60: 2e74 6f6d 6c22 292e 7265 736f 6c76 6528  .toml").resolve(
+00013a70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013a80: 2020 6173 7365 7274 2028 0a20 2020 2020    assert (.     
+00013a90: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00013aa0: 656e 2870 6172 7365 2e6d 6f63 6b5f 6361  en(parse.mock_ca
+00013ab0: 6c6c 7329 203e 3d20 310a 2020 2020 2020  lls) >= 1.      
+00013ac0: 2020 2020 2020 2020 2020 292c 2022 4578            ), "Ex
+00013ad0: 7065 6374 6564 2063 6f6e 6669 6720 7061  pected config pa
+00013ae0: 7273 6520 746f 2062 6520 6361 6c6c 6564  rse to be called
+00013af0: 2077 6974 6820 7468 6520 6375 7272 656e   with the curren
+00013b00: 7420 6469 7265 6374 6f72 792e 220a 0a20  t directory.".. 
+00013b10: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00013b20: 2c20 6361 6c6c 5f61 7267 732c 205f 203d  , call_args, _ =
+00013b30: 2070 6172 7365 2e6d 6f63 6b5f 6361 6c6c   parse.mock_call
+00013b40: 735b 305d 0a20 2020 2020 2020 2020 2020  s[0].           
+00013b50: 2020 2020 2061 7373 6572 7420 280a 2020       assert (.  
+00013b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b70: 2020 6361 6c6c 5f61 7267 735b 305d 2e6c    call_args[0].l
+00013b80: 6f77 6572 2829 203d 3d20 7374 7228 7079  ower() == str(py
+00013b90: 7072 6f6a 6563 745f 7061 7468 292e 6c6f  project_path).lo
+00013ba0: 7765 7228 290a 2020 2020 2020 2020 2020  wer().          
+00013bb0: 2020 2020 2020 292c 2022 496e 636f 7272        ), "Incorr
+00013bc0: 6563 7420 636f 6e66 6967 206c 6f61 6465  ect config loade
+00013bd0: 642e 220a 0a20 2020 2064 6566 2074 6573  d."..    def tes
+00013be0: 745f 666f 725f 6861 6e64 6c65 645f 756e  t_for_handled_un
+00013bf0: 6578 7065 6374 6564 5f65 6f66 5f65 7272  expected_eof_err
+00013c00: 6f72 2873 656c 6629 202d 3e20 4e6f 6e65  or(self) -> None
+00013c10: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00013c20: 2020 2020 2020 5465 7374 2074 6861 7420        Test that 
+00013c30: 616e 2075 6e65 7870 6563 7465 6420 454f  an unexpected EO
+00013c40: 4620 5379 6e74 6178 4572 726f 7220 6973  F SyntaxError is
+00013c50: 206e 6963 656c 7920 7072 6573 656e 7465   nicely presente
+00013c60: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
+00013c70: 2020 2020 2020 2077 6974 6820 7079 7465         with pyte
+00013c80: 7374 2e72 6169 7365 7328 626c 6163 6b2e  st.raises(black.
+00013c90: 7061 7273 696e 672e 496e 7661 6c69 6449  parsing.InvalidI
+00013ca0: 6e70 7574 2920 6173 2065 7863 5f69 6e66  nput) as exc_inf
+00013cb0: 6f3a 0a20 2020 2020 2020 2020 2020 2062  o:.            b
+00013cc0: 6c61 636b 2e6c 6962 3274 6f33 5f70 6172  lack.lib2to3_par
+00013cd0: 7365 2822 7072 696e 7428 222c 207b 7d29  se("print(", {})
+00013ce0: 0a0a 2020 2020 2020 2020 6578 635f 696e  ..        exc_in
+00013cf0: 666f 2e6d 6174 6368 2822 4361 6e6e 6f74  fo.match("Cannot
+00013d00: 2070 6172 7365 3a20 323a 303a 2045 4f46   parse: 2:0: EOF
+00013d10: 2069 6e20 6d75 6c74 692d 6c69 6e65 2073   in multi-line s
+00013d20: 7461 7465 6d65 6e74 2229 0a0a 2020 2020  tatement")..    
+00013d30: 6465 6620 7465 7374 5f6c 696e 655f 7261  def test_line_ra
+00013d40: 6e67 6573 5f77 6974 685f 636f 6465 5f6f  nges_with_code_o
+00013d50: 7074 696f 6e28 7365 6c66 2920 2d3e 204e  ption(self) -> N
+00013d60: 6f6e 653a 0a20 2020 2020 2020 2063 6f64  one:.        cod
+00013d70: 6520 3d20 7465 7874 7772 6170 2e64 6564  e = textwrap.ded
+00013d80: 656e 7428 2222 225c 0a20 2020 2020 2020  ent("""\.       
+00013d90: 2020 2020 2069 6620 2061 2020 3d3d 2020       if  a  ==  
+00013da0: 623a 0a20 2020 2020 2020 2020 2020 2020  b:.             
+00013db0: 2020 2070 7269 6e74 2020 2820 224f 4b22     print  ( "OK"
+00013dc0: 2029 0a20 2020 2020 2020 2020 2020 2022   ).            "
+00013dd0: 2222 290a 2020 2020 2020 2020 6172 6773  "").        args
+00013de0: 203d 205b 222d 2d6c 696e 652d 7261 6e67   = ["--line-rang
+00013df0: 6573 3d31 2d31 222c 2022 2d2d 636f 6465  es=1-1", "--code
+00013e00: 222c 2063 6f64 655d 0a20 2020 2020 2020  ", code].       
+00013e10: 2072 6573 756c 7420 3d20 436c 6952 756e   result = CliRun
+00013e20: 6e65 7228 292e 696e 766f 6b65 2862 6c61  ner().invoke(bla
+00013e30: 636b 2e6d 6169 6e2c 2061 7267 7329 0a0a  ck.main, args)..
+00013e40: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+00013e50: 203d 2074 6578 7477 7261 702e 6465 6465   = textwrap.dede
+00013e60: 6e74 2822 2222 5c0a 2020 2020 2020 2020  nt("""\.        
+00013e70: 2020 2020 6966 2061 203d 3d20 623a 0a20      if a == b:. 
+00013e80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00013e90: 7269 6e74 2020 2820 224f 4b22 2029 0a20  rint  ( "OK" ). 
+00013ea0: 2020 2020 2020 2020 2020 2022 2222 290a             """).
+00013eb0: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+00013ec0: 7061 7265 5f72 6573 756c 7473 2872 6573  pare_results(res
+00013ed0: 756c 742c 2065 7870 6563 7465 642c 2065  ult, expected, e
+00013ee0: 7870 6563 7465 645f 6578 6974 5f63 6f64  xpected_exit_cod
+00013ef0: 653d 3029 0a0a 2020 2020 6465 6620 7465  e=0)..    def te
+00013f00: 7374 5f6c 696e 655f 7261 6e67 6573 5f77  st_line_ranges_w
+00013f10: 6974 685f 7374 6469 6e28 7365 6c66 2920  ith_stdin(self) 
+00013f20: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00013f30: 2063 6f64 6520 3d20 7465 7874 7772 6170   code = textwrap
+00013f40: 2e64 6564 656e 7428 2222 225c 0a20 2020  .dedent("""\.   
+00013f50: 2020 2020 2020 2020 2069 6620 2061 2020           if  a  
+00013f60: 3d3d 2020 623a 0a20 2020 2020 2020 2020  ==  b:.         
+00013f70: 2020 2020 2020 2070 7269 6e74 2020 2820         print  ( 
+00013f80: 224f 4b22 2029 0a20 2020 2020 2020 2020  "OK" ).         
+00013f90: 2020 2022 2222 290a 2020 2020 2020 2020     """).        
+00013fa0: 7275 6e6e 6572 203d 2042 6c61 636b 5275  runner = BlackRu
+00013fb0: 6e6e 6572 2829 0a20 2020 2020 2020 2072  nner().        r
+00013fc0: 6573 756c 7420 3d20 7275 6e6e 6572 2e69  esult = runner.i
+00013fd0: 6e76 6f6b 6528 0a20 2020 2020 2020 2020  nvoke(.         
+00013fe0: 2020 2062 6c61 636b 2e6d 6169 6e2c 205b     black.main, [
+00013ff0: 222d 2d6c 696e 652d 7261 6e67 6573 3d31  "--line-ranges=1
+00014000: 2d31 222c 2022 2d22 5d2c 2069 6e70 7574  -1", "-"], input
+00014010: 3d42 7974 6573 494f 2863 6f64 652e 656e  =BytesIO(code.en
+00014020: 636f 6465 2822 7574 662d 3822 2929 0a20  code("utf-8")). 
+00014030: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00014040: 2020 6578 7065 6374 6564 203d 2074 6578    expected = tex
+00014050: 7477 7261 702e 6465 6465 6e74 2822 2222  twrap.dedent("""
+00014060: 5c0a 2020 2020 2020 2020 2020 2020 6966  \.            if
+00014070: 2061 203d 3d20 623a 0a20 2020 2020 2020   a == b:.       
+00014080: 2020 2020 2020 2020 2070 7269 6e74 2020           print  
+00014090: 2820 224f 4b22 2029 0a20 2020 2020 2020  ( "OK" ).       
+000140a0: 2020 2020 2022 2222 290a 2020 2020 2020       """).      
+000140b0: 2020 7365 6c66 2e63 6f6d 7061 7265 5f72    self.compare_r
+000140c0: 6573 756c 7473 2872 6573 756c 742c 2065  esults(result, e
+000140d0: 7870 6563 7465 642c 2065 7870 6563 7465  xpected, expecte
+000140e0: 645f 6578 6974 5f63 6f64 653d 3029 0a0a  d_exit_code=0)..
+000140f0: 2020 2020 6465 6620 7465 7374 5f6c 696e      def test_lin
+00014100: 655f 7261 6e67 6573 5f77 6974 685f 736f  e_ranges_with_so
+00014110: 7572 6365 2873 656c 6629 202d 3e20 4e6f  urce(self) -> No
+00014120: 6e65 3a0a 2020 2020 2020 2020 7769 7468  ne:.        with
+00014130: 2054 656d 706f 7261 7279 4469 7265 6374   TemporaryDirect
+00014140: 6f72 7928 2920 6173 2077 6f72 6b73 7061  ory() as workspa
+00014150: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00014160: 7465 7374 5f66 696c 6520 3d20 5061 7468  test_file = Path
+00014170: 2877 6f72 6b73 7061 6365 2920 2f20 2274  (workspace) / "t
+00014180: 6573 742e 7079 220a 2020 2020 2020 2020  est.py".        
+00014190: 2020 2020 7465 7374 5f66 696c 652e 7772      test_file.wr
+000141a0: 6974 655f 7465 7874 280a 2020 2020 2020  ite_text(.      
+000141b0: 2020 2020 2020 2020 2020 7465 7874 7772            textwr
+000141c0: 6170 2e64 6564 656e 7428 2222 225c 0a20  ap.dedent("""\. 
+000141d0: 2020 2020 2020 2020 2020 2069 6620 2061             if  a
+000141e0: 2020 3d3d 2020 623a 0a20 2020 2020 2020    ==  b:.       
+000141f0: 2020 2020 2020 2020 2070 7269 6e74 2020           print  
+00014200: 2820 224f 4b22 2029 0a20 2020 2020 2020  ( "OK" ).       
+00014210: 2020 2020 2022 2222 292c 0a20 2020 2020       """),.     
+00014220: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
+00014230: 696e 673d 2275 7466 2d38 222c 0a20 2020  ing="utf-8",.   
+00014240: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00014250: 2020 2020 2020 2061 7267 7320 3d20 5b22         args = ["
+00014260: 2d2d 6c69 6e65 2d72 616e 6765 733d 312d  --line-ranges=1-
+00014270: 3122 2c20 7374 7228 7465 7374 5f66 696c  1", str(test_fil
+00014280: 6529 5d0a 2020 2020 2020 2020 2020 2020  e)].            
+00014290: 7265 7375 6c74 203d 2043 6c69 5275 6e6e  result = CliRunn
+000142a0: 6572 2829 2e69 6e76 6f6b 6528 626c 6163  er().invoke(blac
+000142b0: 6b2e 6d61 696e 2c20 6172 6773 290a 2020  k.main, args).  
+000142c0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+000142d0: 206e 6f74 2072 6573 756c 742e 6578 6974   not result.exit
+000142e0: 5f63 6f64 650a 0a20 2020 2020 2020 2020  _code..         
+000142f0: 2020 2066 6f72 6d61 7474 6564 203d 2074     formatted = t
+00014300: 6573 745f 6669 6c65 2e72 6561 645f 7465  est_file.read_te
+00014310: 7874 2865 6e63 6f64 696e 673d 2275 7466  xt(encoding="utf
+00014320: 2d38 2229 0a20 2020 2020 2020 2020 2020  -8").           
+00014330: 2065 7870 6563 7465 6420 3d20 7465 7874   expected = text
+00014340: 7772 6170 2e64 6564 656e 7428 2222 225c  wrap.dedent("""\
+00014350: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00014360: 6120 3d3d 2062 3a0a 2020 2020 2020 2020  a == b:.        
+00014370: 2020 2020 2020 2020 7072 696e 7420 2028          print  (
+00014380: 2022 4f4b 2220 290a 2020 2020 2020 2020   "OK" ).        
+00014390: 2020 2020 2222 2229 0a20 2020 2020 2020      """).       
+000143a0: 2020 2020 2061 7373 6572 7420 6578 7065       assert expe
+000143b0: 6374 6564 203d 3d20 666f 726d 6174 7465  cted == formatte
+000143c0: 640a 0a20 2020 2064 6566 2074 6573 745f  d..    def test_
+000143d0: 6c69 6e65 5f72 616e 6765 735f 7769 7468  line_ranges_with
+000143e0: 5f6d 756c 7469 706c 655f 736f 7572 6365  _multiple_source
+000143f0: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
+00014400: 0a20 2020 2020 2020 2077 6974 6820 5465  .        with Te
+00014410: 6d70 6f72 6172 7944 6972 6563 746f 7279  mporaryDirectory
+00014420: 2829 2061 7320 776f 726b 7370 6163 653a  () as workspace:
+00014430: 0a20 2020 2020 2020 2020 2020 2074 6573  .            tes
+00014440: 7431 5f66 696c 6520 3d20 5061 7468 2877  t1_file = Path(w
+00014450: 6f72 6b73 7061 6365 2920 2f20 2274 6573  orkspace) / "tes
+00014460: 7431 2e70 7922 0a20 2020 2020 2020 2020  t1.py".         
+00014470: 2020 2074 6573 7431 5f66 696c 652e 7772     test1_file.wr
+00014480: 6974 655f 7465 7874 2822 222c 2065 6e63  ite_text("", enc
+00014490: 6f64 696e 673d 2275 7466 2d38 2229 0a20  oding="utf-8"). 
+000144a0: 2020 2020 2020 2020 2020 2074 6573 7432             test2
+000144b0: 5f66 696c 6520 3d20 5061 7468 2877 6f72  _file = Path(wor
+000144c0: 6b73 7061 6365 2920 2f20 2274 6573 7432  kspace) / "test2
+000144d0: 2e70 7922 0a20 2020 2020 2020 2020 2020  .py".           
+000144e0: 2074 6573 7432 5f66 696c 652e 7772 6974   test2_file.writ
+000144f0: 655f 7465 7874 2822 222c 2065 6e63 6f64  e_text("", encod
+00014500: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
+00014510: 2020 2020 2020 2020 2061 7267 7320 3d20           args = 
+00014520: 5b22 2d2d 6c69 6e65 2d72 616e 6765 733d  ["--line-ranges=
+00014530: 312d 3122 2c20 7374 7228 7465 7374 315f  1-1", str(test1_
+00014540: 6669 6c65 292c 2073 7472 2874 6573 7432  file), str(test2
+00014550: 5f66 696c 6529 5d0a 2020 2020 2020 2020  _file)].        
+00014560: 2020 2020 7265 7375 6c74 203d 2043 6c69      result = Cli
+00014570: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
+00014580: 626c 6163 6b2e 6d61 696e 2c20 6172 6773  black.main, args
+00014590: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+000145a0: 7365 7274 2072 6573 756c 742e 6578 6974  sert result.exit
+000145b0: 5f63 6f64 6520 3d3d 2031 0a20 2020 2020  _code == 1.     
+000145c0: 2020 2020 2020 2061 7373 6572 7420 2243         assert "C
+000145d0: 616e 6e6f 7420 7573 6520 2d2d 6c69 6e65  annot use --line
+000145e0: 2d72 616e 6765 7320 746f 2066 6f72 6d61  -ranges to forma
+000145f0: 7420 6d75 6c74 6970 6c65 2066 696c 6573  t multiple files
+00014600: 2220 696e 2072 6573 756c 742e 6f75 7470  " in result.outp
+00014610: 7574 0a0a 2020 2020 6465 6620 7465 7374  ut..    def test
+00014620: 5f6c 696e 655f 7261 6e67 6573 5f77 6974  _line_ranges_wit
+00014630: 685f 6970 796e 6228 7365 6c66 2920 2d3e  h_ipynb(self) ->
+00014640: 204e 6f6e 653a 0a20 2020 2020 2020 2077   None:.        w
+00014650: 6974 6820 5465 6d70 6f72 6172 7944 6972  ith TemporaryDir
+00014660: 6563 746f 7279 2829 2061 7320 776f 726b  ectory() as work
+00014670: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
+00014680: 2020 2074 6573 745f 6669 6c65 203d 2050     test_file = P
+00014690: 6174 6828 776f 726b 7370 6163 6529 202f  ath(workspace) /
+000146a0: 2022 7465 7374 2e69 7079 6e62 220a 2020   "test.ipynb".  
+000146b0: 2020 2020 2020 2020 2020 7465 7374 5f66            test_f
+000146c0: 696c 652e 7772 6974 655f 7465 7874 2822  ile.write_text("
+000146d0: 7b7d 222c 2065 6e63 6f64 696e 673d 2275  {}", encoding="u
+000146e0: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
+000146f0: 2020 2061 7267 7320 3d20 5b22 2d2d 6c69     args = ["--li
+00014700: 6e65 2d72 616e 6765 733d 312d 3122 2c20  ne-ranges=1-1", 
+00014710: 222d 2d69 7079 6e62 222c 2073 7472 2874  "--ipynb", str(t
+00014720: 6573 745f 6669 6c65 295d 0a20 2020 2020  est_file)].     
+00014730: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00014740: 436c 6952 756e 6e65 7228 292e 696e 766f  CliRunner().invo
+00014750: 6b65 2862 6c61 636b 2e6d 6169 6e2c 2061  ke(black.main, a
+00014760: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
+00014770: 2061 7373 6572 7420 2243 616e 6e6f 7420   assert "Cannot 
+00014780: 7573 6520 2d2d 6c69 6e65 2d72 616e 6765  use --line-range
+00014790: 7320 7769 7468 2069 7079 6e62 2066 696c  s with ipynb fil
+000147a0: 6573 2220 696e 2072 6573 756c 742e 6f75  es" in result.ou
+000147b0: 7470 7574 0a20 2020 2020 2020 2020 2020  tput.           
+000147c0: 2061 7373 6572 7420 7265 7375 6c74 2e65   assert result.e
+000147d0: 7869 745f 636f 6465 203d 3d20 310a 0a20  xit_code == 1.. 
+000147e0: 2020 2064 6566 2074 6573 745f 6c69 6e65     def test_line
+000147f0: 5f72 616e 6765 735f 696e 5f70 7970 726f  _ranges_in_pypro
+00014800: 6a65 6374 5f74 6f6d 6c28 7365 6c66 2920  ject_toml(self) 
+00014810: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00014820: 2063 6f6e 6669 6720 3d20 5448 4953 5f44   config = THIS_D
+00014830: 4952 202f 2022 6461 7461 2220 2f20 2269  IR / "data" / "i
+00014840: 6e76 616c 6964 5f6c 696e 655f 7261 6e67  nvalid_line_rang
+00014850: 6573 2e74 6f6d 6c22 0a20 2020 2020 2020  es.toml".       
+00014860: 2072 6573 756c 7420 3d20 426c 6163 6b52   result = BlackR
+00014870: 756e 6e65 7228 292e 696e 766f 6b65 280a  unner().invoke(.
+00014880: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+00014890: 6b2e 6d61 696e 2c20 5b22 2d2d 636f 6465  k.main, ["--code
+000148a0: 222c 2022 7072 696e 7428 2922 2c20 222d  ", "print()", "-
+000148b0: 2d63 6f6e 6669 6722 2c20 7374 7228 636f  -config", str(co
+000148c0: 6e66 6967 295d 0a20 2020 2020 2020 2029  nfig)].        )
+000148d0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+000148e0: 7265 7375 6c74 2e65 7869 745f 636f 6465  result.exit_code
+000148f0: 203d 3d20 320a 2020 2020 2020 2020 6173   == 2.        as
+00014900: 7365 7274 2072 6573 756c 742e 7374 6465  sert result.stde
+00014910: 7272 5f62 7974 6573 2069 7320 6e6f 7420  rr_bytes is not 
+00014920: 4e6f 6e65 0a20 2020 2020 2020 2061 7373  None.        ass
+00014930: 6572 7420 280a 2020 2020 2020 2020 2020  ert (.          
+00014940: 2020 6222 4361 6e6e 6f74 2075 7365 206c    b"Cannot use l
+00014950: 696e 652d 7261 6e67 6573 2069 6e20 7468  ine-ranges in th
+00014960: 6520 7079 7072 6f6a 6563 742e 746f 6d6c  e pyproject.toml
+00014970: 2066 696c 652e 2220 696e 2072 6573 756c   file." in resul
+00014980: 742e 7374 6465 7272 5f62 7974 6573 0a20  t.stderr_bytes. 
+00014990: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+000149a0: 6620 7465 7374 5f6c 696e 6573 5f77 6974  f test_lines_wit
+000149b0: 685f 6c65 6164 696e 675f 7461 6273 5f65  h_leading_tabs_e
+000149c0: 7870 616e 6465 6428 7365 6c66 2920 2d3e  xpanded(self) ->
+000149d0: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
+000149e0: 2053 6565 2043 5645 2d32 3032 342d 3231   See CVE-2024-21
+000149f0: 3530 332e 204d 6f73 746c 7920 7465 7374  503. Mostly test
+00014a00: 2074 6861 7420 7468 6973 2063 6f6d 706c   that this compl
+00014a10: 6574 6573 2069 6e20 6120 7265 6173 6f6e  etes in a reason
+00014a20: 6162 6c65 0a20 2020 2020 2020 2023 2074  able.        # t
+00014a30: 696d 652e 0a20 2020 2020 2020 2070 6179  ime..        pay
+00014a40: 6c6f 6164 203d 2022 5c74 2220 2a20 3130  load = "\t" * 10
+00014a50: 5f30 3030 0a20 2020 2020 2020 2061 7373  _000.        ass
+00014a60: 6572 7420 6c69 6e65 735f 7769 7468 5f6c  ert lines_with_l
+00014a70: 6561 6469 6e67 5f74 6162 735f 6578 7061  eading_tabs_expa
+00014a80: 6e64 6564 2870 6179 6c6f 6164 2920 3d3d  nded(payload) ==
+00014a90: 205b 7061 796c 6f61 645d 0a0a 2020 2020   [payload]..    
+00014aa0: 2020 2020 7461 6220 3d20 2220 2220 2a20      tab = " " * 
+00014ab0: 380a 2020 2020 2020 2020 6173 7365 7274  8.        assert
+00014ac0: 206c 696e 6573 5f77 6974 685f 6c65 6164   lines_with_lead
+00014ad0: 696e 675f 7461 6273 5f65 7870 616e 6465  ing_tabs_expande
+00014ae0: 6428 225c 7478 2229 203d 3d20 5b66 227b  d("\tx") == [f"{
+00014af0: 7461 627d 7822 5d0a 2020 2020 2020 2020  tab}x"].        
+00014b00: 6173 7365 7274 206c 696e 6573 5f77 6974  assert lines_wit
+00014b10: 685f 6c65 6164 696e 675f 7461 6273 5f65  h_leading_tabs_e
+00014b20: 7870 616e 6465 6428 225c 745c 7478 2229  xpanded("\t\tx")
+00014b30: 203d 3d20 5b66 227b 7461 627d 7b74 6162   == [f"{tab}{tab
+00014b40: 7d78 225d 0a20 2020 2020 2020 2061 7373  }x"].        ass
+00014b50: 6572 7420 6c69 6e65 735f 7769 7468 5f6c  ert lines_with_l
+00014b60: 6561 6469 6e67 5f74 6162 735f 6578 7061  eading_tabs_expa
+00014b70: 6e64 6564 2822 5c74 785c 6e20 2079 2229  nded("\tx\n  y")
+00014b80: 203d 3d20 5b66 227b 7461 627d 7822 2c20   == [f"{tab}x", 
+00014b90: 2220 2079 225d 0a0a 0a63 6c61 7373 2054  "  y"]...class T
+00014ba0: 6573 7443 6163 6869 6e67 3a0a 2020 2020  estCaching:.    
+00014bb0: 6465 6620 7465 7374 5f67 6574 5f63 6163  def test_get_cac
+00014bc0: 6865 5f64 6972 280a 2020 2020 2020 2020  he_dir(.        
+00014bd0: 7365 6c66 2c0a 2020 2020 2020 2020 746d  self,.        tm
+00014be0: 705f 7061 7468 3a20 5061 7468 2c0a 2020  p_path: Path,.  
+00014bf0: 2020 2020 2020 6d6f 6e6b 6579 7061 7463        monkeypatc
+00014c00: 683a 2070 7974 6573 742e 4d6f 6e6b 6579  h: pytest.Monkey
+00014c10: 5061 7463 682c 0a20 2020 2029 202d 3e20  Patch,.    ) -> 
+00014c20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2320  None:.        # 
+00014c30: 4372 6561 7465 206d 756c 7469 706c 6520  Create multiple 
+00014c40: 6361 6368 6520 6469 7265 6374 6f72 6965  cache directorie
+00014c50: 730a 2020 2020 2020 2020 776f 726b 7370  s.        worksp
+00014c60: 6163 6531 203d 2074 6d70 5f70 6174 6820  ace1 = tmp_path 
+00014c70: 2f20 2277 7331 220a 2020 2020 2020 2020  / "ws1".        
+00014c80: 776f 726b 7370 6163 6531 2e6d 6b64 6972  workspace1.mkdir
+00014c90: 2829 0a20 2020 2020 2020 2077 6f72 6b73  ().        works
+00014ca0: 7061 6365 3220 3d20 746d 705f 7061 7468  pace2 = tmp_path
+00014cb0: 202f 2022 7773 3222 0a20 2020 2020 2020   / "ws2".       
+00014cc0: 2077 6f72 6b73 7061 6365 322e 6d6b 6469   workspace2.mkdi
+00014cd0: 7228 290a 0a20 2020 2020 2020 2023 2046  r()..        # F
+00014ce0: 6f72 6365 2075 7365 725f 6361 6368 655f  orce user_cache_
+00014cf0: 6469 7220 746f 2075 7365 2074 6865 2074  dir to use the t
+00014d00: 656d 706f 7261 7279 2064 6972 6563 746f  emporary directo
+00014d10: 7279 2066 6f72 2065 6173 6965 7220 6173  ry for easier as
+00014d20: 7365 7274 696f 6e73 0a20 2020 2020 2020  sertions.       
+00014d30: 2070 6174 6368 5f75 7365 725f 6361 6368   patch_user_cach
+00014d40: 655f 6469 7220 3d20 7061 7463 6828 0a20  e_dir = patch(. 
+00014d50: 2020 2020 2020 2020 2020 2074 6172 6765             targe
+00014d60: 743d 2262 6c61 636b 2e63 6163 6865 2e75  t="black.cache.u
+00014d70: 7365 725f 6361 6368 655f 6469 7222 2c0a  ser_cache_dir",.
+00014d80: 2020 2020 2020 2020 2020 2020 6175 746f              auto
+00014d90: 7370 6563 3d54 7275 652c 0a20 2020 2020  spec=True,.     
+00014da0: 2020 2020 2020 2072 6574 7572 6e5f 7661         return_va
+00014db0: 6c75 653d 7374 7228 776f 726b 7370 6163  lue=str(workspac
+00014dc0: 6531 292c 0a20 2020 2020 2020 2029 0a0a  e1),.        )..
+00014dd0: 2020 2020 2020 2020 2320 4966 2042 4c41          # If BLA
+00014de0: 434b 5f43 4143 4845 5f44 4952 2069 7320  CK_CACHE_DIR is 
+00014df0: 6e6f 7420 7365 742c 2075 7365 2075 7365  not set, use use
+00014e00: 725f 6361 6368 655f 6469 720a 2020 2020  r_cache_dir.    
+00014e10: 2020 2020 6d6f 6e6b 6579 7061 7463 682e      monkeypatch.
+00014e20: 6465 6c65 6e76 2822 424c 4143 4b5f 4341  delenv("BLACK_CA
+00014e30: 4348 455f 4449 5222 2c20 7261 6973 696e  CHE_DIR", raisin
+00014e40: 673d 4661 6c73 6529 0a20 2020 2020 2020  g=False).       
+00014e50: 2077 6974 6820 7061 7463 685f 7573 6572   with patch_user
+00014e60: 5f63 6163 6865 5f64 6972 3a0a 2020 2020  _cache_dir:.    
+00014e70: 2020 2020 2020 2020 6173 7365 7274 2067          assert g
+00014e80: 6574 5f63 6163 6865 5f64 6972 2829 2e70  et_cache_dir().p
+00014e90: 6172 656e 7420 3d3d 2077 6f72 6b73 7061  arent == workspa
+00014ea0: 6365 310a 0a20 2020 2020 2020 2023 2049  ce1..        # I
+00014eb0: 6620 6974 2069 7320 7365 742c 2075 7365  f it is set, use
+00014ec0: 2074 6865 2070 6174 6820 7072 6f76 6964   the path provid
+00014ed0: 6564 2069 6e20 7468 6520 656e 7620 7661  ed in the env va
+00014ee0: 722e 0a20 2020 2020 2020 206d 6f6e 6b65  r..        monke
+00014ef0: 7970 6174 6368 2e73 6574 656e 7628 2242  ypatch.setenv("B
+00014f00: 4c41 434b 5f43 4143 4845 5f44 4952 222c  LACK_CACHE_DIR",
+00014f10: 2073 7472 2877 6f72 6b73 7061 6365 3229   str(workspace2)
+00014f20: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+00014f30: 2067 6574 5f63 6163 6865 5f64 6972 2829   get_cache_dir()
+00014f40: 2e70 6172 656e 7420 3d3d 2077 6f72 6b73  .parent == works
+00014f50: 7061 6365 320a 0a20 2020 2064 6566 2074  pace2..    def t
+00014f60: 6573 745f 6361 6368 655f 6669 6c65 5f6c  est_cache_file_l
+00014f70: 656e 6774 6828 7365 6c66 2920 2d3e 204e  ength(self) -> N
+00014f80: 6f6e 653a 0a20 2020 2020 2020 2063 6173  one:.        cas
+00014f90: 6573 203d 205b 0a20 2020 2020 2020 2020  es = [.         
+00014fa0: 2020 2044 4546 4155 4c54 5f4d 4f44 452c     DEFAULT_MODE,
+00014fb0: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
+00014fc0: 6c6c 206f 6620 7468 6520 7461 7267 6574  ll of the target
+00014fd0: 2076 6572 7369 6f6e 730a 2020 2020 2020   versions.      
+00014fe0: 2020 2020 2020 4d6f 6465 2874 6172 6765        Mode(targe
+00014ff0: 745f 7665 7273 696f 6e73 3d73 6574 2854  t_versions=set(T
+00015000: 6172 6765 7456 6572 7369 6f6e 2929 2c0a  argetVersion)),.
+00015010: 2020 2020 2020 2020 2020 2020 2320 616c              # al
+00015020: 6c20 6f66 2074 6865 2066 6561 7475 7265  l of the feature
+00015030: 730a 2020 2020 2020 2020 2020 2020 4d6f  s.            Mo
+00015040: 6465 2865 6e61 626c 6564 5f66 6561 7475  de(enabled_featu
+00015050: 7265 733d 7365 7428 5072 6576 6965 7729  res=set(Preview)
+00015060: 292c 0a20 2020 2020 2020 2020 2020 2023  ),.            #
+00015070: 2061 6c6c 206f 6620 7468 6520 6d61 6769   all of the magi
+00015080: 6373 0a20 2020 2020 2020 2020 2020 204d  cs.            M
+00015090: 6f64 6528 7079 7468 6f6e 5f63 656c 6c5f  ode(python_cell_
+000150a0: 6d61 6769 6373 3d7b 6622 6d61 6769 637b  magics={f"magic{
+000150b0: 697d 2220 666f 7220 6920 696e 2072 616e  i}" for i in ran
+000150c0: 6765 2835 3030 297d 292c 0a20 2020 2020  ge(500)}),.     
+000150d0: 2020 2020 2020 2023 2061 6c6c 206f 6620         # all of 
+000150e0: 7468 6520 7468 696e 6773 0a20 2020 2020  the things.     
+000150f0: 2020 2020 2020 204d 6f64 6528 0a20 2020         Mode(.   
+00015100: 2020 2020 2020 2020 2020 2020 2074 6172               tar
+00015110: 6765 745f 7665 7273 696f 6e73 3d73 6574  get_versions=set
+00015120: 2854 6172 6765 7456 6572 7369 6f6e 292c  (TargetVersion),
+00015130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015140: 2065 6e61 626c 6564 5f66 6561 7475 7265   enabled_feature
+00015150: 733d 7365 7428 5072 6576 6965 7729 2c0a  s=set(Preview),.
+00015160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015170: 7079 7468 6f6e 5f63 656c 6c5f 6d61 6769  python_cell_magi
+00015180: 6373 3d7b 6622 6d61 6769 637b 697d 2220  cs={f"magic{i}" 
+00015190: 666f 7220 6920 696e 2072 616e 6765 2835  for i in range(5
+000151a0: 3030 297d 2c0a 2020 2020 2020 2020 2020  00)},.          
+000151b0: 2020 292c 0a20 2020 2020 2020 205d 0a20    ),.        ]. 
+000151c0: 2020 2020 2020 2066 6f72 2063 6173 6520         for case 
+000151d0: 696e 2063 6173 6573 3a0a 2020 2020 2020  in cases:.      
+000151e0: 2020 2020 2020 6361 6368 655f 6669 6c65        cache_file
+000151f0: 203d 2067 6574 5f63 6163 6865 5f66 696c   = get_cache_fil
+00015200: 6528 6361 7365 290a 2020 2020 2020 2020  e(case).        
+00015210: 2020 2020 2320 536f 6d65 2063 6f6d 6d6f      # Some commo
+00015220: 6e20 6669 6c65 2073 7973 7465 6d73 2065  n file systems e
+00015230: 6e66 6f72 6365 2061 206d 6178 696d 756d  nforce a maximum
+00015240: 2070 6174 6820 6c65 6e67 7468 0a20 2020   path length.   
+00015250: 2020 2020 2020 2020 2023 206f 6620 3134           # of 14
+00015260: 3320 2869 7373 7565 2023 3431 3734 292e  3 (issue #4174).
+00015270: 2057 6520 6361 6e27 7420 646f 2061 6e79   We can't do any
+00015280: 7468 696e 6720 6966 2074 6865 2064 6972  thing if the dir
+00015290: 6563 746f 7279 0a20 2020 2020 2020 2020  ectory.         
+000152a0: 2020 2023 2070 6174 6820 6973 2074 6f6f     # path is too
+000152b0: 206c 6f6e 672c 2062 7574 2065 6e73 7572   long, but ensur
+000152c0: 6520 7468 6520 6e61 6d65 206f 6620 7468  e the name of th
+000152d0: 6520 6361 6368 6520 6669 6c65 2069 7473  e cache file its
+000152e0: 656c 660a 2020 2020 2020 2020 2020 2020  elf.            
+000152f0: 2320 646f 6573 6e27 7420 6765 7420 746f  # doesn't get to
+00015300: 6f20 6372 617a 792e 0a20 2020 2020 2020  o crazy..       
+00015310: 2020 2020 2061 7373 6572 7420 6c65 6e28       assert len(
+00015320: 6361 6368 655f 6669 6c65 2e6e 616d 6529  cache_file.name)
+00015330: 203c 3d20 3936 0a0a 2020 2020 6465 6620   <= 96..    def 
+00015340: 7465 7374 5f63 6163 6865 5f62 726f 6b65  test_cache_broke
+00015350: 6e5f 6669 6c65 2873 656c 6629 202d 3e20  n_file(self) -> 
+00015360: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d6f  None:.        mo
+00015370: 6465 203d 2044 4546 4155 4c54 5f4d 4f44  de = DEFAULT_MOD
+00015380: 450a 2020 2020 2020 2020 7769 7468 2063  E.        with c
+00015390: 6163 6865 5f64 6972 2829 2061 7320 776f  ache_dir() as wo
+000153a0: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
+000153b0: 2020 2020 2063 6163 6865 5f66 696c 6520       cache_file 
+000153c0: 3d20 6765 745f 6361 6368 655f 6669 6c65  = get_cache_file
+000153d0: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
+000153e0: 2020 2063 6163 6865 5f66 696c 652e 7772     cache_file.wr
+000153f0: 6974 655f 7465 7874 2822 7468 6973 2069  ite_text("this i
+00015400: 7320 6e6f 7420 6120 7069 636b 6c65 222c  s not a pickle",
+00015410: 2065 6e63 6f64 696e 673d 2275 7466 2d38   encoding="utf-8
+00015420: 2229 0a20 2020 2020 2020 2020 2020 2061  ").            a
+00015430: 7373 6572 7420 626c 6163 6b2e 4361 6368  ssert black.Cach
+00015440: 652e 7265 6164 286d 6f64 6529 2e66 696c  e.read(mode).fil
+00015450: 655f 6461 7461 203d 3d20 7b7d 0a20 2020  e_data == {}.   
+00015460: 2020 2020 2020 2020 2073 7263 203d 2028           src = (
+00015470: 776f 726b 7370 6163 6520 2f20 2274 6573  workspace / "tes
+00015480: 742e 7079 2229 2e72 6573 6f6c 7665 2829  t.py").resolve()
+00015490: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+000154a0: 2e77 7269 7465 5f74 6578 7428 2270 7269  .write_text("pri
+000154b0: 6e74 2827 6865 6c6c 6f27 2922 2c20 656e  nt('hello')", en
+000154c0: 636f 6469 6e67 3d22 7574 662d 3822 290a  coding="utf-8").
+000154d0: 2020 2020 2020 2020 2020 2020 696e 766f              invo
+000154e0: 6b65 426c 6163 6b28 5b73 7472 2873 7263  keBlack([str(src
+000154f0: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+00015500: 6361 6368 6520 3d20 626c 6163 6b2e 4361  cache = black.Ca
+00015510: 6368 652e 7265 6164 286d 6f64 6529 0a20  che.read(mode). 
+00015520: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00015530: 7420 6e6f 7420 6361 6368 652e 6973 5f63  t not cache.is_c
+00015540: 6861 6e67 6564 2873 7263 290a 0a20 2020  hanged(src)..   
+00015550: 2064 6566 2074 6573 745f 6361 6368 655f   def test_cache_
+00015560: 7369 6e67 6c65 5f66 696c 655f 616c 7265  single_file_alre
+00015570: 6164 795f 6361 6368 6564 2873 656c 6629  ady_cached(self)
+00015580: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00015590: 2020 6d6f 6465 203d 2044 4546 4155 4c54    mode = DEFAULT
+000155a0: 5f4d 4f44 450a 2020 2020 2020 2020 7769  _MODE.        wi
+000155b0: 7468 2063 6163 6865 5f64 6972 2829 2061  th cache_dir() a
+000155c0: 7320 776f 726b 7370 6163 653a 0a20 2020  s workspace:.   
+000155d0: 2020 2020 2020 2020 2073 7263 203d 2028           src = (
+000155e0: 776f 726b 7370 6163 6520 2f20 2274 6573  workspace / "tes
+000155f0: 742e 7079 2229 2e72 6573 6f6c 7665 2829  t.py").resolve()
+00015600: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+00015610: 2e77 7269 7465 5f74 6578 7428 2270 7269  .write_text("pri
+00015620: 6e74 2827 6865 6c6c 6f27 2922 2c20 656e  nt('hello')", en
+00015630: 636f 6469 6e67 3d22 7574 662d 3822 290a  coding="utf-8").
+00015640: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00015650: 6520 3d20 626c 6163 6b2e 4361 6368 652e  e = black.Cache.
+00015660: 7265 6164 286d 6f64 6529 0a20 2020 2020  read(mode).     
+00015670: 2020 2020 2020 2063 6163 6865 2e77 7269         cache.wri
+00015680: 7465 285b 7372 635d 290a 2020 2020 2020  te([src]).      
+00015690: 2020 2020 2020 696e 766f 6b65 426c 6163        invokeBlac
+000156a0: 6b28 5b73 7472 2873 7263 295d 290a 2020  k([str(src)]).  
+000156b0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+000156c0: 2073 7263 2e72 6561 645f 7465 7874 2865   src.read_text(e
+000156d0: 6e63 6f64 696e 673d 2275 7466 2d38 2229  ncoding="utf-8")
+000156e0: 203d 3d20 2270 7269 6e74 2827 6865 6c6c   == "print('hell
+000156f0: 6f27 2922 0a0a 2020 2020 4065 7665 6e74  o')"..    @event
+00015700: 5f6c 6f6f 7028 290a 2020 2020 6465 6620  _loop().    def 
+00015710: 7465 7374 5f63 6163 6865 5f6d 756c 7469  test_cache_multi
+00015720: 706c 655f 6669 6c65 7328 7365 6c66 2920  ple_files(self) 
+00015730: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00015740: 206d 6f64 6520 3d20 4445 4641 554c 545f   mode = DEFAULT_
+00015750: 4d4f 4445 0a20 2020 2020 2020 2077 6974  MODE.        wit
+00015760: 6820 6361 6368 655f 6469 7228 2920 6173  h cache_dir() as
+00015770: 2077 6f72 6b73 7061 6365 2c20 7061 7463   workspace, patc
+00015780: 6828 0a20 2020 2020 2020 2020 2020 2022  h(.            "
+00015790: 636f 6e63 7572 7265 6e74 2e66 7574 7572  concurrent.futur
+000157a0: 6573 2e50 726f 6365 7373 506f 6f6c 4578  es.ProcessPoolEx
+000157b0: 6563 7574 6f72 222c 206e 6577 3d54 6872  ecutor", new=Thr
+000157c0: 6561 6450 6f6f 6c45 7865 6375 746f 720a  eadPoolExecutor.
+000157d0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+000157e0: 2020 2020 2020 206f 6e65 203d 2028 776f         one = (wo
+000157f0: 726b 7370 6163 6520 2f20 226f 6e65 2e70  rkspace / "one.p
+00015800: 7922 292e 7265 736f 6c76 6528 290a 2020  y").resolve().  
+00015810: 2020 2020 2020 2020 2020 6f6e 652e 7772            one.wr
+00015820: 6974 655f 7465 7874 2822 7072 696e 7428  ite_text("print(
+00015830: 2768 656c 6c6f 2729 222c 2065 6e63 6f64  'hello')", encod
+00015840: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
+00015850: 2020 2020 2020 2020 2074 776f 203d 2028           two = (
+00015860: 776f 726b 7370 6163 6520 2f20 2274 776f  workspace / "two
+00015870: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
+00015880: 2020 2020 2020 2020 2020 2020 7477 6f2e              two.
+00015890: 7772 6974 655f 7465 7874 2822 7072 696e  write_text("prin
+000158a0: 7428 2768 656c 6c6f 2729 222c 2065 6e63  t('hello')", enc
+000158b0: 6f64 696e 673d 2275 7466 2d38 2229 0a20  oding="utf-8"). 
+000158c0: 2020 2020 2020 2020 2020 2063 6163 6865             cache
+000158d0: 203d 2062 6c61 636b 2e43 6163 6865 2e72   = black.Cache.r
+000158e0: 6561 6428 6d6f 6465 290a 2020 2020 2020  ead(mode).      
+000158f0: 2020 2020 2020 6361 6368 652e 7772 6974        cache.writ
+00015900: 6528 5b6f 6e65 5d29 0a20 2020 2020 2020  e([one]).       
+00015910: 2020 2020 2069 6e76 6f6b 6542 6c61 636b       invokeBlack
+00015920: 285b 7374 7228 776f 726b 7370 6163 6529  ([str(workspace)
+00015930: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+00015940: 7373 6572 7420 6f6e 652e 7265 6164 5f74  ssert one.read_t
+00015950: 6578 7428 656e 636f 6469 6e67 3d22 7574  ext(encoding="ut
+00015960: 662d 3822 2920 3d3d 2022 7072 696e 7428  f-8") == "print(
+00015970: 2768 656c 6c6f 2729 220a 2020 2020 2020  'hello')".      
+00015980: 2020 2020 2020 6173 7365 7274 2074 776f        assert two
+00015990: 2e72 6561 645f 7465 7874 2865 6e63 6f64  .read_text(encod
+000159a0: 696e 673d 2275 7466 2d38 2229 203d 3d20  ing="utf-8") == 
+000159b0: 2770 7269 6e74 2822 6865 6c6c 6f22 295c  'print("hello")\
+000159c0: 6e27 0a20 2020 2020 2020 2020 2020 2063  n'.            c
+000159d0: 6163 6865 203d 2062 6c61 636b 2e43 6163  ache = black.Cac
+000159e0: 6865 2e72 6561 6428 6d6f 6465 290a 2020  he.read(mode).  
+000159f0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00015a00: 206e 6f74 2063 6163 6865 2e69 735f 6368   not cache.is_ch
+00015a10: 616e 6765 6428 6f6e 6529 0a20 2020 2020  anged(one).     
+00015a20: 2020 2020 2020 2061 7373 6572 7420 6e6f         assert no
+00015a30: 7420 6361 6368 652e 6973 5f63 6861 6e67  t cache.is_chang
+00015a40: 6564 2874 776f 290a 0a20 2020 2040 7079  ed(two)..    @py
+00015a50: 7465 7374 2e6d 6172 6b2e 696e 636f 6d70  test.mark.incomp
+00015a60: 6174 6962 6c65 5f77 6974 685f 6d79 7079  atible_with_mypy
+00015a70: 630a 2020 2020 4070 7974 6573 742e 6d61  c.    @pytest.ma
+00015a80: 726b 2e70 6172 616d 6574 7269 7a65 2822  rk.parametrize("
+00015a90: 636f 6c6f 7222 2c20 5b46 616c 7365 2c20  color", [False, 
+00015aa0: 5472 7565 5d2c 2069 6473 3d5b 226e 6f2d  True], ids=["no-
+00015ab0: 636f 6c6f 7222 2c20 2277 6974 682d 636f  color", "with-co
+00015ac0: 6c6f 7222 5d29 0a20 2020 2064 6566 2074  lor"]).    def t
+00015ad0: 6573 745f 6e6f 5f63 6163 6865 5f77 6865  est_no_cache_whe
+00015ae0: 6e5f 7772 6974 6562 6163 6b5f 6469 6666  n_writeback_diff
+00015af0: 2873 656c 662c 2063 6f6c 6f72 3a20 626f  (self, color: bo
+00015b00: 6f6c 2920 2d3e 204e 6f6e 653a 0a20 2020  ol) -> None:.   
+00015b10: 2020 2020 206d 6f64 6520 3d20 4445 4641       mode = DEFA
+00015b20: 554c 545f 4d4f 4445 0a20 2020 2020 2020  ULT_MODE.       
+00015b30: 2077 6974 6820 6361 6368 655f 6469 7228   with cache_dir(
+00015b40: 2920 6173 2077 6f72 6b73 7061 6365 3a0a  ) as workspace:.
+00015b50: 2020 2020 2020 2020 2020 2020 7372 6320              src 
+00015b60: 3d20 2877 6f72 6b73 7061 6365 202f 2022  = (workspace / "
+00015b70: 7465 7374 2e70 7922 292e 7265 736f 6c76  test.py").resolv
+00015b80: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00015b90: 7372 632e 7772 6974 655f 7465 7874 2822  src.write_text("
+00015ba0: 7072 696e 7428 2768 656c 6c6f 2729 222c  print('hello')",
+00015bb0: 2065 6e63 6f64 696e 673d 2275 7466 2d38   encoding="utf-8
+00015bc0: 2229 0a20 2020 2020 2020 2020 2020 2077  ").            w
+00015bd0: 6974 6820 7061 7463 682e 6f62 6a65 6374  ith patch.object
+00015be0: 2862 6c61 636b 2e43 6163 6865 2c20 2272  (black.Cache, "r
+00015bf0: 6561 6422 2920 6173 2072 6561 645f 6361  ead") as read_ca
+00015c00: 6368 652c 2070 6174 6368 2e6f 626a 6563  che, patch.objec
+00015c10: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00015c20: 2020 2062 6c61 636b 2e43 6163 6865 2c20     black.Cache, 
+00015c30: 2277 7269 7465 220a 2020 2020 2020 2020  "write".        
+00015c40: 2020 2020 2920 6173 2077 7269 7465 5f63      ) as write_c
+00015c50: 6163 6865 3a0a 2020 2020 2020 2020 2020  ache:.          
+00015c60: 2020 2020 2020 636d 6420 3d20 5b73 7472        cmd = [str
+00015c70: 2873 7263 292c 2022 2d2d 6469 6666 225d  (src), "--diff"]
+00015c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015c90: 2069 6620 636f 6c6f 723a 0a20 2020 2020   if color:.     
+00015ca0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00015cb0: 6d64 2e61 7070 656e 6428 222d 2d63 6f6c  md.append("--col
+00015cc0: 6f72 2229 0a20 2020 2020 2020 2020 2020  or").           
+00015cd0: 2020 2020 2069 6e76 6f6b 6542 6c61 636b       invokeBlack
+00015ce0: 2863 6d64 290a 2020 2020 2020 2020 2020  (cmd).          
+00015cf0: 2020 2020 2020 6361 6368 655f 6669 6c65        cache_file
+00015d00: 203d 2067 6574 5f63 6163 6865 5f66 696c   = get_cache_fil
+00015d10: 6528 6d6f 6465 290a 2020 2020 2020 2020  e(mode).        
+00015d20: 2020 2020 2020 2020 6173 7365 7274 2063          assert c
+00015d30: 6163 6865 5f66 696c 652e 6578 6973 7473  ache_file.exists
+00015d40: 2829 2069 7320 4661 6c73 650a 2020 2020  () is False.    
+00015d50: 2020 2020 2020 2020 2020 2020 7265 6164              read
+00015d60: 5f63 6163 6865 2e61 7373 6572 745f 6361  _cache.assert_ca
+00015d70: 6c6c 6564 5f6f 6e63 6528 290a 2020 2020  lled_once().    
+00015d80: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+00015d90: 655f 6361 6368 652e 6173 7365 7274 5f6e  e_cache.assert_n
+00015da0: 6f74 5f63 616c 6c65 6428 290a 0a20 2020  ot_called()..   
+00015db0: 2040 7079 7465 7374 2e6d 6172 6b2e 7061   @pytest.mark.pa
+00015dc0: 7261 6d65 7472 697a 6528 2263 6f6c 6f72  rametrize("color
+00015dd0: 222c 205b 4661 6c73 652c 2054 7275 655d  ", [False, True]
+00015de0: 2c20 6964 733d 5b22 6e6f 2d63 6f6c 6f72  , ids=["no-color
+00015df0: 222c 2022 7769 7468 2d63 6f6c 6f72 225d  ", "with-color"]
+00015e00: 290a 2020 2020 4065 7665 6e74 5f6c 6f6f  ).    @event_loo
+00015e10: 7028 290a 2020 2020 6465 6620 7465 7374  p().    def test
+00015e20: 5f6f 7574 7075 745f 6c6f 636b 696e 675f  _output_locking_
+00015e30: 7768 656e 5f77 7269 7465 6261 636b 5f64  when_writeback_d
+00015e40: 6966 6628 7365 6c66 2c20 636f 6c6f 723a  iff(self, color:
+00015e50: 2062 6f6f 6c29 202d 3e20 4e6f 6e65 3a0a   bool) -> None:.
+00015e60: 2020 2020 2020 2020 7769 7468 2063 6163          with cac
+00015e70: 6865 5f64 6972 2829 2061 7320 776f 726b  he_dir() as work
+00015e80: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
+00015e90: 2020 2066 6f72 2074 6167 2069 6e20 7261     for tag in ra
+00015ea0: 6e67 6528 302c 2034 293a 0a20 2020 2020  nge(0, 4):.     
+00015eb0: 2020 2020 2020 2020 2020 2073 7263 203d             src =
+00015ec0: 2028 776f 726b 7370 6163 6520 2f20 6622   (workspace / f"
+00015ed0: 7465 7374 7b74 6167 7d2e 7079 2229 2e72  test{tag}.py").r
+00015ee0: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
+00015ef0: 2020 2020 2020 2020 2073 7263 2e77 7269           src.wri
+00015f00: 7465 5f74 6578 7428 2270 7269 6e74 2827  te_text("print('
+00015f10: 6865 6c6c 6f27 2922 2c20 656e 636f 6469  hello')", encodi
+00015f20: 6e67 3d22 7574 662d 3822 290a 2020 2020  ng="utf-8").    
+00015f30: 2020 2020 2020 2020 7769 7468 2070 6174          with pat
+00015f40: 6368 280a 2020 2020 2020 2020 2020 2020  ch(.            
+00015f50: 2020 2020 2262 6c61 636b 2e63 6f6e 6375      "black.concu
+00015f60: 7272 656e 6379 2e4d 616e 6167 6572 222c  rrency.Manager",
+00015f70: 2077 7261 7073 3d6d 756c 7469 7072 6f63   wraps=multiproc
+00015f80: 6573 7369 6e67 2e4d 616e 6167 6572 0a20  essing.Manager. 
+00015f90: 2020 2020 2020 2020 2020 2029 2061 7320             ) as 
+00015fa0: 6d67 723a 0a20 2020 2020 2020 2020 2020  mgr:.           
+00015fb0: 2020 2020 2063 6d64 203d 205b 222d 2d64       cmd = ["--d
+00015fc0: 6966 6622 2c20 7374 7228 776f 726b 7370  iff", str(worksp
+00015fd0: 6163 6529 5d0a 2020 2020 2020 2020 2020  ace)].          
+00015fe0: 2020 2020 2020 6966 2063 6f6c 6f72 3a0a        if color:.
+00015ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016000: 2020 2020 636d 642e 6170 7065 6e64 2822      cmd.append("
+00016010: 2d2d 636f 6c6f 7222 290a 2020 2020 2020  --color").      
+00016020: 2020 2020 2020 2020 2020 696e 766f 6b65            invoke
+00016030: 426c 6163 6b28 636d 642c 2065 7869 745f  Black(cmd, exit_
+00016040: 636f 6465 3d30 290a 2020 2020 2020 2020  code=0).        
+00016050: 2020 2020 2020 2020 2320 7468 6973 2069          # this i
+00016060: 736e 2774 2071 7569 7465 2064 6f69 6e67  sn't quite doing
+00016070: 2077 6861 7420 7765 2077 616e 742c 2062   what we want, b
+00016080: 7574 2069 6620 6974 205f 6973 6e27 745f  ut if it _isn't_
+00016090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000160a0: 2023 2063 616c 6c65 6420 7468 656e 2077   # called then w
+000160b0: 6520 6361 6e6e 6f74 2062 6520 7573 696e  e cannot be usin
+000160c0: 6720 7468 6520 6c6f 636b 2069 7420 7072  g the lock it pr
+000160d0: 6f76 6964 6573 0a20 2020 2020 2020 2020  ovides.         
+000160e0: 2020 2020 2020 206d 6772 2e61 7373 6572         mgr.asser
+000160f0: 745f 6361 6c6c 6564 2829 0a0a 2020 2020  t_called()..    
+00016100: 6465 6620 7465 7374 5f6e 6f5f 6361 6368  def test_no_cach
+00016110: 655f 7768 656e 5f73 7464 696e 2873 656c  e_when_stdin(sel
+00016120: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00016130: 2020 2020 6d6f 6465 203d 2044 4546 4155      mode = DEFAU
+00016140: 4c54 5f4d 4f44 450a 2020 2020 2020 2020  LT_MODE.        
+00016150: 7769 7468 2063 6163 6865 5f64 6972 2829  with cache_dir()
+00016160: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00016170: 7375 6c74 203d 2043 6c69 5275 6e6e 6572  sult = CliRunner
+00016180: 2829 2e69 6e76 6f6b 6528 0a20 2020 2020  ().invoke(.     
+00016190: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+000161a0: 2e6d 6169 6e2c 205b 222d 225d 2c20 696e  .main, ["-"], in
+000161b0: 7075 743d 4279 7465 7349 4f28 6222 7072  put=BytesIO(b"pr
+000161c0: 696e 7428 2768 656c 6c6f 2729 2229 0a20  int('hello')"). 
+000161d0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000161e0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+000161f0: 6e6f 7420 7265 7375 6c74 2e65 7869 745f  not result.exit_
+00016200: 636f 6465 0a20 2020 2020 2020 2020 2020  code.           
+00016210: 2063 6163 6865 5f66 696c 6520 3d20 6765   cache_file = ge
+00016220: 745f 6361 6368 655f 6669 6c65 286d 6f64  t_cache_file(mod
+00016230: 6529 0a20 2020 2020 2020 2020 2020 2061  e).            a
+00016240: 7373 6572 7420 6e6f 7420 6361 6368 655f  ssert not cache_
+00016250: 6669 6c65 2e65 7869 7374 7328 290a 0a20  file.exists().. 
+00016260: 2020 2064 6566 2074 6573 745f 7265 6164     def test_read
+00016270: 5f63 6163 6865 5f6e 6f5f 6361 6368 6566  _cache_no_cachef
+00016280: 696c 6528 7365 6c66 2920 2d3e 204e 6f6e  ile(self) -> Non
+00016290: 653a 0a20 2020 2020 2020 206d 6f64 6520  e:.        mode 
+000162a0: 3d20 4445 4641 554c 545f 4d4f 4445 0a20  = DEFAULT_MODE. 
+000162b0: 2020 2020 2020 2077 6974 6820 6361 6368         with cach
+000162c0: 655f 6469 7228 293a 0a20 2020 2020 2020  e_dir():.       
+000162d0: 2020 2020 2061 7373 6572 7420 626c 6163       assert blac
+000162e0: 6b2e 4361 6368 652e 7265 6164 286d 6f64  k.Cache.read(mod
+000162f0: 6529 2e66 696c 655f 6461 7461 203d 3d20  e).file_data == 
+00016300: 7b7d 0a0a 2020 2020 6465 6620 7465 7374  {}..    def test
+00016310: 5f77 7269 7465 5f63 6163 6865 5f72 6561  _write_cache_rea
+00016320: 645f 6361 6368 6528 7365 6c66 2920 2d3e  d_cache(self) ->
+00016330: 204e 6f6e 653a 0a20 2020 2020 2020 206d   None:.        m
+00016340: 6f64 6520 3d20 4445 4641 554c 545f 4d4f  ode = DEFAULT_MO
+00016350: 4445 0a20 2020 2020 2020 2077 6974 6820  DE.        with 
+00016360: 6361 6368 655f 6469 7228 2920 6173 2077  cache_dir() as w
+00016370: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
+00016380: 2020 2020 2020 7372 6320 3d20 2877 6f72        src = (wor
+00016390: 6b73 7061 6365 202f 2022 7465 7374 2e70  kspace / "test.p
+000163a0: 7922 292e 7265 736f 6c76 6528 290a 2020  y").resolve().  
+000163b0: 2020 2020 2020 2020 2020 7372 632e 746f            src.to
+000163c0: 7563 6828 290a 2020 2020 2020 2020 2020  uch().          
+000163d0: 2020 7772 6974 655f 6361 6368 6520 3d20    write_cache = 
+000163e0: 626c 6163 6b2e 4361 6368 652e 7265 6164  black.Cache.read
+000163f0: 286d 6f64 6529 0a20 2020 2020 2020 2020  (mode).         
+00016400: 2020 2077 7269 7465 5f63 6163 6865 2e77     write_cache.w
+00016410: 7269 7465 285b 7372 635d 290a 2020 2020  rite([src]).    
+00016420: 2020 2020 2020 2020 7265 6164 5f63 6163          read_cac
+00016430: 6865 203d 2062 6c61 636b 2e43 6163 6865  he = black.Cache
+00016440: 2e72 6561 6428 6d6f 6465 290a 2020 2020  .read(mode).    
+00016450: 2020 2020 2020 2020 6173 7365 7274 206e          assert n
+00016460: 6f74 2072 6561 645f 6361 6368 652e 6973  ot read_cache.is
+00016470: 5f63 6861 6e67 6564 2873 7263 290a 0a20  _changed(src).. 
+00016480: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
+00016490: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
+000164a0: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
+000164b0: 7465 7374 5f66 696c 7465 725f 6361 6368  test_filter_cach
+000164c0: 6564 2873 656c 6629 202d 3e20 4e6f 6e65  ed(self) -> None
+000164d0: 3a0a 2020 2020 2020 2020 7769 7468 2054  :.        with T
+000164e0: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
+000164f0: 7928 2920 6173 2077 6f72 6b73 7061 6365  y() as workspace
+00016500: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00016510: 7468 203d 2050 6174 6828 776f 726b 7370  th = Path(worksp
+00016520: 6163 6529 0a20 2020 2020 2020 2020 2020  ace).           
+00016530: 2075 6e63 6163 6865 6420 3d20 2870 6174   uncached = (pat
+00016540: 6820 2f20 2275 6e63 6163 6865 6422 292e  h / "uncached").
+00016550: 7265 736f 6c76 6528 290a 2020 2020 2020  resolve().      
+00016560: 2020 2020 2020 6361 6368 6564 203d 2028        cached = (
+00016570: 7061 7468 202f 2022 6361 6368 6564 2229  path / "cached")
+00016580: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
+00016590: 2020 2020 2020 2063 6163 6865 645f 6275         cached_bu
+000165a0: 745f 6368 616e 6765 6420 3d20 2870 6174  t_changed = (pat
+000165b0: 6820 2f20 2263 6861 6e67 6564 2229 2e72  h / "changed").r
+000165c0: 6573 6f6c 7665 2829 0a20 2020 2020 2020  esolve().       
+000165d0: 2020 2020 2075 6e63 6163 6865 642e 746f       uncached.to
+000165e0: 7563 6828 290a 2020 2020 2020 2020 2020  uch().          
+000165f0: 2020 6361 6368 6564 2e74 6f75 6368 2829    cached.touch()
+00016600: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
+00016610: 6865 645f 6275 745f 6368 616e 6765 642e  hed_but_changed.
+00016620: 746f 7563 6828 290a 2020 2020 2020 2020  touch().        
+00016630: 2020 2020 6361 6368 6520 3d20 626c 6163      cache = blac
+00016640: 6b2e 4361 6368 652e 7265 6164 2844 4546  k.Cache.read(DEF
+00016650: 4155 4c54 5f4d 4f44 4529 0a0a 2020 2020  AULT_MODE)..    
+00016660: 2020 2020 2020 2020 6f72 6967 5f66 756e          orig_fun
+00016670: 6320 3d20 626c 6163 6b2e 4361 6368 652e  c = black.Cache.
+00016680: 6765 745f 6669 6c65 5f64 6174 610a 0a20  get_file_data.. 
+00016690: 2020 2020 2020 2020 2020 2064 6566 2077             def w
+000166a0: 7261 7070 6564 5f66 756e 6328 7061 7468  rapped_func(path
+000166b0: 3a20 5061 7468 2920 2d3e 2046 696c 6544  : Path) -> FileD
+000166c0: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+000166d0: 2020 2020 2069 6620 7061 7468 203d 3d20       if path == 
+000166e0: 6361 6368 6564 3a0a 2020 2020 2020 2020  cached:.        
+000166f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00016700: 726e 206f 7269 675f 6675 6e63 2870 6174  rn orig_func(pat
+00016710: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
+00016720: 2020 2069 6620 7061 7468 203d 3d20 6361     if path == ca
+00016730: 6368 6564 5f62 7574 5f63 6861 6e67 6564  ched_but_changed
+00016740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016750: 2020 2020 2020 7265 7475 726e 2046 696c        return Fil
+00016760: 6544 6174 6128 302e 302c 2030 2c20 2222  eData(0.0, 0, ""
+00016770: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016780: 2020 7261 6973 6520 4173 7365 7274 696f    raise Assertio
+00016790: 6e45 7272 6f72 0a0a 2020 2020 2020 2020  nError..        
+000167a0: 2020 2020 7769 7468 2070 6174 6368 2e6f      with patch.o
+000167b0: 626a 6563 7428 626c 6163 6b2e 4361 6368  bject(black.Cach
+000167c0: 652c 2022 6765 745f 6669 6c65 5f64 6174  e, "get_file_dat
+000167d0: 6122 2c20 7369 6465 5f65 6666 6563 743d  a", side_effect=
+000167e0: 7772 6170 7065 645f 6675 6e63 293a 0a20  wrapped_func):. 
+000167f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00016800: 6163 6865 2e77 7269 7465 285b 6361 6368  ache.write([cach
+00016810: 6564 2c20 6361 6368 6564 5f62 7574 5f63  ed, cached_but_c
+00016820: 6861 6e67 6564 5d29 0a20 2020 2020 2020  hanged]).       
+00016830: 2020 2020 2074 6f64 6f2c 2064 6f6e 6520       todo, done 
+00016840: 3d20 6361 6368 652e 6669 6c74 6572 6564  = cache.filtered
+00016850: 5f63 6163 6865 6428 7b75 6e63 6163 6865  _cached({uncache
+00016860: 642c 2063 6163 6865 642c 2063 6163 6865  d, cached, cache
+00016870: 645f 6275 745f 6368 616e 6765 647d 290a  d_but_changed}).
+00016880: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00016890: 7274 2074 6f64 6f20 3d3d 207b 756e 6361  rt todo == {unca
+000168a0: 6368 6564 2c20 6361 6368 6564 5f62 7574  ched, cached_but
+000168b0: 5f63 6861 6e67 6564 7d0a 2020 2020 2020  _changed}.      
+000168c0: 2020 2020 2020 6173 7365 7274 2064 6f6e        assert don
+000168d0: 6520 3d3d 207b 6361 6368 6564 7d0a 0a20  e == {cached}.. 
+000168e0: 2020 2064 6566 2074 6573 745f 6669 6c74     def test_filt
+000168f0: 6572 5f63 6163 6865 645f 6861 7368 2873  er_cached_hash(s
+00016900: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00016910: 2020 2020 2020 7769 7468 2054 656d 706f        with Tempo
+00016920: 7261 7279 4469 7265 6374 6f72 7928 2920  raryDirectory() 
+00016930: 6173 2077 6f72 6b73 7061 6365 3a0a 2020  as workspace:.  
+00016940: 2020 2020 2020 2020 2020 7061 7468 203d            path =
+00016950: 2050 6174 6828 776f 726b 7370 6163 6529   Path(workspace)
+00016960: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+00016970: 203d 2028 7061 7468 202f 2022 7465 7374   = (path / "test
+00016980: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
+00016990: 2020 2020 2020 2020 2020 2020 7372 632e              src.
+000169a0: 7772 6974 655f 7465 7874 2822 7072 696e  write_text("prin
+000169b0: 7428 2768 656c 6c6f 2729 222c 2065 6e63  t('hello')", enc
+000169c0: 6f64 696e 673d 2275 7466 2d38 2229 0a20  oding="utf-8"). 
+000169d0: 2020 2020 2020 2020 2020 2073 7420 3d20             st = 
+000169e0: 7372 632e 7374 6174 2829 0a20 2020 2020  src.stat().     
+000169f0: 2020 2020 2020 2063 6163 6865 203d 2062         cache = b
+00016a00: 6c61 636b 2e43 6163 6865 2e72 6561 6428  lack.Cache.read(
+00016a10: 4445 4641 554c 545f 4d4f 4445 290a 2020  DEFAULT_MODE).  
+00016a20: 2020 2020 2020 2020 2020 6361 6368 652e            cache.
+00016a30: 7772 6974 6528 5b73 7263 5d29 0a20 2020  write([src]).   
+00016a40: 2020 2020 2020 2020 2063 6163 6865 645f           cached_
+00016a50: 6669 6c65 5f64 6174 6120 3d20 6361 6368  file_data = cach
+00016a60: 652e 6669 6c65 5f64 6174 615b 7374 7228  e.file_data[str(
+00016a70: 7372 6329 5d0a 0a20 2020 2020 2020 2020  src)]..         
+00016a80: 2020 2074 6f64 6f2c 2064 6f6e 6520 3d20     todo, done = 
+00016a90: 6361 6368 652e 6669 6c74 6572 6564 5f63  cache.filtered_c
+00016aa0: 6163 6865 6428 5b73 7263 5d29 0a20 2020  ached([src]).   
+00016ab0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00016ac0: 746f 646f 203d 3d20 7365 7428 290a 2020  todo == set().  
+00016ad0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00016ae0: 2064 6f6e 6520 3d3d 207b 7372 637d 0a20   done == {src}. 
+00016af0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00016b00: 7420 6361 6368 6564 5f66 696c 655f 6461  t cached_file_da
+00016b10: 7461 2e73 745f 6d74 696d 6520 3d3d 2073  ta.st_mtime == s
+00016b20: 742e 7374 5f6d 7469 6d65 0a0a 2020 2020  t.st_mtime..    
+00016b30: 2020 2020 2020 2020 2320 4d6f 6469 6679          # Modify
+00016b40: 2073 745f 6d74 696d 650a 2020 2020 2020   st_mtime.      
+00016b50: 2020 2020 2020 6361 6368 6564 5f66 696c        cached_fil
+00016b60: 655f 6461 7461 203d 2063 6163 6865 2e66  e_data = cache.f
+00016b70: 696c 655f 6461 7461 5b73 7472 2873 7263  ile_data[str(src
+00016b80: 295d 203d 2046 696c 6544 6174 6128 0a20  )] = FileData(. 
+00016b90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00016ba0: 6163 6865 645f 6669 6c65 5f64 6174 612e  ached_file_data.
+00016bb0: 7374 5f6d 7469 6d65 202d 2031 2c0a 2020  st_mtime - 1,.  
+00016bc0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00016bd0: 6368 6564 5f66 696c 655f 6461 7461 2e73  ched_file_data.s
+00016be0: 745f 7369 7a65 2c0a 2020 2020 2020 2020  t_size,.        
+00016bf0: 2020 2020 2020 2020 6361 6368 6564 5f66          cached_f
+00016c00: 696c 655f 6461 7461 2e68 6173 682c 0a20  ile_data.hash,. 
+00016c10: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00016c20: 2020 2020 2020 2020 2074 6f64 6f2c 2064           todo, d
+00016c30: 6f6e 6520 3d20 6361 6368 652e 6669 6c74  one = cache.filt
+00016c40: 6572 6564 5f63 6163 6865 6428 5b73 7263  ered_cached([src
+00016c50: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+00016c60: 7373 6572 7420 746f 646f 203d 3d20 7365  ssert todo == se
+00016c70: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00016c80: 6173 7365 7274 2064 6f6e 6520 3d3d 207b  assert done == {
+00016c90: 7372 637d 0a20 2020 2020 2020 2020 2020  src}.           
+00016ca0: 2061 7373 6572 7420 6361 6368 6564 5f66   assert cached_f
+00016cb0: 696c 655f 6461 7461 2e73 745f 6d74 696d  ile_data.st_mtim
+00016cc0: 6520 3c20 7374 2e73 745f 6d74 696d 650a  e < st.st_mtime.
+00016cd0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00016ce0: 7274 2063 6163 6865 645f 6669 6c65 5f64  rt cached_file_d
+00016cf0: 6174 612e 7374 5f73 697a 6520 3d3d 2073  ata.st_size == s
+00016d00: 742e 7374 5f73 697a 650a 2020 2020 2020  t.st_size.      
+00016d10: 2020 2020 2020 6173 7365 7274 2063 6163        assert cac
+00016d20: 6865 645f 6669 6c65 5f64 6174 612e 6861  hed_file_data.ha
+00016d30: 7368 203d 3d20 626c 6163 6b2e 4361 6368  sh == black.Cach
+00016d40: 652e 6861 7368 5f64 6967 6573 7428 7372  e.hash_digest(sr
+00016d50: 6329 0a0a 2020 2020 2020 2020 2020 2020  c)..            
+00016d60: 2320 4d6f 6469 6679 2063 6f6e 7465 6e74  # Modify content
+00016d70: 730a 2020 2020 2020 2020 2020 2020 7372  s.            sr
+00016d80: 632e 7772 6974 655f 7465 7874 2822 7072  c.write_text("pr
+00016d90: 696e 7428 2768 656c 6c6f 2077 6f72 6c64  int('hello world
+00016da0: 2729 222c 2065 6e63 6f64 696e 673d 2275  ')", encoding="u
+00016db0: 7466 2d38 2229 0a20 2020 2020 2020 2020  tf-8").         
+00016dc0: 2020 206e 6577 5f73 7420 3d20 7372 632e     new_st = src.
+00016dd0: 7374 6174 2829 0a20 2020 2020 2020 2020  stat().         
+00016de0: 2020 2074 6f64 6f2c 2064 6f6e 6520 3d20     todo, done = 
+00016df0: 6361 6368 652e 6669 6c74 6572 6564 5f63  cache.filtered_c
+00016e00: 6163 6865 6428 5b73 7263 5d29 0a20 2020  ached([src]).   
+00016e10: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00016e20: 746f 646f 203d 3d20 7b73 7263 7d0a 2020  todo == {src}.  
+00016e30: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00016e40: 2064 6f6e 6520 3d3d 2073 6574 2829 0a20   done == set(). 
+00016e50: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00016e60: 7420 6361 6368 6564 5f66 696c 655f 6461  t cached_file_da
+00016e70: 7461 2e73 745f 6d74 696d 6520 3c20 6e65  ta.st_mtime < ne
+00016e80: 775f 7374 2e73 745f 6d74 696d 650a 2020  w_st.st_mtime.  
+00016e90: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00016ea0: 2063 6163 6865 645f 6669 6c65 5f64 6174   cached_file_dat
+00016eb0: 612e 7374 5f73 697a 6520 213d 206e 6577  a.st_size != new
+00016ec0: 5f73 742e 7374 5f73 697a 650a 2020 2020  _st.st_size.    
+00016ed0: 2020 2020 2020 2020 6173 7365 7274 2063          assert c
+00016ee0: 6163 6865 645f 6669 6c65 5f64 6174 612e  ached_file_data.
+00016ef0: 6861 7368 2021 3d20 626c 6163 6b2e 4361  hash != black.Ca
+00016f00: 6368 652e 6861 7368 5f64 6967 6573 7428  che.hash_digest(
+00016f10: 7372 6329 0a0a 2020 2020 6465 6620 7465  src)..    def te
+00016f20: 7374 5f77 7269 7465 5f63 6163 6865 5f63  st_write_cache_c
+00016f30: 7265 6174 6573 5f64 6972 6563 746f 7279  reates_directory
+00016f40: 5f69 665f 6e65 6564 6564 2873 656c 6629  _if_needed(self)
+00016f50: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00016f60: 2020 6d6f 6465 203d 2044 4546 4155 4c54    mode = DEFAULT
+00016f70: 5f4d 4f44 450a 2020 2020 2020 2020 7769  _MODE.        wi
+00016f80: 7468 2063 6163 6865 5f64 6972 2865 7869  th cache_dir(exi
+00016f90: 7374 733d 4661 6c73 6529 2061 7320 776f  sts=False) as wo
+00016fa0: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
+00016fb0: 2020 2020 2061 7373 6572 7420 6e6f 7420       assert not 
+00016fc0: 776f 726b 7370 6163 652e 6578 6973 7473  workspace.exists
+00016fd0: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
+00016fe0: 6163 6865 203d 2062 6c61 636b 2e43 6163  ache = black.Cac
+00016ff0: 6865 2e72 6561 6428 6d6f 6465 290a 2020  he.read(mode).  
+00017000: 2020 2020 2020 2020 2020 6361 6368 652e            cache.
+00017010: 7772 6974 6528 5b5d 290a 2020 2020 2020  write([]).      
+00017020: 2020 2020 2020 6173 7365 7274 2077 6f72        assert wor
+00017030: 6b73 7061 6365 2e65 7869 7374 7328 290a  kspace.exists().
+00017040: 0a20 2020 2040 6576 656e 745f 6c6f 6f70  .    @event_loop
+00017050: 2829 0a20 2020 2064 6566 2074 6573 745f  ().    def test_
+00017060: 6661 696c 6564 5f66 6f72 6d61 7474 696e  failed_formattin
+00017070: 675f 646f 6573 5f6e 6f74 5f67 6574 5f63  g_does_not_get_c
+00017080: 6163 6865 6428 7365 6c66 2920 2d3e 204e  ached(self) -> N
+00017090: 6f6e 653a 0a20 2020 2020 2020 206d 6f64  one:.        mod
+000170a0: 6520 3d20 4445 4641 554c 545f 4d4f 4445  e = DEFAULT_MODE
+000170b0: 0a20 2020 2020 2020 2077 6974 6820 6361  .        with ca
+000170c0: 6368 655f 6469 7228 2920 6173 2077 6f72  che_dir() as wor
+000170d0: 6b73 7061 6365 2c20 7061 7463 6828 0a20  kspace, patch(. 
+000170e0: 2020 2020 2020 2020 2020 2022 636f 6e63             "conc
+000170f0: 7572 7265 6e74 2e66 7574 7572 6573 2e50  urrent.futures.P
+00017100: 726f 6365 7373 506f 6f6c 4578 6563 7574  rocessPoolExecut
+00017110: 6f72 222c 206e 6577 3d54 6872 6561 6450  or", new=ThreadP
+00017120: 6f6f 6c45 7865 6375 746f 720a 2020 2020  oolExecutor.    
+00017130: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00017140: 2020 2066 6169 6c69 6e67 203d 2028 776f     failing = (wo
+00017150: 726b 7370 6163 6520 2f20 2266 6169 6c69  rkspace / "faili
+00017160: 6e67 2e70 7922 292e 7265 736f 6c76 6528  ng.py").resolve(
+00017170: 290a 2020 2020 2020 2020 2020 2020 6661  ).            fa
+00017180: 696c 696e 672e 7772 6974 655f 7465 7874  iling.write_text
+00017190: 2822 6e6f 7420 6163 7475 616c 6c79 2070  ("not actually p
+000171a0: 7974 686f 6e22 2c20 656e 636f 6469 6e67  ython", encoding
+000171b0: 3d22 7574 662d 3822 290a 2020 2020 2020  ="utf-8").      
+000171c0: 2020 2020 2020 636c 6561 6e20 3d20 2877        clean = (w
+000171d0: 6f72 6b73 7061 6365 202f 2022 636c 6561  orkspace / "clea
+000171e0: 6e2e 7079 2229 2e72 6573 6f6c 7665 2829  n.py").resolve()
+000171f0: 0a20 2020 2020 2020 2020 2020 2063 6c65  .            cle
+00017200: 616e 2e77 7269 7465 5f74 6578 7428 2770  an.write_text('p
+00017210: 7269 6e74 2822 6865 6c6c 6f22 295c 6e27  rint("hello")\n'
+00017220: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
+00017230: 3822 290a 2020 2020 2020 2020 2020 2020  8").            
+00017240: 696e 766f 6b65 426c 6163 6b28 5b73 7472  invokeBlack([str
+00017250: 2877 6f72 6b73 7061 6365 295d 2c20 6578  (workspace)], ex
+00017260: 6974 5f63 6f64 653d 3132 3329 0a20 2020  it_code=123).   
+00017270: 2020 2020 2020 2020 2063 6163 6865 203d           cache =
+00017280: 2062 6c61 636b 2e43 6163 6865 2e72 6561   black.Cache.rea
+00017290: 6428 6d6f 6465 290a 2020 2020 2020 2020  d(mode).        
+000172a0: 2020 2020 6173 7365 7274 2063 6163 6865      assert cache
+000172b0: 2e69 735f 6368 616e 6765 6428 6661 696c  .is_changed(fail
+000172c0: 696e 6729 0a20 2020 2020 2020 2020 2020  ing).           
+000172d0: 2061 7373 6572 7420 6e6f 7420 6361 6368   assert not cach
+000172e0: 652e 6973 5f63 6861 6e67 6564 2863 6c65  e.is_changed(cle
+000172f0: 616e 290a 0a20 2020 2064 6566 2074 6573  an)..    def tes
+00017300: 745f 7772 6974 655f 6361 6368 655f 7772  t_write_cache_wr
+00017310: 6974 655f 6661 696c 2873 656c 6629 202d  ite_fail(self) -
+00017320: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00017330: 6d6f 6465 203d 2044 4546 4155 4c54 5f4d  mode = DEFAULT_M
+00017340: 4f44 450a 2020 2020 2020 2020 7769 7468  ODE.        with
+00017350: 2063 6163 6865 5f64 6972 2829 3a0a 2020   cache_dir():.  
+00017360: 2020 2020 2020 2020 2020 6361 6368 6520            cache 
+00017370: 3d20 626c 6163 6b2e 4361 6368 652e 7265  = black.Cache.re
+00017380: 6164 286d 6f64 6529 0a20 2020 2020 2020  ad(mode).       
+00017390: 2020 2020 2077 6974 6820 7061 7463 682e       with patch.
+000173a0: 6f62 6a65 6374 2850 6174 682c 2022 6f70  object(Path, "op
+000173b0: 656e 2229 2061 7320 6d6f 636b 3a0a 2020  en") as mock:.  
+000173c0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+000173d0: 636b 2e73 6964 655f 6566 6665 6374 203d  ck.side_effect =
+000173e0: 204f 5345 7272 6f72 0a20 2020 2020 2020   OSError.       
+000173f0: 2020 2020 2020 2020 2063 6163 6865 2e77           cache.w
+00017400: 7269 7465 285b 5d29 0a0a 2020 2020 6465  rite([])..    de
+00017410: 6620 7465 7374 5f72 6561 645f 6361 6368  f test_read_cach
+00017420: 655f 6c69 6e65 5f6c 656e 6774 6873 2873  e_line_lengths(s
+00017430: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00017440: 2020 2020 2020 6d6f 6465 203d 2044 4546        mode = DEF
+00017450: 4155 4c54 5f4d 4f44 450a 2020 2020 2020  AULT_MODE.      
+00017460: 2020 7368 6f72 745f 6d6f 6465 203d 2072    short_mode = r
+00017470: 6570 6c61 6365 2844 4546 4155 4c54 5f4d  eplace(DEFAULT_M
+00017480: 4f44 452c 206c 696e 655f 6c65 6e67 7468  ODE, line_length
+00017490: 3d31 290a 2020 2020 2020 2020 7769 7468  =1).        with
+000174a0: 2063 6163 6865 5f64 6972 2829 2061 7320   cache_dir() as 
+000174b0: 776f 726b 7370 6163 653a 0a20 2020 2020  workspace:.     
+000174c0: 2020 2020 2020 2070 6174 6820 3d20 2877         path = (w
+000174d0: 6f72 6b73 7061 6365 202f 2022 6669 6c65  orkspace / "file
+000174e0: 2e70 7922 292e 7265 736f 6c76 6528 290a  .py").resolve().
+000174f0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00017500: 2e74 6f75 6368 2829 0a20 2020 2020 2020  .touch().       
+00017510: 2020 2020 2063 6163 6865 203d 2062 6c61       cache = bla
+00017520: 636b 2e43 6163 6865 2e72 6561 6428 6d6f  ck.Cache.read(mo
+00017530: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
+00017540: 6361 6368 652e 7772 6974 6528 5b70 6174  cache.write([pat
+00017550: 685d 290a 2020 2020 2020 2020 2020 2020  h]).            
+00017560: 6f6e 6520 3d20 626c 6163 6b2e 4361 6368  one = black.Cach
+00017570: 652e 7265 6164 286d 6f64 6529 0a20 2020  e.read(mode).   
+00017580: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00017590: 6e6f 7420 6f6e 652e 6973 5f63 6861 6e67  not one.is_chang
+000175a0: 6564 2870 6174 6829 0a20 2020 2020 2020  ed(path).       
+000175b0: 2020 2020 2074 776f 203d 2062 6c61 636b       two = black
+000175c0: 2e43 6163 6865 2e72 6561 6428 7368 6f72  .Cache.read(shor
+000175d0: 745f 6d6f 6465 290a 2020 2020 2020 2020  t_mode).        
+000175e0: 2020 2020 6173 7365 7274 2074 776f 2e69      assert two.i
+000175f0: 735f 6368 616e 6765 6428 7061 7468 290a  s_changed(path).
+00017600: 0a0a 6465 6620 6173 7365 7274 5f63 6f6c  ..def assert_col
+00017610: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
+00017620: 2020 2020 7372 633a 2053 6571 7565 6e63      src: Sequenc
+00017630: 655b 556e 696f 6e5b 7374 722c 2050 6174  e[Union[str, Pat
+00017640: 685d 5d2c 0a20 2020 2065 7870 6563 7465  h]],.    expecte
+00017650: 643a 2053 6571 7565 6e63 655b 556e 696f  d: Sequence[Unio
+00017660: 6e5b 7374 722c 2050 6174 685d 5d2c 0a20  n[str, Path]],. 
+00017670: 2020 202a 2c0a 2020 2020 726f 6f74 3a20     *,.    root: 
+00017680: 4f70 7469 6f6e 616c 5b50 6174 685d 203d  Optional[Path] =
+00017690: 204e 6f6e 652c 0a20 2020 2065 7863 6c75   None,.    exclu
+000176a0: 6465 3a20 4f70 7469 6f6e 616c 5b73 7472  de: Optional[str
+000176b0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 696e  ] = None,.    in
+000176c0: 636c 7564 653a 204f 7074 696f 6e61 6c5b  clude: Optional[
+000176d0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+000176e0: 2065 7874 656e 645f 6578 636c 7564 653a   extend_exclude:
+000176f0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+00017700: 204e 6f6e 652c 0a20 2020 2066 6f72 6365   None,.    force
+00017710: 5f65 7863 6c75 6465 3a20 4f70 7469 6f6e  _exclude: Option
+00017720: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+00017730: 2020 2020 7374 6469 6e5f 6669 6c65 6e61      stdin_filena
+00017740: 6d65 3a20 4f70 7469 6f6e 616c 5b73 7472  me: Optional[str
+00017750: 5d20 3d20 4e6f 6e65 2c0a 2920 2d3e 204e  ] = None,.) -> N
+00017760: 6f6e 653a 0a20 2020 2067 735f 7372 6320  one:.    gs_src 
+00017770: 3d20 7475 706c 6528 7374 7228 5061 7468  = tuple(str(Path
+00017780: 2873 2929 2066 6f72 2073 2069 6e20 7372  (s)) for s in sr
+00017790: 6329 0a20 2020 2067 735f 6578 7065 6374  c).    gs_expect
+000177a0: 6564 203d 205b 5061 7468 2873 2920 666f  ed = [Path(s) fo
+000177b0: 7220 7320 696e 2065 7870 6563 7465 645d  r s in expected]
+000177c0: 0a20 2020 2067 735f 6578 636c 7564 6520  .    gs_exclude 
+000177d0: 3d20 4e6f 6e65 2069 6620 6578 636c 7564  = None if exclud
+000177e0: 6520 6973 204e 6f6e 6520 656c 7365 2063  e is None else c
+000177f0: 6f6d 7069 6c65 5f70 6174 7465 726e 2865  ompile_pattern(e
+00017800: 7863 6c75 6465 290a 2020 2020 6773 5f69  xclude).    gs_i
+00017810: 6e63 6c75 6465 203d 2044 4546 4155 4c54  nclude = DEFAULT
+00017820: 5f49 4e43 4c55 4445 2069 6620 696e 636c  _INCLUDE if incl
+00017830: 7564 6520 6973 204e 6f6e 6520 656c 7365  ude is None else
+00017840: 2063 6f6d 7069 6c65 5f70 6174 7465 726e   compile_pattern
+00017850: 2869 6e63 6c75 6465 290a 2020 2020 6773  (include).    gs
+00017860: 5f65 7874 656e 645f 6578 636c 7564 6520  _extend_exclude 
+00017870: 3d20 280a 2020 2020 2020 2020 4e6f 6e65  = (.        None
+00017880: 2069 6620 6578 7465 6e64 5f65 7863 6c75   if extend_exclu
+00017890: 6465 2069 7320 4e6f 6e65 2065 6c73 6520  de is None else 
+000178a0: 636f 6d70 696c 655f 7061 7474 6572 6e28  compile_pattern(
+000178b0: 6578 7465 6e64 5f65 7863 6c75 6465 290a  extend_exclude).
+000178c0: 2020 2020 290a 2020 2020 6773 5f66 6f72      ).    gs_for
+000178d0: 6365 5f65 7863 6c75 6465 203d 204e 6f6e  ce_exclude = Non
+000178e0: 6520 6966 2066 6f72 6365 5f65 7863 6c75  e if force_exclu
+000178f0: 6465 2069 7320 4e6f 6e65 2065 6c73 6520  de is None else 
+00017900: 636f 6d70 696c 655f 7061 7474 6572 6e28  compile_pattern(
+00017910: 666f 7263 655f 6578 636c 7564 6529 0a20  force_exclude). 
+00017920: 2020 2063 6f6c 6c65 6374 6564 203d 2062     collected = b
+00017930: 6c61 636b 2e67 6574 5f73 6f75 7263 6573  lack.get_sources
+00017940: 280a 2020 2020 2020 2020 726f 6f74 3d72  (.        root=r
+00017950: 6f6f 7420 6f72 2054 4849 535f 4449 522c  oot or THIS_DIR,
+00017960: 0a20 2020 2020 2020 2073 7263 3d67 735f  .        src=gs_
+00017970: 7372 632c 0a20 2020 2020 2020 2071 7569  src,.        qui
+00017980: 6574 3d46 616c 7365 2c0a 2020 2020 2020  et=False,.      
+00017990: 2020 7665 7262 6f73 653d 4661 6c73 652c    verbose=False,
+000179a0: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
+000179b0: 3d67 735f 696e 636c 7564 652c 0a20 2020  =gs_include,.   
+000179c0: 2020 2020 2065 7863 6c75 6465 3d67 735f       exclude=gs_
+000179d0: 6578 636c 7564 652c 0a20 2020 2020 2020  exclude,.       
+000179e0: 2065 7874 656e 645f 6578 636c 7564 653d   extend_exclude=
+000179f0: 6773 5f65 7874 656e 645f 6578 636c 7564  gs_extend_exclud
+00017a00: 652c 0a20 2020 2020 2020 2066 6f72 6365  e,.        force
+00017a10: 5f65 7863 6c75 6465 3d67 735f 666f 7263  _exclude=gs_forc
+00017a20: 655f 6578 636c 7564 652c 0a20 2020 2020  e_exclude,.     
+00017a30: 2020 2072 6570 6f72 743d 626c 6163 6b2e     report=black.
+00017a40: 5265 706f 7274 2829 2c0a 2020 2020 2020  Report(),.      
+00017a50: 2020 7374 6469 6e5f 6669 6c65 6e61 6d65    stdin_filename
+00017a60: 3d73 7464 696e 5f66 696c 656e 616d 652c  =stdin_filename,
+00017a70: 0a20 2020 2029 0a20 2020 2061 7373 6572  .    ).    asser
+00017a80: 7420 736f 7274 6564 2863 6f6c 6c65 6374  t sorted(collect
+00017a90: 6564 2920 3d3d 2073 6f72 7465 6428 6773  ed) == sorted(gs
+00017aa0: 5f65 7870 6563 7465 6429 0a0a 0a63 6c61  _expected)...cla
+00017ab0: 7373 2054 6573 7446 696c 6543 6f6c 6c65  ss TestFileColle
+00017ac0: 6374 696f 6e3a 0a20 2020 2064 6566 2074  ction:.    def t
+00017ad0: 6573 745f 696e 636c 7564 655f 6578 636c  est_include_excl
+00017ae0: 7564 6528 7365 6c66 2920 2d3e 204e 6f6e  ude(self) -> Non
+00017af0: 653a 0a20 2020 2020 2020 2070 6174 6820  e:.        path 
+00017b00: 3d20 5448 4953 5f44 4952 202f 2022 6461  = THIS_DIR / "da
+00017b10: 7461 2220 2f20 2269 6e63 6c75 6465 5f65  ta" / "include_e
+00017b20: 7863 6c75 6465 5f74 6573 7473 220a 2020  xclude_tests".  
+00017b30: 2020 2020 2020 7372 6320 3d20 5b70 6174        src = [pat
+00017b40: 685d 0a20 2020 2020 2020 2065 7870 6563  h].        expec
+00017b50: 7465 6420 3d20 5b0a 2020 2020 2020 2020  ted = [.        
+00017b60: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
+00017b70: 2262 2f64 6f6e 745f 6578 636c 7564 652f  "b/dont_exclude/
+00017b80: 612e 7079 2229 2c0a 2020 2020 2020 2020  a.py"),.        
+00017b90: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
+00017ba0: 2262 2f64 6f6e 745f 6578 636c 7564 652f  "b/dont_exclude/
+00017bb0: 612e 7079 6922 292c 0a20 2020 2020 2020  a.pyi"),.       
+00017bc0: 205d 0a20 2020 2020 2020 2061 7373 6572   ].        asser
+00017bd0: 745f 636f 6c6c 6563 7465 645f 736f 7572  t_collected_sour
+00017be0: 6365 7328 0a20 2020 2020 2020 2020 2020  ces(.           
+00017bf0: 2073 7263 2c0a 2020 2020 2020 2020 2020   src,.          
+00017c00: 2020 6578 7065 6374 6564 2c0a 2020 2020    expected,.    
+00017c10: 2020 2020 2020 2020 696e 636c 7564 653d          include=
+00017c20: 7222 5c2e 7079 693f 2422 2c0a 2020 2020  r"\.pyi?$",.    
+00017c30: 2020 2020 2020 2020 6578 636c 7564 653d          exclude=
+00017c40: 7222 2f65 7863 6c75 6465 2f7c 2f5c 2e64  r"/exclude/|/\.d
+00017c50: 6566 696e 6974 656c 795f 6578 636c 7564  efinitely_exclud
+00017c60: 652f 222c 0a20 2020 2020 2020 2029 0a0a  e/",.        )..
+00017c70: 2020 2020 6465 6620 7465 7374 5f67 6974      def test_git
+00017c80: 6967 6e6f 7265 5f75 7365 645f 6173 5f64  ignore_used_as_d
+00017c90: 6566 6175 6c74 2873 656c 6629 202d 3e20  efault(self) -> 
+00017ca0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6261  None:.        ba
+00017cb0: 7365 203d 2050 6174 6828 4441 5441 5f44  se = Path(DATA_D
+00017cc0: 4952 202f 2022 696e 636c 7564 655f 6578  IR / "include_ex
+00017cd0: 636c 7564 655f 7465 7374 7322 290a 2020  clude_tests").  
+00017ce0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+00017cf0: 205b 0a20 2020 2020 2020 2020 2020 2062   [.            b
+00017d00: 6173 6520 2f20 2262 2f2e 6465 6669 6e69  ase / "b/.defini
+00017d10: 7465 6c79 5f65 7863 6c75 6465 2f61 2e70  tely_exclude/a.p
+00017d20: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
+00017d30: 6261 7365 202f 2022 622f 2e64 6566 696e  base / "b/.defin
+00017d40: 6974 656c 795f 6578 636c 7564 652f 612e  itely_exclude/a.
+00017d50: 7079 6922 2c0a 2020 2020 2020 2020 5d0a  pyi",.        ].
+00017d60: 2020 2020 2020 2020 7372 6320 3d20 5b62          src = [b
+00017d70: 6173 6520 2f20 2262 2f22 5d0a 2020 2020  ase / "b/"].    
+00017d80: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
+00017d90: 6374 6564 5f73 6f75 7263 6573 2873 7263  cted_sources(src
+00017da0: 2c20 6578 7065 6374 6564 2c20 726f 6f74  , expected, root
+00017db0: 3d62 6173 652c 2065 7874 656e 645f 6578  =base, extend_ex
+00017dc0: 636c 7564 653d 7222 2f65 7863 6c75 6465  clude=r"/exclude
+00017dd0: 2f22 290a 0a20 2020 2064 6566 2074 6573  /")..    def tes
+00017de0: 745f 6769 7469 676e 6f72 655f 7573 6564  t_gitignore_used
+00017df0: 5f6f 6e5f 6d75 6c74 6970 6c65 5f73 6f75  _on_multiple_sou
+00017e00: 7263 6573 2873 656c 6629 202d 3e20 4e6f  rces(self) -> No
+00017e10: 6e65 3a0a 2020 2020 2020 2020 726f 6f74  ne:.        root
+00017e20: 203d 2050 6174 6828 4441 5441 5f44 4952   = Path(DATA_DIR
+00017e30: 202f 2022 6769 7469 676e 6f72 655f 7573   / "gitignore_us
+00017e40: 6564 5f6f 6e5f 6d75 6c74 6970 6c65 5f73  ed_on_multiple_s
+00017e50: 6f75 7263 6573 2229 0a20 2020 2020 2020  ources").       
+00017e60: 2065 7870 6563 7465 6420 3d20 5b0a 2020   expected = [.  
+00017e70: 2020 2020 2020 2020 2020 726f 6f74 202f            root /
+00017e80: 2022 6469 7231 2220 2f20 2262 2e70 7922   "dir1" / "b.py"
+00017e90: 2c0a 2020 2020 2020 2020 2020 2020 726f  ,.            ro
+00017ea0: 6f74 202f 2022 6469 7232 2220 2f20 2262  ot / "dir2" / "b
+00017eb0: 2e70 7922 2c0a 2020 2020 2020 2020 5d0a  .py",.        ].
+00017ec0: 2020 2020 2020 2020 7372 6320 3d20 5b72          src = [r
+00017ed0: 6f6f 7420 2f20 2264 6972 3122 2c20 726f  oot / "dir1", ro
+00017ee0: 6f74 202f 2022 6469 7232 225d 0a20 2020  ot / "dir2"].   
+00017ef0: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
+00017f00: 6563 7465 645f 736f 7572 6365 7328 7372  ected_sources(sr
+00017f10: 632c 2065 7870 6563 7465 642c 2072 6f6f  c, expected, roo
+00017f20: 743d 726f 6f74 290a 0a20 2020 2040 7061  t=root)..    @pa
+00017f30: 7463 6828 2262 6c61 636b 2e66 696e 645f  tch("black.find_
+00017f40: 7072 6f6a 6563 745f 726f 6f74 222c 206c  project_root", l
+00017f50: 616d 6264 6120 2a61 7267 733a 2028 5448  ambda *args: (TH
+00017f60: 4953 5f44 4952 2e72 6573 6f6c 7665 2829  IS_DIR.resolve()
+00017f70: 2c20 4e6f 6e65 2929 0a20 2020 2064 6566  , None)).    def
+00017f80: 2074 6573 745f 6578 636c 7564 655f 666f   test_exclude_fo
+00017f90: 725f 6973 7375 655f 3135 3732 2873 656c  r_issue_1572(sel
+00017fa0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00017fb0: 2020 2020 2320 4578 636c 7564 6520 7368      # Exclude sh
+00017fc0: 6f75 6c64 6e27 7420 746f 7563 6820 6669  ouldn't touch fi
+00017fd0: 6c65 7320 7468 6174 2077 6572 6520 6578  les that were ex
+00017fe0: 706c 6963 6974 6c79 2067 6976 656e 2074  plicitly given t
+00017ff0: 6f20 426c 6163 6b20 7468 726f 7567 6820  o Black through 
+00018000: 7468 650a 2020 2020 2020 2020 2320 434c  the.        # CL
+00018010: 492e 2045 7863 6c75 6465 2069 7320 7375  I. Exclude is su
+00018020: 7070 6f73 6564 2074 6f20 6f6e 6c79 2061  pposed to only a
+00018030: 7070 6c79 2074 6f20 7468 6520 7265 6375  pply to the recu
+00018040: 7273 6976 6520 6469 7363 6f76 6572 7920  rsive discovery 
+00018050: 6f66 2066 696c 6573 2e0a 2020 2020 2020  of files..      
+00018060: 2020 2320 6874 7470 733a 2f2f 6769 7468    # https://gith
+00018070: 7562 2e63 6f6d 2f70 7366 2f62 6c61 636b  ub.com/psf/black
+00018080: 2f69 7373 7565 732f 3135 3732 0a20 2020  /issues/1572.   
+00018090: 2020 2020 2070 6174 6820 3d20 4441 5441       path = DATA
+000180a0: 5f44 4952 202f 2022 696e 636c 7564 655f  _DIR / "include_
+000180b0: 6578 636c 7564 655f 7465 7374 7322 0a20  exclude_tests". 
+000180c0: 2020 2020 2020 2073 7263 203d 205b 7061         src = [pa
+000180d0: 7468 202f 2022 622f 6578 636c 7564 652f  th / "b/exclude/
+000180e0: 612e 7079 225d 0a20 2020 2020 2020 2065  a.py"].        e
+000180f0: 7870 6563 7465 6420 3d20 5b70 6174 6820  xpected = [path 
+00018100: 2f20 2262 2f65 7863 6c75 6465 2f61 2e70  / "b/exclude/a.p
+00018110: 7922 5d0a 2020 2020 2020 2020 6173 7365  y"].        asse
+00018120: 7274 5f63 6f6c 6c65 6374 6564 5f73 6f75  rt_collected_sou
+00018130: 7263 6573 2873 7263 2c20 6578 7065 6374  rces(src, expect
+00018140: 6564 2c20 696e 636c 7564 653d 2222 2c20  ed, include="", 
+00018150: 6578 636c 7564 653d 7222 2f65 7863 6c75  exclude=r"/exclu
+00018160: 6465 2f7c 615c 2e70 7922 290a 0a20 2020  de/|a\.py")..   
+00018170: 2064 6566 2074 6573 745f 6769 7469 676e   def test_gitign
+00018180: 6f72 655f 6578 636c 7564 6528 7365 6c66  ore_exclude(self
+00018190: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000181a0: 2020 2070 6174 6820 3d20 5448 4953 5f44     path = THIS_D
+000181b0: 4952 202f 2022 6461 7461 2220 2f20 2269  IR / "data" / "i
+000181c0: 6e63 6c75 6465 5f65 7863 6c75 6465 5f74  nclude_exclude_t
+000181d0: 6573 7473 220a 2020 2020 2020 2020 696e  ests".        in
+000181e0: 636c 7564 6520 3d20 7265 2e63 6f6d 7069  clude = re.compi
+000181f0: 6c65 2872 225c 2e70 7969 3f24 2229 0a20  le(r"\.pyi?$"). 
+00018200: 2020 2020 2020 2065 7863 6c75 6465 203d         exclude =
+00018210: 2072 652e 636f 6d70 696c 6528 7222 2229   re.compile(r"")
+00018220: 0a20 2020 2020 2020 2072 6570 6f72 7420  .        report 
+00018230: 3d20 626c 6163 6b2e 5265 706f 7274 2829  = black.Report()
+00018240: 0a20 2020 2020 2020 2067 6974 6967 6e6f  .        gitigno
+00018250: 7265 203d 2050 6174 6853 7065 632e 6672  re = PathSpec.fr
+00018260: 6f6d 5f6c 696e 6573 280a 2020 2020 2020  om_lines(.      
+00018270: 2020 2020 2020 2267 6974 7769 6c64 6d61        "gitwildma
+00018280: 7463 6822 2c20 5b22 6578 636c 7564 652f  tch", ["exclude/
+00018290: 222c 2022 2e64 6566 696e 6974 656c 795f  ", ".definitely_
+000182a0: 6578 636c 7564 6522 5d0a 2020 2020 2020  exclude"].      
+000182b0: 2020 290a 2020 2020 2020 2020 736f 7572    ).        sour
+000182c0: 6365 733a 204c 6973 745b 5061 7468 5d20  ces: List[Path] 
+000182d0: 3d20 5b5d 0a20 2020 2020 2020 2065 7870  = [].        exp
+000182e0: 6563 7465 6420 3d20 5b0a 2020 2020 2020  ected = [.      
+000182f0: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
+00018300: 2f20 2262 2f64 6f6e 745f 6578 636c 7564  / "b/dont_exclud
+00018310: 652f 612e 7079 2229 2c0a 2020 2020 2020  e/a.py"),.      
+00018320: 2020 2020 2020 5061 7468 2870 6174 6820        Path(path 
+00018330: 2f20 2262 2f64 6f6e 745f 6578 636c 7564  / "b/dont_exclud
+00018340: 652f 612e 7079 6922 292c 0a20 2020 2020  e/a.pyi"),.     
+00018350: 2020 205d 0a20 2020 2020 2020 2074 6869     ].        thi
+00018360: 735f 6162 7320 3d20 5448 4953 5f44 4952  s_abs = THIS_DIR
+00018370: 2e72 6573 6f6c 7665 2829 0a20 2020 2020  .resolve().     
+00018380: 2020 2073 6f75 7263 6573 2e65 7874 656e     sources.exten
+00018390: 6428 0a20 2020 2020 2020 2020 2020 2062  d(.            b
+000183a0: 6c61 636b 2e67 656e 5f70 7974 686f 6e5f  lack.gen_python_
+000183b0: 6669 6c65 7328 0a20 2020 2020 2020 2020  files(.         
+000183c0: 2020 2020 2020 2070 6174 682e 6974 6572         path.iter
+000183d0: 6469 7228 292c 0a20 2020 2020 2020 2020  dir(),.         
+000183e0: 2020 2020 2020 2074 6869 735f 6162 732c         this_abs,
+000183f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018400: 2069 6e63 6c75 6465 2c0a 2020 2020 2020   include,.      
+00018410: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+00018420: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00018430: 2020 204e 6f6e 652c 0a20 2020 2020 2020     None,.       
+00018440: 2020 2020 2020 2020 204e 6f6e 652c 0a20           None,. 
+00018450: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00018460: 6570 6f72 742c 0a20 2020 2020 2020 2020  eport,.         
+00018470: 2020 2020 2020 207b 7061 7468 3a20 6769         {path: gi
+00018480: 7469 676e 6f72 657d 2c0a 2020 2020 2020  tignore},.      
+00018490: 2020 2020 2020 2020 2020 7665 7262 6f73            verbos
+000184a0: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+000184b0: 2020 2020 2020 2020 2071 7569 6574 3d46           quiet=F
+000184c0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+000184d0: 2020 290a 2020 2020 2020 2020 290a 2020    ).        ).  
+000184e0: 2020 2020 2020 6173 7365 7274 2073 6f72        assert sor
+000184f0: 7465 6428 6578 7065 6374 6564 2920 3d3d  ted(expected) ==
+00018500: 2073 6f72 7465 6428 736f 7572 6365 7329   sorted(sources)
+00018510: 0a0a 2020 2020 6465 6620 7465 7374 5f6e  ..    def test_n
+00018520: 6573 7465 645f 6769 7469 676e 6f72 6528  ested_gitignore(
+00018530: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
+00018540: 2020 2020 2020 2070 6174 6820 3d20 5061         path = Pa
+00018550: 7468 2854 4849 535f 4449 5220 2f20 2264  th(THIS_DIR / "d
+00018560: 6174 6122 202f 2022 6e65 7374 6564 5f67  ata" / "nested_g
+00018570: 6974 6967 6e6f 7265 5f74 6573 7473 2229  itignore_tests")
+00018580: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
+00018590: 203d 2072 652e 636f 6d70 696c 6528 7222   = re.compile(r"
+000185a0: 5c2e 7079 693f 2422 290a 2020 2020 2020  \.pyi?$").      
+000185b0: 2020 6578 636c 7564 6520 3d20 7265 2e63    exclude = re.c
+000185c0: 6f6d 7069 6c65 2872 2222 290a 2020 2020  ompile(r"").    
+000185d0: 2020 2020 726f 6f74 5f67 6974 6967 6e6f      root_gitigno
+000185e0: 7265 203d 2062 6c61 636b 2e66 696c 6573  re = black.files
+000185f0: 2e67 6574 5f67 6974 6967 6e6f 7265 2870  .get_gitignore(p
+00018600: 6174 6829 0a20 2020 2020 2020 2072 6570  ath).        rep
+00018610: 6f72 7420 3d20 626c 6163 6b2e 5265 706f  ort = black.Repo
+00018620: 7274 2829 0a20 2020 2020 2020 2065 7870  rt().        exp
+00018630: 6563 7465 643a 204c 6973 745b 5061 7468  ected: List[Path
+00018640: 5d20 3d20 5b0a 2020 2020 2020 2020 2020  ] = [.          
+00018650: 2020 5061 7468 2870 6174 6820 2f20 2278    Path(path / "x
+00018660: 2e70 7922 292c 0a20 2020 2020 2020 2020  .py"),.         
+00018670: 2020 2050 6174 6828 7061 7468 202f 2022     Path(path / "
+00018680: 726f 6f74 2f62 2e70 7922 292c 0a20 2020  root/b.py"),.   
+00018690: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
+000186a0: 7468 202f 2022 726f 6f74 2f63 2e70 7922  th / "root/c.py"
+000186b0: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
+000186c0: 6174 6828 7061 7468 202f 2022 726f 6f74  ath(path / "root
+000186d0: 2f63 6869 6c64 2f63 2e70 7922 292c 0a20  /child/c.py"),. 
+000186e0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+000186f0: 2074 6869 735f 6162 7320 3d20 5448 4953   this_abs = THIS
+00018700: 5f44 4952 2e72 6573 6f6c 7665 2829 0a20  _DIR.resolve(). 
+00018710: 2020 2020 2020 2073 6f75 7263 6573 203d         sources =
+00018720: 206c 6973 7428 0a20 2020 2020 2020 2020   list(.         
+00018730: 2020 2062 6c61 636b 2e67 656e 5f70 7974     black.gen_pyt
+00018740: 686f 6e5f 6669 6c65 7328 0a20 2020 2020  hon_files(.     
+00018750: 2020 2020 2020 2020 2020 2070 6174 682e             path.
+00018760: 6974 6572 6469 7228 292c 0a20 2020 2020  iterdir(),.     
+00018770: 2020 2020 2020 2020 2020 2074 6869 735f             this_
+00018780: 6162 732c 0a20 2020 2020 2020 2020 2020  abs,.           
+00018790: 2020 2020 2069 6e63 6c75 6465 2c0a 2020       include,.  
+000187a0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+000187b0: 636c 7564 652c 0a20 2020 2020 2020 2020  clude,.         
+000187c0: 2020 2020 2020 204e 6f6e 652c 0a20 2020         None,.   
+000187d0: 2020 2020 2020 2020 2020 2020 204e 6f6e               Non
+000187e0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+000187f0: 2020 2072 6570 6f72 742c 0a20 2020 2020     report,.     
+00018800: 2020 2020 2020 2020 2020 207b 7061 7468             {path
+00018810: 3a20 726f 6f74 5f67 6974 6967 6e6f 7265  : root_gitignore
+00018820: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+00018830: 2020 2076 6572 626f 7365 3d46 616c 7365     verbose=False
+00018840: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018850: 2020 7175 6965 743d 4661 6c73 652c 0a20    quiet=False,. 
+00018860: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00018870: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
+00018880: 7373 6572 7420 736f 7274 6564 2865 7870  ssert sorted(exp
+00018890: 6563 7465 6429 203d 3d20 736f 7274 6564  ected) == sorted
+000188a0: 2873 6f75 7263 6573 290a 0a20 2020 2064  (sources)..    d
+000188b0: 6566 2074 6573 745f 6e65 7374 6564 5f67  ef test_nested_g
+000188c0: 6974 6967 6e6f 7265 5f64 6972 6563 746c  itignore_directl
+000188d0: 795f 696e 5f73 6f75 7263 655f 6469 7265  y_in_source_dire
+000188e0: 6374 6f72 7928 7365 6c66 2920 2d3e 204e  ctory(self) -> N
+000188f0: 6f6e 653a 0a20 2020 2020 2020 2023 2068  one:.        # h
+00018900: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+00018910: 6d2f 7073 662f 626c 6163 6b2f 6973 7375  m/psf/black/issu
+00018920: 6573 2f32 3539 380a 2020 2020 2020 2020  es/2598.        
+00018930: 7061 7468 203d 2050 6174 6828 4441 5441  path = Path(DATA
+00018940: 5f44 4952 202f 2022 6e65 7374 6564 5f67  _DIR / "nested_g
+00018950: 6974 6967 6e6f 7265 5f74 6573 7473 2229  itignore_tests")
+00018960: 0a20 2020 2020 2020 2073 7263 203d 2050  .        src = P
+00018970: 6174 6828 7061 7468 202f 2022 726f 6f74  ath(path / "root
+00018980: 2220 2f20 2263 6869 6c64 2229 0a20 2020  " / "child").   
+00018990: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
+000189a0: 5b73 7263 202f 2022 612e 7079 222c 2073  [src / "a.py", s
+000189b0: 7263 202f 2022 632e 7079 225d 0a20 2020  rc / "c.py"].   
+000189c0: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
+000189d0: 6563 7465 645f 736f 7572 6365 7328 5b73  ected_sources([s
+000189e0: 7263 5d2c 2065 7870 6563 7465 6429 0a0a  rc], expected)..
+000189f0: 2020 2020 6465 6620 7465 7374 5f69 6e76      def test_inv
+00018a00: 616c 6964 5f67 6974 6967 6e6f 7265 2873  alid_gitignore(s
+00018a10: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00018a20: 2020 2020 2020 7061 7468 203d 2054 4849        path = THI
+00018a30: 535f 4449 5220 2f20 2264 6174 6122 202f  S_DIR / "data" /
+00018a40: 2022 696e 7661 6c69 645f 6769 7469 676e   "invalid_gitign
+00018a50: 6f72 655f 7465 7374 7322 0a20 2020 2020  ore_tests".     
+00018a60: 2020 2065 6d70 7479 5f63 6f6e 6669 6720     empty_config 
+00018a70: 3d20 7061 7468 202f 2022 7079 7072 6f6a  = path / "pyproj
+00018a80: 6563 742e 746f 6d6c 220a 2020 2020 2020  ect.toml".      
+00018a90: 2020 7265 7375 6c74 203d 2042 6c61 636b    result = Black
+00018aa0: 5275 6e6e 6572 2829 2e69 6e76 6f6b 6528  Runner().invoke(
+00018ab0: 0a20 2020 2020 2020 2020 2020 2062 6c61  .            bla
+00018ac0: 636b 2e6d 6169 6e2c 205b 222d 2d76 6572  ck.main, ["--ver
+00018ad0: 626f 7365 222c 2022 2d2d 636f 6e66 6967  bose", "--config
+00018ae0: 222c 2073 7472 2865 6d70 7479 5f63 6f6e  ", str(empty_con
+00018af0: 6669 6729 2c20 7374 7228 7061 7468 295d  fig), str(path)]
+00018b00: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00018b10: 2020 2061 7373 6572 7420 7265 7375 6c74     assert result
+00018b20: 2e65 7869 745f 636f 6465 203d 3d20 310a  .exit_code == 1.
+00018b30: 2020 2020 2020 2020 6173 7365 7274 2072          assert r
+00018b40: 6573 756c 742e 7374 6465 7272 5f62 7974  esult.stderr_byt
+00018b50: 6573 2069 7320 6e6f 7420 4e6f 6e65 0a0a  es is not None..
+00018b60: 2020 2020 2020 2020 6769 7469 676e 6f72          gitignor
+00018b70: 6520 3d20 7061 7468 202f 2022 2e67 6974  e = path / ".git
+00018b80: 6967 6e6f 7265 220a 2020 2020 2020 2020  ignore".        
+00018b90: 6173 7365 7274 2072 652e 7365 6172 6368  assert re.search
+00018ba0: 280a 2020 2020 2020 2020 2020 2020 6622  (.            f"
+00018bb0: 436f 756c 6420 6e6f 7420 7061 7273 6520  Could not parse 
+00018bc0: 7b67 6974 6967 6e6f 7265 7d22 2e72 6570  {gitignore}".rep
+00018bd0: 6c61 6365 2822 5c5c 222c 2022 5c5c 5c5c  lace("\\", "\\\\
+00018be0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+00018bf0: 7265 7375 6c74 2e73 7464 6572 725f 6279  result.stderr_by
+00018c00: 7465 732e 6465 636f 6465 2829 2c0a 2020  tes.decode(),.  
+00018c10: 2020 2020 2020 2020 2020 7265 2e49 474e            re.IGN
+00018c20: 4f52 4543 4153 4520 6966 2069 7369 6e73  ORECASE if isins
+00018c30: 7461 6e63 6528 6769 7469 676e 6f72 652c  tance(gitignore,
+00018c40: 2057 696e 646f 7773 5061 7468 2920 656c   WindowsPath) el
+00018c50: 7365 2030 2c0a 2020 2020 2020 2020 290a  se 0,.        ).
+00018c60: 0a20 2020 2064 6566 2074 6573 745f 696e  .    def test_in
+00018c70: 7661 6c69 645f 6e65 7374 6564 5f67 6974  valid_nested_git
+00018c80: 6967 6e6f 7265 2873 656c 6629 202d 3e20  ignore(self) -> 
+00018c90: 4e6f 6e65 3a0a 2020 2020 2020 2020 7061  None:.        pa
+00018ca0: 7468 203d 2054 4849 535f 4449 5220 2f20  th = THIS_DIR / 
+00018cb0: 2264 6174 6122 202f 2022 696e 7661 6c69  "data" / "invali
+00018cc0: 645f 6e65 7374 6564 5f67 6974 6967 6e6f  d_nested_gitigno
+00018cd0: 7265 5f74 6573 7473 220a 2020 2020 2020  re_tests".      
+00018ce0: 2020 656d 7074 795f 636f 6e66 6967 203d    empty_config =
+00018cf0: 2070 6174 6820 2f20 2270 7970 726f 6a65   path / "pyproje
+00018d00: 6374 2e74 6f6d 6c22 0a20 2020 2020 2020  ct.toml".       
+00018d10: 2072 6573 756c 7420 3d20 426c 6163 6b52   result = BlackR
+00018d20: 756e 6e65 7228 292e 696e 766f 6b65 280a  unner().invoke(.
+00018d30: 2020 2020 2020 2020 2020 2020 626c 6163              blac
+00018d40: 6b2e 6d61 696e 2c20 5b22 2d2d 7665 7262  k.main, ["--verb
+00018d50: 6f73 6522 2c20 222d 2d63 6f6e 6669 6722  ose", "--config"
+00018d60: 2c20 7374 7228 656d 7074 795f 636f 6e66  , str(empty_conf
+00018d70: 6967 292c 2073 7472 2870 6174 6829 5d0a  ig), str(path)].
+00018d80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00018d90: 2020 6173 7365 7274 2072 6573 756c 742e    assert result.
+00018da0: 6578 6974 5f63 6f64 6520 3d3d 2031 0a20  exit_code == 1. 
+00018db0: 2020 2020 2020 2061 7373 6572 7420 7265         assert re
+00018dc0: 7375 6c74 2e73 7464 6572 725f 6279 7465  sult.stderr_byte
+00018dd0: 7320 6973 206e 6f74 204e 6f6e 650a 0a20  s is not None.. 
+00018de0: 2020 2020 2020 2067 6974 6967 6e6f 7265         gitignore
+00018df0: 203d 2070 6174 6820 2f20 2261 2220 2f20   = path / "a" / 
+00018e00: 222e 6769 7469 676e 6f72 6522 0a20 2020  ".gitignore".   
+00018e10: 2020 2020 2061 7373 6572 7420 7265 2e73       assert re.s
+00018e20: 6561 7263 6828 0a20 2020 2020 2020 2020  earch(.         
+00018e30: 2020 2066 2243 6f75 6c64 206e 6f74 2070     f"Could not p
+00018e40: 6172 7365 207b 6769 7469 676e 6f72 657d  arse {gitignore}
+00018e50: 222e 7265 706c 6163 6528 225c 5c22 2c20  ".replace("\\", 
+00018e60: 225c 5c5c 5c22 292c 0a20 2020 2020 2020  "\\\\"),.       
+00018e70: 2020 2020 2072 6573 756c 742e 7374 6465       result.stde
+00018e80: 7272 5f62 7974 6573 2e64 6563 6f64 6528  rr_bytes.decode(
+00018e90: 292c 0a20 2020 2020 2020 2020 2020 2072  ),.            r
+00018ea0: 652e 4947 4e4f 5245 4341 5345 2069 6620  e.IGNORECASE if 
+00018eb0: 6973 696e 7374 616e 6365 2867 6974 6967  isinstance(gitig
+00018ec0: 6e6f 7265 2c20 5769 6e64 6f77 7350 6174  nore, WindowsPat
+00018ed0: 6829 2065 6c73 6520 302c 0a20 2020 2020  h) else 0,.     
+00018ee0: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
+00018ef0: 7374 5f67 6974 6967 6e6f 7265 5f74 6861  st_gitignore_tha
+00018f00: 745f 6967 6e6f 7265 735f 7375 6266 6f6c  t_ignores_subfol
+00018f10: 6465 7273 2873 656c 6629 202d 3e20 4e6f  ders(self) -> No
+00018f20: 6e65 3a0a 2020 2020 2020 2020 2320 4966  ne:.        # If
+00018f30: 2067 6974 6967 6e6f 7265 2077 6974 6820   gitignore with 
+00018f40: 2a2f 2a20 6973 2069 6e20 726f 6f74 0a20  */* is in root. 
+00018f50: 2020 2020 2020 2072 6f6f 7420 3d20 5061         root = Pa
+00018f60: 7468 2844 4154 415f 4449 5220 2f20 2269  th(DATA_DIR / "i
+00018f70: 676e 6f72 655f 7375 6266 6f6c 6465 7273  gnore_subfolders
+00018f80: 5f67 6974 6967 6e6f 7265 5f74 6573 7473  _gitignore_tests
+00018f90: 2220 2f20 2273 7562 6469 7222 290a 2020  " / "subdir").  
+00018fa0: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+00018fb0: 205b 726f 6f74 202f 2022 622e 7079 225d   [root / "b.py"]
+00018fc0: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
+00018fd0: 636f 6c6c 6563 7465 645f 736f 7572 6365  collected_source
+00018fe0: 7328 5b72 6f6f 745d 2c20 6578 7065 6374  s([root], expect
+00018ff0: 6564 2c20 726f 6f74 3d72 6f6f 7429 0a0a  ed, root=root)..
+00019000: 2020 2020 2020 2020 2320 4966 202e 6769          # If .gi
+00019010: 7469 676e 6f72 6520 7769 7468 202a 2f2a  tignore with */*
+00019020: 2069 7320 6e65 7374 6564 0a20 2020 2020   is nested.     
+00019030: 2020 2072 6f6f 7420 3d20 5061 7468 2844     root = Path(D
+00019040: 4154 415f 4449 5220 2f20 2269 676e 6f72  ATA_DIR / "ignor
+00019050: 655f 7375 6266 6f6c 6465 7273 5f67 6974  e_subfolders_git
+00019060: 6967 6e6f 7265 5f74 6573 7473 2229 0a20  ignore_tests"). 
+00019070: 2020 2020 2020 2065 7870 6563 7465 6420         expected 
+00019080: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+00019090: 726f 6f74 202f 2022 612e 7079 222c 0a20  root / "a.py",. 
+000190a0: 2020 2020 2020 2020 2020 2072 6f6f 7420             root 
+000190b0: 2f20 2273 7562 6469 7222 202f 2022 622e  / "subdir" / "b.
+000190c0: 7079 222c 0a20 2020 2020 2020 205d 0a20  py",.        ]. 
+000190d0: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
+000190e0: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
+000190f0: 5b72 6f6f 745d 2c20 6578 7065 6374 6564  [root], expected
+00019100: 2c20 726f 6f74 3d72 6f6f 7429 0a0a 2020  , root=root)..  
+00019110: 2020 2020 2020 2320 4966 2063 6f6d 6d61        # If comma
+00019120: 6e64 2069 7320 6578 6563 7574 6564 2066  nd is executed f
+00019130: 726f 6d20 6f75 7465 7220 6469 720a 2020  rom outer dir.  
+00019140: 2020 2020 2020 726f 6f74 203d 2050 6174        root = Pat
+00019150: 6828 4441 5441 5f44 4952 202f 2022 6967  h(DATA_DIR / "ig
+00019160: 6e6f 7265 5f73 7562 666f 6c64 6572 735f  nore_subfolders_
+00019170: 6769 7469 676e 6f72 655f 7465 7374 7322  gitignore_tests"
+00019180: 290a 2020 2020 2020 2020 7461 7267 6574  ).        target
+00019190: 203d 2072 6f6f 7420 2f20 2273 7562 6469   = root / "subdi
+000191a0: 7222 0a20 2020 2020 2020 2065 7870 6563  r".        expec
+000191b0: 7465 6420 3d20 5b74 6172 6765 7420 2f20  ted = [target / 
+000191c0: 2262 2e70 7922 5d0a 2020 2020 2020 2020  "b.py"].        
+000191d0: 6173 7365 7274 5f63 6f6c 6c65 6374 6564  assert_collected
+000191e0: 5f73 6f75 7263 6573 285b 7461 7267 6574  _sources([target
+000191f0: 5d2c 2065 7870 6563 7465 642c 2072 6f6f  ], expected, roo
+00019200: 743d 726f 6f74 290a 0a20 2020 2064 6566  t=root)..    def
+00019210: 2074 6573 745f 656d 7074 795f 696e 636c   test_empty_incl
+00019220: 7564 6528 7365 6c66 2920 2d3e 204e 6f6e  ude(self) -> Non
+00019230: 653a 0a20 2020 2020 2020 2070 6174 6820  e:.        path 
+00019240: 3d20 4441 5441 5f44 4952 202f 2022 696e  = DATA_DIR / "in
+00019250: 636c 7564 655f 6578 636c 7564 655f 7465  clude_exclude_te
+00019260: 7374 7322 0a20 2020 2020 2020 2073 7263  sts".        src
+00019270: 203d 205b 7061 7468 5d0a 2020 2020 2020   = [path].      
+00019280: 2020 6578 7065 6374 6564 203d 205b 0a20    expected = [. 
+00019290: 2020 2020 2020 2020 2020 2050 6174 6828             Path(
+000192a0: 7061 7468 202f 2022 622f 6578 636c 7564  path / "b/exclud
+000192b0: 652f 612e 7069 6522 292c 0a20 2020 2020  e/a.pie"),.     
+000192c0: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
+000192d0: 202f 2022 622f 6578 636c 7564 652f 612e   / "b/exclude/a.
+000192e0: 7079 2229 2c0a 2020 2020 2020 2020 2020  py"),.          
+000192f0: 2020 5061 7468 2870 6174 6820 2f20 2262    Path(path / "b
+00019300: 2f65 7863 6c75 6465 2f61 2e70 7969 2229  /exclude/a.pyi")
+00019310: 2c0a 2020 2020 2020 2020 2020 2020 5061  ,.            Pa
+00019320: 7468 2870 6174 6820 2f20 2262 2f64 6f6e  th(path / "b/don
+00019330: 745f 6578 636c 7564 652f 612e 7069 6522  t_exclude/a.pie"
+00019340: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
+00019350: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
+00019360: 6e74 5f65 7863 6c75 6465 2f61 2e70 7922  nt_exclude/a.py"
+00019370: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
+00019380: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
+00019390: 6e74 5f65 7863 6c75 6465 2f61 2e70 7969  nt_exclude/a.pyi
+000193a0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+000193b0: 5061 7468 2870 6174 6820 2f20 2262 2f2e  Path(path / "b/.
+000193c0: 6465 6669 6e69 7465 6c79 5f65 7863 6c75  definitely_exclu
+000193d0: 6465 2f61 2e70 6965 2229 2c0a 2020 2020  de/a.pie"),.    
+000193e0: 2020 2020 2020 2020 5061 7468 2870 6174          Path(pat
+000193f0: 6820 2f20 2262 2f2e 6465 6669 6e69 7465  h / "b/.definite
+00019400: 6c79 5f65 7863 6c75 6465 2f61 2e70 7922  ly_exclude/a.py"
+00019410: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
+00019420: 6174 6828 7061 7468 202f 2022 622f 2e64  ath(path / "b/.d
+00019430: 6566 696e 6974 656c 795f 6578 636c 7564  efinitely_exclud
+00019440: 652f 612e 7079 6922 292c 0a20 2020 2020  e/a.pyi"),.     
+00019450: 2020 2020 2020 2050 6174 6828 7061 7468         Path(path
+00019460: 202f 2022 2e67 6974 6967 6e6f 7265 2229   / ".gitignore")
+00019470: 2c0a 2020 2020 2020 2020 2020 2020 5061  ,.            Pa
+00019480: 7468 2870 6174 6820 2f20 2270 7970 726f  th(path / "pypro
+00019490: 6a65 6374 2e74 6f6d 6c22 292c 0a20 2020  ject.toml"),.   
+000194a0: 2020 2020 205d 0a20 2020 2020 2020 2023       ].        #
+000194b0: 2053 6574 7469 6e67 2065 7863 6c75 6465   Setting exclude
+000194c0: 2065 7870 6c69 6369 746c 7920 746f 2061   explicitly to a
+000194d0: 6e20 656d 7074 7920 7374 7269 6e67 2074  n empty string t
+000194e0: 6f20 626c 6f63 6b20 2e67 6974 6967 6e6f  o block .gitigno
+000194f0: 7265 2075 7361 6765 2e0a 2020 2020 2020  re usage..      
+00019500: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
+00019510: 6564 5f73 6f75 7263 6573 2873 7263 2c20  ed_sources(src, 
+00019520: 6578 7065 6374 6564 2c20 696e 636c 7564  expected, includ
+00019530: 653d 2222 2c20 6578 636c 7564 653d 2222  e="", exclude=""
+00019540: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00019550: 696e 636c 7564 655f 6162 736f 6c75 7465  include_absolute
+00019560: 5f70 6174 6828 7365 6c66 2920 2d3e 204e  _path(self) -> N
+00019570: 6f6e 653a 0a20 2020 2020 2020 2070 6174  one:.        pat
+00019580: 6820 3d20 4441 5441 5f44 4952 202f 2022  h = DATA_DIR / "
+00019590: 696e 636c 7564 655f 6578 636c 7564 655f  include_exclude_
+000195a0: 7465 7374 7322 0a20 2020 2020 2020 2073  tests".        s
+000195b0: 7263 203d 205b 7061 7468 5d0a 2020 2020  rc = [path].    
+000195c0: 2020 2020 6578 7065 6374 6564 203d 205b      expected = [
+000195d0: 0a20 2020 2020 2020 2020 2020 2050 6174  .            Pat
+000195e0: 6828 7061 7468 202f 2022 622f 646f 6e74  h(path / "b/dont
+000195f0: 5f65 7863 6c75 6465 2f61 2e70 6965 2229  _exclude/a.pie")
+00019600: 2c0a 2020 2020 2020 2020 5d0a 2020 2020  ,.        ].    
+00019610: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
+00019620: 6374 6564 5f73 6f75 7263 6573 280a 2020  cted_sources(.  
+00019630: 2020 2020 2020 2020 2020 7372 632c 2065            src, e
+00019640: 7870 6563 7465 642c 2072 6f6f 743d 7061  xpected, root=pa
+00019650: 7468 2c20 696e 636c 7564 653d 7222 5e2f  th, include=r"^/
+00019660: 622f 646f 6e74 5f65 7863 6c75 6465 2f61  b/dont_exclude/a
+00019670: 5c2e 7069 6524 222c 2065 7863 6c75 6465  \.pie$", exclude
+00019680: 3d22 220a 2020 2020 2020 2020 290a 0a20  ="".        ).. 
+00019690: 2020 2064 6566 2074 6573 745f 6578 636c     def test_excl
+000196a0: 7564 655f 6162 736f 6c75 7465 5f70 6174  ude_absolute_pat
+000196b0: 6828 7365 6c66 2920 2d3e 204e 6f6e 653a  h(self) -> None:
+000196c0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+000196d0: 4441 5441 5f44 4952 202f 2022 696e 636c  DATA_DIR / "incl
+000196e0: 7564 655f 6578 636c 7564 655f 7465 7374  ude_exclude_test
+000196f0: 7322 0a20 2020 2020 2020 2073 7263 203d  s".        src =
+00019700: 205b 7061 7468 5d0a 2020 2020 2020 2020   [path].        
+00019710: 6578 7065 6374 6564 203d 205b 0a20 2020  expected = [.   
+00019720: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
+00019730: 7468 202f 2022 622f 646f 6e74 5f65 7863  th / "b/dont_exc
+00019740: 6c75 6465 2f61 2e70 7922 292c 0a20 2020  lude/a.py"),.   
+00019750: 2020 2020 2020 2020 2050 6174 6828 7061           Path(pa
+00019760: 7468 202f 2022 622f 2e64 6566 696e 6974  th / "b/.definit
+00019770: 656c 795f 6578 636c 7564 652f 612e 7079  ely_exclude/a.py
+00019780: 2229 2c0a 2020 2020 2020 2020 5d0a 2020  "),.        ].  
+00019790: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
+000197a0: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
+000197b0: 2020 2020 2020 2020 2020 2020 7372 632c              src,
+000197c0: 2065 7870 6563 7465 642c 2072 6f6f 743d   expected, root=
+000197d0: 7061 7468 2c20 696e 636c 7564 653d 7222  path, include=r"
+000197e0: 5c2e 7079 2422 2c20 6578 636c 7564 653d  \.py$", exclude=
+000197f0: 7222 5e2f 622f 6578 636c 7564 652f 615c  r"^/b/exclude/a\
+00019800: 2e70 7924 220a 2020 2020 2020 2020 290a  .py$".        ).
+00019810: 0a20 2020 2064 6566 2074 6573 745f 6578  .    def test_ex
+00019820: 7465 6e64 5f65 7863 6c75 6465 2873 656c  tend_exclude(sel
+00019830: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00019840: 2020 2020 7061 7468 203d 2044 4154 415f      path = DATA_
+00019850: 4449 5220 2f20 2269 6e63 6c75 6465 5f65  DIR / "include_e
+00019860: 7863 6c75 6465 5f74 6573 7473 220a 2020  xclude_tests".  
+00019870: 2020 2020 2020 7372 6320 3d20 5b70 6174        src = [pat
+00019880: 685d 0a20 2020 2020 2020 2065 7870 6563  h].        expec
+00019890: 7465 6420 3d20 5b0a 2020 2020 2020 2020  ted = [.        
+000198a0: 2020 2020 5061 7468 2870 6174 6820 2f20      Path(path / 
+000198b0: 2262 2f65 7863 6c75 6465 2f61 2e70 7922  "b/exclude/a.py"
+000198c0: 292c 0a20 2020 2020 2020 2020 2020 2050  ),.            P
+000198d0: 6174 6828 7061 7468 202f 2022 622f 646f  ath(path / "b/do
+000198e0: 6e74 5f65 7863 6c75 6465 2f61 2e70 7922  nt_exclude/a.py"
+000198f0: 292c 0a20 2020 2020 2020 205d 0a20 2020  ),.        ].   
+00019900: 2020 2020 2061 7373 6572 745f 636f 6c6c       assert_coll
+00019910: 6563 7465 645f 736f 7572 6365 7328 0a20  ected_sources(. 
+00019920: 2020 2020 2020 2020 2020 2073 7263 2c20             src, 
+00019930: 6578 7065 6374 6564 2c20 6578 636c 7564  expected, exclud
+00019940: 653d 7222 5c2e 7079 6924 222c 2065 7874  e=r"\.pyi$", ext
+00019950: 656e 645f 6578 636c 7564 653d 7222 5c2e  end_exclude=r"\.
+00019960: 6465 6669 6e69 7465 6c79 5f65 7863 6c75  definitely_exclu
+00019970: 6465 220a 2020 2020 2020 2020 290a 0a20  de".        ).. 
+00019980: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
+00019990: 696e 636f 6d70 6174 6962 6c65 5f77 6974  incompatible_wit
+000199a0: 685f 6d79 7079 630a 2020 2020 6465 6620  h_mypyc.    def 
+000199b0: 7465 7374 5f73 796d 6c69 6e6b 7328 7365  test_symlinks(se
+000199c0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+000199d0: 2020 2020 2072 6f6f 7420 3d20 5448 4953       root = THIS
+000199e0: 5f44 4952 2e72 6573 6f6c 7665 2829 0a20  _DIR.resolve(). 
+000199f0: 2020 2020 2020 2069 6e63 6c75 6465 203d         include =
+00019a00: 2072 652e 636f 6d70 696c 6528 626c 6163   re.compile(blac
+00019a10: 6b2e 4445 4641 554c 545f 494e 434c 5544  k.DEFAULT_INCLUD
+00019a20: 4553 290a 2020 2020 2020 2020 6578 636c  ES).        excl
+00019a30: 7564 6520 3d20 7265 2e63 6f6d 7069 6c65  ude = re.compile
+00019a40: 2862 6c61 636b 2e44 4546 4155 4c54 5f45  (black.DEFAULT_E
+00019a50: 5843 4c55 4445 5329 0a20 2020 2020 2020  XCLUDES).       
+00019a60: 2072 6570 6f72 7420 3d20 626c 6163 6b2e   report = black.
+00019a70: 5265 706f 7274 2829 0a20 2020 2020 2020  Report().       
+00019a80: 2067 6974 6967 6e6f 7265 203d 2050 6174   gitignore = Pat
+00019a90: 6853 7065 632e 6672 6f6d 5f6c 696e 6573  hSpec.from_lines
+00019aa0: 2822 6769 7477 696c 646d 6174 6368 222c  ("gitwildmatch",
+00019ab0: 205b 5d29 0a0a 2020 2020 2020 2020 7265   [])..        re
+00019ac0: 6775 6c61 7220 3d20 4d61 6769 634d 6f63  gular = MagicMoc
+00019ad0: 6b28 290a 2020 2020 2020 2020 7265 6775  k().        regu
+00019ae0: 6c61 722e 7265 6c61 7469 7665 5f74 6f2e  lar.relative_to.
+00019af0: 7265 7475 726e 5f76 616c 7565 203d 2050  return_value = P
+00019b00: 6174 6828 2272 6567 756c 6172 2e70 7922  ath("regular.py"
+00019b10: 290a 2020 2020 2020 2020 7265 6775 6c61  ).        regula
+00019b20: 722e 7265 736f 6c76 652e 7265 7475 726e  r.resolve.return
+00019b30: 5f76 616c 7565 203d 2072 6f6f 7420 2f20  _value = root / 
+00019b40: 2272 6567 756c 6172 2e70 7922 0a20 2020  "regular.py".   
+00019b50: 2020 2020 2072 6567 756c 6172 2e69 735f       regular.is_
+00019b60: 6469 722e 7265 7475 726e 5f76 616c 7565  dir.return_value
+00019b70: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00019b80: 2072 6567 756c 6172 2e69 735f 6669 6c65   regular.is_file
+00019b90: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
+00019ba0: 5472 7565 0a0a 2020 2020 2020 2020 6f75  True..        ou
+00019bb0: 7473 6964 655f 726f 6f74 5f73 796d 6c69  tside_root_symli
+00019bc0: 6e6b 203d 204d 6167 6963 4d6f 636b 2829  nk = MagicMock()
+00019bd0: 0a20 2020 2020 2020 206f 7574 7369 6465  .        outside
+00019be0: 5f72 6f6f 745f 7379 6d6c 696e 6b2e 7265  _root_symlink.re
+00019bf0: 6c61 7469 7665 5f74 6f2e 7265 7475 726e  lative_to.return
+00019c00: 5f76 616c 7565 203d 2050 6174 6828 2273  _value = Path("s
+00019c10: 796d 6c69 6e6b 2e70 7922 290a 2020 2020  ymlink.py").    
+00019c20: 2020 2020 6f75 7473 6964 655f 726f 6f74      outside_root
+00019c30: 5f73 796d 6c69 6e6b 2e72 6573 6f6c 7665  _symlink.resolve
+00019c40: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
+00019c50: 5061 7468 2822 2f6e 6f77 6865 7265 2229  Path("/nowhere")
+00019c60: 0a20 2020 2020 2020 206f 7574 7369 6465  .        outside
+00019c70: 5f72 6f6f 745f 7379 6d6c 696e 6b2e 6973  _root_symlink.is
+00019c80: 5f64 6972 2e72 6574 7572 6e5f 7661 6c75  _dir.return_valu
+00019c90: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
+00019ca0: 2020 6f75 7473 6964 655f 726f 6f74 5f73    outside_root_s
+00019cb0: 796d 6c69 6e6b 2e69 735f 6669 6c65 2e72  ymlink.is_file.r
+00019cc0: 6574 7572 6e5f 7661 6c75 6520 3d20 5472  eturn_value = Tr
+00019cd0: 7565 0a0a 2020 2020 2020 2020 6967 6e6f  ue..        igno
+00019ce0: 7265 645f 7379 6d6c 696e 6b20 3d20 4d61  red_symlink = Ma
+00019cf0: 6769 634d 6f63 6b28 290a 2020 2020 2020  gicMock().      
+00019d00: 2020 6967 6e6f 7265 645f 7379 6d6c 696e    ignored_symlin
+00019d10: 6b2e 7265 6c61 7469 7665 5f74 6f2e 7265  k.relative_to.re
+00019d20: 7475 726e 5f76 616c 7565 203d 2050 6174  turn_value = Pat
+00019d30: 6828 222e 6d79 7079 5f63 6163 6865 2229  h(".mypy_cache")
+00019d40: 202f 2022 7379 6d6c 696e 6b2e 7079 220a   / "symlink.py".
+00019d50: 2020 2020 2020 2020 6967 6e6f 7265 645f          ignored_
+00019d60: 7379 6d6c 696e 6b2e 6973 5f64 6972 2e72  symlink.is_dir.r
+00019d70: 6574 7572 6e5f 7661 6c75 6520 3d20 4661  eturn_value = Fa
+00019d80: 6c73 650a 2020 2020 2020 2020 6967 6e6f  lse.        igno
+00019d90: 7265 645f 7379 6d6c 696e 6b2e 6973 5f66  red_symlink.is_f
+00019da0: 696c 652e 7265 7475 726e 5f76 616c 7565  ile.return_value
+00019db0: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
+00019dc0: 2023 2041 2073 796d 6c69 6e6b 2074 6861   # A symlink tha
+00019dd0: 7420 6861 7320 616e 2065 7863 6c75 6465  t has an exclude
+00019de0: 6420 6e61 6d65 2c20 6275 7420 706f 696e  d name, but poin
+00019df0: 7473 2074 6f20 616e 2069 6e63 6c75 6465  ts to an include
+00019e00: 6420 6e61 6d65 0a20 2020 2020 2020 2073  d name.        s
+00019e10: 796d 6c69 6e6b 5f65 7863 6c75 6465 645f  ymlink_excluded_
+00019e20: 6e61 6d65 203d 204d 6167 6963 4d6f 636b  name = MagicMock
+00019e30: 2829 0a20 2020 2020 2020 2073 796d 6c69  ().        symli
+00019e40: 6e6b 5f65 7863 6c75 6465 645f 6e61 6d65  nk_excluded_name
+00019e50: 2e72 656c 6174 6976 655f 746f 2e72 6574  .relative_to.ret
+00019e60: 7572 6e5f 7661 6c75 6520 3d20 5061 7468  urn_value = Path
+00019e70: 2822 6578 636c 7564 6564 5f6e 616d 6522  ("excluded_name"
+00019e80: 290a 2020 2020 2020 2020 7379 6d6c 696e  ).        symlin
+00019e90: 6b5f 6578 636c 7564 6564 5f6e 616d 652e  k_excluded_name.
+00019ea0: 7265 736f 6c76 652e 7265 7475 726e 5f76  resolve.return_v
+00019eb0: 616c 7565 203d 2072 6f6f 7420 2f20 2269  alue = root / "i
+00019ec0: 6e63 6c75 6465 645f 6e61 6d65 2e70 7922  ncluded_name.py"
+00019ed0: 0a20 2020 2020 2020 2073 796d 6c69 6e6b  .        symlink
+00019ee0: 5f65 7863 6c75 6465 645f 6e61 6d65 2e69  _excluded_name.i
+00019ef0: 735f 6469 722e 7265 7475 726e 5f76 616c  s_dir.return_val
+00019f00: 7565 203d 2046 616c 7365 0a20 2020 2020  ue = False.     
+00019f10: 2020 2073 796d 6c69 6e6b 5f65 7863 6c75     symlink_exclu
+00019f20: 6465 645f 6e61 6d65 2e69 735f 6669 6c65  ded_name.is_file
+00019f30: 2e72 6574 7572 6e5f 7661 6c75 6520 3d20  .return_value = 
+00019f40: 5472 7565 0a0a 2020 2020 2020 2020 2320  True..        # 
+00019f50: 4120 7379 6d6c 696e 6b20 7468 6174 2068  A symlink that h
+00019f60: 6173 2061 6e20 696e 636c 7564 6564 206e  as an included n
+00019f70: 616d 652c 2062 7574 2070 6f69 6e74 7320  ame, but points 
+00019f80: 746f 2061 6e20 6578 636c 7564 6564 206e  to an excluded n
+00019f90: 616d 650a 2020 2020 2020 2020 7379 6d6c  ame.        syml
+00019fa0: 696e 6b5f 696e 636c 7564 6564 5f6e 616d  ink_included_nam
+00019fb0: 6520 3d20 4d61 6769 634d 6f63 6b28 290a  e = MagicMock().
+00019fc0: 2020 2020 2020 2020 7379 6d6c 696e 6b5f          symlink_
+00019fd0: 696e 636c 7564 6564 5f6e 616d 652e 7265  included_name.re
+00019fe0: 6c61 7469 7665 5f74 6f2e 7265 7475 726e  lative_to.return
+00019ff0: 5f76 616c 7565 203d 2050 6174 6828 2269  _value = Path("i
+0001a000: 6e63 6c75 6465 645f 6e61 6d65 2e70 7922  ncluded_name.py"
+0001a010: 290a 2020 2020 2020 2020 7379 6d6c 696e  ).        symlin
+0001a020: 6b5f 696e 636c 7564 6564 5f6e 616d 652e  k_included_name.
+0001a030: 7265 736f 6c76 652e 7265 7475 726e 5f76  resolve.return_v
+0001a040: 616c 7565 203d 2072 6f6f 7420 2f20 2265  alue = root / "e
+0001a050: 7863 6c75 6465 645f 6e61 6d65 220a 2020  xcluded_name".  
+0001a060: 2020 2020 2020 7379 6d6c 696e 6b5f 696e        symlink_in
+0001a070: 636c 7564 6564 5f6e 616d 652e 6973 5f64  cluded_name.is_d
+0001a080: 6972 2e72 6574 7572 6e5f 7661 6c75 6520  ir.return_value 
+0001a090: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0001a0a0: 7379 6d6c 696e 6b5f 696e 636c 7564 6564  symlink_included
+0001a0b0: 5f6e 616d 652e 6973 5f66 696c 652e 7265  _name.is_file.re
+0001a0c0: 7475 726e 5f76 616c 7565 203d 2054 7275  turn_value = Tru
+0001a0d0: 650a 0a20 2020 2020 2020 2070 6174 6820  e..        path 
+0001a0e0: 3d20 4d61 6769 634d 6f63 6b28 290a 2020  = MagicMock().  
+0001a0f0: 2020 2020 2020 7061 7468 2e69 7465 7264        path.iterd
+0001a100: 6972 2e72 6574 7572 6e5f 7661 6c75 6520  ir.return_value 
+0001a110: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+0001a120: 7265 6775 6c61 722c 0a20 2020 2020 2020  regular,.       
+0001a130: 2020 2020 206f 7574 7369 6465 5f72 6f6f       outside_roo
+0001a140: 745f 7379 6d6c 696e 6b2c 0a20 2020 2020  t_symlink,.     
+0001a150: 2020 2020 2020 2069 676e 6f72 6564 5f73         ignored_s
+0001a160: 796d 6c69 6e6b 2c0a 2020 2020 2020 2020  ymlink,.        
+0001a170: 2020 2020 7379 6d6c 696e 6b5f 6578 636c      symlink_excl
+0001a180: 7564 6564 5f6e 616d 652c 0a20 2020 2020  uded_name,.     
+0001a190: 2020 2020 2020 2073 796d 6c69 6e6b 5f69         symlink_i
+0001a1a0: 6e63 6c75 6465 645f 6e61 6d65 2c0a 2020  ncluded_name,.  
+0001a1b0: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+0001a1c0: 2066 696c 6573 203d 206c 6973 7428 0a20   files = list(. 
+0001a1d0: 2020 2020 2020 2020 2020 2062 6c61 636b             black
+0001a1e0: 2e67 656e 5f70 7974 686f 6e5f 6669 6c65  .gen_python_file
+0001a1f0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+0001a200: 2020 2070 6174 682e 6974 6572 6469 7228     path.iterdir(
+0001a210: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001a220: 2020 2072 6f6f 742c 0a20 2020 2020 2020     root,.       
+0001a230: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+0001a240: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001a250: 2020 6578 636c 7564 652c 0a20 2020 2020    exclude,.     
+0001a260: 2020 2020 2020 2020 2020 204e 6f6e 652c             None,
+0001a270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a280: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+0001a290: 2020 2020 2020 2072 6570 6f72 742c 0a20         report,. 
+0001a2a0: 2020 2020 2020 2020 2020 2020 2020 207b                 {
+0001a2b0: 7061 7468 3a20 6769 7469 676e 6f72 657d  path: gitignore}
+0001a2c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001a2d0: 2020 7665 7262 6f73 653d 4661 6c73 652c    verbose=False,
+0001a2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a2f0: 2071 7569 6574 3d46 616c 7365 2c0a 2020   quiet=False,.  
+0001a300: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001a310: 2020 2020 290a 2020 2020 2020 2020 6173      ).        as
+0001a320: 7365 7274 2066 696c 6573 203d 3d20 5b72  sert files == [r
+0001a330: 6567 756c 6172 2c20 7379 6d6c 696e 6b5f  egular, symlink_
+0001a340: 696e 636c 7564 6564 5f6e 616d 655d 0a0a  included_name]..
+0001a350: 2020 2020 2020 2020 7061 7468 2e69 7465          path.ite
+0001a360: 7264 6972 2e61 7373 6572 745f 6361 6c6c  rdir.assert_call
+0001a370: 6564 5f6f 6e63 6528 290a 2020 2020 2020  ed_once().      
+0001a380: 2020 6f75 7473 6964 655f 726f 6f74 5f73    outside_root_s
+0001a390: 796d 6c69 6e6b 2e72 6573 6f6c 7665 2e61  ymlink.resolve.a
+0001a3a0: 7373 6572 745f 6361 6c6c 6564 5f6f 6e63  ssert_called_onc
+0001a3b0: 6528 290a 2020 2020 2020 2020 6967 6e6f  e().        igno
+0001a3c0: 7265 645f 7379 6d6c 696e 6b2e 7265 736f  red_symlink.reso
+0001a3d0: 6c76 652e 6173 7365 7274 5f6e 6f74 5f63  lve.assert_not_c
+0001a3e0: 616c 6c65 6428 290a 0a20 2020 2064 6566  alled()..    def
+0001a3f0: 2074 6573 745f 6765 745f 736f 7572 6365   test_get_source
+0001a400: 735f 7379 6d6c 696e 6b5f 616e 645f 666f  s_symlink_and_fo
+0001a410: 7263 655f 6578 636c 7564 6528 7365 6c66  rce_exclude(self
+0001a420: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0001a430: 2020 2077 6974 6820 5465 6d70 6f72 6172     with Temporar
+0001a440: 7944 6972 6563 746f 7279 2829 2061 7320  yDirectory() as 
+0001a450: 7465 6d70 6469 723a 0a20 2020 2020 2020  tempdir:.       
+0001a460: 2020 2020 2074 6d70 203d 2050 6174 6828       tmp = Path(
+0001a470: 7465 6d70 6469 7229 2e72 6573 6f6c 7665  tempdir).resolve
+0001a480: 2829 0a20 2020 2020 2020 2020 2020 2061  ().            a
+0001a490: 6374 7561 6c20 3d20 746d 7020 2f20 2261  ctual = tmp / "a
+0001a4a0: 6374 7561 6c22 0a20 2020 2020 2020 2020  ctual".         
+0001a4b0: 2020 2061 6374 7561 6c2e 6d6b 6469 7228     actual.mkdir(
+0001a4c0: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
+0001a4d0: 6d6c 696e 6b20 3d20 746d 7020 2f20 2273  mlink = tmp / "s
+0001a4e0: 796d 6c69 6e6b 220a 2020 2020 2020 2020  ymlink".        
+0001a4f0: 2020 2020 7379 6d6c 696e 6b2e 7379 6d6c      symlink.syml
+0001a500: 696e 6b5f 746f 2861 6374 7561 6c29 0a0a  ink_to(actual)..
+0001a510: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+0001a520: 616c 5f70 726f 6a20 3d20 6163 7475 616c  al_proj = actual
+0001a530: 202f 2022 7072 6f6a 6563 7422 0a20 2020   / "project".   
+0001a540: 2020 2020 2020 2020 2061 6374 7561 6c5f           actual_
+0001a550: 7072 6f6a 2e6d 6b64 6972 2829 0a20 2020  proj.mkdir().   
+0001a560: 2020 2020 2020 2020 2028 6163 7475 616c           (actual
+0001a570: 5f70 726f 6a20 2f20 226d 6f64 756c 652e  _proj / "module.
+0001a580: 7079 2229 2e77 7269 7465 5f74 6578 7428  py").write_text(
+0001a590: 2270 7269 6e74 2827 6865 6c6c 6f27 2922  "print('hello')"
+0001a5a0: 2c20 656e 636f 6469 6e67 3d22 7574 662d  , encoding="utf-
+0001a5b0: 3822 290a 0a20 2020 2020 2020 2020 2020  8")..           
+0001a5c0: 2073 796d 6c69 6e6b 5f70 726f 6a20 3d20   symlink_proj = 
+0001a5d0: 7379 6d6c 696e 6b20 2f20 2270 726f 6a65  symlink / "proje
+0001a5e0: 6374 220a 0a20 2020 2020 2020 2020 2020  ct"..           
+0001a5f0: 2077 6974 6820 6368 616e 6765 5f64 6972   with change_dir
+0001a600: 6563 746f 7279 2873 796d 6c69 6e6b 5f70  ectory(symlink_p
+0001a610: 726f 6a29 3a0a 2020 2020 2020 2020 2020  roj):.          
+0001a620: 2020 2020 2020 6173 7365 7274 5f63 6f6c        assert_col
+0001a630: 6c65 6374 6564 5f73 6f75 7263 6573 280a  lected_sources(.
+0001a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a650: 2020 2020 7372 633d 5b22 6d6f 6475 6c65      src=["module
+0001a660: 2e70 7922 5d2c 0a20 2020 2020 2020 2020  .py"],.         
+0001a670: 2020 2020 2020 2020 2020 2072 6f6f 743d             root=
+0001a680: 7379 6d6c 696e 6b5f 7072 6f6a 2e72 6573  symlink_proj.res
+0001a690: 6f6c 7665 2829 2c0a 2020 2020 2020 2020  olve(),.        
+0001a6a0: 2020 2020 2020 2020 2020 2020 6578 7065              expe
+0001a6b0: 6374 6564 3d5b 226d 6f64 756c 652e 7079  cted=["module.py
+0001a6c0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0001a6d0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+0001a6e0: 2020 2020 2020 2061 6273 6f6c 7574 655f         absolute_
+0001a6f0: 6d6f 6475 6c65 203d 2073 796d 6c69 6e6b  module = symlink
+0001a700: 5f70 726f 6a20 2f20 226d 6f64 756c 652e  _proj / "module.
+0001a710: 7079 220a 2020 2020 2020 2020 2020 2020  py".            
+0001a720: 2020 2020 6173 7365 7274 5f63 6f6c 6c65      assert_colle
+0001a730: 6374 6564 5f73 6f75 7263 6573 280a 2020  cted_sources(.  
+0001a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a750: 2020 7372 633d 5b61 6273 6f6c 7574 655f    src=[absolute_
+0001a760: 6d6f 6475 6c65 5d2c 0a20 2020 2020 2020  module],.       
+0001a770: 2020 2020 2020 2020 2020 2020 2072 6f6f               roo
+0001a780: 743d 7379 6d6c 696e 6b5f 7072 6f6a 2e72  t=symlink_proj.r
+0001a790: 6573 6f6c 7665 2829 2c0a 2020 2020 2020  esolve(),.      
+0001a7a0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0001a7b0: 7065 6374 6564 3d5b 6162 736f 6c75 7465  pected=[absolute
+0001a7c0: 5f6d 6f64 756c 655d 2c0a 2020 2020 2020  _module],.      
+0001a7d0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0001a7e0: 2020 2020 2020 2020 2020 2020 2023 2061               # a
+0001a7f0: 2066 6577 2074 7269 636b 7920 7465 7374   few tricky test
+0001a800: 7320 666f 7220 666f 7263 655f 6578 636c  s for force_excl
+0001a810: 7564 650a 2020 2020 2020 2020 2020 2020  ude.            
+0001a820: 2020 2020 666c 6174 5f73 796d 6c69 6e6b      flat_symlink
+0001a830: 203d 2073 796d 6c69 6e6b 5f70 726f 6a20   = symlink_proj 
+0001a840: 2f20 2273 796d 6c69 6e6b 5f6d 6f64 756c  / "symlink_modul
+0001a850: 652e 7079 220a 2020 2020 2020 2020 2020  e.py".          
+0001a860: 2020 2020 2020 666c 6174 5f73 796d 6c69        flat_symli
+0001a870: 6e6b 2e73 796d 6c69 6e6b 5f74 6f28 6163  nk.symlink_to(ac
+0001a880: 7475 616c 5f70 726f 6a20 2f20 226d 6f64  tual_proj / "mod
+0001a890: 756c 652e 7079 2229 0a20 2020 2020 2020  ule.py").       
+0001a8a0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+0001a8b0: 636f 6c6c 6563 7465 645f 736f 7572 6365  collected_source
+0001a8c0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+0001a8d0: 2020 2020 2020 2073 7263 3d5b 666c 6174         src=[flat
+0001a8e0: 5f73 796d 6c69 6e6b 5d2c 0a20 2020 2020  _symlink],.     
+0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001a900: 6f6f 743d 7379 6d6c 696e 6b5f 7072 6f6a  oot=symlink_proj
+0001a910: 2e72 6573 6f6c 7665 2829 2c0a 2020 2020  .resolve(),.    
+0001a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a930: 666f 7263 655f 6578 636c 7564 653d 7222  force_exclude=r"
+0001a940: 2f73 796d 6c69 6e6b 5f6d 6f64 756c 652e  /symlink_module.
+0001a950: 7079 222c 0a20 2020 2020 2020 2020 2020  py",.           
+0001a960: 2020 2020 2020 2020 2065 7870 6563 7465           expecte
+0001a970: 643d 5b5d 2c0a 2020 2020 2020 2020 2020  d=[],.          
+0001a980: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0001a990: 2020 2020 2020 2020 2074 6172 6765 7420           target 
+0001a9a0: 3d20 6163 7475 616c 5f70 726f 6a20 2f20  = actual_proj / 
+0001a9b0: 2274 6172 6765 7422 0a20 2020 2020 2020  "target".       
+0001a9c0: 2020 2020 2020 2020 2074 6172 6765 742e           target.
+0001a9d0: 6d6b 6469 7228 290a 2020 2020 2020 2020  mkdir().        
+0001a9e0: 2020 2020 2020 2020 2874 6172 6765 7420          (target 
+0001a9f0: 2f20 2261 6e6f 7468 6572 2e70 7922 292e  / "another.py").
+0001aa00: 7772 6974 655f 7465 7874 2822 7072 696e  write_text("prin
+0001aa10: 7428 2768 656c 6c6f 2729 222c 2065 6e63  t('hello')", enc
+0001aa20: 6f64 696e 673d 2275 7466 2d38 2229 0a20  oding="utf-8"). 
+0001aa30: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001aa40: 7379 6d6c 696e 6b5f 7072 6f6a 202f 2022  symlink_proj / "
+0001aa50: 6e65 7374 6564 2229 2e73 796d 6c69 6e6b  nested").symlink
+0001aa60: 5f74 6f28 7461 7267 6574 290a 0a20 2020  _to(target)..   
+0001aa70: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+0001aa80: 6572 745f 636f 6c6c 6563 7465 645f 736f  ert_collected_so
+0001aa90: 7572 6365 7328 0a20 2020 2020 2020 2020  urces(.         
+0001aaa0: 2020 2020 2020 2020 2020 2073 7263 3d5b             src=[
+0001aab0: 7379 6d6c 696e 6b5f 7072 6f6a 202f 2022  symlink_proj / "
+0001aac0: 6e65 7374 6564 2220 2f20 2261 6e6f 7468  nested" / "anoth
+0001aad0: 6572 2e70 7922 5d2c 0a20 2020 2020 2020  er.py"],.       
+0001aae0: 2020 2020 2020 2020 2020 2020 2072 6f6f               roo
+0001aaf0: 743d 7379 6d6c 696e 6b5f 7072 6f6a 2e72  t=symlink_proj.r
+0001ab00: 6573 6f6c 7665 2829 2c0a 2020 2020 2020  esolve(),.      
+0001ab10: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001ab20: 7263 655f 6578 636c 7564 653d 7222 6e65  rce_exclude=r"ne
+0001ab30: 7374 6564 222c 0a20 2020 2020 2020 2020  sted",.         
+0001ab40: 2020 2020 2020 2020 2020 2065 7870 6563             expec
+0001ab50: 7465 643d 5b5d 2c0a 2020 2020 2020 2020  ted=[],.        
+0001ab60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001ab70: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0001ab80: 5f63 6f6c 6c65 6374 6564 5f73 6f75 7263  _collected_sourc
+0001ab90: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+0001aba0: 2020 2020 2020 2020 7372 633d 5b73 796d          src=[sym
+0001abb0: 6c69 6e6b 5f70 726f 6a20 2f20 226e 6573  link_proj / "nes
+0001abc0: 7465 6422 202f 2022 616e 6f74 6865 722e  ted" / "another.
+0001abd0: 7079 225d 2c0a 2020 2020 2020 2020 2020  py"],.          
+0001abe0: 2020 2020 2020 2020 2020 726f 6f74 3d73            root=s
+0001abf0: 796d 6c69 6e6b 5f70 726f 6a2e 7265 736f  ymlink_proj.reso
+0001ac00: 6c76 6528 292c 0a20 2020 2020 2020 2020  lve(),.         
+0001ac10: 2020 2020 2020 2020 2020 2066 6f72 6365             force
+0001ac20: 5f65 7863 6c75 6465 3d72 2274 6172 6765  _exclude=r"targe
+0001ac30: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+0001ac40: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+0001ac50: 3d5b 7379 6d6c 696e 6b5f 7072 6f6a 202f  =[symlink_proj /
+0001ac60: 2022 6e65 7374 6564 2220 2f20 2261 6e6f   "nested" / "ano
+0001ac70: 7468 6572 2e70 7922 5d2c 0a20 2020 2020  ther.py"],.     
+0001ac80: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0001ac90: 2020 6465 6620 7465 7374 5f67 6574 5f73    def test_get_s
+0001aca0: 6f75 7263 6573 5f77 6974 685f 7374 6469  ources_with_stdi
+0001acb0: 6e5f 7379 6d6c 696e 6b5f 6f75 7473 6964  n_symlink_outsid
+0001acc0: 655f 726f 6f74 280a 2020 2020 2020 2020  e_root(.        
+0001acd0: 7365 6c66 2c0a 2020 2020 2920 2d3e 204e  self,.    ) -> N
+0001ace0: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
+0001acf0: 6820 5465 6d70 6f72 6172 7944 6972 6563  h TemporaryDirec
+0001ad00: 746f 7279 2829 2061 7320 7465 6d70 6469  tory() as tempdi
+0001ad10: 723a 0a20 2020 2020 2020 2020 2020 2074  r:.            t
+0001ad20: 6d70 203d 2050 6174 6828 7465 6d70 6469  mp = Path(tempdi
+0001ad30: 7229 2e72 6573 6f6c 7665 2829 0a0a 2020  r).resolve()..  
+0001ad40: 2020 2020 2020 2020 2020 726f 6f74 203d            root =
+0001ad50: 2074 6d70 202f 2022 726f 6f74 220a 2020   tmp / "root".  
+0001ad60: 2020 2020 2020 2020 2020 726f 6f74 2e6d            root.m
+0001ad70: 6b64 6972 2829 0a20 2020 2020 2020 2020  kdir().         
+0001ad80: 2020 2028 726f 6f74 202f 2022 7079 7072     (root / "pypr
+0001ad90: 6f6a 6563 742e 746f 6d6c 2229 2e77 7269  oject.toml").wri
+0001ada0: 7465 5f74 6578 7428 225b 746f 6f6c 2e62  te_text("[tool.b
+0001adb0: 6c61 636b 5d22 2c20 656e 636f 6469 6e67  lack]", encoding
+0001adc0: 3d22 7574 662d 3822 290a 0a20 2020 2020  ="utf-8")..     
+0001add0: 2020 2020 2020 2074 6172 6765 7420 3d20         target = 
+0001ade0: 746d 7020 2f20 226f 7574 7369 6465 5f72  tmp / "outside_r
+0001adf0: 6f6f 7422 202f 2022 612e 7079 220a 2020  oot" / "a.py".  
+0001ae00: 2020 2020 2020 2020 2020 7461 7267 6574            target
+0001ae10: 2e70 6172 656e 742e 6d6b 6469 7228 290a  .parent.mkdir().
+0001ae20: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+0001ae30: 6574 2e77 7269 7465 5f74 6578 7428 2270  et.write_text("p
+0001ae40: 7269 6e74 2827 6865 6c6c 6f27 2922 2c20  rint('hello')", 
+0001ae50: 656e 636f 6469 6e67 3d22 7574 662d 3822  encoding="utf-8"
+0001ae60: 290a 2020 2020 2020 2020 2020 2020 2872  ).            (r
+0001ae70: 6f6f 7420 2f20 2261 2e70 7922 292e 7379  oot / "a.py").sy
+0001ae80: 6d6c 696e 6b5f 746f 2874 6172 6765 7429  mlink_to(target)
+0001ae90: 0a0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+0001aea0: 6469 6e5f 6669 6c65 6e61 6d65 203d 2073  din_filename = s
+0001aeb0: 7472 2872 6f6f 7420 2f20 2261 2e70 7922  tr(root / "a.py"
+0001aec0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+0001aed0: 7365 7274 5f63 6f6c 6c65 6374 6564 5f73  sert_collected_s
+0001aee0: 6f75 7263 6573 280a 2020 2020 2020 2020  ources(.        
+0001aef0: 2020 2020 2020 2020 726f 6f74 3d72 6f6f          root=roo
+0001af00: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0001af10: 2020 2073 7263 3d5b 222d 225d 2c0a 2020     src=["-"],.  
+0001af20: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0001af30: 7065 6374 6564 3d5b 5d2c 0a20 2020 2020  pected=[],.     
+0001af40: 2020 2020 2020 2020 2020 2073 7464 696e             stdin
+0001af50: 5f66 696c 656e 616d 653d 7374 6469 6e5f  _filename=stdin_
+0001af60: 6669 6c65 6e61 6d65 2c0a 2020 2020 2020  filename,.      
+0001af70: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+0001af80: 2074 6573 745f 6765 745f 736f 7572 6365   test_get_source
+0001af90: 735f 7769 7468 5f73 7464 696e 2873 656c  s_with_stdin(sel
+0001afa0: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0001afb0: 2020 2020 7372 6320 3d20 5b22 2d22 5d0a      src = ["-"].
+0001afc0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+0001afd0: 203d 205b 222d 225d 0a20 2020 2020 2020   = ["-"].       
+0001afe0: 2061 7373 6572 745f 636f 6c6c 6563 7465   assert_collecte
+0001aff0: 645f 736f 7572 6365 7328 0a20 2020 2020  d_sources(.     
+0001b000: 2020 2020 2020 2073 7263 2c0a 2020 2020         src,.    
+0001b010: 2020 2020 2020 2020 726f 6f74 3d54 4849          root=THI
+0001b020: 535f 4449 522e 7265 736f 6c76 6528 292c  S_DIR.resolve(),
+0001b030: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
+0001b040: 6563 7465 643d 6578 7065 6374 6564 2c0a  ected=expected,.
+0001b050: 2020 2020 2020 2020 2020 2020 696e 636c              incl
+0001b060: 7564 653d 2222 2c0a 2020 2020 2020 2020  ude="",.        
+0001b070: 2020 2020 6578 636c 7564 653d 7222 2f65      exclude=r"/e
+0001b080: 7863 6c75 6465 2f7c 615c 2e70 7922 2c0a  xclude/|a\.py",.
+0001b090: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+0001b0a0: 6566 2074 6573 745f 6765 745f 736f 7572  ef test_get_sour
+0001b0b0: 6365 735f 7769 7468 5f73 7464 696e 5f66  ces_with_stdin_f
+0001b0c0: 696c 656e 616d 6528 7365 6c66 2920 2d3e  ilename(self) ->
+0001b0d0: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+0001b0e0: 7263 203d 205b 222d 225d 0a20 2020 2020  rc = ["-"].     
+0001b0f0: 2020 2073 7464 696e 5f66 696c 656e 616d     stdin_filenam
+0001b100: 6520 3d20 7374 7228 5448 4953 5f44 4952  e = str(THIS_DIR
+0001b110: 202f 2022 6461 7461 2f63 6f6c 6c65 6374   / "data/collect
+0001b120: 696f 6e73 2e70 7922 290a 2020 2020 2020  ions.py").      
+0001b130: 2020 6578 7065 6374 6564 203d 205b 6622    expected = [f"
+0001b140: 5f5f 424c 4143 4b5f 5354 4449 4e5f 4649  __BLACK_STDIN_FI
+0001b150: 4c45 4e41 4d45 5f5f 7b73 7464 696e 5f66  LENAME__{stdin_f
+0001b160: 696c 656e 616d 657d 225d 0a20 2020 2020  ilename}"].     
+0001b170: 2020 2061 7373 6572 745f 636f 6c6c 6563     assert_collec
+0001b180: 7465 645f 736f 7572 6365 7328 0a20 2020  ted_sources(.   
+0001b190: 2020 2020 2020 2020 2073 7263 2c0a 2020           src,.  
+0001b1a0: 2020 2020 2020 2020 2020 726f 6f74 3d54            root=T
+0001b1b0: 4849 535f 4449 522e 7265 736f 6c76 6528  HIS_DIR.resolve(
+0001b1c0: 292c 0a20 2020 2020 2020 2020 2020 2065  ),.            e
+0001b1d0: 7870 6563 7465 643d 6578 7065 6374 6564  xpected=expected
+0001b1e0: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
+0001b1f0: 636c 7564 653d 7222 2f65 7863 6c75 6465  clude=r"/exclude
+0001b200: 2f61 5c2e 7079 222c 0a20 2020 2020 2020  /a\.py",.       
+0001b210: 2020 2020 2073 7464 696e 5f66 696c 656e       stdin_filen
+0001b220: 616d 653d 7374 6469 6e5f 6669 6c65 6e61  ame=stdin_filena
+0001b230: 6d65 2c0a 2020 2020 2020 2020 290a 0a20  me,.        ).. 
+0001b240: 2020 2064 6566 2074 6573 745f 6765 745f     def test_get_
+0001b250: 736f 7572 6365 735f 7769 7468 5f73 7464  sources_with_std
+0001b260: 696e 5f66 696c 656e 616d 655f 616e 645f  in_filename_and_
+0001b270: 6578 636c 7564 6528 7365 6c66 2920 2d3e  exclude(self) ->
+0001b280: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
+0001b290: 2045 7863 6c75 6465 2073 686f 756c 646e   Exclude shouldn
+0001b2a0: 2774 2065 7863 6c75 6465 2073 7464 696e  't exclude stdin
+0001b2b0: 5f66 696c 656e 616d 6520 7369 6e63 6520  _filename since 
+0001b2c0: 6974 2069 7320 6d69 6d69 636b 696e 6720  it is mimicking 
+0001b2d0: 7468 650a 2020 2020 2020 2020 2320 6669  the.        # fi
+0001b2e0: 6c65 2062 6569 6e67 2070 6173 7365 6420  le being passed 
+0001b2f0: 6469 7265 6374 6c79 2e20 5468 6973 2069  directly. This i
+0001b300: 7320 7468 6520 7361 6d65 2061 730a 2020  s the same as.  
+0001b310: 2020 2020 2020 2320 7465 7374 5f65 7863        # test_exc
+0001b320: 6c75 6465 5f66 6f72 5f69 7373 7565 5f31  lude_for_issue_1
+0001b330: 3537 320a 2020 2020 2020 2020 7061 7468  572.        path
+0001b340: 203d 2044 4154 415f 4449 5220 2f20 2269   = DATA_DIR / "i
+0001b350: 6e63 6c75 6465 5f65 7863 6c75 6465 5f74  nclude_exclude_t
+0001b360: 6573 7473 220a 2020 2020 2020 2020 7372  ests".        sr
+0001b370: 6320 3d20 5b22 2d22 5d0a 2020 2020 2020  c = ["-"].      
+0001b380: 2020 7374 6469 6e5f 6669 6c65 6e61 6d65    stdin_filename
+0001b390: 203d 2073 7472 2870 6174 6820 2f20 2262   = str(path / "b
+0001b3a0: 2f65 7863 6c75 6465 2f61 2e70 7922 290a  /exclude/a.py").
+0001b3b0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+0001b3c0: 203d 205b 6622 5f5f 424c 4143 4b5f 5354   = [f"__BLACK_ST
+0001b3d0: 4449 4e5f 4649 4c45 4e41 4d45 5f5f 7b73  DIN_FILENAME__{s
+0001b3e0: 7464 696e 5f66 696c 656e 616d 657d 225d  tdin_filename}"]
+0001b3f0: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
+0001b400: 636f 6c6c 6563 7465 645f 736f 7572 6365  collected_source
+0001b410: 7328 0a20 2020 2020 2020 2020 2020 2073  s(.            s
+0001b420: 7263 2c0a 2020 2020 2020 2020 2020 2020  rc,.            
+0001b430: 726f 6f74 3d54 4849 535f 4449 522e 7265  root=THIS_DIR.re
+0001b440: 736f 6c76 6528 292c 0a20 2020 2020 2020  solve(),.       
+0001b450: 2020 2020 2065 7870 6563 7465 643d 6578       expected=ex
+0001b460: 7065 6374 6564 2c0a 2020 2020 2020 2020  pected,.        
+0001b470: 2020 2020 6578 636c 7564 653d 7222 2f65      exclude=r"/e
+0001b480: 7863 6c75 6465 2f7c 615c 2e70 7922 2c0a  xclude/|a\.py",.
+0001b490: 2020 2020 2020 2020 2020 2020 7374 6469              stdi
+0001b4a0: 6e5f 6669 6c65 6e61 6d65 3d73 7464 696e  n_filename=stdin
+0001b4b0: 5f66 696c 656e 616d 652c 0a20 2020 2020  _filename,.     
+0001b4c0: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
+0001b4d0: 7374 5f67 6574 5f73 6f75 7263 6573 5f77  st_get_sources_w
+0001b4e0: 6974 685f 7374 6469 6e5f 6669 6c65 6e61  ith_stdin_filena
+0001b4f0: 6d65 5f61 6e64 5f65 7874 656e 645f 6578  me_and_extend_ex
+0001b500: 636c 7564 6528 7365 6c66 2920 2d3e 204e  clude(self) -> N
+0001b510: 6f6e 653a 0a20 2020 2020 2020 2023 2045  one:.        # E
+0001b520: 7874 656e 6420 6578 636c 7564 6520 7368  xtend exclude sh
+0001b530: 6f75 6c64 6e27 7420 6578 636c 7564 6520  ouldn't exclude 
+0001b540: 7374 6469 6e5f 6669 6c65 6e61 6d65 2073  stdin_filename s
+0001b550: 696e 6365 2069 7420 6973 206d 696d 6963  ince it is mimic
+0001b560: 6b69 6e67 2074 6865 0a20 2020 2020 2020  king the.       
+0001b570: 2023 2066 696c 6520 6265 696e 6720 7061   # file being pa
+0001b580: 7373 6564 2064 6972 6563 746c 792e 2054  ssed directly. T
+0001b590: 6869 7320 6973 2074 6865 2073 616d 6520  his is the same 
+0001b5a0: 6173 0a20 2020 2020 2020 2023 2074 6573  as.        # tes
+0001b5b0: 745f 6578 636c 7564 655f 666f 725f 6973  t_exclude_for_is
+0001b5c0: 7375 655f 3135 3732 0a20 2020 2020 2020  sue_1572.       
+0001b5d0: 2073 7263 203d 205b 222d 225d 0a20 2020   src = ["-"].   
+0001b5e0: 2020 2020 2070 6174 6820 3d20 5448 4953       path = THIS
+0001b5f0: 5f44 4952 202f 2022 6461 7461 2220 2f20  _DIR / "data" / 
+0001b600: 2269 6e63 6c75 6465 5f65 7863 6c75 6465  "include_exclude
+0001b610: 5f74 6573 7473 220a 2020 2020 2020 2020  _tests".        
+0001b620: 7374 6469 6e5f 6669 6c65 6e61 6d65 203d  stdin_filename =
+0001b630: 2073 7472 2870 6174 6820 2f20 2262 2f65   str(path / "b/e
+0001b640: 7863 6c75 6465 2f61 2e70 7922 290a 2020  xclude/a.py").  
+0001b650: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
+0001b660: 205b 6622 5f5f 424c 4143 4b5f 5354 4449   [f"__BLACK_STDI
+0001b670: 4e5f 4649 4c45 4e41 4d45 5f5f 7b73 7464  N_FILENAME__{std
+0001b680: 696e 5f66 696c 656e 616d 657d 225d 0a20  in_filename}"]. 
+0001b690: 2020 2020 2020 2061 7373 6572 745f 636f         assert_co
+0001b6a0: 6c6c 6563 7465 645f 736f 7572 6365 7328  llected_sources(
+0001b6b0: 0a20 2020 2020 2020 2020 2020 2073 7263  .            src
+0001b6c0: 2c0a 2020 2020 2020 2020 2020 2020 726f  ,.            ro
+0001b6d0: 6f74 3d54 4849 535f 4449 522e 7265 736f  ot=THIS_DIR.reso
+0001b6e0: 6c76 6528 292c 0a20 2020 2020 2020 2020  lve(),.         
+0001b6f0: 2020 2065 7870 6563 7465 643d 6578 7065     expected=expe
+0001b700: 6374 6564 2c0a 2020 2020 2020 2020 2020  cted,.          
+0001b710: 2020 6578 7465 6e64 5f65 7863 6c75 6465    extend_exclude
+0001b720: 3d72 222f 6578 636c 7564 652f 7c61 5c2e  =r"/exclude/|a\.
+0001b730: 7079 222c 0a20 2020 2020 2020 2020 2020  py",.           
+0001b740: 2073 7464 696e 5f66 696c 656e 616d 653d   stdin_filename=
+0001b750: 7374 6469 6e5f 6669 6c65 6e61 6d65 2c0a  stdin_filename,.
+0001b760: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+0001b770: 6566 2074 6573 745f 6765 745f 736f 7572  ef test_get_sour
+0001b780: 6365 735f 7769 7468 5f73 7464 696e 5f66  ces_with_stdin_f
+0001b790: 696c 656e 616d 655f 616e 645f 666f 7263  ilename_and_forc
+0001b7a0: 655f 6578 636c 7564 6528 7365 6c66 2920  e_exclude(self) 
+0001b7b0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0001b7c0: 2023 2046 6f72 6365 2065 7863 6c75 6465   # Force exclude
+0001b7d0: 2073 686f 756c 6420 6578 636c 7564 6520   should exclude 
+0001b7e0: 7468 6520 6669 6c65 2077 6865 6e20 7061  the file when pa
+0001b7f0: 7373 696e 6720 6974 2074 6872 6f75 6768  ssing it through
+0001b800: 0a20 2020 2020 2020 2023 2073 7464 696e  .        # stdin
+0001b810: 5f66 696c 656e 616d 650a 2020 2020 2020  _filename.      
+0001b820: 2020 7061 7468 203d 2054 4849 535f 4449    path = THIS_DI
+0001b830: 5220 2f20 2264 6174 6122 202f 2022 696e  R / "data" / "in
+0001b840: 636c 7564 655f 6578 636c 7564 655f 7465  clude_exclude_te
+0001b850: 7374 7322 0a20 2020 2020 2020 2073 7464  sts".        std
+0001b860: 696e 5f66 696c 656e 616d 6520 3d20 7374  in_filename = st
+0001b870: 7228 7061 7468 202f 2022 622f 6578 636c  r(path / "b/excl
+0001b880: 7564 652f 612e 7079 2229 0a20 2020 2020  ude/a.py").     
+0001b890: 2020 2061 7373 6572 745f 636f 6c6c 6563     assert_collec
+0001b8a0: 7465 645f 736f 7572 6365 7328 0a20 2020  ted_sources(.   
+0001b8b0: 2020 2020 2020 2020 2073 7263 3d5b 222d           src=["-
+0001b8c0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0001b8d0: 726f 6f74 3d54 4849 535f 4449 522e 7265  root=THIS_DIR.re
+0001b8e0: 736f 6c76 6528 292c 0a20 2020 2020 2020  solve(),.       
+0001b8f0: 2020 2020 2065 7870 6563 7465 643d 5b5d       expected=[]
+0001b900: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
+0001b910: 7263 655f 6578 636c 7564 653d 7222 2f65  rce_exclude=r"/e
+0001b920: 7863 6c75 6465 2f7c 615c 2e70 7922 2c0a  xclude/|a\.py",.
+0001b930: 2020 2020 2020 2020 2020 2020 7374 6469              stdi
+0001b940: 6e5f 6669 6c65 6e61 6d65 3d73 7464 696e  n_filename=stdin
+0001b950: 5f66 696c 656e 616d 652c 0a20 2020 2020  _filename,.     
+0001b960: 2020 2029 0a0a 2020 2020 6465 6620 7465     )..    def te
+0001b970: 7374 5f67 6574 5f73 6f75 7263 6573 5f77  st_get_sources_w
+0001b980: 6974 685f 7374 6469 6e5f 6669 6c65 6e61  ith_stdin_filena
+0001b990: 6d65 5f61 6e64 5f66 6f72 6365 5f65 7863  me_and_force_exc
+0001b9a0: 6c75 6465 5f61 6e64 5f73 796d 6c69 6e6b  lude_and_symlink
+0001b9b0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0001b9c0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
+0001b9d0: 2020 2020 2020 2023 2046 6f72 6365 2065         # Force e
+0001b9e0: 7863 6c75 6465 2073 686f 756c 6420 6578  xclude should ex
+0001b9f0: 636c 7564 6520 6120 7379 6d6c 696e 6b20  clude a symlink 
+0001ba00: 6261 7365 6420 6f6e 2074 6865 2073 796d  based on the sym
+0001ba10: 6c69 6e6b 2c20 6e6f 7420 6974 7320 7461  link, not its ta
+0001ba20: 7267 6574 0a20 2020 2020 2020 2077 6974  rget.        wit
+0001ba30: 6820 5465 6d70 6f72 6172 7944 6972 6563  h TemporaryDirec
+0001ba40: 746f 7279 2829 2061 7320 7465 6d70 6469  tory() as tempdi
+0001ba50: 723a 0a20 2020 2020 2020 2020 2020 2074  r:.            t
+0001ba60: 6d70 203d 2050 6174 6828 7465 6d70 6469  mp = Path(tempdi
+0001ba70: 7229 2e72 6573 6f6c 7665 2829 0a20 2020  r).resolve().   
+0001ba80: 2020 2020 2020 2020 2028 746d 7020 2f20           (tmp / 
+0001ba90: 2265 7863 6c75 6465 2229 2e6d 6b64 6972  "exclude").mkdir
+0001baa0: 2829 0a20 2020 2020 2020 2020 2020 2028  ().            (
+0001bab0: 746d 7020 2f20 2265 7863 6c75 6465 2220  tmp / "exclude" 
+0001bac0: 2f20 2261 2e70 7922 292e 7772 6974 655f  / "a.py").write_
+0001bad0: 7465 7874 2822 7072 696e 7428 2768 656c  text("print('hel
+0001bae0: 6c6f 2729 222c 2065 6e63 6f64 696e 673d  lo')", encoding=
+0001baf0: 2275 7466 2d38 2229 0a20 2020 2020 2020  "utf-8").       
+0001bb00: 2020 2020 2028 746d 7020 2f20 2273 796d       (tmp / "sym
+0001bb10: 6c69 6e6b 2e70 7922 292e 7379 6d6c 696e  link.py").symlin
+0001bb20: 6b5f 746f 2874 6d70 202f 2022 6578 636c  k_to(tmp / "excl
+0001bb30: 7564 6522 202f 2022 612e 7079 2229 0a0a  ude" / "a.py")..
+0001bb40: 2020 2020 2020 2020 2020 2020 7374 6469              stdi
+0001bb50: 6e5f 6669 6c65 6e61 6d65 203d 2073 7472  n_filename = str
+0001bb60: 2874 6d70 202f 2022 7379 6d6c 696e 6b2e  (tmp / "symlink.
+0001bb70: 7079 2229 0a20 2020 2020 2020 2020 2020  py").           
+0001bb80: 2065 7870 6563 7465 6420 3d20 5b66 225f   expected = [f"_
+0001bb90: 5f42 4c41 434b 5f53 5444 494e 5f46 494c  _BLACK_STDIN_FIL
+0001bba0: 454e 414d 455f 5f7b 7374 6469 6e5f 6669  ENAME__{stdin_fi
+0001bbb0: 6c65 6e61 6d65 7d22 5d0a 2020 2020 2020  lename}"].      
+0001bbc0: 2020 2020 2020 7769 7468 2063 6861 6e67        with chang
+0001bbd0: 655f 6469 7265 6374 6f72 7928 746d 7029  e_directory(tmp)
+0001bbe0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001bbf0: 2020 6173 7365 7274 5f63 6f6c 6c65 6374    assert_collect
+0001bc00: 6564 5f73 6f75 7263 6573 280a 2020 2020  ed_sources(.    
+0001bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc20: 7372 633d 5b22 2d22 5d2c 0a20 2020 2020  src=["-"],.     
+0001bc30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001bc40: 6f6f 743d 746d 702c 0a20 2020 2020 2020  oot=tmp,.       
+0001bc50: 2020 2020 2020 2020 2020 2020 2065 7870               exp
+0001bc60: 6563 7465 643d 6578 7065 6374 6564 2c0a  ected=expected,.
+0001bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc80: 2020 2020 666f 7263 655f 6578 636c 7564      force_exclud
+0001bc90: 653d 7222 6578 636c 7564 652f 615c 2e70  e=r"exclude/a\.p
+0001bca0: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
+0001bcb0: 2020 2020 2020 2020 7374 6469 6e5f 6669          stdin_fi
+0001bcc0: 6c65 6e61 6d65 3d73 7464 696e 5f66 696c  lename=stdin_fil
+0001bcd0: 656e 616d 652c 0a20 2020 2020 2020 2020  ename,.         
+0001bce0: 2020 2020 2020 2029 0a0a 0a63 6c61 7373         )...class
+0001bcf0: 2054 6573 7444 6546 6163 746f 4150 493a   TestDeFactoAPI:
+0001bd00: 0a20 2020 2022 2222 5465 7374 2074 6861  .    """Test tha
+0001bd10: 7420 6365 7274 6169 6e20 7379 6d62 6f6c  t certain symbol
+0001bd20: 7320 7468 6174 2061 7265 2063 6f6d 6d6f  s that are commo
+0001bd30: 6e6c 7920 7573 6564 2065 7874 6572 6e61  nly used externa
+0001bd40: 6c6c 7920 6b65 6570 2077 6f72 6b69 6e67  lly keep working
+0001bd50: 2e0a 0a20 2020 2057 6520 646f 6e27 7420  ...    We don't 
+0001bd60: 2879 6574 2920 666f 726d 616c 6c79 2065  (yet) formally e
+0001bd70: 7870 6f73 6520 616e 2041 5049 2028 7365  xpose an API (se
+0001bd80: 6520 6973 7375 6520 2337 3739 292c 2062  e issue #779), b
+0001bd90: 7574 2077 6520 7368 6f75 6c64 2065 6e64  ut we should end
+0001bda0: 6561 766f 7220 746f 0a20 2020 206b 6565  eavor to.    kee
+0001bdb0: 7020 6365 7274 6169 6e20 6675 6e63 7469  p certain functi
+0001bdc0: 6f6e 7320 7468 6174 2065 7874 6572 6e61  ons that externa
+0001bdd0: 6c20 7573 6572 7320 636f 6d6d 6f6e 6c79  l users commonly
+0001bde0: 2072 656c 7920 6f6e 2077 6f72 6b69 6e67   rely on working
+0001bdf0: 2e0a 0a20 2020 2022 2222 0a0a 2020 2020  ...    """..    
+0001be00: 6465 6620 7465 7374 5f66 6f72 6d61 745f  def test_format_
+0001be10: 7374 7228 7365 6c66 2920 2d3e 204e 6f6e  str(self) -> Non
+0001be20: 653a 0a20 2020 2020 2020 2023 2066 6f72  e:.        # for
+0001be30: 6d61 745f 7374 7220 616e 6420 4d6f 6465  mat_str and Mode
+0001be40: 2073 686f 756c 6420 6b65 6570 2077 6f72   should keep wor
+0001be50: 6b69 6e67 0a20 2020 2020 2020 2061 7373  king.        ass
+0001be60: 6572 7420 280a 2020 2020 2020 2020 2020  ert (.          
+0001be70: 2020 626c 6163 6b2e 666f 726d 6174 5f73    black.format_s
+0001be80: 7472 2822 7072 696e 7428 2768 656c 6c6f  tr("print('hello
+0001be90: 2729 222c 206d 6f64 653d 626c 6163 6b2e  ')", mode=black.
+0001bea0: 4d6f 6465 2829 2920 3d3d 2027 7072 696e  Mode()) == 'prin
+0001beb0: 7428 2268 656c 6c6f 2229 5c6e 270a 2020  t("hello")\n'.  
+0001bec0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0001bed0: 2023 2079 6f75 2063 616e 2070 6173 7320   # you can pass 
+0001bee0: 6c69 6e65 206c 656e 6774 680a 2020 2020  line length.    
+0001bef0: 2020 2020 6173 7365 7274 2028 0a20 2020      assert (.   
+0001bf00: 2020 2020 2020 2020 2062 6c61 636b 2e66           black.f
+0001bf10: 6f72 6d61 745f 7374 7228 2270 7269 6e74  ormat_str("print
+0001bf20: 2827 6865 6c6c 6f27 2922 2c20 6d6f 6465  ('hello')", mode
+0001bf30: 3d62 6c61 636b 2e4d 6f64 6528 6c69 6e65  =black.Mode(line
+0001bf40: 5f6c 656e 6774 683d 3432 2929 0a20 2020  _length=42)).   
+0001bf50: 2020 2020 2020 2020 203d 3d20 2770 7269           == 'pri
+0001bf60: 6e74 2822 6865 6c6c 6f22 295c 6e27 0a20  nt("hello")\n'. 
+0001bf70: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0001bf80: 2020 2320 696e 7661 6c69 6420 696e 7075    # invalid inpu
+0001bf90: 7420 7261 6973 6573 2049 6e76 616c 6964  t raises Invalid
+0001bfa0: 496e 7075 740a 2020 2020 2020 2020 7769  Input.        wi
+0001bfb0: 7468 2070 7974 6573 742e 7261 6973 6573  th pytest.raises
+0001bfc0: 2862 6c61 636b 2e49 6e76 616c 6964 496e  (black.InvalidIn
+0001bfd0: 7075 7429 3a0a 2020 2020 2020 2020 2020  put):.          
+0001bfe0: 2020 626c 6163 6b2e 666f 726d 6174 5f73    black.format_s
+0001bff0: 7472 2822 7379 6e74 6178 2065 7272 6f72  tr("syntax error
+0001c000: 222c 206d 6f64 653d 626c 6163 6b2e 4d6f  ", mode=black.Mo
+0001c010: 6465 2829 290a 0a20 2020 2064 6566 2074  de())..    def t
+0001c020: 6573 745f 666f 726d 6174 5f66 696c 655f  est_format_file_
+0001c030: 636f 6e74 656e 7473 2873 656c 6629 202d  contents(self) -
+0001c040: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0001c050: 2320 596f 7520 7072 6f62 6162 6c79 2073  # You probably s
+0001c060: 686f 756c 6420 6265 2075 7369 6e67 2066  hould be using f
+0001c070: 6f72 6d61 745f 7374 7228 2920 696e 7374  ormat_str() inst
+0001c080: 6561 642c 2062 7574 206c 6574 2773 206b  ead, but let's k
+0001c090: 6565 700a 2020 2020 2020 2020 2320 7468  eep.        # th
+0001c0a0: 6973 206f 6e65 2061 726f 756e 6420 7369  is one around si
+0001c0b0: 6e63 6520 7065 6f70 6c65 2064 6f20 7573  nce people do us
+0001c0c0: 6520 6974 0a20 2020 2020 2020 2061 7373  e it.        ass
+0001c0d0: 6572 7420 280a 2020 2020 2020 2020 2020  ert (.          
+0001c0e0: 2020 626c 6163 6b2e 666f 726d 6174 5f66    black.format_f
+0001c0f0: 696c 655f 636f 6e74 656e 7473 2822 783d  ile_contents("x=
+0001c100: 3122 2c20 6661 7374 3d54 7275 652c 206d  1", fast=True, m
+0001c110: 6f64 653d 626c 6163 6b2e 4d6f 6465 2829  ode=black.Mode()
+0001c120: 2920 3d3d 2022 7820 3d20 315c 6e22 0a20  ) == "x = 1\n". 
+0001c130: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0001c140: 2020 7769 7468 2070 7974 6573 742e 7261    with pytest.ra
+0001c150: 6973 6573 2862 6c61 636b 2e4e 6f74 6869  ises(black.Nothi
+0001c160: 6e67 4368 616e 6765 6429 3a0a 2020 2020  ngChanged):.    
+0001c170: 2020 2020 2020 2020 626c 6163 6b2e 666f          black.fo
+0001c180: 726d 6174 5f66 696c 655f 636f 6e74 656e  rmat_file_conten
+0001c190: 7473 2822 7820 3d20 315c 6e22 2c20 6661  ts("x = 1\n", fa
+0001c1a0: 7374 3d54 7275 652c 206d 6f64 653d 626c  st=True, mode=bl
+0001c1b0: 6163 6b2e 4d6f 6465 2829 290a 0a0a 636c  ack.Mode())...cl
+0001c1c0: 6173 7320 5465 7374 4153 5453 6166 6574  ass TestASTSafet
+0001c1d0: 7928 426c 6163 6b42 6173 6554 6573 7443  y(BlackBaseTestC
+0001c1e0: 6173 6529 3a0a 2020 2020 6465 6620 6368  ase):.    def ch
+0001c1f0: 6563 6b5f 6173 745f 6571 7569 7661 6c65  eck_ast_equivale
+0001c200: 6e63 6528 0a20 2020 2020 2020 2073 656c  nce(.        sel
+0001c210: 662c 2073 6f75 7263 653a 2073 7472 2c20  f, source: str, 
+0001c220: 6465 7374 3a20 7374 722c 202a 2c20 7368  dest: str, *, sh
+0001c230: 6f75 6c64 5f66 6169 6c3a 2062 6f6f 6c20  ould_fail: bool 
+0001c240: 3d20 4661 6c73 650a 2020 2020 2920 2d3e  = False.    ) ->
+0001c250: 204e 6f6e 653a 0a20 2020 2020 2020 2023   None:.        #
+0001c260: 2049 6620 7765 2067 6574 2061 2066 6169   If we get a fai
+0001c270: 6c75 7265 2c20 6d61 6b65 2073 7572 6520  lure, make sure 
+0001c280: 6974 2773 206e 6f74 2062 6563 6175 7365  it's not because
+0001c290: 2074 6865 2063 6f64 6520 6974 7365 6c66   the code itself
+0001c2a0: 0a20 2020 2020 2020 2023 2069 7320 696e  .        # is in
+0001c2b0: 7661 6c69 642c 2073 696e 6365 2074 6861  valid, since tha
+0001c2c0: 7420 7769 6c6c 2061 6c73 6f20 6361 7573  t will also caus
+0001c2d0: 6520 6173 7365 7274 5f65 7175 6976 616c  e assert_equival
+0001c2e0: 656e 7428 2920 746f 2074 6872 6f77 0a20  ent() to throw. 
+0001c2f0: 2020 2020 2020 2023 2041 5354 5361 6665         # ASTSafe
+0001c300: 7479 4572 726f 722e 0a20 2020 2020 2020  tyError..       
+0001c310: 2073 6f75 7263 6520 3d20 7465 7874 7772   source = textwr
+0001c320: 6170 2e64 6564 656e 7428 736f 7572 6365  ap.dedent(source
+0001c330: 290a 2020 2020 2020 2020 6465 7374 203d  ).        dest =
+0001c340: 2074 6578 7477 7261 702e 6465 6465 6e74   textwrap.dedent
+0001c350: 2864 6573 7429 0a20 2020 2020 2020 2062  (dest).        b
+0001c360: 6c61 636b 2e70 6172 7365 5f61 7374 2873  lack.parse_ast(s
+0001c370: 6f75 7263 6529 0a20 2020 2020 2020 2062  ource).        b
+0001c380: 6c61 636b 2e70 6172 7365 5f61 7374 2864  lack.parse_ast(d
+0001c390: 6573 7429 0a20 2020 2020 2020 2069 6620  est).        if 
+0001c3a0: 7368 6f75 6c64 5f66 6169 6c3a 0a20 2020  should_fail:.   
+0001c3b0: 2020 2020 2020 2020 2077 6974 6820 7365           with se
+0001c3c0: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0001c3d0: 4153 5453 6166 6574 7945 7272 6f72 293a  ASTSafetyError):
+0001c3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c3f0: 2062 6c61 636b 2e61 7373 6572 745f 6571   black.assert_eq
+0001c400: 7569 7661 6c65 6e74 2873 6f75 7263 652c  uivalent(source,
+0001c410: 2064 6573 7429 0a20 2020 2020 2020 2065   dest).        e
+0001c420: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001c430: 2062 6c61 636b 2e61 7373 6572 745f 6571   black.assert_eq
+0001c440: 7569 7661 6c65 6e74 2873 6f75 7263 652c  uivalent(source,
+0001c450: 2064 6573 7429 0a0a 2020 2020 6465 6620   dest)..    def 
+0001c460: 7465 7374 5f61 7373 6572 745f 6571 7569  test_assert_equi
+0001c470: 7661 6c65 6e74 5f62 6173 6963 2873 656c  valent_basic(sel
+0001c480: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+0001c490: 2020 2020 7365 6c66 2e63 6865 636b 5f61      self.check_a
+0001c4a0: 7374 5f65 7175 6976 616c 656e 6365 2822  st_equivalence("
+0001c4b0: 7b7d 222c 2022 4e6f 6e65 222c 2073 686f  {}", "None", sho
+0001c4c0: 756c 645f 6661 696c 3d54 7275 6529 0a20  uld_fail=True). 
+0001c4d0: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+0001c4e0: 6b5f 6173 745f 6571 7569 7661 6c65 6e63  k_ast_equivalenc
+0001c4f0: 6528 2231 2b32 222c 2022 3120 2020 202b  e("1+2", "1    +
+0001c500: 2020 2032 2229 0a20 2020 2020 2020 2073     2").        s
+0001c510: 656c 662e 6368 6563 6b5f 6173 745f 6571  elf.check_ast_eq
+0001c520: 7569 7661 6c65 6e63 6528 2268 6920 2320  uivalence("hi # 
+0001c530: 636f 6d6d 656e 7422 2c20 2268 6922 290a  comment", "hi").
+0001c540: 0a20 2020 2064 6566 2074 6573 745f 6173  .    def test_as
+0001c550: 7365 7274 5f65 7175 6976 616c 656e 745f  sert_equivalent_
+0001c560: 6465 6c28 7365 6c66 2920 2d3e 204e 6f6e  del(self) -> Non
+0001c570: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
+0001c580: 6368 6563 6b5f 6173 745f 6571 7569 7661  check_ast_equiva
+0001c590: 6c65 6e63 6528 2264 656c 2028 612c 2062  lence("del (a, b
+0001c5a0: 2922 2c20 2264 656c 2061 2c20 6222 290a  )", "del a, b").
+0001c5b0: 0a20 2020 2064 6566 2074 6573 745f 6173  .    def test_as
+0001c5c0: 7365 7274 5f65 7175 6976 616c 656e 745f  sert_equivalent_
+0001c5d0: 7374 7269 6e67 7328 7365 6c66 2920 2d3e  strings(self) ->
+0001c5e0: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+0001c5f0: 656c 662e 6368 6563 6b5f 6173 745f 6571  elf.check_ast_eq
+0001c600: 7569 7661 6c65 6e63 6528 2778 203d 2022  uivalence('x = "
+0001c610: 7822 272c 2027 7820 3d20 2220 7820 2227  x"', 'x = " x "'
+0001c620: 2c20 7368 6f75 6c64 5f66 6169 6c3d 5472  , should_fail=Tr
+0001c630: 7565 290a 2020 2020 2020 2020 7365 6c66  ue).        self
+0001c640: 2e63 6865 636b 5f61 7374 5f65 7175 6976  .check_ast_equiv
+0001c650: 616c 656e 6365 280a 2020 2020 2020 2020  alence(.        
+0001c660: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
+0001c670: 2020 2020 2222 2264 6f63 7374 7269 6e67      """docstring
+0001c680: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
+0001c690: 2020 2727 272c 0a20 2020 2020 2020 2020    ''',.         
+0001c6a0: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
+0001c6b0: 2020 2022 2222 646f 6373 7472 696e 6722     """docstring"
+0001c6c0: 2222 0a20 2020 2020 2020 2020 2020 2027  "".            '
+0001c6d0: 2727 2c0a 2020 2020 2020 2020 290a 2020  '',.        ).  
+0001c6e0: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+0001c6f0: 5f61 7374 5f65 7175 6976 616c 656e 6365  _ast_equivalence
+0001c700: 280a 2020 2020 2020 2020 2020 2020 2727  (.            ''
+0001c710: 270a 2020 2020 2020 2020 2020 2020 2222  '.            ""
+0001c720: 2264 6f63 7374 7269 6e67 2020 2222 220a  "docstring  """.
+0001c730: 2020 2020 2020 2020 2020 2020 2727 272c              ''',
+0001c740: 0a20 2020 2020 2020 2020 2020 2027 2727  .            '''
+0001c750: 0a20 2020 2020 2020 2020 2020 2022 2222  .            """
+0001c760: 6464 6f63 7374 7269 6e67 2222 220a 2020  ddocstring""".  
+0001c770: 2020 2020 2020 2020 2020 2727 272c 0a20            ''',. 
+0001c780: 2020 2020 2020 2020 2020 2073 686f 756c             shoul
+0001c790: 645f 6661 696c 3d54 7275 652c 0a20 2020  d_fail=True,.   
+0001c7a0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
+0001c7b0: 656c 662e 6368 6563 6b5f 6173 745f 6571  elf.check_ast_eq
+0001c7c0: 7569 7661 6c65 6e63 6528 0a20 2020 2020  uivalence(.     
+0001c7d0: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
+0001c7e0: 2020 2020 2020 2063 6c61 7373 2041 3a0a         class A:.
+0001c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c800: 2222 220a 0a20 2020 2020 2020 2020 2020  """..           
+0001c810: 2020 2020 2064 6f63 7374 7269 6e67 0a0a       docstring..
+0001c820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c830: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
+0001c840: 2027 2727 2c0a 2020 2020 2020 2020 2020   ''',.          
+0001c850: 2020 2727 270a 2020 2020 2020 2020 2020    '''.          
+0001c860: 2020 636c 6173 7320 413a 0a20 2020 2020    class A:.     
+0001c870: 2020 2020 2020 2020 2020 2022 2222 646f             """do
+0001c880: 6373 7472 696e 6722 2222 0a20 2020 2020  cstring""".     
+0001c890: 2020 2020 2020 2027 2727 2c0a 2020 2020         ''',.    
+0001c8a0: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+0001c8b0: 6c66 2e63 6865 636b 5f61 7374 5f65 7175  lf.check_ast_equ
+0001c8c0: 6976 616c 656e 6365 280a 2020 2020 2020  ivalence(.      
+0001c8d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001c8e0: 2020 2020 2020 6465 6620 6628 293a 0a20        def f():. 
+0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001c900: 2064 6f63 7374 7269 6e67 2020 220a 2020   docstring  ".  
+0001c910: 2020 2020 2020 2020 2020 2222 222c 0a20            """,. 
+0001c920: 2020 2020 2020 2020 2020 2027 2727 0a20             '''. 
+0001c930: 2020 2020 2020 2020 2020 2064 6566 2066             def f
+0001c940: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0001c950: 2020 2020 2222 2264 6f63 7374 7269 6e67      """docstring
+0001c960: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+0001c970: 2727 272c 0a20 2020 2020 2020 2029 0a20  ''',.        ). 
+0001c980: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+0001c990: 6b5f 6173 745f 6571 7569 7661 6c65 6e63  k_ast_equivalenc
+0001c9a0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
+0001c9b0: 2222 0a20 2020 2020 2020 2020 2020 2061  "".            a
+0001c9c0: 7379 6e63 2064 6566 2066 2829 3a0a 2020  sync def f():.  
+0001c9d0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+0001c9e0: 2020 646f 6373 7472 696e 6720 2022 0a20    docstring  ". 
+0001c9f0: 2020 2020 2020 2020 2020 2022 2222 2c0a             """,.
+0001ca00: 2020 2020 2020 2020 2020 2020 2727 270a              '''.
+0001ca10: 2020 2020 2020 2020 2020 2020 6173 796e              asyn
+0001ca20: 6320 6465 6620 6628 293a 0a20 2020 2020  c def f():.     
+0001ca30: 2020 2020 2020 2020 2020 2022 2222 646f             """do
+0001ca40: 6373 7472 696e 6722 2222 0a20 2020 2020  cstring""".     
+0001ca50: 2020 2020 2020 2027 2727 2c0a 2020 2020         ''',.    
+0001ca60: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+0001ca70: 6c66 2e63 6865 636b 5f61 7374 5f65 7175  lf.check_ast_equ
+0001ca80: 6976 616c 656e 6365 280a 2020 2020 2020  ivalence(.      
+0001ca90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001caa0: 2020 2020 2020 6966 205f 5f6e 616d 655f        if __name_
+0001cab0: 5f20 3d3d 2022 5f5f 6d61 696e 5f5f 223a  _ == "__main__":
+0001cac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cad0: 2022 2020 646f 6373 7472 696e 672d 6c69   "  docstring-li
+0001cae0: 6b65 2020 220a 2020 2020 2020 2020 2020  ke  ".          
+0001caf0: 2020 2222 222c 0a20 2020 2020 2020 2020    """,.         
+0001cb00: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
+0001cb10: 2020 2069 6620 5f5f 6e61 6d65 5f5f 203d     if __name__ =
+0001cb20: 3d20 225f 5f6d 6169 6e5f 5f22 3a0a 2020  = "__main__":.  
+0001cb30: 2020 2020 2020 2020 2020 2020 2020 2222                ""
+0001cb40: 2264 6f63 7374 7269 6e67 2d6c 696b 6522  "docstring-like"
+0001cb50: 2222 0a20 2020 2020 2020 2020 2020 2027  "".            '
+0001cb60: 2727 2c0a 2020 2020 2020 2020 290a 2020  '',.        ).  
+0001cb70: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+0001cb80: 5f61 7374 5f65 7175 6976 616c 656e 6365  _ast_equivalence
+0001cb90: 2872 2764 6566 2066 2829 3a20 7222 205c  (r'def f(): r" \
+0001cba0: 6e20 2227 2c20 7227 6465 6620 6628 293a  n "', r'def f():
+0001cbb0: 2022 5c5c 6e22 2729 0a20 2020 2020 2020   "\\n"').       
+0001cbc0: 2073 656c 662e 6368 6563 6b5f 6173 745f   self.check_ast_
+0001cbd0: 6571 7569 7661 6c65 6e63 6528 2774 7279  equivalence('try
+0001cbe0: 3a20 7061 7373 5c6e 6578 6365 7074 3a20  : pass\nexcept: 
+0001cbf0: 2220 7820 2227 2c20 2774 7279 3a20 7061  " x "', 'try: pa
+0001cc00: 7373 5c6e 6578 6365 7074 3a20 2278 2227  ss\nexcept: "x"'
+0001cc10: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001cc20: 6368 6563 6b5f 6173 745f 6571 7569 7661  check_ast_equiva
+0001cc30: 6c65 6e63 6528 0a20 2020 2020 2020 2020  lence(.         
+0001cc40: 2020 2027 6465 6620 666f 6f28 293a 2072     'def foo(): r
+0001cc50: 6574 7572 6e20 2220 7820 2227 2c20 2764  eturn " x "', 'd
+0001cc60: 6566 2066 6f6f 2829 3a20 7265 7475 726e  ef foo(): return
+0001cc70: 2022 7822 272c 2073 686f 756c 645f 6661   "x"', should_fa
+0001cc80: 696c 3d54 7275 650a 2020 2020 2020 2020  il=True.        
+0001cc90: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0001cca0: 6173 7365 7274 5f65 7175 6976 616c 656e  assert_equivalen
+0001ccb0: 745f 6673 7472 696e 6728 7365 6c66 2920  t_fstring(self) 
+0001ccc0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0001ccd0: 206d 616a 6f72 2c20 6d69 6e6f 7220 3d20   major, minor = 
+0001cce0: 7379 732e 7665 7273 696f 6e5f 696e 666f  sys.version_info
+0001ccf0: 5b3a 325d 0a20 2020 2020 2020 2069 6620  [:2].        if 
+0001cd00: 6d61 6a6f 7220 3c20 3320 6f72 2028 6d61  major < 3 or (ma
+0001cd10: 6a6f 7220 3d3d 2033 2061 6e64 206d 696e  jor == 3 and min
+0001cd20: 6f72 203c 2031 3229 3a0a 2020 2020 2020  or < 12):.      
+0001cd30: 2020 2020 2020 7079 7465 7374 2e73 6b69        pytest.ski
+0001cd40: 7028 2272 656c 6965 7320 6f6e 2033 2e31  p("relies on 3.1
+0001cd50: 322b 2073 796e 7461 7822 290a 2020 2020  2+ syntax").    
+0001cd60: 2020 2020 2320 6874 7470 733a 2f2f 6769      # https://gi
+0001cd70: 7468 7562 2e63 6f6d 2f70 7366 2f62 6c61  thub.com/psf/bla
+0001cd80: 636b 2f69 7373 7565 732f 3432 3638 0a20  ck/issues/4268. 
+0001cd90: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+0001cda0: 6b5f 6173 745f 6571 7569 7661 6c65 6e63  k_ast_equivalenc
+0001cdb0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
+0001cdc0: 2222 7072 696e 7428 6622 7b22 7c22 2e6a  ""print(f"{"|".j
+0001cdd0: 6f69 6e28 5b61 2c62 2c63 5d29 7d22 2922  oin([a,b,c])}")"
+0001cde0: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
+0001cdf0: 2222 2270 7269 6e74 2866 227b 2220 7c20  """print(f"{" | 
+0001ce00: 222e 6a6f 696e 285b 612c 622c 635d 297d  ".join([a,b,c])}
+0001ce10: 2229 2222 222c 0a20 2020 2020 2020 2020  ")""",.         
+0001ce20: 2020 2073 686f 756c 645f 6661 696c 3d54     should_fail=T
+0001ce30: 7275 652c 0a20 2020 2020 2020 2029 0a20  rue,.        ). 
+0001ce40: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+0001ce50: 6b5f 6173 745f 6571 7569 7661 6c65 6e63  k_ast_equivalenc
+0001ce60: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
+0001ce70: 2222 7072 696e 7428 6622 7b22 7c22 2e6a  ""print(f"{"|".j
+0001ce80: 6f69 6e28 5b27 6127 2c27 6227 2c27 6327  oin(['a','b','c'
+0001ce90: 5d29 7d22 2922 2222 2c0a 2020 2020 2020  ])}")""",.      
+0001cea0: 2020 2020 2020 2222 2270 7269 6e74 2866        """print(f
+0001ceb0: 227b 2220 7c20 222e 6a6f 696e 285b 2761  "{" | ".join(['a
+0001cec0: 272c 2762 272c 2763 275d 297d 2229 2222  ','b','c'])}")""
+0001ced0: 222c 0a20 2020 2020 2020 2020 2020 2073  ",.            s
+0001cee0: 686f 756c 645f 6661 696c 3d54 7275 652c  hould_fail=True,
+0001cef0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0001cf00: 6465 6620 7465 7374 5f65 7175 6976 616c  def test_equival
+0001cf10: 656e 6379 5f61 7374 5f70 6172 7365 5f66  ency_ast_parse_f
+0001cf20: 6169 6c75 7265 5f69 6e63 6c75 6465 735f  ailure_includes_
+0001cf30: 6572 726f 7228 7365 6c66 2920 2d3e 204e  error(self) -> N
+0001cf40: 6f6e 653a 0a20 2020 2020 2020 2077 6974  one:.        wit
+0001cf50: 6820 7079 7465 7374 2e72 6169 7365 7328  h pytest.raises(
+0001cf60: 4153 5453 6166 6574 7945 7272 6f72 2920  ASTSafetyError) 
+0001cf70: 6173 2065 7272 3a0a 2020 2020 2020 2020  as err:.        
+0001cf80: 2020 2020 626c 6163 6b2e 6173 7365 7274      black.assert
+0001cf90: 5f65 7175 6976 616c 656e 7428 2261 c2ab  _equivalent("a..
+0001cfa0: c2bb 6120 203d 2031 222c 2022 61c2 abc2  ..a  = 1", "a...
+0001cfb0: bb61 2020 3d20 3122 290a 0a20 2020 2020  .a  = 1")..     
+0001cfc0: 2020 2065 7272 2e6d 6174 6368 2822 2d2d     err.match("--
+0001cfd0: 7361 6665 2229 0a20 2020 2020 2020 2023  safe").        #
+0001cfe0: 2055 6e66 6f72 7475 6e61 7465 6c79 2074   Unfortunately t
+0001cff0: 6865 2053 796e 7461 7845 7272 6f72 206d  he SyntaxError m
+0001d000: 6573 7361 6765 2068 6173 2063 6861 6e67  essage has chang
+0001d010: 6564 2069 6e20 6e65 7765 7220 7665 7273  ed in newer vers
+0001d020: 696f 6e73 2073 6f20 7765 0a20 2020 2020  ions so we.     
+0001d030: 2020 2023 2063 616e 2774 206d 6174 6368     # can't match
+0001d040: 2069 7420 6469 7265 6374 6c79 2e0a 2020   it directly..  
+0001d050: 2020 2020 2020 6572 722e 6d61 7463 6828        err.match(
+0001d060: 2269 6e76 616c 6964 2063 6861 7261 6374  "invalid charact
+0001d070: 6572 2229 0a20 2020 2020 2020 2065 7272  er").        err
+0001d080: 2e6d 6174 6368 2872 225c 283c 756e 6b6e  .match(r"\(<unkn
+0001d090: 6f77 6e3e 2c20 6c69 6e65 2031 5c29 2229  own>, line 1\)")
+0001d0a0: 0a0a 0a74 7279 3a0a 2020 2020 7769 7468  ...try:.    with
+0001d0b0: 206f 7065 6e28 626c 6163 6b2e 5f5f 6669   open(black.__fi
+0001d0c0: 6c65 5f5f 2c20 2272 222c 2065 6e63 6f64  le__, "r", encod
+0001d0d0: 696e 673d 2275 7466 2d38 2229 2061 7320  ing="utf-8") as 
+0001d0e0: 5f62 663a 0a20 2020 2020 2020 2062 6c61  _bf:.        bla
+0001d0f0: 636b 5f73 6f75 7263 655f 6c69 6e65 7320  ck_source_lines 
+0001d100: 3d20 5f62 662e 7265 6164 6c69 6e65 7328  = _bf.readlines(
+0001d110: 290a 6578 6365 7074 2055 6e69 636f 6465  ).except Unicode
+0001d120: 4465 636f 6465 4572 726f 723a 0a20 2020  DecodeError:.   
+0001d130: 2069 6620 6e6f 7420 626c 6163 6b2e 434f   if not black.CO
+0001d140: 4d50 494c 4544 3a0a 2020 2020 2020 2020  MPILED:.        
+0001d150: 7261 6973 650a 0a0a 6465 6620 7472 6163  raise...def trac
+0001d160: 6566 756e 6328 0a20 2020 2066 7261 6d65  efunc(.    frame
+0001d170: 3a20 7479 7065 732e 4672 616d 6554 7970  : types.FrameTyp
+0001d180: 652c 2065 7665 6e74 3a20 7374 722c 2061  e, event: str, a
+0001d190: 7267 3a20 416e 790a 2920 2d3e 2043 616c  rg: Any.) -> Cal
+0001d1a0: 6c61 626c 655b 5b74 7970 6573 2e46 7261  lable[[types.Fra
+0001d1b0: 6d65 5479 7065 2c20 7374 722c 2041 6e79  meType, str, Any
+0001d1c0: 5d2c 2041 6e79 5d3a 0a20 2020 2022 2222  ], Any]:.    """
+0001d1d0: 5368 6f77 2066 756e 6374 696f 6e20 6361  Show function ca
+0001d1e0: 6c6c 7320 6066 726f 6d20 626c 6163 6b2f  lls `from black/
+0001d1f0: 5f5f 696e 6974 5f5f 2e70 7960 2061 7320  __init__.py` as 
+0001d200: 7468 6579 2068 6170 7065 6e2e 0a0a 2020  they happen...  
+0001d210: 2020 5265 6769 7374 6572 2074 6869 7320    Register this 
+0001d220: 7769 7468 2060 7379 732e 7365 7474 7261  with `sys.settra
+0001d230: 6365 2829 6020 696e 2061 2074 6573 7420  ce()` in a test 
+0001d240: 796f 7527 7265 2064 6562 7567 6769 6e67  you're debugging
+0001d250: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
+0001d260: 2065 7665 6e74 2021 3d20 2263 616c 6c22   event != "call"
+0001d270: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001d280: 2074 7261 6365 6675 6e63 0a0a 2020 2020   tracefunc..    
+0001d290: 7374 6163 6b20 3d20 6c65 6e28 696e 7370  stack = len(insp
+0001d2a0: 6563 742e 7374 6163 6b28 2929 202d 2031  ect.stack()) - 1
+0001d2b0: 390a 2020 2020 7374 6163 6b20 2a3d 2032  9.    stack *= 2
+0001d2c0: 0a20 2020 2066 696c 656e 616d 6520 3d20  .    filename = 
+0001d2d0: 6672 616d 652e 665f 636f 6465 2e63 6f5f  frame.f_code.co_
+0001d2e0: 6669 6c65 6e61 6d65 0a20 2020 206c 696e  filename.    lin
+0001d2f0: 656e 6f20 3d20 6672 616d 652e 665f 6c69  eno = frame.f_li
+0001d300: 6e65 6e6f 0a20 2020 2066 756e 635f 7369  neno.    func_si
+0001d310: 675f 6c69 6e65 6e6f 203d 206c 696e 656e  g_lineno = linen
+0001d320: 6f20 2d20 310a 2020 2020 6675 6e63 6e61  o - 1.    funcna
+0001d330: 6d65 203d 2062 6c61 636b 5f73 6f75 7263  me = black_sourc
+0001d340: 655f 6c69 6e65 735b 6675 6e63 5f73 6967  e_lines[func_sig
+0001d350: 5f6c 696e 656e 6f5d 2e73 7472 6970 2829  _lineno].strip()
+0001d360: 0a20 2020 2077 6869 6c65 2066 756e 636e  .    while funcn
+0001d370: 616d 652e 7374 6172 7473 7769 7468 2822  ame.startswith("
+0001d380: 4022 293a 0a20 2020 2020 2020 2066 756e  @"):.        fun
+0001d390: 635f 7369 675f 6c69 6e65 6e6f 202b 3d20  c_sig_lineno += 
+0001d3a0: 310a 2020 2020 2020 2020 6675 6e63 6e61  1.        funcna
+0001d3b0: 6d65 203d 2062 6c61 636b 5f73 6f75 7263  me = black_sourc
+0001d3c0: 655f 6c69 6e65 735b 6675 6e63 5f73 6967  e_lines[func_sig
+0001d3d0: 5f6c 696e 656e 6f5d 2e73 7472 6970 2829  _lineno].strip()
+0001d3e0: 0a20 2020 2069 6620 2262 6c61 636b 2f5f  .    if "black/_
+0001d3f0: 5f69 6e69 745f 5f2e 7079 2220 696e 2066  _init__.py" in f
+0001d400: 696c 656e 616d 653a 0a20 2020 2020 2020  ilename:.       
+0001d410: 2070 7269 6e74 2866 227b 2720 2720 2a20   print(f"{' ' * 
+0001d420: 7374 6163 6b7d 7b6c 696e 656e 6f7d 3a7b  stack}{lineno}:{
+0001d430: 6675 6e63 6e61 6d65 7d22 290a 2020 2020  funcname}").    
+0001d440: 7265 7475 726e 2074 7261 6365 6675 6e63  return tracefunc
+0001d450: 0a                                       .
```

### Comparing `black-24.4.0/tests/test_blackd.py` & `black-24.4.1/tests/test_blackd.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/test_docs.py` & `black-24.4.1/tests/test_docs.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/test_format.py` & `black-24.4.1/tests/test_format.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/test_ipynb.py` & `black-24.4.1/tests/test_ipynb.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/test_no_ipynb.py` & `black-24.4.1/tests/test_no_ipynb.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/test_ranges.py` & `black-24.4.1/tests/test_ranges.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/test_schema.py` & `black-24.4.1/tests/test_schema.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/test_trans.py` & `black-24.4.1/tests/test_trans.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/util.py` & `black-24.4.1/tests/util.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/allow_empty_first_line.py` & `black-24.4.1/tests/data/cases/allow_empty_first_line.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/attribute_access_on_number_literals.py` & `black-24.4.1/tests/data/cases/attribute_access_on_number_literals.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/class_blank_parentheses.py` & `black-24.4.1/tests/data/cases/class_blank_parentheses.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/class_methods_new_line.py` & `black-24.4.1/tests/data/cases/class_methods_new_line.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/collections.py` & `black-24.4.1/tests/data/cases/collections.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments.py` & `black-24.4.1/tests/data/cases/comments.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments2.py` & `black-24.4.1/tests/data/cases/comments2.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments3.py` & `black-24.4.1/tests/data/cases/comments3.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments4.py` & `black-24.4.1/tests/data/cases/comments4.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments5.py` & `black-24.4.1/tests/data/cases/comments5.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments6.py` & `black-24.4.1/tests/data/cases/comments6.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments9.py` & `black-24.4.1/tests/data/cases/comments9.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments_in_blocks.py` & `black-24.4.1/tests/data/cases/comments_in_blocks.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments_in_double_parens.py` & `black-24.4.1/tests/data/cases/comments_in_double_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/comments_non_breaking_space.py` & `black-24.4.1/tests/data/cases/comments_non_breaking_space.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/composition.py` & `black-24.4.1/tests/data/cases/composition.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/composition_no_trailing_comma.py` & `black-24.4.1/tests/data/cases/composition_no_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/conditional_expression.py` & `black-24.4.1/tests/data/cases/conditional_expression.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/context_managers_38.py` & `black-24.4.1/tests/data/cases/context_managers_38.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/context_managers_39.py` & `black-24.4.1/tests/data/cases/context_managers_39.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/context_managers_autodetect_310.py` & `black-24.4.1/tests/data/cases/context_managers_autodetect_310.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/context_managers_autodetect_311.py` & `black-24.4.1/tests/data/cases/context_managers_autodetect_311.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/context_managers_autodetect_38.py` & `black-24.4.1/tests/data/cases/context_managers_autodetect_38.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/context_managers_autodetect_39.py` & `black-24.4.1/tests/data/cases/context_managers_autodetect_39.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/docstring.py` & `black-24.4.1/tests/data/cases/docstring.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/docstring_no_string_normalization.py` & `black-24.4.1/tests/data/cases/docstring_no_string_normalization.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/docstring_preview.py` & `black-24.4.1/tests/data/cases/docstring_preview.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/empty_lines.py` & `black-24.4.1/tests/data/cases/empty_lines.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/expression.diff` & `black-24.4.1/tests/data/cases/expression.diff`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/expression.py` & `black-24.4.1/tests/data/cases/expression.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/fmtonoff.py` & `black-24.4.1/tests/data/cases/fmtonoff.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/fmtonoff2.py` & `black-24.4.1/tests/data/cases/fmtonoff2.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/fmtonoff5.py` & `black-24.4.1/tests/data/cases/fmtonoff5.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/fmtskip2.py` & `black-24.4.1/tests/data/cases/fmtskip2.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/fmtskip8.py` & `black-24.4.1/tests/data/cases/fmtskip8.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/form_feeds.py` & `black-24.4.1/tests/data/cases/form_feeds.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/fstring.py` & `black-24.4.1/tests/data/cases/fstring.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/funcdef_return_type_trailing_comma.py` & `black-24.4.1/tests/data/cases/funcdef_return_type_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/function.py` & `black-24.4.1/tests/data/cases/function.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/function2.py` & `black-24.4.1/tests/data/cases/function2.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/function_trailing_comma.py` & `black-24.4.1/tests/data/cases/function_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/ignore_pyi.py` & `black-24.4.1/tests/data/cases/ignore_pyi.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/import_spacing.py` & `black-24.4.1/tests/data/cases/import_spacing.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/is_simple_lookup_for_doublestar_expression.py` & `black-24.4.1/tests/data/cases/is_simple_lookup_for_doublestar_expression.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/keep_newline_after_match.py` & `black-24.4.1/tests/data/cases/keep_newline_after_match.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_basic.py` & `black-24.4.1/tests/data/cases/line_ranges_basic.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_diff_edge_case.py` & `black-24.4.1/tests/data/cases/line_ranges_diff_edge_case.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_exceeding_end.py` & `black-24.4.1/tests/data/cases/line_ranges_exceeding_end.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_fmt_off.py` & `black-24.4.1/tests/data/cases/line_ranges_fmt_off.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_fmt_off_decorator.py` & `black-24.4.1/tests/data/cases/line_ranges_fmt_off_decorator.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_fmt_off_overlap.py` & `black-24.4.1/tests/data/cases/line_ranges_fmt_off_overlap.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_indentation.py` & `black-24.4.1/tests/data/cases/line_ranges_indentation.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_outside_source.py` & `black-24.4.1/tests/data/cases/line_ranges_outside_source.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_two_passes.py` & `black-24.4.1/tests/data/cases/line_ranges_two_passes.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/line_ranges_unwrapping.py` & `black-24.4.1/tests/data/cases/line_ranges_unwrapping.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/long_strings_flag_disabled.py` & `black-24.4.1/tests/data/cases/long_strings_flag_disabled.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/module_docstring_2.py` & `black-24.4.1/tests/data/cases/module_docstring_2.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/multiline_consecutive_open_parentheses_ignore.py` & `black-24.4.1/tests/data/cases/multiline_consecutive_open_parentheses_ignore.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/nested_stub.py` & `black-24.4.1/tests/data/cases/nested_stub.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/no_blank_line_before_docstring.py` & `black-24.4.1/tests/data/cases/no_blank_line_before_docstring.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/numeric_literals.py` & `black-24.4.1/tests/data/cases/numeric_literals.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/one_element_subscript.py` & `black-24.4.1/tests/data/cases/one_element_subscript.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/parenthesized_context_managers.py` & `black-24.4.1/tests/data/cases/parenthesized_context_managers.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pattern_matching_complex.py` & `black-24.4.1/tests/data/cases/pattern_matching_complex.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pattern_matching_extras.py` & `black-24.4.1/tests/data/cases/pattern_matching_extras.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pattern_matching_generic.py` & `black-24.4.1/tests/data/cases/pattern_matching_generic.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pattern_matching_long.py` & `black-24.4.1/tests/data/cases/pattern_matching_long.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pattern_matching_simple.py` & `black-24.4.1/tests/data/cases/pattern_matching_simple.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pattern_matching_style.py` & `black-24.4.1/tests/data/cases/pattern_matching_style.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pattern_matching_trailing_comma.py` & `black-24.4.1/tests/data/cases/pattern_matching_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pattern_matching_with_if_stmt.py` & `black-24.4.1/tests/data/cases/pattern_matching_with_if_stmt.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep604_union_types_line_breaks.py` & `black-24.4.1/tests/data/cases/pep604_union_types_line_breaks.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep_570.py` & `black-24.4.1/tests/data/cases/pep_570.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep_572.py` & `black-24.4.1/tests/data/cases/pep_572.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep_572_do_not_remove_parens.py` & `black-24.4.1/tests/data/cases/pep_572_do_not_remove_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep_572_py310.py` & `black-24.4.1/tests/data/cases/pep_572_py310.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep_572_remove_parens.py` & `black-24.4.1/tests/data/cases/pep_572_remove_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep_604.py` & `black-24.4.1/tests/data/cases/pep_604.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep_646.py` & `black-24.4.1/tests/data/cases/pep_646.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep_654.py` & `black-24.4.1/tests/data/cases/pep_654.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/pep_654_style.py` & `black-24.4.1/tests/data/cases/pep_654_style.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/power_op_spacing.py` & `black-24.4.1/tests/data/cases/power_op_spacing.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/power_op_spacing_long.py` & `black-24.4.1/tests/data/cases/power_op_spacing_long.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/prefer_rhs_split.py` & `black-24.4.1/tests/data/cases/prefer_rhs_split.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/prefer_rhs_split_reformatted.py` & `black-24.4.1/tests/data/cases/prefer_rhs_split_reformatted.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_cantfit.py` & `black-24.4.1/tests/data/cases/preview_cantfit.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_cantfit_string.py` & `black-24.4.1/tests/data/cases/preview_cantfit_string.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_comments7.py` & `black-24.4.1/tests/data/cases/preview_comments7.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_format_unicode_escape_seq.py` & `black-24.4.1/tests/data/cases/preview_format_unicode_escape_seq.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets.py` & `black-24.4.1/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets_no_ll1.py` & `black-24.4.1/tests/data/cases/preview_hug_parens_with_braces_and_square_brackets_no_ll1.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_long_dict_values.py` & `black-24.4.1/tests/data/cases/preview_long_dict_values.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_long_strings.py` & `black-24.4.1/tests/data/cases/preview_long_strings.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_long_strings__east_asian_width.py` & `black-24.4.1/tests/data/cases/preview_long_strings__east_asian_width.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_long_strings__edge_case.py` & `black-24.4.1/tests/data/cases/preview_long_strings__edge_case.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_long_strings__regression.py` & `black-24.4.1/tests/data/cases/preview_long_strings__regression.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_long_strings__type_annotations.py` & `black-24.4.1/tests/data/cases/preview_long_strings__type_annotations.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_multiline_strings.py` & `black-24.4.1/tests/data/cases/preview_multiline_strings.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/preview_return_annotation_brackets_string.py` & `black-24.4.1/tests/data/cases/preview_return_annotation_brackets_string.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/python37.py` & `black-24.4.1/tests/data/cases/python37.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/python38.py` & `black-24.4.1/tests/data/cases/python38.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/python39.py` & `black-24.4.1/tests/data/cases/python39.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/remove_await_parens.py` & `black-24.4.1/tests/data/cases/remove_await_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/remove_except_parens.py` & `black-24.4.1/tests/data/cases/remove_except_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/remove_for_brackets.py` & `black-24.4.1/tests/data/cases/remove_for_brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/remove_newline_after_code_block_open.py` & `black-24.4.1/tests/data/cases/remove_newline_after_code_block_open.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/remove_parens.py` & `black-24.4.1/tests/data/cases/remove_parens.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/remove_redundant_parens_in_case_guard.py` & `black-24.4.1/tests/data/cases/remove_redundant_parens_in_case_guard.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/remove_with_brackets.py` & `black-24.4.1/tests/data/cases/remove_with_brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/return_annotation_brackets.py` & `black-24.4.1/tests/data/cases/return_annotation_brackets.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/single_line_format_skip_with_multiple_comments.py` & `black-24.4.1/tests/data/cases/single_line_format_skip_with_multiple_comments.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/skip_magic_trailing_comma.py` & `black-24.4.1/tests/data/cases/skip_magic_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/slices.py` & `black-24.4.1/tests/data/cases/slices.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/split_delimiter_comments.py` & `black-24.4.1/tests/data/cases/split_delimiter_comments.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/string_prefixes.py` & `black-24.4.1/tests/data/cases/string_prefixes.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/stub.py` & `black-24.4.1/tests/data/cases/stub.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/torture.py` & `black-24.4.1/tests/data/cases/torture.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/trailing_comma.py` & `black-24.4.1/tests/data/cases/trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/trailing_comma_optional_parens1.py` & `black-24.4.1/tests/data/cases/trailing_comma_optional_parens1.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/trailing_comma_optional_parens3.py` & `black-24.4.1/tests/data/cases/trailing_comma_optional_parens3.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/trailing_commas_in_leading_parts.py` & `black-24.4.1/tests/data/cases/trailing_commas_in_leading_parts.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/type_params.py` & `black-24.4.1/tests/data/cases/type_params.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/cases/typed_params_trailing_comma.py` & `black-24.4.1/tests/data/cases/typed_params_trailing_comma.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/jupyter/notebook_no_trailing_newline.ipynb` & `black-24.4.1/tests/data/jupyter/notebook_no_trailing_newline.ipynb`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/jupyter/notebook_trailing_newline.ipynb` & `black-24.4.1/tests/data/jupyter/notebook_trailing_newline.ipynb`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/jupyter/notebook_without_changes.ipynb` & `black-24.4.1/tests/data/jupyter/notebook_without_changes.ipynb`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/line_ranges_formatted/basic.py` & `black-24.4.1/tests/data/line_ranges_formatted/basic.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/line_ranges_formatted/pattern_matching.py` & `black-24.4.1/tests/data/line_ranges_formatted/pattern_matching.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/miscellaneous/debug_visitor.py` & `black-24.4.1/tests/data/miscellaneous/debug_visitor.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/miscellaneous/decorators.py` & `black-24.4.1/tests/data/miscellaneous/decorators.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff` & `black-24.4.1/tests/data/miscellaneous/expression_skip_magic_trailing_comma.diff`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/miscellaneous/force_py36.py` & `black-24.4.1/tests/data/miscellaneous/force_py36.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/miscellaneous/force_pyi.py` & `black-24.4.1/tests/data/miscellaneous/force_pyi.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/miscellaneous/python2_detection.py` & `black-24.4.1/tests/data/miscellaneous/python2_detection.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/tests/data/miscellaneous/string_quotes.py` & `black-24.4.1/tests/data/miscellaneous/string_quotes.py`

 * *Files identical despite different names*

### Comparing `black-24.4.0/AUTHORS.md` & `black-24.4.1/AUTHORS.md`

 * *Files identical despite different names*

### Comparing `black-24.4.0/LICENSE` & `black-24.4.1/LICENSE`

 * *Files identical despite different names*

### Comparing `black-24.4.0/pyproject.toml` & `black-24.4.1/pyproject.toml`

 * *Files identical despite different names*

### Comparing `black-24.4.0/PKG-INFO` & `black-24.4.1/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.3
 Name: black
-Version: 24.4.0
+Version: 24.4.1
 Summary: The uncompromising code formatter.
 Project-URL: Changelog, https://github.com/psf/black/blob/main/CHANGES.md
 Project-URL: Homepage, https://github.com/psf/black
 Author-email: Łukasz Langa <lukasz@langa.pl>
 License: MIT
 License-File: AUTHORS.md
 License-File: LICENSE
@@ -271,14 +271,33 @@
 
 At the same time, humor is encouraged. In fact, basic familiarity with Monty Python's
 Flying Circus is expected. We are not savages.
 
 And if you _really_ need to slap somebody, do it with a fish while dancing.
 # Change Log
 
+## 24.4.1
+
+### Highlights
+
+- Add support for the new Python 3.12 f-string syntax introduced by PEP 701 (#3822)
+
+### Stable style
+
+- Fix crash involving indented dummy functions containing newlines (#4318)
+
+### Parser
+
+- Add support for type parameter defaults, a new syntactic feature added to Python 3.13
+  by PEP 696 (#4327)
+
+### Integrations
+
+- Github Action now works even when `git archive` is skipped (#4313)
+
 ## 24.4.0
 
 ### Stable style
 
 - Fix unwanted crashes caused by AST equivalency check (#4290)
 
 ### Preview style
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.3 Name: black Version: 24.4.0 Summary: The uncompromising
+Metadata-Version: 2.3 Name: black Version: 24.4.1 Summary: The uncompromising
 code formatter. Project-URL: Changelog, https://github.com/psf/black/blob/main/
 CHANGES.md Project-URL: Homepage, https://github.com/psf/black Author-email:
 Åukasz Langa
 langa.pl> License: MIT License-File: AUTHORS.md License-File: LICENSE Keywords:
 automation,autopep8,formatter,gofmt,pyfmt,rustfmt,yapf Classifier: Development
 Status :: 5 - Production/Stable Classifier: Environment :: Console Classifier:
 Intended Audience :: Developers Classifier: License :: OSI Approved :: MIT
@@ -137,48 +137,53 @@
 [AUTHORS.md](./AUTHORS.md) ## Code of Conduct Everyone participating in the
 _Black_ project, and in particular in the issue tracker, pull requests, and
 social media activity, is expected to treat other people with respect and more
 generally to follow the guidelines articulated in the [Python Community Code of
 Conduct](https://www.python.org/psf/codeofconduct/). At the same time, humor is
 encouraged. In fact, basic familiarity with Monty Python's Flying Circus is
 expected. We are not savages. And if you _really_ need to slap somebody, do it
-with a fish while dancing. # Change Log ## 24.4.0 ### Stable style - Fix
-unwanted crashes caused by AST equivalency check (#4290) ### Preview style -
-`if` guards in `case` blocks are now wrapped in parentheses when the line is
-too long. (#4269) - Stop moving multiline strings to a new line unless inside
-brackets (#4289) ### Integrations - Add a new option `use_pyproject` to the
-GitHub Action `psf/black`. This will read the Black version from
-`pyproject.toml`. (#4294) ## 24.3.0 ### Highlights This release is a milestone:
-it fixes Black's first CVE security vulnerability. If you run Black on
-untrusted input, or if you habitually put thousands of leading tab characters
-in your docstrings, you are strongly encouraged to upgrade immediately to fix
-[CVE-2024-21503](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-
-21503). This release also fixes a bug in Black's AST safety check that allowed
-Black to make incorrect changes to certain f-strings that are valid in Python
-3.12 and higher. ### Stable style - Don't move comments along with delimiters,
-which could cause crashes (#4248) - Strengthen AST safety check to catch more
-unsafe changes to strings. Previous versions of Black would incorrectly format
-the contents of certain unusual f-strings containing nested strings with the
-same quote type. Now, Black will crash on such strings until support for the
-new f-string syntax is implemented. (#4270) - Fix a bug where line-ranges
-exceeding the last code line would not work as expected (#4273) ### Performance
-- Fix catastrophic performance on docstrings that contain large numbers of
-leading tab characters. This fixes [CVE-2024-21503](https://cve.mitre.org/cgi-
-bin/cvename.cgi?name=CVE-2024-21503). (#4278) ### Documentation - Note what
-happens when `--check` is used with `--quiet` (#4236) ## 24.2.0 ### Stable
-style - Fixed a bug where comments where mistakenly removed along with
-redundant parentheses (#4218) ### Preview style - Move the
-`hug_parens_with_braces_and_square_brackets` feature to the unstable style due
-to an outstanding crash and proposed formatting tweaks (#4198) - Fixed a bug
-where base expressions caused inconsistent formatting of \*\* in tenary
-expression (#4154) - Checking for newline before adding one on docstring that
-is almost at the line limit (#4185) - Remove redundant parentheses in `case`
-statement `if` guards (#4214). ### Configuration - Fix issue where _Black_
-would ignore input files in the presence of symlinks (#4222) - _Black_ now
-ignores `pyproject.toml` that is missing a `tool.black` section when
+with a fish while dancing. # Change Log ## 24.4.1 ### Highlights - Add support
+for the new Python 3.12 f-string syntax introduced by PEP 701 (#3822) ###
+Stable style - Fix crash involving indented dummy functions containing newlines
+(#4318) ### Parser - Add support for type parameter defaults, a new syntactic
+feature added to Python 3.13 by PEP 696 (#4327) ### Integrations - Github
+Action now works even when `git archive` is skipped (#4313) ## 24.4.0 ###
+Stable style - Fix unwanted crashes caused by AST equivalency check (#4290) ###
+Preview style - `if` guards in `case` blocks are now wrapped in parentheses
+when the line is too long. (#4269) - Stop moving multiline strings to a new
+line unless inside brackets (#4289) ### Integrations - Add a new option
+`use_pyproject` to the GitHub Action `psf/black`. This will read the Black
+version from `pyproject.toml`. (#4294) ## 24.3.0 ### Highlights This release is
+a milestone: it fixes Black's first CVE security vulnerability. If you run
+Black on untrusted input, or if you habitually put thousands of leading tab
+characters in your docstrings, you are strongly encouraged to upgrade
+immediately to fix [CVE-2024-21503](https://cve.mitre.org/cgi-bin/
+cvename.cgi?name=CVE-2024-21503). This release also fixes a bug in Black's AST
+safety check that allowed Black to make incorrect changes to certain f-strings
+that are valid in Python 3.12 and higher. ### Stable style - Don't move
+comments along with delimiters, which could cause crashes (#4248) - Strengthen
+AST safety check to catch more unsafe changes to strings. Previous versions of
+Black would incorrectly format the contents of certain unusual f-strings
+containing nested strings with the same quote type. Now, Black will crash on
+such strings until support for the new f-string syntax is implemented. (#4270)
+- Fix a bug where line-ranges exceeding the last code line would not work as
+expected (#4273) ### Performance - Fix catastrophic performance on docstrings
+that contain large numbers of leading tab characters. This fixes [CVE-2024-
+21503](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-21503). (#4278)
+### Documentation - Note what happens when `--check` is used with `--quiet`
+(#4236) ## 24.2.0 ### Stable style - Fixed a bug where comments where
+mistakenly removed along with redundant parentheses (#4218) ### Preview style -
+Move the `hug_parens_with_braces_and_square_brackets` feature to the unstable
+style due to an outstanding crash and proposed formatting tweaks (#4198) -
+Fixed a bug where base expressions caused inconsistent formatting of \*\* in
+tenary expression (#4154) - Checking for newline before adding one on docstring
+that is almost at the line limit (#4185) - Remove redundant parentheses in
+`case` statement `if` guards (#4214). ### Configuration - Fix issue where
+_Black_ would ignore input files in the presence of symlinks (#4222) - _Black_
+now ignores `pyproject.toml` that is missing a `tool.black` section when
 discovering project root and configuration. Since _Black_ continues to use
 version control as an indicator of project root, this is expected to primarily
 change behavior for users in a monorepo setup (desirably). If you wish to
 preserve previous behavior, simply add an empty `[tool.black]` to the
 previously discovered `pyproject.toml` (#4204) ### Output - Black will swallow
 any `SyntaxWarning`s or `DeprecationWarning`s produced by the `ast` module when
 performing equivalence checks (#4189) ### Integrations - Add a JSONSchema and
```

